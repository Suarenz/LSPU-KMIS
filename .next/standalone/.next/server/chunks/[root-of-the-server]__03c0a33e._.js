module.exports=[18622,(e,r,t)=>{r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,r,t)=>{r.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,r,t)=>{r.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},29173,(e,r,t)=>{r.exports=e.x("@prisma/client",()=>require("@prisma/client"))},15270,e=>{"use strict";var r=e.i(29173);let t=globalThis.prisma||new r.PrismaClient({log:["query","info","warn","error"]});e.s(["default",0,t])},75188,e=>{"use strict";let r=new class{secret;constructor(){this.secret=process.env.JWT_SECRET||"6dFk5d0vbyLnZC0Amy83LtI47DsNr/KB4M+FgbUc6njd4cjk7XB2/8nTuhQDWW8OOgQ6fI74huxJE3a/RP2giw=="}stringToUint8Array(e){return new TextEncoder().encode(e)}uint8ArrayToBase64Url(e){let r="";for(let t=0;t<e.byteLength;t++)r+=String.fromCharCode(e[t]);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async importSecret(){let e=new TextEncoder().encode(this.secret);return await crypto.subtle.importKey("raw",e,{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"])}async generateToken(e){try{let r=Math.floor(Date.now()/1e3),t={...e,iat:r,exp:r+3600},n=this.uint8ArrayToBase64Url(this.stringToUint8Array(JSON.stringify({alg:"HS256",typ:"JWT"}))),o=this.uint8ArrayToBase64Url(this.stringToUint8Array(JSON.stringify(t))),i=`${n}.${o}`,s=await this.importSecret(),a=new TextEncoder().encode(i),l=await crypto.subtle.sign("HMAC",s,a),u=new Uint8Array(l),f=this.uint8ArrayToBase64Url(u);return`${i}.${f}`}catch(e){throw console.error("JWT token generation failed:",e),Error("Failed to generate JWT token")}}async verifyToken(e){try{if(!e||"string"!=typeof e||""===e.trim())return console.error("Invalid token provided for verification"),null;let r=e.split(".");if(3!==r.length)return console.error("Token format is invalid"),null;let[t,n,o]=r;if(!this.base64UrlDecode(t))return console.error("Failed to decode token header"),null;let i=this.base64UrlDecode(n);if(!i)return console.error("Failed to decode token payload"),null;let s=JSON.parse(i),a=Math.floor(Date.now()/1e3);if(s.exp&&s.exp<a)return console.error("Token has expired"),null;let l=await this.importSecret();if(!await this.verifySignature(`${t}.${n}`,o,l))return console.error("Token signature verification failed"),null;return s}catch(e){return console.error("Token verification failed:",e?.message||e),null}}async verifySignature(e,r,t){try{let n=this.base64UrlDecodeToUint8Array(r);if(!n)return!1;let o=new TextEncoder().encode(e),i=new Uint8Array(n.buffer,n.byteOffset,n.byteLength),s=new Uint8Array(o.buffer,o.byteOffset,o.byteLength);return await crypto.subtle.verify("HMAC",t,i,s)}catch(e){return console.error("Signature verification error:",e),!1}}decodeToken(e){try{if(!e||"string"!=typeof e||""===e.trim())return null;let r=e.split(".");if(3!==r.length)return console.error("Token format is invalid"),null;let t=r[1],n=this.base64UrlDecode(t);if(!n)return null;return JSON.parse(n)}catch(e){return console.error("Token decoding failed:",e?.message||e),null}}isTokenExpired(e){try{let r=this.decodeToken(e);if(!r||!r.exp)return!0;let t=Math.floor(Date.now()/1e3);return r.exp<t}catch(e){return console.error("Error checking token expiration:",e),!0}}base64UrlDecode(e){try{let r="=".repeat((4-e.length%4)%4),t=e.replace(/-/g,"+").replace(/_/g,"/")+r,n=atob(t);return decodeURIComponent(escape(n))}catch(e){return console.error("Base64 URL decode error:",e),null}}base64UrlDecodeToUint8Array(e){try{let r="=".repeat((4-e.length%4)%4),t=e.replace(/-/g,"+").replace(/_/g,"/")+r,n=atob(t),o=new Uint8Array(n.length);for(let e=0;e<n.length;e++)o[e]=n.charCodeAt(e);return o}catch(e){return console.error("Base64 URL decode to Uint8Array error:",e),null}}};e.s(["default",0,r])},81563,83274,e=>{"use strict";var r=e.i(89171),t=e.i(75188),n=e.i(15270);function o(e,r){return e===r}function i(e,r){return r.includes(e)}async function s(e,o){let s=e.headers.get("authorization"),a=null;if(s&&s.startsWith("Bearer "))a=s.substring(7);else{let r=e.cookies;a=r.get("access_token")?.value}if(!a)return e.nextUrl.pathname.startsWith("/api/")?r.NextResponse.json({error:"Authentication required"},{status:401}):r.NextResponse.redirect(new URL("/login",e.url));let l=await t.default.verifyToken(a);if(!l)return(console.error("Token verification failed:",a?a.substring(0,20)+"...":"null"),e.nextUrl.pathname.startsWith("/api/"))?r.NextResponse.json({error:"Invalid or expired token"},{status:401}):r.NextResponse.redirect(new URL("/",e.url));if(console.log("Decoded token:",l),!l.userId)return(console.error("Token does not contain userId:",l),e.nextUrl.pathname.startsWith("/api/"))?r.NextResponse.json({error:"Invalid token: missing user ID"},{status:401}):r.NextResponse.redirect(new URL("/login",e.url));let u=await n.default.user.findUnique({where:{id:l.userId},select:{id:!0,email:!0,name:!0,role:!0,unitId:!0}});return u?o&&o.length>0&&!i(u.role,o)?e.nextUrl.pathname.startsWith("/api/")?r.NextResponse.json({error:"User does not have required role to perform this action"},{status:403}):r.NextResponse.redirect(new URL("/unauthorized",e.url)):{user:u}:(console.error("User not found with ID from token:",l.userId),r.NextResponse.redirect(new URL("/login",e.url)))}e.s(["hasAnyRole",()=>i,"hasRole",()=>o],83274),e.s(["requireAuth",()=>s],81563)},66680,(e,r,t)=>{r.exports=e.x("node:crypto",()=>require("node:crypto"))},99359,e=>{"use strict";let r={randomUUID:e.i(66680).default.randomUUID};e.s(["default",0,r])},36689,e=>{"use strict";var r=e.i(66680);let t=new Uint8Array(256),n=t.length;function o(){return n>t.length-16&&(r.default.randomFillSync(t),n=0),t.slice(n,n+=16)}e.s(["default",()=>o])},9807,e=>{"use strict";let r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;e.s(["default",0,function(e){return"string"==typeof e&&r.test(e)}],9807)},23157,e=>{"use strict";var r=e.i(9807);let t=[];for(let e=0;e<256;++e)t.push((e+256).toString(16).slice(1));function n(e,r=0){return(t[e[r+0]]+t[e[r+1]]+t[e[r+2]]+t[e[r+3]]+"-"+t[e[r+4]]+t[e[r+5]]+"-"+t[e[r+6]]+t[e[r+7]]+"-"+t[e[r+8]]+t[e[r+9]]+"-"+t[e[r+10]]+t[e[r+11]]+t[e[r+12]]+t[e[r+13]]+t[e[r+14]]+t[e[r+15]]).toLowerCase()}e.s(["default",0,function(e,t=0){let o=n(e,t);if(!(0,r.default)(o))throw TypeError("Stringified UUID is invalid");return o},"unsafeStringify",()=>n])},29674,e=>{"use strict";var r=e.i(99359),t=e.i(36689),n=e.i(23157);e.s(["default",0,function(e,o,i){if(r.default.randomUUID&&!o&&!e)return r.default.randomUUID();let s=(e=e||{}).random||(e.rng||t.default)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,o){i=i||0;for(let e=0;e<16;++e)o[i+e]=s[e];return o}return(0,n.unsafeStringify)(s)}])},84630,e=>{"use strict";var r=e.i(36689),t=e.i(23157);let n=null,o=null,i=0;e.s(["default",0,function(e,s,a){e=e||{};let l=s&&a||0,u=s||new Uint8Array(16),f=e.random||(e.rng||r.default)(),c=void 0!==e.msecs?e.msecs:Date.now(),d=void 0!==e.seq?e.seq:null,p=o,h=n;return c>i&&void 0===e.msecs&&(i=c,null!==d&&(p=null,h=null)),null!==d&&(d>0x7fffffff&&(d=0x7fffffff),p=d>>>19&4095,h=524287&d),(null===p||null===h)&&(p=(p=127&f[6])<<8|f[7],h=(h=(h=63&f[8])<<8|f[9])<<5|f[10]>>>3),c+1e4>i&&null===d?++h>524287&&(h=0,++p>4095&&(p=0,i++)):i=c,o=p,n=h,u[l++]=i/0x10000000000&255,u[l++]=i/0x100000000&255,u[l++]=i/0x1000000&255,u[l++]=i/65536&255,u[l++]=i/256&255,u[l++]=255&i,u[l++]=p>>>4&15|112,u[l++]=255&p,u[l++]=h>>>13&63|128,u[l++]=h>>>5&255,u[l++]=h<<3&255|7&f[10],u[l++]=f[11],u[l++]=f[12],u[l++]=f[13],u[l++]=f[14],u[l++]=f[15],s||(0,t.unsafeStringify)(u)}])},65336,e=>{"use strict";var r=e.i(9807);e.s(["default",0,function(e){let t;if(!(0,r.default)(e))throw TypeError("Invalid UUID");let n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/0x10000000000&255,n[11]=t/0x100000000&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n}])},48458,e=>{"use strict";var r=e.i(23157),t=e.i(65336);function n(e,n,o){function i(e,i,s,a){var l;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));let r=[];for(let t=0;t<e.length;++t)r.push(e.charCodeAt(t));return r}(e)),"string"==typeof i&&(i=(0,t.default)(i)),(null==(l=i)?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+e.length);if(u.set(i),u.set(e,i.length),(u=o(u))[6]=15&u[6]|n,u[8]=63&u[8]|128,s){a=a||0;for(let e=0;e<16;++e)s[a+e]=u[e];return s}return(0,r.unsafeStringify)(u)}try{i.name=e}catch(e){}return i.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",i.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",i}e.s(["default",()=>n])},58982,e=>{"use strict";var r=e.i(48458),t=e.i(66680);let n=(0,r.default)("v5",80,function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),t.default.createHash("sha1").update(e).digest()});e.s(["default",0,n],58982)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__03c0a33e._.js.map