module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},29173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},15270,e=>{"use strict";var t=e.i(29173);let r=globalThis.prisma||new t.PrismaClient({log:["query","info","warn","error"]});e.s(["default",0,r])},75188,e=>{"use strict";let t=new class{secret;constructor(){this.secret=process.env.JWT_SECRET||"6dFk5d0vbyLnZC0Amy83LtI47DsNr/KB4M+FgbUc6njd4cjk7XB2/8nTuhQDWW8OOgQ6fI74huxJE3a/RP2giw=="}stringToUint8Array(e){return new TextEncoder().encode(e)}uint8ArrayToBase64Url(e){let t="";for(let r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async importSecret(){let e=new TextEncoder().encode(this.secret);return await crypto.subtle.importKey("raw",e,{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"])}async generateToken(e){try{let t=Math.floor(Date.now()/1e3),r={...e,iat:t,exp:t+3600},n=this.uint8ArrayToBase64Url(this.stringToUint8Array(JSON.stringify({alg:"HS256",typ:"JWT"}))),o=this.uint8ArrayToBase64Url(this.stringToUint8Array(JSON.stringify(r))),a=`${n}.${o}`,i=await this.importSecret(),s=new TextEncoder().encode(a),d=await crypto.subtle.sign("HMAC",i,s),l=new Uint8Array(d),u=this.uint8ArrayToBase64Url(l);return`${a}.${u}`}catch(e){throw console.error("JWT token generation failed:",e),Error("Failed to generate JWT token")}}async verifyToken(e){try{if(!e||"string"!=typeof e||""===e.trim())return console.error("Invalid token provided for verification"),null;let t=e.split(".");if(3!==t.length)return console.error("Token format is invalid"),null;let[r,n,o]=t;if(!this.base64UrlDecode(r))return console.error("Failed to decode token header"),null;let a=this.base64UrlDecode(n);if(!a)return console.error("Failed to decode token payload"),null;let i=JSON.parse(a),s=Math.floor(Date.now()/1e3);if(i.exp&&i.exp<s)return console.error("Token has expired"),null;let d=await this.importSecret();if(!await this.verifySignature(`${r}.${n}`,o,d))return console.error("Token signature verification failed"),null;return i}catch(e){return console.error("Token verification failed:",e?.message||e),null}}async verifySignature(e,t,r){try{let n=this.base64UrlDecodeToUint8Array(t);if(!n)return!1;let o=new TextEncoder().encode(e),a=new Uint8Array(n.buffer,n.byteOffset,n.byteLength),i=new Uint8Array(o.buffer,o.byteOffset,o.byteLength);return await crypto.subtle.verify("HMAC",r,a,i)}catch(e){return console.error("Signature verification error:",e),!1}}decodeToken(e){try{if(!e||"string"!=typeof e||""===e.trim())return null;let t=e.split(".");if(3!==t.length)return console.error("Token format is invalid"),null;let r=t[1],n=this.base64UrlDecode(r);if(!n)return null;return JSON.parse(n)}catch(e){return console.error("Token decoding failed:",e?.message||e),null}}isTokenExpired(e){try{let t=this.decodeToken(e);if(!t||!t.exp)return!0;let r=Math.floor(Date.now()/1e3);return t.exp<r}catch(e){return console.error("Error checking token expiration:",e),!0}}base64UrlDecode(e){try{let t="=".repeat((4-e.length%4)%4),r=e.replace(/-/g,"+").replace(/_/g,"/")+t,n=atob(r);return decodeURIComponent(escape(n))}catch(e){return console.error("Base64 URL decode error:",e),null}}base64UrlDecodeToUint8Array(e){try{let t="=".repeat((4-e.length%4)%4),r=e.replace(/-/g,"+").replace(/_/g,"/")+t,n=atob(r),o=new Uint8Array(n.length);for(let e=0;e<n.length;e++)o[e]=n.charCodeAt(e);return o}catch(e){return console.error("Base64 URL decode to Uint8Array error:",e),null}}};e.s(["default",0,t])},81563,83274,e=>{"use strict";var t=e.i(89171),r=e.i(75188),n=e.i(15270);function o(e,t){return e===t}function a(e,t){return t.includes(e)}async function i(e,o){let i=e.headers.get("authorization"),s=null;if(i&&i.startsWith("Bearer "))s=i.substring(7);else{let t=e.cookies;s=t.get("access_token")?.value}if(!s)return e.nextUrl.pathname.startsWith("/api/")?t.NextResponse.json({error:"Authentication required"},{status:401}):t.NextResponse.redirect(new URL("/login",e.url));let d=await r.default.verifyToken(s);if(!d)return(console.error("Token verification failed:",s?s.substring(0,20)+"...":"null"),e.nextUrl.pathname.startsWith("/api/"))?t.NextResponse.json({error:"Invalid or expired token"},{status:401}):t.NextResponse.redirect(new URL("/",e.url));if(console.log("Decoded token:",d),!d.userId)return(console.error("Token does not contain userId:",d),e.nextUrl.pathname.startsWith("/api/"))?t.NextResponse.json({error:"Invalid token: missing user ID"},{status:401}):t.NextResponse.redirect(new URL("/login",e.url));let l=await n.default.user.findUnique({where:{id:d.userId},select:{id:!0,email:!0,name:!0,role:!0,unitId:!0}});return l?o&&o.length>0&&!a(l.role,o)?e.nextUrl.pathname.startsWith("/api/")?t.NextResponse.json({error:"User does not have required role to perform this action"},{status:403}):t.NextResponse.redirect(new URL("/unauthorized",e.url)):{user:l}:(console.error("User not found with ID from token:",d.userId),t.NextResponse.redirect(new URL("/login",e.url)))}e.s(["hasAnyRole",()=>a,"hasRole",()=>o],83274),e.s(["requireAuth",()=>i],81563)},51615,(e,t,r)=>{t.exports=e.x("node:buffer",()=>require("node:buffer"))},2157,(e,t,r)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},81111,(e,t,r)=>{t.exports=e.x("node:stream",()=>require("node:stream"))},83522,e=>{"use strict";function t(e){if(null==e)return null;if("number"==typeof e)return Number.isFinite(e)?e:null;let t=String(e).replace(/,/g,"").trim();if(!t)return null;let r=Number(t);return Number.isFinite(r)?r:null}function r(e){return String(e||"").replace(/\s+/g,"")}function n(e){let t=String(e||"").trim().replace(/\s+/g," "),r=t.match(/^KRA\s*(\d+)$/i);return r?`KRA ${r[1]}`:t}function o(e,o,a,i){let s=function(e,t,o){if(!t||!o)return null;let a=e?.kras||[],i=n(t),s=a.find(e=>n(e.kra_id)===i);if(!s?.initiatives)return null;let d=r(String(o)),l=s.initiatives.find(e=>r(String(e.id))===d);if(!l){let e=String(o).match(/KPI(\d+)/i);e&&(l=s.initiatives.find(t=>String(t.id).includes(`KPI${e[1]}`)))}return l||null}(e,o,a),d=s?.targets?.type??null,l="string"==typeof s?.targets?.unit_basis?s.targets.unit_basis:null,u=s?.targets?.target_scope==="PER_UNIT"?"PER_UNIT":"INSTITUTIONAL";return{targetType:d,targetValue:function(e,r){if(!Array.isArray(e)||0===e.length)return null;let n=e.find(e=>Number(e?.year)===r),o=t(n?.target_value);if(null!==o)return o;let a=e.map(e=>({year:Number(e?.year),target:t(e?.target_value)})).filter(e=>Number.isFinite(e.year)&&null!==e.target),i=a.filter(e=>e.year<=r).sort((e,t)=>t.year-e.year);if(i.length>0)return i[0].target;let s=a.sort((e,t)=>e.year-t.year);return s.length>0?s[0].target:null}(s?.targets?.timeline_data||[],i),targetScope:u,unitBasis:l}}function a(e){return e.reduce((e,t)=>e+("number"==typeof t&&Number.isFinite(t)?t:0),0)}function i(e){let{targetType:r,targetValue:n,targetScope:o="INSTITUTIONAL",unitMultiplier:i,activities:s}=e,d=String(r||"").toLowerCase(),l="PER_UNIT"===o?n*("number"==typeof i&&Number.isFinite(i)?i:1):n;if("percentage"===d){let e,r=0===(e=s.map(e=>{let r=t(e.reported);if(null===r)return null;if(r>=0&&r<=100)return r;let n=t(e.target);if(null!==n&&n>0&&r>=0){let e=r/n*100;if(e>=0&&e<=100)return e}return null}).filter(e=>"number"==typeof e&&Number.isFinite(e))).length?0:e.reduce((e,t)=>e+t,0)/e.length;return{totalReported:r,totalTarget:l,achievementPercent:l>0?r/l*100:0}}if("financial"===d||"count"===d){let e=a(s.map(e=>t(e.reported)));0===e&&s.length>0&&"count"===d&&(e=s.length);let r=l>0?e/l*100:0;return{totalReported:e,totalTarget:l,achievementPercent:r}}if("milestone"===d||"text_condition"===d){let e=s.some(e=>{let t=e.reported;return"number"==typeof t?t>0:"string"==typeof t&&t.trim().length>0});return{totalReported:+!!e,totalTarget:1,achievementPercent:100*!!e}}let u=a(s.map(e=>t(e.reported)));0===u&&s.length>0&&(u=s.length);let c=l>0?u/l*100:0;return{totalReported:u,totalTarget:l,achievementPercent:c}}e.s(["computeAggregatedAchievement",()=>i,"getInitiativeTargetMeta",()=>o,"normalizeKraId",()=>n])},68626,e=>{"use strict";var t=e.i(15270);let r=new(e.i(92674)).default,n=new class{async getDocuments(e=1,r=10,n,o,a,i,s="desc",d,l,u){let c={status:"ACTIVE"};if(n&&"all"!==n&&(c.category=n),d&&(c.unitId=d),l&&(c.year=l),u&&(c.quarter=u),o){let e={OR:[{title:{contains:o,mode:"insensitive"}},{description:{contains:o,mode:"insensitive"}},{tags:{array_contains:[o]}}]};Object.keys(c).length>1?(c.AND=c.AND||[],c.AND.push(e)):Object.assign(c,e)}if(a){let e=await t.default.user.findUnique({where:{id:a}});if(e&&"ADMIN"!==e.role&&"FACULTY"!==e.role){let t={OR:[{uploadedById:e.id},{permissions:{some:{userId:e.id,permission:{in:["READ","WRITE","ADMIN"]}}}}]};Object.keys(c).length>1?(c.AND=c.AND||[],c.AND.push(t)):Object.assign(c,t)}}try{let[n,o]=await Promise.all([t.default.document.findMany({where:c,skip:(e-1)*r,take:r,orderBy:i?{[i]:s}:{uploadedAt:"desc"},include:{uploadedByUser:!0,documentUnit:!0}}),t.default.document.count({where:c})]);return{documents:n.map(e=>({...e,tags:Array.isArray(e.tags)?e.tags:[],unitId:e.unitId??void 0,blobName:e.blobName??void 0,year:e.year??void 0,quarter:e.quarter??void 0,isQproDocument:e.isQproDocument??!1,versionNotes:e.versionNotes??void 0,uploadedBy:e.uploadedByUser?.name||e.uploadedBy,status:e.status,unit:e.documentUnit?{id:e.documentUnit.id,name:e.documentUnit.name,code:e.documentUnit.code,description:e.documentUnit.description||void 0,createdAt:e.documentUnit.createdAt,updatedAt:e.documentUnit.updatedAt}:void 0,uploadedAt:new Date(e.uploadedAt),createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),colivaraDocumentId:e.colivaraDocumentId??void 0,colivaraProcessingStatus:e.colivaraProcessingStatus??void 0,colivaraProcessedAt:e.colivaraProcessedAt?new Date(e.colivaraProcessedAt):void 0,colivaraChecksum:e.colivaraChecksum??void 0})),total:o}}catch(e){throw console.error("Database connection error in getDocuments:",e),e}}async getDocumentById(e,r){try{let n=await t.default.document.findUnique({where:{id:e},include:{uploadedByUser:!0,documentUnit:!0}});if(!n)return null;if(r){let o=await t.default.user.findUnique({where:{id:r}});if(o&&"ADMIN"!==o.role&&"FACULTY"!==o.role&&!await t.default.documentPermission.findFirst({where:{documentId:e,userId:o.id,permission:{in:["READ","WRITE","ADMIN"]}}})&&n.uploadedById!==o.id)return null}return{id:n.id,title:n.title,description:n.description,category:n.category,tags:Array.isArray(n.tags)?n.tags:[],uploadedBy:n.uploadedByUser?.name||n.uploadedBy,uploadedById:n.uploadedById,uploadedAt:new Date(n.uploadedAt),fileUrl:n.fileUrl,blobName:n.blobName??void 0,fileName:n.fileName,fileType:n.fileType,fileSize:n.fileSize,downloadsCount:n.downloadsCount||0,viewsCount:n.viewsCount||0,version:n.version||1,versionNotes:n.versionNotes||void 0,status:n.status,createdAt:new Date(n.createdAt),updatedAt:new Date(n.updatedAt),unitId:n.unitId||void 0,year:n.year??void 0,quarter:n.quarter??void 0,isQproDocument:n.isQproDocument??!1,unit:n.documentUnit?{id:n.documentUnit.id,name:n.documentUnit.name,code:n.documentUnit.code||"",description:n.documentUnit.description||void 0,createdAt:n.documentUnit.createdAt,updatedAt:n.documentUnit.updatedAt}:void 0,colivaraDocumentId:n.colivaraDocumentId??void 0,colivaraProcessingStatus:n.colivaraProcessingStatus??void 0,colivaraProcessedAt:n.colivaraProcessedAt?new Date(n.colivaraProcessedAt):void 0,colivaraChecksum:n.colivaraChecksum??void 0}}catch(e){throw console.error("Database connection error in getDocumentById:",e),e}}async createDocument(e,n,o,a,i,s,d,l,u,c,p,m,f,y){try{if(console.log("Creating document in database...",{title:e,description:n,category:o,tags:a,uploadedBy:i,fileUrl:s,fileName:d,fileType:l,fileSize:u,userId:c}),!c)throw console.error("No userId provided to createDocument function"),Error("User ID is required to upload documents");console.log("Attempting to find user with ID:",c);let g=await t.default.user.findUnique({where:{id:c}});if(!g)throw console.error("User not found with provided ID:",c),Error("Only admins and faculty can upload documents");if(console.log("User lookup result:",{user:!!g,role:g?.role,id:g?.id}),!g||!["ADMIN","FACULTY"].includes(g.role))throw console.error("User does not have required role to upload documents:",g?.role),Error("Only admins and faculty can upload documents");let v=await t.default.document.create({data:{title:e,description:n||"",category:o||"Uncategorized",tags:a||[],uploadedBy:g.name,uploadedById:g.id,fileUrl:s,blobName:f||void 0,fileName:d,fileType:l,fileSize:u,unitId:p||null,year:y?.year||null,quarter:y?.quarter||null,isQproDocument:y?.isQproDocument||!1,status:"ACTIVE",colivaraProcessingStatus:"PENDING"}});console.log("Document created:",v.id),await t.default.documentPermission.create({data:{documentId:v.id,userId:g.id,permission:"ADMIN"}}),console.log("Document permissions granted");let h=await t.default.document.findUnique({where:{id:v.id},include:{uploadedByUser:!0,documentUnit:!0}});if(!h)throw Error(`Document with id ${v.id} not found after creation`);if(y?.isQproDocument)console.log(`[EnhancedDocumentService] Skipping background Colivara processing for QPRO document ${v.id} - handled by upload route`);else try{r.processNewDocument(h,s,m)}catch(e){console.error(`Error triggering Colivara processing for document ${v.id}:`,e)}return{id:h.id,title:h.title,description:h.description,category:h.category,tags:Array.isArray(h.tags)?h.tags:[],uploadedBy:h.uploadedByUser?.name||h.uploadedBy,uploadedById:h.uploadedById,uploadedAt:new Date(h.uploadedAt),fileUrl:h.fileUrl,blobName:h.blobName??void 0,fileName:h.fileName,fileType:h.fileType,fileSize:h.fileSize,downloadsCount:h.downloadsCount||0,viewsCount:h.viewsCount||0,version:h.version||1,versionNotes:h.versionNotes??void 0,status:h.status,createdAt:new Date(h.createdAt),updatedAt:new Date(h.updatedAt),unitId:h.unitId??void 0,year:h.year??void 0,quarter:h.quarter??void 0,isQproDocument:h.isQproDocument??!1,unit:h.documentUnit?{id:h.documentUnit.id,name:h.documentUnit.name,code:h.documentUnit.code||"",description:h.documentUnit.description||void 0,createdAt:h.documentUnit.createdAt,updatedAt:h.documentUnit.updatedAt}:void 0,colivaraDocumentId:h.colivaraDocumentId??void 0,colivaraProcessingStatus:h.colivaraProcessingStatus??void 0,colivaraProcessedAt:h.colivaraProcessedAt?new Date(h.colivaraProcessedAt):void 0,colivaraChecksum:h.colivaraChecksum??void 0}}catch(e){throw console.error("Database connection error in createDocument:",e),e}}async updateDocument(e,n,o,a,i,s,d,l,u){try{let c=await t.default.document.findUnique({where:{id:e}});if(!c)return null;let p=null,m=null;if(d&&(m=await t.default.user.findUnique({where:{id:d}}))&&(p=await t.default.documentPermission.findFirst({where:{documentId:e,userId:m.id,permission:{in:["WRITE","ADMIN"]}}})),d&&!p&&m?.role!=="ADMIN"&&c.uploadedById!==m?.id)throw Error("User does not have permission to update this document");let f=await t.default.document.update({where:{id:e},data:{...n&&{title:n},...void 0!==o&&{description:o||""},...void 0!==a&&{category:a||"Uncategorized"},...void 0!==i&&{tags:i||[]},...void 0!==s&&{unitId:s},updatedAt:new Date},include:{uploadedByUser:!0,documentUnit:!0}});if(!f)throw Error(`Document with id ${e} not found after update`);if(l)try{r.handleDocumentUpdate(e,f,l,u)}catch(t){console.error(`Error triggering Colivara reprocessing for document ${e}:`,t)}return{id:f.id,title:f.title,description:f.description,category:f.category,tags:Array.isArray(f.tags)?f.tags:[],uploadedBy:f.uploadedByUser?.name||f.uploadedBy,uploadedById:f.uploadedById,uploadedAt:new Date(f.uploadedAt),fileUrl:f.fileUrl,fileName:f.fileName,fileType:f.fileType,fileSize:f.fileSize,downloadsCount:f.downloadsCount||0,viewsCount:f.viewsCount||0,version:f.version||1,versionNotes:f.versionNotes??void 0,status:f.status,createdAt:new Date(f.createdAt),updatedAt:new Date(f.updatedAt),unitId:f.unitId??void 0,unit:f.documentUnit?{id:f.documentUnit.id,name:f.documentUnit.name,code:f.documentUnit.code||"",description:f.documentUnit.description||void 0,createdAt:f.documentUnit.createdAt,updatedAt:f.documentUnit.updatedAt}:void 0,colivaraDocumentId:f.colivaraDocumentId??void 0,colivaraProcessingStatus:f.colivaraProcessingStatus??void 0,colivaraProcessedAt:f.colivaraProcessedAt?new Date(f.colivaraProcessedAt):void 0,colivaraChecksum:f.colivaraChecksum??void 0}}catch(e){throw console.error("Database connection error in updateDocument:",e),e}}async getDocumentsByUnit(e,t=1,r=10,n){return this.getDocuments(t,r,void 0,void 0,n,void 0,"desc",e)}async getAdminDocumentsByUnit(e,r=1,n=10,o){let a={status:"ACTIVE",unitId:e};if(o){let e=await t.default.user.findUnique({where:{id:o}});if(e&&"ADMIN"===e.role);else if(e&&"FACULTY"!==e.role){let t={OR:[{uploadedById:e.id},{permissions:{some:{userId:e.id,permission:{in:["READ","WRITE","ADMIN"]}}}}]};Object.keys(a).length>1?(a.AND=a.AND||[],a.AND.push(t)):Object.assign(a,t)}}try{let[e,o]=await Promise.all([t.default.document.findMany({where:a,skip:(r-1)*n,take:n,orderBy:{uploadedAt:"desc"},include:{uploadedByUser:!0,documentUnit:!0}}),t.default.document.count({where:a})]);return{documents:e.map(e=>({...e,tags:Array.isArray(e.tags)?e.tags:[],unitId:e.unitId??void 0,versionNotes:e.versionNotes??void 0,uploadedBy:e.uploadedByUser?.name||e.uploadedBy,status:e.status,unit:e.documentUnit?{id:e.documentUnit.id,name:e.documentUnit.name,code:e.documentUnit.code||"",description:e.documentUnit.description||void 0,createdAt:e.documentUnit.createdAt,updatedAt:e.documentUnit.updatedAt}:void 0,uploadedAt:new Date(e.uploadedAt),createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),colivaraDocumentId:e.colivaraDocumentId??void 0,colivaraProcessingStatus:e.colivaraProcessingStatus??void 0,colivaraProcessedAt:e.colivaraProcessedAt?new Date(e.colivaraProcessedAt):void 0,colivaraChecksum:e.colivaraChecksum??void 0})),total:o}}catch(e){throw console.error("Database connection error in getAdminDocumentsByUnit:",e),e}}async getUserUnitPermissions(e,t){return null}async searchDocuments(e,t,r,n,o,a=1,i=10){return this.getDocuments(a,i,r,e,o,void 0,"desc",t)}};e.s(["default",0,n])},99793,e=>{"use strict";var t=e.i(47909),r=e.i(74017),n=e.i(96250),o=e.i(59756),a=e.i(61916),i=e.i(14444),s=e.i(37092),d=e.i(69741),l=e.i(16795),u=e.i(87718),c=e.i(95169),p=e.i(47587),m=e.i(66012),f=e.i(70101),y=e.i(26937),g=e.i(10372),v=e.i(93695);e.i(52474);var h=e.i(220),A=e.i(89171),w=e.i(81563),U=e.i(42513),D=e.i(68626);async function I(e,{params:t}){try{let r=await (0,w.requireAuth)(e);if("status"in r)return r;let n=r.user,{id:o}=await t;if(!o||Array.isArray(o))return A.NextResponse.json({error:"Invalid document ID"},{status:400});console.log(`[Document Analysis] Starting QPRO analysis for document ${o}`);let a=await D.default.getDocumentById(o);if(!a)return A.NextResponse.json({error:"Document not found"},{status:404});if(n.id!==a.uploadedById&&"ADMIN"!==n.role)return A.NextResponse.json({error:"Unauthorized to analyze this document"},{status:403});let i=a.fileType.toLowerCase().includes("pdf")?"PDF":"DOCX",s=await U.qproAnalysisService.createQPROAnalysis({documentId:a.id,documentTitle:a.title,documentPath:a.fileUrl,documentType:i,uploadedById:n.id,unitId:a.unitId,year:new Date().getFullYear(),quarter:Math.ceil((new Date().getMonth()+1)/3)});return console.log(`[Document Analysis] Analysis completed for document ${o}:`,s.id),A.NextResponse.json(s,{status:201})}catch(t){console.error("[Document Analysis] Error analyzing document:",t);let e=t instanceof Error?t.message:"Failed to analyze document";return A.NextResponse.json({error:e},{status:500})}}async function R(e,{params:t}){try{let r=await (0,w.requireAuth)(e);if("status"in r)return r;let n=r.user,{id:o}=await t;if(!o||Array.isArray(o))return A.NextResponse.json({error:"Invalid document ID"},{status:400});let a=(await U.qproAnalysisService.getQPROAnalysesByDocument(o)).filter(e=>e.uploadedById===n.id||"ADMIN"===n.role);return A.NextResponse.json({analyses:a})}catch(e){return console.error("[Document Analysis] Error fetching document analyses:",e),A.NextResponse.json({error:"Failed to fetch document analyses"},{status:500})}}e.s(["GET",()=>R,"POST",()=>I],87869);var x=e.i(87869);let N=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/documents/[id]/analyze/route",pathname:"/api/documents/[id]/analyze",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/documents/[id]/analyze/route.ts",nextConfigOutput:"standalone",userland:x}),{workAsyncStorage:b,workUnitAsyncStorage:T,serverHooks:C}=N;function E(){return(0,n.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:T})}async function P(e,t,n){N.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let A="/api/documents/[id]/analyze/route";A=A.replace(/\/index$/,"")||"/";let w=await N.prepare(e,t,{srcPage:A,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:U,params:D,nextConfig:I,parsedUrl:R,isDraftMode:x,prerenderManifest:b,routerServerContext:T,isOnDemandRevalidate:C,revalidateOnlyGenerated:E,resolvedPathname:P,clientReferenceManifest:k,serverActionsManifest:S}=w,B=(0,d.normalizeAppPath)(A),q=!!(b.dynamicRoutes[B]||b.routes[P]),O=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,R,!1):t.end("This page could not be found"),null);if(q&&!x){let e=!!b.routes[P],t=b.dynamicRoutes[B];if(t&&!1===t.fallback&&!e){if(I.experimental.adapterPath)return await O();throw new v.NoFallbackError}}let M=null;!q||N.isDev||x||(M="/index"===(M=P)?"/":M);let j=!0===N.isDev||!q,_=q&&!j;S&&k&&(0,i.setReferenceManifestsSingleton)({page:A,clientReferenceManifest:k,serverActionsManifest:S,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:S})});let F=e.method||"GET",L=(0,a.getTracer)(),$=L.getActiveScopeSpan(),H={params:D,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!I.experimental.authInterrupts},cacheComponents:!!I.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:I.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>N.onRequestError(e,t,n,T)},sharedContext:{buildId:U}},z=new l.NodeNextRequest(e),W=new l.NodeNextResponse(t),K=u.NextRequestAdapter.fromNodeNextRequest(z,(0,u.signalFromNodeResponse)(t));try{let i=async e=>N.handle(K,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${F} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${A}`)}),s=!!(0,o.getRequestMeta)(e,"minimalMode"),d=async o=>{var a,d;let l=async({previousCacheEntry:r})=>{try{if(!s&&C&&E&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await i(o);e.fetchMetrics=H.renderOpts.fetchMetrics;let d=H.renderOpts.pendingWaitUntil;d&&n.waitUntil&&(n.waitUntil(d),d=void 0);let l=H.renderOpts.collectedTags;if(!q)return await (0,m.sendResponse)(z,W,a,H.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(a.headers);l&&(t[g.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,n=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:A,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:C})},T),t}},u=await N.handleResponse({req:e,nextConfig:I,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:E,responseGenerator:l,waitUntil:n.waitUntil,isMinimalMode:s});if(!q)return null;if((null==u||null==(a=u.value)?void 0:a.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",C?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,f.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&q||c.delete(g.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,y.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(z,W,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};$?await d($):await L.withPropagatedContext(e.headers,()=>L.trace(c.BaseServerSpan.handleRequest,{spanName:`${F} ${A}`,kind:a.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},d))}catch(t){if(t instanceof v.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:B,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:C})}),q)throw t;return await (0,m.sendResponse)(z,W,new Response(null,{status:500})),null}}e.s(["handler",()=>P,"patchFetch",()=>E,"routeModule",()=>N,"serverHooks",()=>C,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>T],99793)},34695,e=>{e.v(e=>Promise.resolve().then(()=>e(23257)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__720c0475._.js.map