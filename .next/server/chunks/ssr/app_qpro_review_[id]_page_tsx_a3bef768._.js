module.exports=[3090,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(21937),f=a.i(10815),g=a.i(40695),h=a.i(3130),i=a.i(96221),j=a.i(13749),k=a.i(65733),l=a.i(30553),m=a.i(77192),n=a.i(50104),o=a.i(70121),p=a.i(46872),q=a.i(7827),r=a.i(72752),s=a.i(30656),t=a.i(7554),u="ScrollArea",[v,w]=(0,n.createContextScope)(u),[x,y]=v(u),z=c.forwardRef((a,d)=>{let{__scopeScrollArea:e,type:f="hover",dir:g,scrollHideDelay:h=600,...i}=a,[j,k]=c.useState(null),[m,n]=c.useState(null),[p,r]=c.useState(null),[s,t]=c.useState(null),[u,v]=c.useState(null),[w,y]=c.useState(0),[z,A]=c.useState(0),[B,C]=c.useState(!1),[D,E]=c.useState(!1),F=(0,o.useComposedRefs)(d,a=>k(a)),G=(0,q.useDirection)(g);return(0,b.jsx)(x,{scope:e,type:f,dir:G,scrollHideDelay:h,scrollArea:j,viewport:m,onViewportChange:n,content:p,onContentChange:r,scrollbarX:s,onScrollbarXChange:t,scrollbarXEnabled:B,onScrollbarXEnabledChange:C,scrollbarY:u,onScrollbarYChange:v,scrollbarYEnabled:D,onScrollbarYEnabledChange:E,onCornerWidthChange:y,onCornerHeightChange:A,children:(0,b.jsx)(l.Primitive.div,{dir:G,...i,ref:F,style:{position:"relative","--radix-scroll-area-corner-width":w+"px","--radix-scroll-area-corner-height":z+"px",...a.style}})})});z.displayName=u;var A="ScrollAreaViewport",B=c.forwardRef((a,d)=>{let{__scopeScrollArea:e,children:f,nonce:g,...h}=a,i=y(A,e),j=c.useRef(null),k=(0,o.useComposedRefs)(d,j,i.onViewportChange);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:g}),(0,b.jsx)(l.Primitive.div,{"data-radix-scroll-area-viewport":"",...h,ref:k,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...a.style},children:(0,b.jsx)("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:f})})]})});B.displayName=A;var C="ScrollAreaScrollbar",D=c.forwardRef((a,d)=>{let{forceMount:e,...f}=a,g=y(C,a.__scopeScrollArea),{onScrollbarXEnabledChange:h,onScrollbarYEnabledChange:i}=g,j="horizontal"===a.orientation;return c.useEffect(()=>(j?h(!0):i(!0),()=>{j?h(!1):i(!1)}),[j,h,i]),"hover"===g.type?(0,b.jsx)(E,{...f,ref:d,forceMount:e}):"scroll"===g.type?(0,b.jsx)(F,{...f,ref:d,forceMount:e}):"auto"===g.type?(0,b.jsx)(G,{...f,ref:d,forceMount:e}):"always"===g.type?(0,b.jsx)(H,{...f,ref:d}):null});D.displayName=C;var E=c.forwardRef((a,d)=>{let{forceMount:e,...f}=a,g=y(C,a.__scopeScrollArea),[h,i]=c.useState(!1);return c.useEffect(()=>{let a=g.scrollArea,b=0;if(a){let c=()=>{window.clearTimeout(b),i(!0)},d=()=>{b=window.setTimeout(()=>i(!1),g.scrollHideDelay)};return a.addEventListener("pointerenter",c),a.addEventListener("pointerleave",d),()=>{window.clearTimeout(b),a.removeEventListener("pointerenter",c),a.removeEventListener("pointerleave",d)}}},[g.scrollArea,g.scrollHideDelay]),(0,b.jsx)(m.Presence,{present:e||h,children:(0,b.jsx)(G,{"data-state":h?"visible":"hidden",...f,ref:d})})}),F=c.forwardRef((a,d)=>{var e;let{forceMount:f,...g}=a,h=y(C,a.__scopeScrollArea),i="horizontal"===a.orientation,j=Z(()=>l("SCROLL_END"),100),[k,l]=(e={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},c.useReducer((a,b)=>e[a][b]??a,"hidden"));return c.useEffect(()=>{if("idle"===k){let a=window.setTimeout(()=>l("HIDE"),h.scrollHideDelay);return()=>window.clearTimeout(a)}},[k,h.scrollHideDelay,l]),c.useEffect(()=>{let a=h.viewport,b=i?"scrollLeft":"scrollTop";if(a){let c=a[b],d=()=>{let d=a[b];c!==d&&(l("SCROLL"),j()),c=d};return a.addEventListener("scroll",d),()=>a.removeEventListener("scroll",d)}},[h.viewport,i,l,j]),(0,b.jsx)(m.Presence,{present:f||"hidden"!==k,children:(0,b.jsx)(H,{"data-state":"hidden"===k?"hidden":"visible",...g,ref:d,onPointerEnter:(0,t.composeEventHandlers)(a.onPointerEnter,()=>l("POINTER_ENTER")),onPointerLeave:(0,t.composeEventHandlers)(a.onPointerLeave,()=>l("POINTER_LEAVE"))})})}),G=c.forwardRef((a,d)=>{let e=y(C,a.__scopeScrollArea),{forceMount:f,...g}=a,[h,i]=c.useState(!1),j="horizontal"===a.orientation,k=Z(()=>{if(e.viewport){let a=e.viewport.offsetWidth<e.viewport.scrollWidth,b=e.viewport.offsetHeight<e.viewport.scrollHeight;i(j?a:b)}},10);return $(e.viewport,k),$(e.content,k),(0,b.jsx)(m.Presence,{present:f||h,children:(0,b.jsx)(H,{"data-state":h?"visible":"hidden",...g,ref:d})})}),H=c.forwardRef((a,d)=>{let{orientation:e="vertical",...f}=a,g=y(C,a.__scopeScrollArea),h=c.useRef(null),i=c.useRef(0),[j,k]=c.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),l=U(j.viewport,j.content),m={...f,sizes:j,onSizesChange:k,hasThumb:!!(l>0&&l<1),onThumbChange:a=>h.current=a,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:a=>i.current=a};function n(a,b){return function(a,b,c,d="ltr"){let e=V(c),f=b||e/2,g=c.scrollbar.paddingStart+f,h=c.scrollbar.size-c.scrollbar.paddingEnd-(e-f),i=c.content-c.viewport;return X([g,h],"ltr"===d?[0,i]:[-1*i,0])(a)}(a,i.current,j,b)}return"horizontal"===e?(0,b.jsx)(I,{...m,ref:d,onThumbPositionChange:()=>{if(g.viewport&&h.current){let a=W(g.viewport.scrollLeft,j,g.dir);h.current.style.transform=`translate3d(${a}px, 0, 0)`}},onWheelScroll:a=>{g.viewport&&(g.viewport.scrollLeft=a)},onDragScroll:a=>{g.viewport&&(g.viewport.scrollLeft=n(a,g.dir))}}):"vertical"===e?(0,b.jsx)(J,{...m,ref:d,onThumbPositionChange:()=>{if(g.viewport&&h.current){let a=W(g.viewport.scrollTop,j);h.current.style.transform=`translate3d(0, ${a}px, 0)`}},onWheelScroll:a=>{g.viewport&&(g.viewport.scrollTop=a)},onDragScroll:a=>{g.viewport&&(g.viewport.scrollTop=n(a))}}):null}),I=c.forwardRef((a,d)=>{let{sizes:e,onSizesChange:f,...g}=a,h=y(C,a.__scopeScrollArea),[i,j]=c.useState(),k=c.useRef(null),l=(0,o.useComposedRefs)(d,k,h.onScrollbarXChange);return c.useEffect(()=>{k.current&&j(getComputedStyle(k.current))},[k]),(0,b.jsx)(M,{"data-orientation":"horizontal",...g,ref:l,sizes:e,style:{bottom:0,left:"rtl"===h.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===h.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":V(e)+"px",...a.style},onThumbPointerDown:b=>a.onThumbPointerDown(b.x),onDragScroll:b=>a.onDragScroll(b.x),onWheelScroll:(b,c)=>{if(h.viewport){var d,e;let f=h.viewport.scrollLeft+b.deltaX;a.onWheelScroll(f),d=f,e=c,d>0&&d<e&&b.preventDefault()}},onResize:()=>{k.current&&h.viewport&&i&&f({content:h.viewport.scrollWidth,viewport:h.viewport.offsetWidth,scrollbar:{size:k.current.clientWidth,paddingStart:T(i.paddingLeft),paddingEnd:T(i.paddingRight)}})}})}),J=c.forwardRef((a,d)=>{let{sizes:e,onSizesChange:f,...g}=a,h=y(C,a.__scopeScrollArea),[i,j]=c.useState(),k=c.useRef(null),l=(0,o.useComposedRefs)(d,k,h.onScrollbarYChange);return c.useEffect(()=>{k.current&&j(getComputedStyle(k.current))},[k]),(0,b.jsx)(M,{"data-orientation":"vertical",...g,ref:l,sizes:e,style:{top:0,right:"ltr"===h.dir?0:void 0,left:"rtl"===h.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":V(e)+"px",...a.style},onThumbPointerDown:b=>a.onThumbPointerDown(b.y),onDragScroll:b=>a.onDragScroll(b.y),onWheelScroll:(b,c)=>{if(h.viewport){var d,e;let f=h.viewport.scrollTop+b.deltaY;a.onWheelScroll(f),d=f,e=c,d>0&&d<e&&b.preventDefault()}},onResize:()=>{k.current&&h.viewport&&i&&f({content:h.viewport.scrollHeight,viewport:h.viewport.offsetHeight,scrollbar:{size:k.current.clientHeight,paddingStart:T(i.paddingTop),paddingEnd:T(i.paddingBottom)}})}})}),[K,L]=v(C),M=c.forwardRef((a,d)=>{let{__scopeScrollArea:e,sizes:f,hasThumb:g,onThumbChange:h,onThumbPointerUp:i,onThumbPointerDown:j,onThumbPositionChange:k,onDragScroll:m,onWheelScroll:n,onResize:q,...r}=a,s=y(C,e),[u,v]=c.useState(null),w=(0,o.useComposedRefs)(d,a=>v(a)),x=c.useRef(null),z=c.useRef(""),A=s.viewport,B=f.content-f.viewport,D=(0,p.useCallbackRef)(n),E=(0,p.useCallbackRef)(k),F=Z(q,10);function G(a){x.current&&m({x:a.clientX-x.current.left,y:a.clientY-x.current.top})}return c.useEffect(()=>{let a=a=>{let b=a.target;u?.contains(b)&&D(a,B)};return document.addEventListener("wheel",a,{passive:!1}),()=>document.removeEventListener("wheel",a,{passive:!1})},[A,u,B,D]),c.useEffect(E,[f,E]),$(u,F),$(s.content,F),(0,b.jsx)(K,{scope:e,scrollbar:u,hasThumb:g,onThumbChange:(0,p.useCallbackRef)(h),onThumbPointerUp:(0,p.useCallbackRef)(i),onThumbPositionChange:E,onThumbPointerDown:(0,p.useCallbackRef)(j),children:(0,b.jsx)(l.Primitive.div,{...r,ref:w,style:{position:"absolute",...r.style},onPointerDown:(0,t.composeEventHandlers)(a.onPointerDown,a=>{0===a.button&&(a.target.setPointerCapture(a.pointerId),x.current=u.getBoundingClientRect(),z.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",s.viewport&&(s.viewport.style.scrollBehavior="auto"),G(a))}),onPointerMove:(0,t.composeEventHandlers)(a.onPointerMove,G),onPointerUp:(0,t.composeEventHandlers)(a.onPointerUp,a=>{let b=a.target;b.hasPointerCapture(a.pointerId)&&b.releasePointerCapture(a.pointerId),document.body.style.webkitUserSelect=z.current,s.viewport&&(s.viewport.style.scrollBehavior=""),x.current=null})})})}),N="ScrollAreaThumb",O=c.forwardRef((a,c)=>{let{forceMount:d,...e}=a,f=L(N,a.__scopeScrollArea);return(0,b.jsx)(m.Presence,{present:d||f.hasThumb,children:(0,b.jsx)(P,{ref:c,...e})})}),P=c.forwardRef((a,d)=>{let{__scopeScrollArea:e,style:f,...g}=a,h=y(N,e),i=L(N,e),{onThumbPositionChange:j}=i,k=(0,o.useComposedRefs)(d,a=>i.onThumbChange(a)),m=c.useRef(void 0),n=Z(()=>{m.current&&(m.current(),m.current=void 0)},100);return c.useEffect(()=>{let a=h.viewport;if(a){let b=()=>{n(),m.current||(m.current=Y(a,j),j())};return j(),a.addEventListener("scroll",b),()=>a.removeEventListener("scroll",b)}},[h.viewport,n,j]),(0,b.jsx)(l.Primitive.div,{"data-state":i.hasThumb?"visible":"hidden",...g,ref:k,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...f},onPointerDownCapture:(0,t.composeEventHandlers)(a.onPointerDownCapture,a=>{let b=a.target.getBoundingClientRect(),c=a.clientX-b.left,d=a.clientY-b.top;i.onThumbPointerDown({x:c,y:d})}),onPointerUp:(0,t.composeEventHandlers)(a.onPointerUp,i.onThumbPointerUp)})});O.displayName=N;var Q="ScrollAreaCorner",R=c.forwardRef((a,c)=>{let d=y(Q,a.__scopeScrollArea),e=!!(d.scrollbarX&&d.scrollbarY);return"scroll"!==d.type&&e?(0,b.jsx)(S,{...a,ref:c}):null});R.displayName=Q;var S=c.forwardRef((a,d)=>{let{__scopeScrollArea:e,...f}=a,g=y(Q,e),[h,i]=c.useState(0),[j,k]=c.useState(0),m=!!(h&&j);return $(g.scrollbarX,()=>{let a=g.scrollbarX?.offsetHeight||0;g.onCornerHeightChange(a),k(a)}),$(g.scrollbarY,()=>{let a=g.scrollbarY?.offsetWidth||0;g.onCornerWidthChange(a),i(a)}),m?(0,b.jsx)(l.Primitive.div,{...f,ref:d,style:{width:h,height:j,position:"absolute",right:"ltr"===g.dir?0:void 0,left:"rtl"===g.dir?0:void 0,bottom:0,...a.style}}):null});function T(a){return a?parseInt(a,10):0}function U(a,b){let c=a/b;return isNaN(c)?0:c}function V(a){let b=U(a.viewport,a.content),c=a.scrollbar.paddingStart+a.scrollbar.paddingEnd;return Math.max((a.scrollbar.size-c)*b,18)}function W(a,b,c="ltr"){let d=V(b),e=b.scrollbar.paddingStart+b.scrollbar.paddingEnd,f=b.scrollbar.size-e,g=b.content-b.viewport,h=(0,s.clamp)(a,"ltr"===c?[0,g]:[-1*g,0]);return X([0,g],[0,f-d])(h)}function X(a,b){return c=>{if(a[0]===a[1]||b[0]===b[1])return b[0];let d=(b[1]-b[0])/(a[1]-a[0]);return b[0]+d*(c-a[0])}}var Y=(a,b=()=>{})=>{let c={left:a.scrollLeft,top:a.scrollTop},d=0;return!function e(){let f={left:a.scrollLeft,top:a.scrollTop},g=c.left!==f.left,h=c.top!==f.top;(g||h)&&b(),c=f,d=window.requestAnimationFrame(e)}(),()=>window.cancelAnimationFrame(d)};function Z(a,b){let d=(0,p.useCallbackRef)(a),e=c.useRef(0);return c.useEffect(()=>()=>window.clearTimeout(e.current),[]),c.useCallback(()=>{window.clearTimeout(e.current),e.current=window.setTimeout(d,b)},[d,b])}function $(a,b){let c=(0,p.useCallbackRef)(b);(0,r.useLayoutEffect)(()=>{let b=0;if(a){let d=new ResizeObserver(()=>{cancelAnimationFrame(b),b=window.requestAnimationFrame(c)});return d.observe(a),()=>{window.cancelAnimationFrame(b),d.unobserve(a)}}},[a,c])}var _=a.i(97895);function aa({className:a,children:c,...d}){return(0,b.jsxs)(z,{"data-slot":"scroll-area",className:(0,_.cn)("relative",a),...d,children:[(0,b.jsx)(B,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:c}),(0,b.jsx)(ab,{}),(0,b.jsx)(R,{})]})}function ab({className:a,orientation:c="vertical",...d}){return(0,b.jsx)(D,{"data-slot":"scroll-area-scrollbar",orientation:c,className:(0,_.cn)("flex touch-none p-px transition-colors select-none","vertical"===c&&"h-full w-2.5 border-l border-l-transparent","horizontal"===c&&"h-2.5 flex-col border-t border-t-transparent",a),...d,children:(0,b.jsx)(O,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}var ac=a.i(77687),ad=a.i(16201),ae=a.i(62722);let af=(0,a.i(70106).default)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var ag=a.i(50429),ah=a.i(69439),ai=a.i(50889),aj=a.i(23257),ak=a.i(17171),al=a.i(87682),am=a.i(81560),an=a.i(4720);function ao({activity:a,editedKRA:c,editedKPI:d,onKRAChange:e,onKPIChange:f,onDelete:g,kraChanged:h,availableKRAs:i=[],availableKPIs:j=[],mismatches:k,kraValidationError:l,kpiValidationError:m}){return(0,b.jsxs)("div",{className:"w-full bg-white rounded-2xl border border-gray-200 p-6 mb-4 shadow-sm",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-5",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:a.name})}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)("button",{onClick:g,className:"text-gray-300 hover:text-red-500 transition-colors p-1",title:"Delete",children:(0,b.jsx)(am.Trash2,{className:"w-5 h-5"})})})]}),(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(ak.Label,{className:"text-xs font-bold text-gray-600 uppercase tracking-wide",children:"KRA Assignment *"}),(0,b.jsxs)(al.Select,{value:c||a.kraId,onValueChange:e,children:[(0,b.jsx)(al.SelectTrigger,{className:(0,_.cn)("w-full mt-1 bg-white border rounded-lg",l?"border-red-500":"border-gray-300"),children:(0,b.jsx)(al.SelectValue,{placeholder:"Select KRA"})}),(0,b.jsx)(al.SelectContent,{children:i.map(a=>(0,b.jsxs)(al.SelectItem,{value:a.id,children:[a.id,": ",a.title]},a.id))})]}),l&&(0,b.jsx)("p",{className:"text-xs text-red-500 mt-1",children:l}),k&&(0,b.jsx)("p",{className:"text-xs text-yellow-600 mt-1",children:"⚠️ Potential KRA mismatch detected"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(ak.Label,{className:"text-xs font-bold text-gray-600 uppercase tracking-wide",children:"KPI Selection"}),(0,b.jsxs)("div",{className:(0,_.cn)("mt-1 bg-gray-50 rounded-lg border p-3",m?"border-red-500":"border-gray-200"),children:[(0,b.jsxs)(al.Select,{value:d||a.initiativeId,onValueChange:f,children:[(0,b.jsx)(al.SelectTrigger,{className:"w-full bg-white border border-gray-300 rounded-md h-auto min-h-[40px] py-2",children:(0,b.jsx)(al.SelectValue,{placeholder:"Select KPI",children:(d||a.initiativeId)&&(0,b.jsx)("span",{className:"text-left",children:d||a.initiativeId})})}),(0,b.jsx)(al.SelectContent,{className:"max-h-[300px] overflow-y-auto",children:j.map(a=>(0,b.jsx)(al.SelectItem,{value:a.id,className:"cursor-pointer",children:(0,b.jsxs)("div",{className:"py-1",children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:a.id}),a.title&&(0,b.jsx)("div",{className:"text-xs text-gray-500 mt-0.5 whitespace-normal max-w-[350px]",children:a.title}),void 0!==a.target&&(0,b.jsxs)("div",{className:"text-xs text-blue-600 font-medium mt-0.5",children:["Target: ",a.target,"percentage"===a.targetType?"%":""]})]})},a.id))})]}),m&&(0,b.jsx)("p",{className:"text-xs text-red-500 mt-1",children:m}),(d||a.initiativeId)&&(0,b.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200 space-y-1",children:[(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,b.jsx)("span",{className:"font-medium text-gray-700",children:"Output:"})," ",j.find(b=>b.id===(d||a.initiativeId))?.title||"N/A"]}),(0,b.jsx)("p",{className:"text-xs",children:(0,b.jsxs)("span",{className:"bg-blue-100 text-blue-700 px-2 py-0.5 rounded font-medium",children:["Target: ",a.target]})})]})]}),h&&(0,b.jsx)("span",{className:"inline-block mt-1 text-xs bg-yellow-100 text-yellow-700 rounded px-2 py-1 font-semibold",children:"Possible Mismatch"})]}),a.evidenceSnippet&&!a.evidenceSnippet.startsWith("Target:")&&a.evidenceSnippet.length>10&&(0,b.jsxs)("div",{children:[(0,b.jsx)(ak.Label,{className:"text-xs font-bold text-gray-600 uppercase tracking-wide",children:"Evidence"}),(0,b.jsxs)("div",{className:"mt-1 flex items-start gap-2 text-xs text-gray-600 bg-gray-50 p-3 rounded border border-dashed border-gray-300",children:[(0,b.jsx)(an.FileText,{className:"w-4 h-4 mt-0.5 shrink-0"}),(0,b.jsxs)("span",{className:"italic",children:['"',a.evidenceSnippet,'"']})]})]})]})})]})}var ap=a.i(96499);function aq(a){if(!a)return"";if("string"!=typeof a){if(Array.isArray(a))return a.map(a=>aq(a)).join("\n");if("object"==typeof a){if(a.action)return`${a.action}${a.timeline?` (${a.timeline})`:""}`;if(a.recommendation)return a.recommendation;try{return JSON.stringify(a)}catch{}}return String(a)}let b=a;try{let a=JSON.parse(b);if(Array.isArray(a))return a.map(a=>"string"==typeof a?a:a?.action?a.action:a?.recommendation?a.recommendation:String(a)).join("\n• ");if("object"==typeof a&&null!==a){if(a.action)return a.action;if(a.recommendation)return a.recommendation}}catch{}return(b=(b=(b=(b=(b=b.replace(/^#{1,3}\s+/gm,"")).replace(/\*\*([^*]+)\*\*/g,"$1")).replace(/\*([^*]+)\*/g,"$1")).replace(/^\["|"\]$/g,"")).replace(/","/g,", ")).trim()}function ar(a){if(!a)return null;let c=a.split("\n").filter(a=>a.trim()),d=[],e=[],f=null,g=()=>{e.length>0&&("numbered"===f?d.push((0,b.jsx)("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:e.map((a,c)=>(0,b.jsx)("li",{children:aq(a)},c))},`ol-${d.length}`)):d.push((0,b.jsx)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:e.map((a,c)=>(0,b.jsx)("li",{children:aq(a)},c))},`ul-${d.length}`)),e=[],f=null)};return c.forEach((a,c)=>{let h=a.trim();if(h.startsWith("###")||h.startsWith("##")||h.startsWith("#")){g();let a=h.replace(/^#{1,3}\s+/,"");d.push((0,b.jsx)("p",{className:"font-semibold mt-3 first:mt-0",children:aq(a)},`h-${c}`));return}let i=h.match(/^\d+\.\s+(.+)/);if(i){"numbered"!==f&&(g(),f="numbered"),e.push(i[1]);return}let j=h.match(/^[-*]\s+(.+)/);if(j){"bullet"!==f&&(g(),f="bullet"),e.push(j[1]);return}g(),h&&d.push((0,b.jsx)("p",{className:"mb-2 last:mb-0",children:aq(h)},`p-${c}`))}),g(),(0,b.jsx)("div",{className:"space-y-2",children:d})}let as={"KRA 1":["curriculum","curricula","course","program design"],"KRA 2":["market","industry","demand"],"KRA 3":["instruction","teaching","learning","quality","student","employment","graduate"],"KRA 4":["international","mou","moa","global","linkage"],"KRA 5":["research","publication","innovation"],"KRA 6":["research linkage","collaboration","partnership"],"KRA 7":["research resources","funding","laboratory"],"KRA 8":["community","outreach","service"],"KRA 11":["human resources","faculty","staff"],"KRA 12":["international","global","stakeholder"],"KRA 13":["competitive","human resources"],"KRA 14":["satisfaction","satisfaction rating"],"KRA 18":["risk","compliance"],"KRA 19":["revenue","operational","efficiency"],"KRA 22":["financial","resources","budget"]},at=[{id:"KRA 1",title:"Development of New Curricula Incorporating Emerging Technologies"},{id:"KRA 2",title:"Market-Driven Program Design and Implementation"},{id:"KRA 3",title:"Quality and Relevance of Instruction"},{id:"KRA 4",title:"College and Office International Activities and Projects"},{id:"KRA 5",title:"Research, Extension, and Innovation Productivity"},{id:"KRA 6",title:"Research, Extension, and Innovation Linkages"},{id:"KRA 7",title:"Research, Extension, and Innovation Resources"},{id:"KRA 8",title:"Service to the Community"},{id:"KRA 9",title:"Implementation of Sustainable Governance"},{id:"KRA 10",title:"Transforming into Green University"},{id:"KRA 11",title:"Judicious Management of Human Resources"},{id:"KRA 12",title:"Internationalized/Global University Stakeholders"},{id:"KRA 13",title:"Competitive Human Resources"},{id:"KRA 14",title:"Improved Satisfaction Rating of the Students, Faculty, and Personnel of the University"},{id:"KRA 15",title:"Certification and Compliance to Regulatory Requirements"},{id:"KRA 16",title:"Updating of Learning Materials and Facilities"},{id:"KRA 17",title:"Digital Transformation and Smart Campus Enablement"},{id:"KRA 18",title:"Risk Management and Compliance"},{id:"KRA 19",title:"Revenue Growth and Operational Efficiency"},{id:"KRA 20",title:"Related IGP Industry Engagement"},{id:"KRA 21",title:"Responsive Management of Resources"},{id:"KRA 22",title:"Management of Financial Resources"}];function au({isOpen:a,onClose:d,analysisId:e,onApprove:f,onReject:h,forceFullPage:j=!1}){let{toast:l}=(0,ac.useToast)(),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(new Set),[E,F]=(0,c.useState)({}),[G,H]=(0,c.useState)({}),[I,J]=(0,c.useState)({}),[K,L]=(0,c.useState)(new Map),[M,N]=(0,c.useState)(!1);(0,c.useEffect)(()=>{e&&(a||j)&&(async()=>{try{let a=await ai.default.getAccessToken(),b=await fetch(`/api/qpro/analyses/${e}`,{headers:{Authorization:`Bearer ${a}`}});if(!b.ok)return;let c=await b.json(),d=c.activities||[],f=Array.from(new Set(d.map(a=>a.kraId).filter(Boolean))),g=new Map;for(let b of f){let d=c.year||new Date().getFullYear(),e=await fetch(`/api/kpi-progress?kraId=${encodeURIComponent(b)}&year=${d}`,{headers:{Authorization:`Bearer ${a}`}});if(e.ok){let a=(await e.json()).data;if(a?.initiatives)for(let b of a.initiatives){let a=b.progress?.filter(a=>a.year===d).reduce((a,b)=>{let c="number"==typeof b.currentValue?b.currentValue:parseFloat(String(b.currentValue))||0;return a+c},0)||0,c=b.progress?.find(a=>a.year===d),e=c?.targetValue||0;g.set(b.id,{current:a,target:"number"==typeof e?e:parseFloat(String(e))||0})}}}L(g)}catch(a){console.error("Error fetching current progress:",a)}})()},[e,a,j]),(0,c.useEffect)(()=>{e&&(a||j)&&P()},[e,a,j]);let O=a=>{if(a.activities&&Array.isArray(a.activities)&&a.activities.length>0)return a.activities.map(a=>({name:a.name||a.title||"Unnamed Activity",kraId:a.kraId||a.kra_id||"",initiativeId:a.initiativeId||a.initiative_id||"",reported:Number(a.reported)||0,target:Number(a.target)||0,achievement:Number(a.achievement)||0,status:"MET"===a.status?"MET":"MISSED",authorizedStrategy:a.authorizedStrategy||"",evidenceSnippet:a.evidenceSnippet||"",confidence:Number(a.confidence)||.75,confidenceScore:Number(a.confidenceScore)||Number(a.confidence)||.75,prescriptiveNote:a.prescriptiveNote||"",prescriptiveAnalysis:a.prescriptiveAnalysis||"",rootCause:a.rootCause||"",aiInsight:a.aiInsight||""}));if(a.organizedActivities&&Array.isArray(a.organizedActivities)){let b=[];return a.organizedActivities.forEach(a=>{let c=a.kraId||"",d=a.kpiId||"";a.activities&&Array.isArray(a.activities)&&a.activities.forEach(a=>{b.push({name:a.title||a.name||"Unnamed Activity",kraId:c,initiativeId:a.initiativeId||d||"",reported:Number(a.reported)||0,target:Number(a.target)||0,achievement:Number(a.achievement)||0,status:"MET"===a.status||Number(a.achievement)>=100?"MET":"MISSED",authorizedStrategy:a.authorizedStrategy||"",evidenceSnippet:a.evidenceSnippet||a.description||"",confidence:Number(a.confidence)||.75,confidenceScore:Number(a.confidenceScore)||Number(a.confidence)||.75,prescriptiveNote:a.prescriptiveNote||"",prescriptiveAnalysis:a.prescriptiveAnalysis||"",rootCause:a.rootCause||"",aiInsight:a.aiInsight||""})})}),b}return[]},P=async()=>{try{n(!0);let a=await ai.default.getAccessToken(),b=await fetch(`/api/qpro/analyses/${e}`,{headers:{Authorization:`Bearer ${a}`}});if(!b.ok)throw Error("Failed to fetch analysis");let c=await b.json();r(c),"APPROVED"===c.status&&N(!0);let d=O(c);t(d)}catch(a){p(a instanceof Error?a.message:"An error occurred")}finally{n(!1)}},Q=a=>{let b=aj.default.kras.find(b=>b.kra_id===a);if(!b?.initiatives)return[];let c=Number(q?.year)||new Date().getFullYear();return b.initiatives.map(a=>{let b=a.targets?.timeline_data,d=b?.find(a=>a.year===c),e=d?parseFloat(d.target_value):void 0;return{...a,title:a.key_performance_indicator?.outputs||a.key_performance_indicator?.outcomes||a.description||a.id,target:e,targetType:a.targets?.type||"count"}})},R=(a,b,c)=>{let d=[...s];if(d[a]={...d[a],[b]:c},"reported"===b||"target"===b){let e="reported"===b?c:d[a].reported,f="target"===b?c:d[a].target;f>0?(d[a].achievement=e/f*100,d[a].status=d[a].achievement>=100?"MET":"MISSED"):d[a].achievement=0}t(d)},S=()=>{let a={};return s.forEach((b,c)=>{C.has(c)&&!b.initiativeId&&(a[c]="KPI is required for changed KRA")}),J(a),0===Object.keys(a).length},T=a=>{if(!a)return null;if("string"==typeof a)return a;if(Array.isArray(a))return a.map((a,b)=>{if("string"==typeof a)return`${b+1}. ${a}`;if("object"==typeof a){let b=a.title||a.issue||a.name||"",c=a.action||a.nextStep||a.recommendation||"";return b&&c?`**${b}**: ${c}`:b?`- ${b}`:c?`- ${c}`:Object.keys(a).filter(b=>"string"==typeof a[b]).map(b=>`- **${b}**: ${a[b]}`).join("\n")}return String(a)}).join("\n\n");if("object"==typeof a){let b=[];if(a.documentInsight&&b.push(T(a.documentInsight)||""),a.prescriptiveAnalysis&&b.push(T(a.prescriptiveAnalysis)||""),a.summary&&b.push(T(a.summary)||""),a.recommendations&&b.push(T(a.recommendations)||""),a.prescriptiveItems&&b.push(T(a.prescriptiveItems)||""),b.length>0)return b.filter(Boolean).join("\n\n");let c=Object.entries(a).filter(([,a])=>a&&"string"==typeof a);if(c.length>0)return c.map(([a,b])=>`**${a}**: ${b}`).join("\n\n")}return null},U=async()=>{if(0===C.size)return void p("No KRA changes to regenerate");if(!S())return void p("Please select the correct KPI for each changed activity before regenerating.");try{B(!0),p(null),l({title:"Regenerating Insights",description:"Analyzing KPI types and generating fresh recommendations...",duration:3e3});let a=await ai.default.getAccessToken();if(!a)throw Error("Authentication required");let b=s.map((a,b)=>({...a,index:b,userSelectedKPI:!0})).filter(a=>C.has(a.index)),c=await fetch("/api/qpro/regenerate-insights",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({analysisId:e,activities:b})});if(!c.ok){let a=await c.json();throw Error(a.error||"Failed to regenerate insights")}let d=await c.json();console.log("[ReviewQProModal] Regeneration successful, refetching fresh analysis data..."),r(a=>({...a||{},...d,_regeneratedAt:new Date().toISOString()})),t(a=>{let c=[...a];return d.activities.forEach(a=>{let d=b.find(b=>b.name===a.name)?.index;void 0!==d&&(c[d]={...c[d],...a})}),c});try{let b=await fetch(`/api/qpro/analyses/${e}`,{headers:{Authorization:`Bearer ${a}`},cache:"no-store"});if(b.ok){let a=await b.json();console.log("[ReviewQProModal] Fresh analysis data retrieved after regeneration"),r(b=>({...b||{},...a,prescriptiveAnalysis:a.prescriptiveAnalysis||d.prescriptiveAnalysis||b?.prescriptiveAnalysis}));let c=O(a);c.length>0&&t(c)}}catch(a){console.warn("[ReviewQProModal] Could not refetch fresh data after regeneration:",a)}D(new Set),p(null),l({title:"✓ Success - Insights Regenerated",description:`${b.length} ${1===b.length?"activity":"activities"} updated with fresh AI analysis and corrected KPI classifications.`,duration:5e3,className:"bg-green-50 border-green-200"})}catch(a){p(a instanceof Error?a.message:"Failed to regenerate insights")}finally{B(!1)}},V=async()=>{try{let a;if(x(!0),p(null),a={},s.forEach((b,c)=>{b.kraId||(a[c]="KRA is required")}),H(a),0!==Object.keys(a).length){p("Please assign a KRA to all activities before approval"),x(!1);return}if(!S()){p("Please select the correct KPI under the corrected KRA before approval"),x(!1);return}let b=await ai.default.getAccessToken();if(!b)throw Error("Authentication required");console.log("[ReviewModal] Saving activity edits before approval...");let c=await fetch(`/api/qpro/analyses/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({activities:s})});if(!c.ok){let a=await c.json().catch(()=>({}));throw Error(a.error||"Failed to save activity edits. Please try again.")}console.log("[ReviewModal] Activity edits saved successfully, proceeding with approval...");let d=await fetch(`/api/qpro/approve/${e}`,{method:"POST",headers:{Authorization:`Bearer ${b}`}});if(!d.ok){let a=await d.json();throw Error(a.error||"Failed to approve analysis")}console.log("[ReviewModal] Analysis approved successfully"),console.log("[ReviewModal] Calling onApprove callback to trigger page reload..."),f?.()}catch(a){p(a instanceof Error?a.message:"Failed to approve")}finally{x(!1)}},W=async()=>{try{z(!0),p(null);let a=await ai.default.getAccessToken();if(!a)throw Error("Authentication required");if(!(await fetch(`/api/qpro/approve/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({reason:"Rejected after review"})})).ok)throw Error("Failed to reject analysis");h?.(),d()}catch(a){p(a instanceof Error?a.message:"Failed to reject")}finally{z(!1)}},X=(()=>{let a=s.filter(a=>a.target>0),b=new Map;for(let c of a){let a=String(c.kraId||"").trim(),d=String(c.initiativeId||"").trim();if(!a||!d)continue;let e=`${a}::${d}`;b.has(e)||b.set(e,{kraId:a,initiativeId:d,activities:[]}),b.get(e).activities.push(c)}let c=aj.default.kras||[],d=q?.year||2025,e=[];for(let a of b.values()){let b=(0,ap.getInitiativeTargetMeta)({kras:c},a.kraId,a.initiativeId,d),f="number"==typeof a.activities?.[0]?.target?a.activities[0].target:Number(a.activities?.[0]?.target||0),g=b.targetValue??(Number.isFinite(f)&&f>0?f:0),h=(0,ap.computeAggregatedAchievement)({targetType:b.targetType||a.activities?.[0]?.targetType,targetValue:g,targetScope:b.targetScope,activities:a.activities.map(a=>({reported:a.reported,target:a.target}))}),i=h.achievementPercent;if(a.initiativeId&&K.has(a.initiativeId)){let b=K.get(a.initiativeId),c=b.target||g||1,d=b.current+h.totalReported,e=c>0?d/c*100:0;i=Math.min(e,100),console.log(`[Review] KPI ${a.initiativeId}:`),console.log(`  Current progress: ${b.current}, This document adds: ${h.totalReported}`),console.log(`  New total: ${d}, Target: ${c}, Raw Achievement: ${e.toFixed(1)}%, Displayed: ${i.toFixed(1)}%`)}i>=0&&e.push(i)}let f=e.length>0?e.reduce((a,b)=>a+b,0)/e.length:0,g=a.filter(a=>a.achievement>=100).length,h=a.filter(a=>a.achievement<100).length;return{totalActivities:s.length,metCount:g,missedCount:h,avgAchievement:f}})(),Y=()=>{let a,c,d,e,f,g,h,j;return(0,b.jsx)(b.Fragment,{children:m?(0,b.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,b.jsx)(i.Loader2,{className:"w-6 h-6 animate-spin text-blue-600"}),(0,b.jsx)("span",{className:"ml-2 text-slate-600",children:"Loading analysis..."})]}):o?(0,b.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,b.jsx)("p",{className:"text-red-700",children:o})}):(0,b.jsxs)(b.Fragment,{children:[M&&(0,b.jsx)("div",{className:"p-4 mb-4 bg-amber-50 border border-amber-200 rounded-lg",children:(0,b.jsx)("p",{className:"text-amber-800 font-medium",children:"Only DRAFT analyses can be edited. This analysis is already APPROVED"})}),(0,b.jsxs)("div",{className:"flex justify-center gap-3 mb-4 flex-wrap",children:[(0,b.jsxs)("div",{className:"p-3 bg-blue-50 rounded-lg text-center min-w-[100px]",children:[(0,b.jsxs)("p",{className:"text-2xl font-bold text-blue-700",children:[X.avgAchievement.toFixed(1),"%"]}),(0,b.jsx)("p",{className:"text-xs text-blue-600",children:"Overall Achievement"})]}),(0,b.jsxs)("div",{className:"p-3 bg-slate-50 rounded-lg text-center min-w-[100px]",children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:X.totalActivities}),(0,b.jsx)("p",{className:"text-xs text-slate-600",children:"Total Activities"})]})]}),(a=q?T(q.aiInsight||q.documentInsight):null,c=q?T(q.prescriptiveAnalysis):null,e=(d=(()=>{if(!q?.prescriptiveAnalysis||"object"!=typeof q.prescriptiveAnalysis)return[];let a=q.prescriptiveAnalysis.prescriptiveItems;return Array.isArray(a)?a.filter(a=>a&&"object"==typeof a).slice(0,5).map(a=>({title:String(a.title||"").trim(),issue:String(a.issue||"").trim(),action:String(a.action||"").trim(),nextStep:a.nextStep?String(a.nextStep).trim():void 0})).filter(a=>a.title&&a.issue&&a.action):[]})()).length>0?d:c?(function(a){if("string"!=typeof a)return[];let b=a.replace(/\r\n/g,"\n").trim();if(!b)return[];let c=b.split("\n"),d=[],e=null,f=()=>{if(!e)return;let a=String(e.title||"").trim(),b=String(e.issue||"").trim(),c=String(e.action||"").trim(),f=e.nextStep?String(e.nextStep).trim():void 0;a&&b&&c&&d.push({title:a,issue:b,action:c,nextStep:f}),e=null};for(let a of c){let b=a.trim();if(!b)continue;let c=b.match(/^\d+\.\s+(.*)$/);if(c){f(),e={title:c[1].trim()};continue}let d=b.match(/^(?:-\s*)?(Issue|Action|Next\s*Step)\s*:\s*(.*)$/i);if(d&&e){let a=d[1].toLowerCase().replace(/\s+/g,""),b=d[2].trim();"issue"===a&&(e.issue=b),"action"===a&&(e.action=b),"nextstep"===a&&(e.nextStep=b);continue}}return f(),d})(c).slice(0,5):[],g="string"==typeof(f=q?.prescriptiveAnalysis&&"object"==typeof q.prescriptiveAnalysis?q.prescriptiveAnalysis.documentInsight:null)&&f.trim()?f.trim():a||"",j="string"==typeof(h=q?.prescriptiveAnalysis&&"object"==typeof q.prescriptiveAnalysis?q.prescriptiveAnalysis.prescriptiveAnalysis:null)&&h.trim()?h.trim():c||"",g||j||e.length>0?(0,b.jsxs)("div",{className:"space-y-4 mb-4",children:[g&&(0,b.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,b.jsxs)("h4",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)(ag.Target,{className:"w-4 h-4"}),"Document Insight"]}),(0,b.jsx)("div",{className:"text-sm text-blue-800 prose prose-sm prose-blue max-w-none",children:ar(g)})]}),(e.length>0||j)&&(0,b.jsxs)("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[(0,b.jsxs)("h4",{className:"font-semibold text-purple-900 mb-2 flex items-center gap-2 text-sm",children:[(0,b.jsx)(ah.Lightbulb,{className:"w-4 h-4"}),"Prescriptive Analysis"]}),(0,b.jsx)("div",{className:"text-sm text-purple-800 prose prose-sm prose-purple max-w-none",children:e.length>0?(0,b.jsx)("ol",{className:"list-decimal list-inside space-y-3",children:e.map((a,c)=>(0,b.jsxs)("li",{className:"",children:[(0,b.jsx)("span",{className:"font-semibold text-purple-900",children:a.title}),(0,b.jsxs)("ul",{className:"list-disc ml-6 mt-1 space-y-1",children:[(0,b.jsxs)("li",{children:[(0,b.jsx)("span",{className:"font-semibold",children:"Issue:"})," ",a.issue]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("span",{className:"font-semibold",children:"Action:"})," ",a.action]}),a.nextStep?(0,b.jsxs)("li",{children:[(0,b.jsx)("span",{className:"font-semibold",children:"Next Step:"})," ",a.nextStep]}):null]})]},c))}):ar(j)})]})]}):null),(0,b.jsx)(aa,{className:"flex-1",children:(0,b.jsx)("div",{className:"space-y-3 pr-4",children:s.map((a,c)=>(0,b.jsx)(ao,{activity:a,mismatches:E[c],kraValidationError:G[c],kpiValidationError:I[c],availableKRAs:at,availableKPIs:Q(a.kraId),onKRAChange:a=>{let b,d,e,f,g;return(b=[...s])[c]={...b[c],kraId:a,initiativeId:void 0},t(b),(d=new Set(C)).add(c),D(d),e=as[a]||[],f=b[c].name.toLowerCase(),g=!e.some(a=>f.includes(a)),void F(a=>({...a,[c]:g}))},onKPIChange:a=>{var b;let d,e,f,g;return(d=[...s])[c]={...d[c],initiativeId:a},e=Number(q?.year)||new Date().getFullYear(),b=d[c].kraId,f=a?Q(b).find(b=>b.id===a):null,void(null!==(g=((a,b)=>{if(!a)return null;let c=a.find(a=>a.year===b);return c?parseFloat(c.target_value):null})(f?.targets?.timeline_data,e))&&(d[c].target=g,g>0&&(d[c].achievement=d[c].reported/g*100,d[c].status=d[c].achievement>=100?"MET":"MISSED")),t(d))},onReportedChange:a=>R(c,"reported",a),onTargetChange:a=>R(c,"target",a),onDelete:()=>{t(s.filter((a,b)=>b!==c))},kraChanged:C.has(c)},a.name+c))})})]})})},Z=()=>(0,b.jsxs)("div",{className:j?"mt-6 gap-2 flex flex-col sm:flex-row":"gap-2 flex flex-col sm:flex-row",children:[C.size>0&&!M&&(0,b.jsx)("div",{className:"sm:col-span-2 md:col-span-3 p-3 bg-blue-50 border border-blue-200 rounded-lg mb-2",children:(0,b.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,b.jsxs)("strong",{children:[C.size," activity update(s) pending."]}),' Click "Regenerate Insights" to update targets and document-level AI analysis based on corrected KRA/KPI selections.']})}),(0,b.jsx)(g.Button,{variant:"outline",onClick:d,disabled:w||y||A,children:"Cancel"}),C.size>0&&!M&&(0,b.jsxs)(g.Button,{onClick:U,disabled:A||u,className:"bg-indigo-600 hover:bg-indigo-700",children:[A?(0,b.jsx)(i.Loader2,{className:"w-4 h-4 animate-spin mr-2"}):(0,b.jsx)(af,{className:"w-4 h-4 mr-2"}),A?"Regenerating...":"Regenerate Insights"]}),(0,b.jsx)(g.Button,{variant:"destructive",onClick:W,disabled:m||w||y||A||M,children:y?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.Loader2,{className:"w-4 h-4 animate-spin mr-2"}),"Rejecting..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ae.XCircle,{className:"w-4 h-4 mr-2"}),"Reject"]})}),(0,b.jsx)(g.Button,{onClick:V,disabled:m||w||y||A||M,className:"bg-green-600 hover:bg-green-700",children:w?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.Loader2,{className:"w-4 h-4 animate-spin mr-2"}),"Approving..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ad.CheckCircle,{className:"w-4 h-4 mr-2"}),"Approve & Commit"]})})]});return j?(0,b.jsxs)("div",{className:"space-y-6 relative",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(af,{className:"w-5 h-5"}),(0,b.jsx)("h2",{className:"text-2xl font-bold",children:"Review QPro Analysis"})]}),A&&(0,b.jsx)("div",{className:"fixed inset-0 bg-white/80 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-xl border-2 border-indigo-200 p-8 flex flex-col items-center gap-4 max-w-md mx-4",children:[(0,b.jsx)(i.Loader2,{className:"w-12 h-12 animate-spin text-indigo-600"}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xl font-semibold text-slate-900",children:"Regenerating Insights"}),(0,b.jsx)("p",{className:"text-sm text-slate-600 mt-2",children:"Analyzing KPI types and generating fresh recommendations..."}),(0,b.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:"This may take a few moments."})]})]})}),(0,b.jsx)(Y,{}),(0,b.jsx)(Z,{})]}):(0,b.jsx)(k.Dialog,{open:!!a,onOpenChange:a=>{a||d()},children:(0,b.jsxs)(k.DialogContent,{className:"w-[95vw] h-[95vh] max-w-[1400px] flex flex-col",children:[(0,b.jsx)(k.DialogHeader,{children:(0,b.jsxs)(k.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(af,{className:"w-5 h-5"}),"Review QPro Analysis"]})}),A&&(0,b.jsx)("div",{className:"absolute inset-0 bg-white/80 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-xl border-2 border-indigo-200 p-8 flex flex-col items-center gap-4 max-w-md",children:[(0,b.jsx)(i.Loader2,{className:"w-12 h-12 animate-spin text-indigo-600"}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xl font-semibold text-slate-900",children:"Regenerating Insights"}),(0,b.jsx)("p",{className:"text-sm text-slate-600 mt-2",children:"Analyzing KPI types and generating fresh recommendations..."}),(0,b.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:"This may take a few moments."})]})]})}),(0,b.jsx)(Y,{}),(0,b.jsx)(k.DialogFooter,{className:"mt-4 gap-2 flex flex-col sm:flex-row",children:(0,b.jsx)(Z,{})})]})})}function av(){let a=(0,d.useParams)(),k=(0,d.useRouter)(),{isAuthenticated:l,isLoading:m}=(0,e.useAuth)(),n=a.id;(0,c.useEffect)(()=>{m||l||k.push("/")},[m,l,k]);let o=()=>{k.back()};return m?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)(i.Loader2,{className:"w-8 h-8 animate-spin text-primary"})}):l?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.Navbar,{}),(0,b.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,b.jsx)("div",{className:"border-b bg-card",children:(0,b.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Review QPRO Analysis"})})})}),(0,b.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)(g.Button,{variant:"ghost",onClick:o,className:"gap-2",children:[(0,b.jsx)(j.ChevronLeft,{className:"w-4 h-4"}),"Back"]}),n?(0,b.jsx)("div",{className:"w-full",children:(0,b.jsx)(au,{isOpen:!0,onClose:o,analysisId:n,onApprove:()=>{console.log("[Review Page] handleApproveSuccess called - redirecting to QPRO page..."),k.push("/qpro")},forceFullPage:!0})}):(0,b.jsx)(h.Card,{children:(0,b.jsxs)("div",{className:"flex items-start gap-3 p-6",children:[(0,b.jsx)("p",{className:"font-medium text-red-900",children:"Invalid Analysis ID"}),(0,b.jsx)("p",{className:"text-sm text-red-700 mt-1",children:"No analysis ID was provided"})]})})]})})]})]}):null}a.s(["default",()=>av],3090)}];

//# sourceMappingURL=app_qpro_review_%5Bid%5D_page_tsx_a3bef768._.js.map