{"version":3,"sources":["../../../lib/services/document-service.ts"],"sourcesContent":["import prisma from '@/lib/prisma';\r\nimport { Document, DocumentPermission, DocumentComment, User } from '@/lib/api/types';\r\nimport fileStorageService from './file-storage-service';\r\nimport ColivaraService from './colivara-service';\r\n\r\n// Create a singleton instance of the Colivara service\r\nconst colivaraService = new ColivaraService();\r\n\r\nclass DocumentService {\r\n  /**\r\n   * Helper method to find a user by database ID only\r\n   */\r\n  private async findUserById(userId: string): Promise<User | null> {\r\n    // Find user by the provided userId (database ID)\r\n    const user = await prisma.user.findUnique({\r\n      where: { id: userId },\r\n    });\r\n\r\n    if (!user) {\r\n      return null;\r\n    }\r\n\r\n    // Transform the Prisma user to match the API type\r\n    return {\r\n      id: user.id,\r\n      email: user.email,\r\n      name: user.name,\r\n      role: user.role as 'ADMIN' | 'FACULTY' | 'STUDENT' | 'EXTERNAL',\r\n      unitId: user.unitId || undefined, // Convert null to undefined\r\n      avatar: user.avatar || undefined, // Convert null to undefined\r\n      createdAt: user.createdAt,\r\n      updatedAt: user.updatedAt,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get all documents with optional filtering and pagination\r\n   */\r\n  async getDocuments(\r\n    page: number = 1,\r\n    limit: number = 10,\r\n    category?: string,\r\n    search?: string,\r\n    userId?: string,\r\n    sort?: string,\r\n    order: 'asc' | 'desc' = 'desc',\r\n    unitId?: string  // NEW: Unit filter\r\n ): Promise<{ documents: Document[]; total: number }> {\r\n    const skip = (page - 1) * limit;\r\n    \r\n    // Build where clause based on permissions and filters\r\n    const whereClause: any = {\r\n      status: 'ACTIVE', // Only show active documents\r\n    };\r\n\r\n    // Add category filter if provided\r\n    if (category && category !== 'all') {\r\n      whereClause.category = category;\r\n    }\r\n\r\n    // Add unit filter if provided\r\n    if (unitId) {\r\n      whereClause.unitId = unitId;\r\n    }\r\n\r\n    // Add search filter if provided\r\n    if (search) {\r\n      const searchCondition = {\r\n        OR: [\r\n          { title: { contains: search, mode: 'insensitive' } },\r\n          { description: { contains: search, mode: 'insensitive' } },\r\n          { tags: { array_contains: [search] } }, // Updated for JSON field\r\n        ]\r\n      };\r\n      \r\n      // If we already have conditions (like category or unit), wrap everything in AND\r\n      if (Object.keys(whereClause).length > 1) { // More than just status\r\n        whereClause.AND = whereClause.AND || [];\r\n        whereClause.AND.push(searchCondition);\r\n      } else {\r\n        // If no other conditions exist, just add the search condition\r\n        Object.assign(whereClause, searchCondition);\r\n      }\r\n    }\r\n\r\n    // If user is not admin, only show documents they have access to\r\n    if (userId) {\r\n      const user = await this.findUserById(userId);\r\n\r\n      if (user && user.role !== 'ADMIN' && user.role !== 'FACULTY') {\r\n        // For non-admin and non-faculty users, we need to check document permissions\r\n        const permissionCondition = {\r\n          OR: [\r\n            { uploadedById: user.id }, // Allow access to user's own documents (using db ID)\r\n            { permissions: { some: { userId: user.id, permission: { in: ['READ', 'WRITE', 'ADMIN'] } } } } // Documents with explicit permissions\r\n          ]\r\n        };\r\n\r\n        // If we already have conditions in whereClause, wrap everything in AND\r\n        if (Object.keys(whereClause).length > 1) { // More than just status\r\n          whereClause.AND = whereClause.AND || [];\r\n          whereClause.AND.push(permissionCondition);\r\n        } else {\r\n          // If no other conditions exist, just add the permission condition\r\n          Object.assign(whereClause, permissionCondition);\r\n        }\r\n      }\r\n    }\r\n\r\n    try {\r\n      const [documents, total] = await Promise.all([\r\n        prisma.document.findMany({\r\n          where: whereClause,\r\n          skip,\r\n          take: limit,\r\n          orderBy: sort ? { [sort]: order } : { uploadedAt: 'desc' },\r\n          include: {\r\n            uploadedByUser: true,\r\n            documentUnit: true,\r\n          }\r\n        }),\r\n        prisma.document.count({ where: whereClause }),\r\n      ]);\r\n\r\n      return {\r\n        documents: documents.map((doc: any) => ({\r\n          ...doc,\r\n          tags: Array.isArray(doc.tags) ? doc.tags as string[] : (typeof doc.tags === 'object' && doc.tags !== null ? Object.values(doc.tags) : []),\r\n          unitId: doc.unitId ?? undefined,\r\n          blobName: doc.blobName ?? undefined, // Azure Blob Storage blob name (UUID.ext)\r\n          versionNotes: doc.versionNotes ?? undefined,\r\n          downloadsCount: doc.downloadsCount ?? 0,\r\n          viewsCount: doc.viewsCount ?? 0,\r\n          uploadedBy: doc.uploadedByUser?.name || doc.uploadedBy,\r\n          unit: doc.documentUnit || undefined,\r\n          uploadedAt: new Date(doc.uploadedAt),\r\n          createdAt: new Date(doc.createdAt),\r\n          updatedAt: new Date(doc.updatedAt),\r\n        })),\r\n        total,\r\n      };\r\n    } catch (error) {\r\n      console.error('Database connection error in getDocuments:', error);\r\n      // Check if this is an authentication error\r\n      if (error instanceof Error &&\r\n          (error.message.includes('Authentication failed') ||\r\n           error.message.includes('password') ||\r\n           error.message.includes('credentials'))) {\r\n        throw new Error('Database authentication failed. Please check your database credentials.');\r\n      }\r\n      throw error; // Re-throw to be handled by the calling function\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a specific document by ID\r\n   */\r\n  async getDocumentById(id: string, userId?: string): Promise<Document | null> {\r\n    try {\r\n      // Validate the document ID format before querying the database\r\n      if (!id || typeof id !== 'string' || id.trim() === '' || id.includes('undefined') || id.includes('.pdf') || id.includes('.')) {\r\n        console.warn('Invalid document ID format received in getDocumentById:', id);\r\n        return null;\r\n      }\r\n\r\n      const document = await prisma.document.findUnique({\r\n        where: { id },\r\n        include: {\r\n          uploadedByUser: true,\r\n          documentUnit: true,\r\n        }\r\n      });\r\n\r\n      if (!document) {\r\n        return null;\r\n      }\r\n\r\n      // Check if user has access to the document\r\n      if (userId) {\r\n        const user = await this.findUserById(userId);\r\n\r\n        if (user && user.role !== 'ADMIN' && user.role !== 'FACULTY') {\r\n          // Check if user has explicit permission for this document\r\n          const permission = await prisma.documentPermission.findFirst({\r\n            where: {\r\n              documentId: id,\r\n              userId: user.id, // Use the database user ID\r\n              permission: { in: ['READ', 'WRITE', 'ADMIN'] }, // User needs at least READ permission\r\n            },\r\n          });\r\n\r\n          // Allow access if user has explicit READ/WRITE/ADMIN permission OR if user uploaded the document\r\n          if (!permission && document.uploadedById !== user.id) {\r\n            return null; // User doesn't have access\r\n          }\r\n        }\r\n      }\r\n\r\n      return {\r\n        ...document,\r\n        tags: Array.isArray(document.tags) ?\r\n          (document.tags as any[]).map(tag => String(tag)) :\r\n          (typeof document.tags === 'object' && document.tags !== null ?\r\n            Object.values(document.tags).map(tag => String(tag)) : []),\r\n        year: document.year ?? undefined,\r\n        quarter: document.quarter ?? undefined,\r\n        unitId: document.unitId || undefined, // Convert null to undefined\r\n        blobName: document.blobName ?? undefined, // Azure Blob Storage blob name (UUID.ext)\r\n        versionNotes: document.versionNotes || undefined, // Convert null to undefined\r\n        downloadsCount: document.downloadsCount || 0, // Convert null to 0\r\n        viewsCount: document.viewsCount || 0, // Convert null to 0\r\n        uploadedBy: document.uploadedByUser?.name || document.uploadedBy,\r\n        status: document.status as 'ACTIVE' | 'ARCHIVED' | 'PENDING_REVIEW',\r\n        unit: document.documentUnit && document.documentUnit.code ? {\r\n          id: document.documentUnit.id,\r\n          name: document.documentUnit.name,\r\n          code: document.documentUnit.code,\r\n          description: document.documentUnit.description || undefined, // Convert null to undefined\r\n          createdAt: document.documentUnit.createdAt,\r\n          updatedAt: document.documentUnit.updatedAt,\r\n        } : undefined,\r\n        uploadedAt: new Date(document.uploadedAt),\r\n        createdAt: new Date(document.createdAt),\r\n        updatedAt: new Date(document.updatedAt),\r\n        colivaraDocumentId: document.colivaraDocumentId ?? undefined,\r\n        colivaraProcessingStatus: document.colivaraProcessingStatus as 'PENDING' | 'PROCESSING' | 'COMPLETED' | 'FAILED' ?? undefined,\r\n        colivaraProcessedAt: document.colivaraProcessedAt ? new Date(document.colivaraProcessedAt) : undefined,\r\n        colivaraChecksum: document.colivaraChecksum ?? undefined,\r\n      };\r\n    } catch (error) {\r\n      console.error('Database connection error in getDocumentById:', error);\r\n      // Check if this is an authentication error\r\n      if (error instanceof Error &&\r\n          (error.message.includes('Authentication failed') ||\r\n           error.message.includes('password') ||\r\n           error.message.includes('credentials'))) {\r\n        throw new Error('Database authentication failed. Please check your database credentials.');\r\n      }\r\n      throw error; // Re-throw to be handled by the calling function\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a new document\r\n   */\r\n  async createDocument(\r\n    title: string,\r\n    description: string,\r\n    category: string,\r\n    tags: string[],\r\n    uploadedBy: string,\r\n    fileUrl: string,\r\n    fileName: string,\r\n    fileType: string,\r\n    fileSize: number,\r\n    userId: string,\r\n    unitId?: string  // NEW: Unit assignment\r\n  ): Promise<Document> {\r\n    try {\r\n      console.log('Creating document in database...', {\r\n        title,\r\n        description,\r\n        category,\r\n        tags,\r\n        uploadedBy,\r\n        fileUrl,\r\n        fileName,\r\n        fileType,\r\n        fileSize,\r\n        userId\r\n      });\r\n      \r\n      const user = await this.findUserById(userId);\r\n      \r\n      console.log('User lookup result:', { user: !!user, role: user?.role });\r\n\r\n      if (!user || !['ADMIN', 'FACULTY'].includes(user.role)) {\r\n        throw new Error('Only admins and faculty can upload documents');\r\n      }\r\n\r\n      const document = await prisma.document.create({\r\n        data: {\r\n          title,\r\n          description,\r\n          category,\r\n          tags: tags || [], // Ensure tags is always an array, even if undefined\r\n          uploadedBy: user.name,\r\n          uploadedById: user.id, // Use the database user ID, not the Supabase auth ID\r\n          fileUrl,\r\n          fileName,\r\n          fileType,\r\n          fileSize,\r\n          unitId: unitId || undefined, // Use provided unitId or undefined\r\n          status: 'ACTIVE',\r\n        },\r\n        include: {\r\n          uploadedByUser: true,\r\n          documentUnit: true,\r\n        }\r\n      });\r\n      \r\n      console.log('Document created:', document.id);\r\n\r\n      // Grant the uploader full permissions\r\n      await prisma.documentPermission.create({\r\n        data: {\r\n          documentId: document.id,\r\n          userId: user.id, // Use the database user ID for permissions\r\n          permission: 'ADMIN',\r\n        },\r\n      });\r\n      \r\n      console.log('Document permissions granted');\r\n      \r\n      return {\r\n        id: document.id,\r\n        title: document.title,\r\n        description: document.description,\r\n        category: document.category,\r\n        tags: Array.isArray(document.tags) ?\r\n          (document.tags as any[]).map(tag => String(tag)) :\r\n          (typeof document.tags === 'object' && document.tags !== null ?\r\n            Object.values(document.tags).map(tag => String(tag)) : []),\r\n        uploadedBy: document.uploadedByUser?.name || document.uploadedBy,\r\n        uploadedById: document.uploadedById,\r\n        uploadedAt: new Date(document.uploadedAt),\r\n        fileUrl: document.fileUrl,\r\n        fileName: document.fileName,\r\n        fileType: document.fileType,\r\n        fileSize: document.fileSize,\r\n        downloadsCount: document.downloadsCount || 0, // Convert null to 0\r\n        viewsCount: document.viewsCount || 0, // Convert null to 0\r\n        version: document.version || 1,\r\n        versionNotes: document.versionNotes || undefined, // Convert null to undefined\r\n        status: document.status as 'ACTIVE' | 'ARCHIVED' | 'PENDING_REVIEW',\r\n        createdAt: new Date(document.createdAt),\r\n        updatedAt: new Date(document.updatedAt),\r\n        unitId: document.unitId || undefined, // Convert null to undefined\r\n        unit: document.documentUnit && document.documentUnit.code ? {\r\n          id: document.documentUnit.id,\r\n          name: document.documentUnit.name,\r\n          code: document.documentUnit.code,\r\n          description: document.documentUnit.description || undefined, // Convert null to undefined\r\n          createdAt: document.documentUnit.createdAt,\r\n          updatedAt: document.documentUnit.updatedAt,\r\n        } : undefined,\r\n        colivaraDocumentId: document.colivaraDocumentId ?? undefined,\r\n        colivaraProcessingStatus: document.colivaraProcessingStatus as 'PENDING' | 'PROCESSING' | 'COMPLETED' | 'FAILED' ?? undefined,\r\n        colivaraProcessedAt: document.colivaraProcessedAt ? new Date(document.colivaraProcessedAt) : undefined,\r\n        colivaraChecksum: document.colivaraChecksum ?? undefined,\r\n      };\r\n    } catch (error) {\r\n      console.error('Database connection error in createDocument:', error);\r\n      // Check if this is an authentication error\r\n      if (error instanceof Error &&\r\n          (error.message.includes('Authentication failed') ||\r\n           error.message.includes('password') ||\r\n           error.message.includes('credentials'))) {\r\n        throw new Error('Database authentication failed. Please check your database credentials.');\r\n      }\r\n      throw error; // Re-throw to be handled by the calling function\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update a document\r\n   */\r\n  async updateDocument(\r\n    id: string,\r\n    title?: string,\r\n    description?: string,\r\n    category?: string,\r\n    tags?: string[],\r\n    unitId?: string, // NEW: Unit assignment\r\n    userId?: string,\r\n    fileUrl?: string // NEW: File URL for Colivara reprocessing\r\n  ): Promise<Document | null> {\r\n    try {\r\n      const document = await prisma.document.findUnique({\r\n        where: { id },\r\n      });\r\n\r\n      if (!document) {\r\n        return null;\r\n      }\r\n\r\n      // Check if user has permission to update the document\r\n      let permission = null;\r\n      let user = null;\r\n\r\n      if (userId) {\r\n        user = await this.findUserById(userId);\r\n\r\n        if (user) {\r\n          permission = await prisma.documentPermission.findFirst({\r\n            where: {\r\n              documentId: id,\r\n              userId: user.id, // Use the database user ID\r\n              permission: { in: ['WRITE', 'ADMIN'] },\r\n            },\r\n          });\r\n        }\r\n      }\r\n\r\n      if (userId && !permission && user?.role !== 'ADMIN' && document.uploadedById !== user?.id) {\r\n        throw new Error('User does not have permission to update this document');\r\n      }\r\n\r\n      // Update document fields that Prisma client recognizes\r\n      const updatedDocument = await prisma.document.update({\r\n        where: { id },\r\n        data: {\r\n          ...(title && { title }),\r\n          ...(description && { description }),\r\n          ...(category && { category }),\r\n          ...(tags !== undefined && { tags: tags || [] }),\r\n          ...(unitId !== undefined && { unitId }),\r\n          updatedAt: new Date(),\r\n        },\r\n        include: {\r\n          uploadedByUser: true,\r\n          documentUnit: true,\r\n        }\r\n      });\r\n\r\n      return {\r\n        id: updatedDocument.id,\r\n        title: updatedDocument.title,\r\n        description: updatedDocument.description,\r\n        category: updatedDocument.category,\r\n        tags: Array.isArray(updatedDocument.tags) ?\r\n          (updatedDocument.tags as any[]).map(tag => String(tag)) :\r\n          (typeof updatedDocument.tags === 'object' && updatedDocument.tags !== null ?\r\n            Object.values(updatedDocument.tags).map(tag => String(tag)) : []),\r\n        uploadedBy: updatedDocument.uploadedByUser?.name || updatedDocument.uploadedBy,\r\n        uploadedById: updatedDocument.uploadedById,\r\n        uploadedAt: new Date(updatedDocument.uploadedAt),\r\n        fileUrl: updatedDocument.fileUrl,\r\n        fileName: updatedDocument.fileName,\r\n        fileType: updatedDocument.fileType,\r\n        fileSize: updatedDocument.fileSize,\r\n        downloadsCount: updatedDocument.downloadsCount || 0, // Convert null to 0\r\n        viewsCount: updatedDocument.viewsCount || 0, // Convert null to 0\r\n        version: updatedDocument.version || 1,\r\n        versionNotes: updatedDocument.versionNotes || undefined, // Convert null to undefined\r\n        status: updatedDocument.status as 'ACTIVE' | 'ARCHIVED' | 'PENDING_REVIEW',\r\n        createdAt: new Date(updatedDocument.createdAt),\r\n        updatedAt: new Date(updatedDocument.updatedAt),\r\n        unitId: updatedDocument.unitId || undefined, // Convert null to undefined\r\n        unit: updatedDocument.documentUnit && updatedDocument.documentUnit.code ? {\r\n          id: updatedDocument.documentUnit.id,\r\n          name: updatedDocument.documentUnit.name,\r\n          code: updatedDocument.documentUnit.code,\r\n          description: updatedDocument.documentUnit.description || undefined, // Convert null to undefined\r\n          createdAt: updatedDocument.documentUnit.createdAt,\r\n          updatedAt: updatedDocument.documentUnit.updatedAt,\r\n        } : undefined,\r\n        colivaraDocumentId: updatedDocument.colivaraDocumentId ?? undefined,\r\n        colivaraProcessingStatus: updatedDocument.colivaraProcessingStatus as 'PENDING' | 'PROCESSING' | 'COMPLETED' | 'FAILED' ?? undefined,\r\n        colivaraProcessedAt: updatedDocument.colivaraProcessedAt ? new Date(updatedDocument.colivaraProcessedAt) : undefined,\r\n        colivaraChecksum: updatedDocument.colivaraChecksum ?? undefined,\r\n      };\r\n    } catch (error) {\r\n      console.error('Database connection error in updateDocument:', error);\r\n      // Check if this is an authentication error\r\n      if (error instanceof Error &&\r\n          (error.message.includes('Authentication failed') ||\r\n           error.message.includes('password') ||\r\n           error.message.includes('credentials'))) {\r\n        throw new Error('Database authentication failed. Please check your database credentials.');\r\n      }\r\n      throw error; // Re-throw to be handled by the calling function\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete a document\r\n   */\r\n  async deleteDocument(id: string, userId: string): Promise<boolean> {\r\n    try {\r\n      const document = await prisma.document.findUnique({\r\n        where: { id },\r\n        include: {\r\n          permissions: true, // Include related permissions\r\n          comments: true,    // Include related comments\r\n          downloads: true,   // Include related downloads\r\n          views: true,       // Include related views\r\n        }\r\n      });\r\n  \r\n      if (!document) {\r\n        return false;\r\n      }\r\n  \r\n      const user = await this.findUserById(userId);\r\n  \r\n      if (!user) {\r\n        throw new Error('User not found');\r\n      }\r\n  \r\n      // Check if user has permission to delete the document\r\n      const permission = await prisma.documentPermission.findFirst({\r\n        where: {\r\n          documentId: id,\r\n          userId: user.id, // Use the database user ID\r\n          permission: 'ADMIN',\r\n        },\r\n      });\r\n  \r\n      if (!permission && user.role !== 'ADMIN' && document.uploadedById !== user.id) {\r\n        throw new Error('User does not have permission to delete this document');\r\n      }\r\n  \r\n      // QPRO CLEANUP: Before deleting, capture KPIContribution records for accurate deduction\r\n      // This solves the \"memory loss\" problem - we know exactly what this document contributed\r\n      const kpiContributions = await prisma.kPIContribution.findMany({\r\n        where: { document_id: id },\r\n        select: {\r\n          id: true,\r\n          kra_id: true,\r\n          initiative_id: true,\r\n          value: true,\r\n          year: true,\r\n          quarter: true,\r\n          target_type: true,\r\n        }\r\n      });\r\n\r\n      // Also get aggregation activities for legacy cleanup (in case contributions don't exist)\r\n      const qproAnalysis = await prisma.qPROAnalysis.findFirst({\r\n        where: { documentId: id },\r\n        select: {\r\n          id: true,\r\n          year: true,\r\n          quarter: true,\r\n          unitId: true,\r\n          aggregationActivities: {\r\n            where: { isApproved: true },\r\n            select: {\r\n              initiative_id: true,\r\n              reported: true,\r\n              aggregation_id: true,\r\n            }\r\n          }\r\n        }\r\n      });\r\n\r\n      // Track which KRAggregations need recalculation (from KPIContributions - preferred)\r\n      const contributionsByKpi = new Map<string, { kraId: string; initiativeId: string; value: number; year: number; quarter: number }>();\r\n      for (const contrib of kpiContributions) {\r\n        const key = `${contrib.kra_id}|${contrib.initiative_id}|${contrib.year}|${contrib.quarter}`;\r\n        contributionsByKpi.set(key, {\r\n          kraId: contrib.kra_id,\r\n          initiativeId: contrib.initiative_id,\r\n          value: contrib.value,\r\n          year: contrib.year,\r\n          quarter: contrib.quarter,\r\n        });\r\n      }\r\n\r\n      // Fallback: Track from aggregation activities if no contributions exist\r\n      const affectedAggregations: { aggregationId: string; initiativeId: string; reportedValue: number }[] = [];\r\n      if (kpiContributions.length === 0 && qproAnalysis?.aggregationActivities) {\r\n        for (const activity of qproAnalysis.aggregationActivities) {\r\n          if (activity.aggregation_id && activity.reported !== null) {\r\n            affectedAggregations.push({\r\n              aggregationId: activity.aggregation_id,\r\n              initiativeId: activity.initiative_id,\r\n              reportedValue: activity.reported,\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      console.log(`[Document Delete] Found ${kpiContributions.length} KPIContributions to deduct, ${affectedAggregations.length} legacy aggregation activities`);\r\n\r\n      // Delete related records first (due to foreign key constraints)\r\n      await prisma.documentComment.deleteMany({\r\n        where: { documentId: id },\r\n      });\r\n      \r\n      await prisma.documentDownload.deleteMany({\r\n        where: { documentId: id },\r\n      });\r\n      \r\n      await prisma.documentView.deleteMany({\r\n        where: { documentId: id },\r\n      });\r\n      \r\n      await prisma.documentPermission.deleteMany({\r\n        where: { documentId: id },\r\n      });\r\n      \r\n      // Delete Colivara indexes if they exist\r\n      await prisma.colivaraIndex.deleteMany({\r\n        where: { documentId: id },\r\n      });\r\n\r\n      // Delete the file from storage before removing the database record\r\n      try {\r\n        const fileName = document.fileUrl.split('/').pop(); // Extract filename from URL\r\n        if (fileName) {\r\n          const fileDeleted = await fileStorageService.deleteFile(fileName);\r\n          if (!fileDeleted) {\r\n            console.warn(`Failed to delete file ${fileName} from storage, but continuing with database deletion`);\r\n          }\r\n        } else {\r\n          console.warn(`Could not extract filename from URL: ${document.fileUrl}`);\r\n        }\r\n      } catch (fileError) {\r\n        console.error('Error deleting file from storage:', fileError);\r\n        // Continue with database deletion even if file deletion fails to avoid orphaned records\r\n      }\r\n  \r\n      // Delete from Colivara index if it exists\r\n      try {\r\n        // Initialize the service if needed (in case it hasn't been initialized)\r\n        if (!colivaraService['isInitialized']) {\r\n          await colivaraService.initialize();\r\n        }\r\n        await colivaraService.deleteFromIndex(id);\r\n      } catch (colivaraError) {\r\n        console.error(`Failed to delete document ${id} from Colivara index:`, colivaraError);\r\n        // Continue with deletion even if Colivara deletion fails\r\n      }\r\n      \r\n      // Delete the document from the database (cascades to QPROAnalysis, AggregationActivity, and KPIContribution)\r\n      await prisma.document.delete({\r\n        where: { id },\r\n      });\r\n\r\n      // QPRO CLEANUP: Deduct contributions from KRAggregation records after deletion\r\n      // Use KPIContributions (preferred - accurate per-document stamped values)\r\n      if (contributionsByKpi.size > 0) {\r\n        console.log(`[Document Delete] Deducting ${contributionsByKpi.size} KPI contributions from aggregations`);\r\n        \r\n        for (const [, contrib] of contributionsByKpi) {\r\n          try {\r\n            // Find the KRAggregation for this KPI\r\n            const aggregation = await prisma.kRAggregation.findFirst({\r\n              where: {\r\n                year: contrib.year,\r\n                quarter: contrib.quarter,\r\n                kra_id: contrib.kraId,\r\n                initiative_id: contrib.initiativeId,\r\n              },\r\n            });\r\n\r\n            if (!aggregation) {\r\n              console.log(`[Document Delete] No KRAggregation found for ${contrib.kraId}/${contrib.initiativeId}`);\r\n              continue;\r\n            }\r\n\r\n            // Deduct the exact contribution value\r\n            const newTotal = Math.max(0, (aggregation.total_reported ?? 0) - contrib.value);\r\n            const newCount = Math.max(0, aggregation.submission_count - 1);\r\n            \r\n            if (newCount === 0) {\r\n              // No more contributions - delete the KRAggregation record\r\n              await prisma.kRAggregation.delete({\r\n                where: { id: aggregation.id },\r\n              });\r\n              console.log(`[Document Delete] Deleted empty KRAggregation: ${aggregation.id}`);\r\n            } else {\r\n              // Recalculate achievement with the deducted total\r\n              const targetValue = aggregation.target_value?.toNumber() ?? 1;\r\n              const newAchievement = targetValue > 0 ? (newTotal / targetValue) * 100 : 0;\r\n              \r\n              await prisma.kRAggregation.update({\r\n                where: { id: aggregation.id },\r\n                data: {\r\n                  total_reported: newTotal,\r\n                  submission_count: newCount,\r\n                  achievement_percent: Math.min(newAchievement, 100),\r\n                  last_updated: new Date(),\r\n                }\r\n              });\r\n              console.log(`[Document Delete] Deducted ${contrib.value} from KRAggregation ${aggregation.id}: new total=${newTotal}`);\r\n            }\r\n          } catch (deductError) {\r\n            console.error(`[Document Delete] Error deducting contribution for ${contrib.initiativeId}:`, deductError);\r\n          }\r\n        }\r\n      } \r\n      // Fallback: Legacy recalculation for documents without KPIContributions\r\n      else if (affectedAggregations.length > 0) {\r\n        console.log(`[Document Delete] Legacy recalculating ${affectedAggregations.length} affected KRAggregation records`);\r\n        \r\n        for (const affected of affectedAggregations) {\r\n          try {\r\n            // Get remaining approved activities for this aggregation\r\n            const remainingActivities = await prisma.aggregationActivity.findMany({\r\n              where: {\r\n                aggregation_id: affected.aggregationId,\r\n                isApproved: true,\r\n              },\r\n              select: {\r\n                reported: true,\r\n              }\r\n            });\r\n\r\n            if (remainingActivities.length === 0) {\r\n              // No more activities - delete the KRAggregation record\r\n              await prisma.kRAggregation.delete({\r\n                where: { id: affected.aggregationId },\r\n              });\r\n              console.log(`[Document Delete] Deleted orphaned KRAggregation: ${affected.aggregationId}`);\r\n            } else {\r\n              // Recalculate totals from remaining activities\r\n              const newTotal = remainingActivities.reduce((sum, a) => sum + (a.reported ?? 0), 0);\r\n              const newCount = remainingActivities.length;\r\n              \r\n              // Get target for achievement calculation\r\n              const aggregation = await prisma.kRAggregation.findUnique({\r\n                where: { id: affected.aggregationId },\r\n                select: { target_value: true }\r\n              });\r\n              \r\n              const targetValue = aggregation?.target_value?.toNumber() ?? 1;\r\n              const newAchievement = targetValue > 0 ? (newTotal / targetValue) * 100 : 0;\r\n              \r\n              await prisma.kRAggregation.update({\r\n                where: { id: affected.aggregationId },\r\n                data: {\r\n                  total_reported: newTotal,\r\n                  submission_count: newCount,\r\n                  achievement_percent: Math.min(newAchievement, 100),\r\n                  last_updated: new Date(),\r\n                }\r\n              });\r\n              console.log(`[Document Delete] Updated KRAggregation ${affected.aggregationId}: total=${newTotal}, count=${newCount}`);\r\n            }\r\n          } catch (recalcError) {\r\n            console.error(`[Document Delete] Error recalculating KRAggregation ${affected.aggregationId}:`, recalcError);\r\n            // Continue with other aggregations even if one fails\r\n          }\r\n        }\r\n      }\r\n  \r\n      return true;\r\n    } catch (error) {\r\n      console.error('Database connection error in deleteDocument:', error);\r\n      // Check if this is an authentication error\r\n      if (error instanceof Error &&\r\n          (error.message.includes('Authentication failed') ||\r\n           error.message.includes('password') ||\r\n           error.message.includes('credentials'))) {\r\n        throw new Error('Database authentication failed. Please check your database credentials.');\r\n      }\r\n      throw error; // Re-throw to be handled by the calling function\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get document permissions\r\n   */\r\n  async getDocumentPermissions(documentId: string, userId: string): Promise<DocumentPermission[]> {\r\n    try {\r\n      const user = await this.findUserById(userId);\r\n  \r\n      if (!user) {\r\n        throw new Error('User not found');\r\n      }\r\n  \r\n      // Check if user has admin permission for the document\r\n      const adminPermission = await prisma.documentPermission.findFirst({\r\n        where: {\r\n          documentId,\r\n          userId: user.id, // Use the database user ID\r\n          permission: 'ADMIN',\r\n        },\r\n      });\r\n  \r\n      if (!adminPermission && user.role !== 'ADMIN') {\r\n        throw new Error('User does not have permission to view document permissions');\r\n      }\r\n  \r\n      const permissions = await prisma.documentPermission.findMany({\r\n        where: { documentId },\r\n      });\r\n  \r\n      return permissions.map((perm: any) => ({\r\n        ...perm,\r\n        permission: perm.permission as 'READ' | 'WRITE' | 'ADMIN',\r\n        createdAt: new Date(perm.createdAt),\r\n      }));\r\n    } catch (error) {\r\n      console.error('Database connection error in getDocumentPermissions:', error);\r\n      // Check if this is an authentication error\r\n      if (error instanceof Error &&\r\n          (error.message.includes('Authentication failed') ||\r\n           error.message.includes('password') ||\r\n           error.message.includes('credentials'))) {\r\n        throw new Error('Database authentication failed. Please check your database credentials.');\r\n      }\r\n      throw error; // Re-throw to be handled by the calling function\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add or update document permission\r\n   */\r\n  async setDocumentPermission(\r\n    documentId: string,\r\n    userId: string,\r\n    targetUserId: string,\r\n    permission: 'READ' | 'WRITE' | 'ADMIN'\r\n  ): Promise<DocumentPermission> {\r\n    try {\r\n      // Find the requesting user\r\n      const user = await this.findUserById(userId);\r\n  \r\n      if (!user) {\r\n        throw new Error('Requesting user not found');\r\n      }\r\n  \r\n      // Check if the requesting user has admin permission for the document\r\n      const adminPermission = await prisma.documentPermission.findFirst({\r\n        where: {\r\n          documentId,\r\n          userId: user.id, // Use the database user ID\r\n          permission: 'ADMIN',\r\n        },\r\n      });\r\n  \r\n      if (!adminPermission && user.role !== 'ADMIN') {\r\n        throw new Error('User does not have permission to manage document permissions');\r\n      }\r\n  \r\n      // Find the target user\r\n      const targetUser = await this.findUserById(targetUserId);\r\n  \r\n      if (!targetUser) {\r\n        throw new Error('Target user does not exist');\r\n      }\r\n  \r\n      // Create or update the permission\r\n      const permissionRecord = await prisma.documentPermission.upsert({\r\n        where: {\r\n          documentId_userId: {\r\n            documentId,\r\n            userId: targetUser.id, // Use the target user's database ID\r\n          },\r\n        },\r\n        update: {\r\n          permission,\r\n        },\r\n        create: {\r\n          documentId,\r\n          userId: targetUser.id, // Use the target user's database ID\r\n          permission,\r\n        },\r\n      });\r\n  \r\n      return {\r\n        ...permissionRecord,\r\n        permission: permissionRecord.permission as 'READ' | 'WRITE' | 'ADMIN',\r\n        createdAt: new Date(permissionRecord.createdAt),\r\n      };\r\n    } catch (error) {\r\n      console.error('Database connection error in setDocumentPermission:', error);\r\n      // Check if this is an authentication error\r\n      if (error instanceof Error &&\r\n          (error.message.includes('Authentication failed') ||\r\n           error.message.includes('password') ||\r\n           error.message.includes('credentials'))) {\r\n        throw new Error('Database authentication failed. Please check your database credentials.');\r\n      }\r\n      throw error; // Re-throw to be handled by the calling function\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove document permission\r\n   */\r\n  async removeDocumentPermission(\r\n    documentId: string,\r\n    userId: string,\r\n    targetUserId: string\r\n  ): Promise<boolean> {\r\n    try {\r\n      // Find the requesting user\r\n      const requestingUser = await this.findUserById(userId);\r\n\r\n      if (!requestingUser) {\r\n        throw new Error('Requesting user not found');\r\n      }\r\n\r\n      // Check if the requesting user has admin permission for the document\r\n      const adminPermission = await prisma.documentPermission.findFirst({\r\n        where: {\r\n          documentId,\r\n          userId: requestingUser.id, // Use the database user ID\r\n          permission: 'ADMIN',\r\n        },\r\n      });\r\n\r\n      if (!adminPermission && requestingUser.role !== 'ADMIN') {\r\n        throw new Error('User does not have permission to manage document permissions');\r\n      }\r\n\r\n      // Find the target user\r\n      const targetUser = await this.findUserById(targetUserId);\r\n\r\n      if (!targetUser) {\r\n        throw new Error('Target user does not exist');\r\n      }\r\n\r\n      await prisma.documentPermission.delete({\r\n        where: {\r\n          documentId_userId: {\r\n            documentId,\r\n            userId: targetUser.id, // Use the target user's database ID\r\n          },\r\n        },\r\n      });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Database connection error in removeDocumentPermission:', error);\r\n      // Check if this is an authentication error\r\n      if (error instanceof Error &&\r\n          (error.message.includes('Authentication failed') ||\r\n           error.message.includes('password') ||\r\n           error.message.includes('credentials'))) {\r\n        throw new Error('Database authentication failed. Please check your database credentials.');\r\n      }\r\n      throw error; // Re-throw to be handled by the calling function\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Record document download\r\n   */\r\n  async recordDownload(documentId: string, userId: string): Promise<void> {\r\n    try {\r\n      const user = await this.findUserById(userId);\r\n\r\n      if (!user) {\r\n        throw new Error('User not found');\r\n      }\r\n\r\n      await prisma.documentDownload.create({\r\n        data: {\r\n          documentId,\r\n          userId: user.id, // Use the database user ID\r\n        },\r\n      });\r\n\r\n      // Increment download count\r\n      await prisma.document.update({\r\n        where: { id: documentId },\r\n        data: {\r\n          downloadsCount: {\r\n            increment: 1,\r\n          },\r\n        },\r\n      });\r\n    } catch (error) {\r\n      console.error('Database connection error in recordDownload:', error);\r\n      // Check if this is an authentication error\r\n      if (error instanceof Error &&\r\n          (error.message.includes('Authentication failed') ||\r\n           error.message.includes('password') ||\r\n           error.message.includes('credentials'))) {\r\n        throw new Error('Database authentication failed. Please check your database credentials.');\r\n      }\r\n      throw error; // Re-throw to be handled by the calling function\r\n    }\r\n }\r\n\r\n  /**\r\n   * Record document view\r\n   */\r\n  async recordView(documentId: string, userId: string): Promise<void> {\r\n    try {\r\n      const user = await this.findUserById(userId);\r\n\r\n      if (!user) {\r\n        throw new Error('User not found');\r\n      }\r\n\r\n      // Check if user has already viewed the document recently to avoid inflating stats\r\n      const recentView = await prisma.documentView.findFirst({\r\n        where: {\r\n          documentId,\r\n          userId: user.id, // Use the database user ID\r\n          viewedAt: {\r\n            gte: new Date(Date.now() - 24 * 60 * 60 * 1000), // Within last 24 hours\r\n          },\r\n        },\r\n      });\r\n\r\n      if (!recentView) {\r\n        await prisma.documentView.create({\r\n          data: {\r\n            documentId,\r\n            userId: user.id, // Use the database user ID\r\n          },\r\n        });\r\n\r\n        // Increment view count\r\n        await prisma.document.update({\r\n          where: { id: documentId },\r\n          data: {\r\n            viewsCount: {\r\n              increment: 1,\r\n            },\r\n          },\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Database connection error in recordView:', error);\r\n      // Check if this is an authentication error\r\n      if (error instanceof Error &&\r\n          (error.message.includes('Authentication failed') ||\r\n           error.message.includes('password') ||\r\n           error.message.includes('credentials'))) {\r\n        throw new Error('Database authentication failed. Please check your database credentials.');\r\n      }\r\n      throw error; // Re-throw to be handled by the calling function\r\n    }\r\n }\r\n\r\n  /**\r\n   * Get document comments\r\n   */\r\n  async getDocumentComments(\r\n    documentId: string,\r\n    page: number = 1,\r\n    limit: number = 10\r\n  ): Promise<{ comments: DocumentComment[]; total: number }> {\r\n    try {\r\n      const skip = (page - 1) * limit;\r\n\r\n      const [comments, total] = await Promise.all([\r\n        prisma.documentComment.findMany({\r\n          where: { documentId },\r\n          skip,\r\n          take: limit,\r\n          orderBy: { createdAt: 'desc' },\r\n          include: {\r\n            user: true,\r\n          }\r\n        }),\r\n        prisma.documentComment.count({ where: { documentId } }),\r\n      ]);\r\n\r\n      return {\r\n        comments: comments.map((comment: any) => ({\r\n          ...comment,\r\n          parentCommentId: comment.parentCommentId ?? undefined, // Convert null to undefined\r\n          createdAt: new Date(comment.createdAt),\r\n          updatedAt: new Date(comment.updatedAt),\r\n        })),\r\n        total,\r\n      };\r\n    } catch (error) {\r\n      console.error('Database connection error in getDocumentComments:', error);\r\n      // Check if this is an authentication error\r\n      if (error instanceof Error &&\r\n          (error.message.includes('Authentication failed') ||\r\n           error.message.includes('password') ||\r\n           error.message.includes('credentials'))) {\r\n        throw new Error('Database authentication failed. Please check your database credentials.');\r\n      }\r\n      throw error; // Re-throw to be handled by the calling function\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add comment to document\r\n   */\r\n  async addDocumentComment(\r\n    documentId: string,\r\n    userId: string,\r\n    content: string,\r\n    parentCommentId?: string\r\n  ): Promise<DocumentComment> {\r\n    try {\r\n      // Check if document exists\r\n      const document = await prisma.document.findUnique({\r\n        where: { id: documentId },\r\n      });\r\n\r\n      if (!document) {\r\n        throw new Error('Document not found');\r\n      }\r\n\r\n      // Find the user\r\n      const user = await this.findUserById(userId);\r\n\r\n      if (!user) {\r\n        throw new Error('User not found');\r\n      }\r\n\r\n      // Check if user has permission to comment (must have read access)\r\n      // Allow admins and faculty to comment on any document\r\n      if (user.role !== 'ADMIN' && user.role !== 'FACULTY') {\r\n        const permission = await prisma.documentPermission.findFirst({\r\n          where: {\r\n            documentId,\r\n            userId: user.id, // Use the database user ID\r\n            permission: { in: ['READ', 'WRITE', 'ADMIN'] }, // User needs at least READ permission to comment\r\n          },\r\n        });\r\n\r\n        if (!permission && document.uploadedById !== user.id) {\r\n          throw new Error('User does not have permission to comment on this document');\r\n        }\r\n      }\r\n\r\n      if (parentCommentId) {\r\n        // Verify the parent comment exists and belongs to the same document\r\n        const parentComment = await prisma.documentComment.findUnique({\r\n          where: { id: parentCommentId },\r\n        });\r\n\r\n        if (!parentComment || parentComment.documentId !== documentId) {\r\n          throw new Error('Invalid parent comment');\r\n        }\r\n      }\r\n\r\n      const comment = await prisma.documentComment.create({\r\n        data: {\r\n          documentId,\r\n          userId: user.id, // Use the database user ID\r\n          content,\r\n          parentCommentId,\r\n        },\r\n      });\r\n\r\n      return {\r\n        ...comment,\r\n        parentCommentId: comment.parentCommentId ?? undefined, // Convert null to undefined\r\n        createdAt: new Date(comment.createdAt),\r\n        updatedAt: new Date(comment.updatedAt),\r\n      };\r\n    } catch (error) {\r\n      console.error('Database connection error in addDocumentComment:', error);\r\n      // Check if this is an authentication error\r\n      if (error instanceof Error &&\r\n          (error.message.includes('Authentication failed') ||\r\n           error.message.includes('password') ||\r\n           error.message.includes('credentials'))) {\r\n        throw new Error('Database authentication failed. Please check your database credentials.');\r\n      }\r\n      throw error; // Re-throw to be handled by the calling function\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a document by its Colivara document ID\r\n   */\r\n  async getDocumentByColivaraId(colivaraDocumentId: string, userId?: string): Promise<Document | null> {\r\n    try {\r\n      // Validate the colivara document ID format before querying the database\r\n      if (!colivaraDocumentId || typeof colivaraDocumentId !== 'string' || colivaraDocumentId.trim() === '' || colivaraDocumentId.includes('undefined') || colivaraDocumentId.includes('.pdf') || colivaraDocumentId.includes('.')) {\r\n        console.warn('Invalid colivara document ID format received in getDocumentByColivaraId:', colivaraDocumentId);\r\n        return null;\r\n      }\r\n\r\n      // Find the document that has this colivaraDocumentId\r\n      const dbDocument = await prisma.document.findFirst({\r\n        where: {\r\n          colivaraDocumentId: colivaraDocumentId\r\n        },\r\n        include: {\r\n          uploadedByUser: true,\r\n          documentUnit: true,\r\n        }\r\n      });\r\n\r\n      if (!dbDocument) {\r\n        return null;\r\n      }\r\n\r\n      // Check if user has access to the document - reuse the same access logic as getDocumentById\r\n      if (userId) {\r\n        const user = await this.findUserById(userId);\r\n\r\n        if (user && user.role !== 'ADMIN' && user.role !== 'FACULTY') {\r\n          // Check if user has explicit permission for this document\r\n          const permission = await prisma.documentPermission.findFirst({\r\n            where: {\r\n              documentId: dbDocument.id,  // Use the database document ID for permission check\r\n              userId: user.id, // Use the database user ID\r\n              permission: { in: ['READ', 'WRITE', 'ADMIN'] }, // User needs at least READ permission\r\n            },\r\n          });\r\n\r\n          // Allow access if user has explicit READ/WRITE/ADMIN permission OR if user uploaded the document\r\n          if (!permission && dbDocument.uploadedById !== user.id) {\r\n            return null; // User doesn't have access\r\n          }\r\n        }\r\n      }\r\n\r\n      // Return the document in the expected format\r\n      return {\r\n        id: dbDocument.id,\r\n        title: dbDocument.title,\r\n        description: dbDocument.description,\r\n        category: dbDocument.category,\r\n        tags: Array.isArray(dbDocument.tags) ?\r\n          (dbDocument.tags as any[]).map(tag => String(tag)) :\r\n          (typeof dbDocument.tags === 'object' && dbDocument.tags !== null ?\r\n            Object.values(dbDocument.tags).map(tag => String(tag)) : []),\r\n        uploadedBy: dbDocument.uploadedByUser?.name || dbDocument.uploadedBy,\r\n        uploadedById: dbDocument.uploadedById,\r\n        uploadedAt: new Date(dbDocument.uploadedAt),\r\n        fileUrl: dbDocument.fileUrl,\r\n        blobName: dbDocument.blobName ?? undefined, // Azure Blob Storage blob name (UUID.ext)\r\n        fileName: dbDocument.fileName,\r\n        fileType: dbDocument.fileType,\r\n        fileSize: dbDocument.fileSize,\r\n        downloadsCount: dbDocument.downloadsCount || 0, // Convert null to 0\r\n        viewsCount: dbDocument.viewsCount || 0, // Convert null to 0\r\n        version: dbDocument.version || 1,\r\n        versionNotes: dbDocument.versionNotes || undefined, // Convert null to undefined\r\n        status: dbDocument.status as 'ACTIVE' | 'ARCHIVED' | 'PENDING_REVIEW',\r\n        createdAt: new Date(dbDocument.createdAt),\r\n        updatedAt: new Date(dbDocument.updatedAt),\r\n        unitId: dbDocument.unitId || undefined, // Convert null to undefined\r\n        unit: dbDocument.documentUnit ? {\r\n          id: dbDocument.documentUnit.id,\r\n          name: dbDocument.documentUnit.name,\r\n          code: dbDocument.documentUnit.code || \"\", // Provide empty string as fallback since Unit type requires string\r\n          description: dbDocument.documentUnit.description || undefined, // Convert null to undefined\r\n          createdAt: dbDocument.documentUnit.createdAt,\r\n          updatedAt: dbDocument.documentUnit.updatedAt,\r\n        } : undefined,\r\n        colivaraDocumentId: dbDocument.colivaraDocumentId ?? undefined,\r\n        colivaraProcessingStatus: dbDocument.colivaraProcessingStatus as 'PENDING' | 'PROCESSING' | 'COMPLETED' | 'FAILED' ?? undefined,\r\n        colivaraProcessedAt: dbDocument.colivaraProcessedAt ? new Date(dbDocument.colivaraProcessedAt) : undefined,\r\n        colivaraChecksum: dbDocument.colivaraChecksum ?? undefined,\r\n      };\r\n    } catch (error) {\r\n      console.error('Database connection error in getDocumentByColivaraId:', error);\r\n      // Check if this is an authentication error\r\n      if (error instanceof Error &&\r\n          (error.message.includes('Authentication failed') ||\r\n           error.message.includes('password') ||\r\n           error.message.includes('credentials'))) {\r\n        throw new Error('Database authentication failed. Please check your database credentials.');\r\n      }\r\n      throw error; // Re-throw to be handled by the calling function\r\n    }\r\n  }\r\n}\r\n\r\nexport default new DocumentService();"],"names":[],"mappings":"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"}