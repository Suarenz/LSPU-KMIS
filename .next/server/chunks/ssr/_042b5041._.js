module.exports=[87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},50889,a=>{"use strict";let b=new class{secret;constructor(){this.secret=process.env.JWT_SECRET||"6dFk5d0vbyLnZC0Amy83LtI47DsNr/KB4M+FgbUc6njd4cjk7XB2/8nTuhQDWW8OOgQ6fI74huxJE3a/RP2giw=="}stringToUint8Array(a){return new TextEncoder().encode(a)}uint8ArrayToBase64Url(a){let b="";for(let c=0;c<a.byteLength;c++)b+=String.fromCharCode(a[c]);return btoa(b).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async importSecret(){let a=new TextEncoder().encode(this.secret);return await crypto.subtle.importKey("raw",a,{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"])}async generateToken(a){try{let b=Math.floor(Date.now()/1e3),c={...a,iat:b,exp:b+3600},d=this.uint8ArrayToBase64Url(this.stringToUint8Array(JSON.stringify({alg:"HS256",typ:"JWT"}))),e=this.uint8ArrayToBase64Url(this.stringToUint8Array(JSON.stringify(c))),f=`${d}.${e}`,g=await this.importSecret(),h=new TextEncoder().encode(f),i=await crypto.subtle.sign("HMAC",g,h),j=new Uint8Array(i),k=this.uint8ArrayToBase64Url(j);return`${f}.${k}`}catch(a){throw console.error("JWT token generation failed:",a),Error("Failed to generate JWT token")}}async verifyToken(a){try{if(!a||"string"!=typeof a||""===a.trim())return console.error("Invalid token provided for verification"),null;let b=a.split(".");if(3!==b.length)return console.error("Token format is invalid"),null;let[c,d,e]=b;if(!this.base64UrlDecode(c))return console.error("Failed to decode token header"),null;let f=this.base64UrlDecode(d);if(!f)return console.error("Failed to decode token payload"),null;let g=JSON.parse(f),h=Math.floor(Date.now()/1e3);if(g.exp&&g.exp<h)return console.error("Token has expired"),null;let i=await this.importSecret();if(!await this.verifySignature(`${c}.${d}`,e,i))return console.error("Token signature verification failed"),null;return g}catch(a){return console.error("Token verification failed:",a?.message||a),null}}async verifySignature(a,b,c){try{let d=this.base64UrlDecodeToUint8Array(b);if(!d)return!1;let e=new TextEncoder().encode(a),f=new Uint8Array(d.buffer,d.byteOffset,d.byteLength),g=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return await crypto.subtle.verify("HMAC",c,f,g)}catch(a){return console.error("Signature verification error:",a),!1}}decodeToken(a){try{if(!a||"string"!=typeof a||""===a.trim())return null;let b=a.split(".");if(3!==b.length)return console.error("Token format is invalid"),null;let c=b[1],d=this.base64UrlDecode(c);if(!d)return null;return JSON.parse(d)}catch(a){return console.error("Token decoding failed:",a?.message||a),null}}isTokenExpired(a){try{let b=this.decodeToken(a);if(!b||!b.exp)return!0;let c=Math.floor(Date.now()/1e3);return b.exp<c}catch(a){return console.error("Error checking token expiration:",a),!0}}base64UrlDecode(a){try{let b="=".repeat((4-a.length%4)%4),c=a.replace(/-/g,"+").replace(/_/g,"/")+b,d=atob(c);return decodeURIComponent(escape(d))}catch(a){return console.error("Base64 URL decode error:",a),null}}base64UrlDecodeToUint8Array(a){try{let b="=".repeat((4-a.length%4)%4),c=a.replace(/-/g,"+").replace(/_/g,"/")+b,d=atob(c),e=new Uint8Array(d.length);for(let a=0;a<d.length;a++)e[a]=d.charCodeAt(a);return e}catch(a){return console.error("Base64 URL decode to Uint8Array error:",a),null}}};class c{sessionValidationDebounce=null;constructor(){}getCachedSession(){return null}setCachedSession(a,b=3e5){}clearCachedSession(){}getLastAuthCheck(){return null}setLastAuthCheck(a){}async validateSessionWithoutLoading(){return this.sessionValidationDebounce&&clearTimeout(this.sessionValidationDebounce),new Promise(a=>{this.sessionValidationDebounce=setTimeout(async()=>{try{let c=this.getAccessTokenFromStorage();if(!c)return void a(!1);b.verifyToken(c).then(b=>{a(!!b)}).catch(()=>a(!1))}catch(b){console.error("Session validation error:",b),a(!1)}},500)})}getAccessTokenFromStorage(){return null}setAccessTokenInStorage(a){}removeAccessTokenFromStorage(){}async login(a,b){try{let c=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:b})});if(!c.ok){let a=await c.json().catch(()=>({}));return{success:!1,error:a.error||"Login failed"}}let d=await c.json();if(!d.success||!d.token||!d.user)return{success:!1,error:d.error||"Login failed"};{this.setAccessTokenInStorage(d.token);let a=this.generateMockRefreshToken();localStorage.setItem("refresh_token",a),this.refreshTokensStore.set(a,{userId:d.user.id,email:d.user.email,role:d.user.role});let b={id:d.user.id,email:d.user.email,name:d.user.name,role:d.user.role,unitId:d.user.unitId||void 0};return{success:!0,user:b}}}catch(a){return console.error("Login error:",a),{success:!1,error:"An unexpected error occurred during login"}}}async signup(a,b,c,d="STUDENT",e){try{let f=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:b,name:c,role:d,department:e})});if(!f.ok){let a=await f.json().catch(()=>({}));return{success:!1,error:a.error||"Signup failed"}}let g=await f.json();if(!g.success||!g.token||!g.user)return{success:!1,error:g.error||"Signup failed"};{this.setAccessTokenInStorage(g.token);let a=this.generateMockRefreshToken();localStorage.setItem("refresh_token",a),this.refreshTokensStore.set(a,{userId:g.user.id,email:g.user.email,role:g.user.role});let b={id:g.user.id,email:g.user.email,name:g.user.name,role:g.user.role,unitId:g.user.unitId||void 0};return{success:!0,user:b}}}catch(a){return console.error("Signup error:",a),{success:!1,error:"An unexpected error occurred during signup"}}}async logout(){try{await fetch("/api/auth/logout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.getAccessTokenFromStorage()}`}});let a=localStorage.getItem("refresh_token");this.removeAccessTokenFromStorage(),localStorage.removeItem("refresh_token"),a&&this.refreshTokensStore.delete(a)}catch(b){console.error("Logout error:",b);let a=localStorage.getItem("refresh_token");this.removeAccessTokenFromStorage(),localStorage.removeItem("refresh_token"),a&&this.refreshTokensStore.delete(a)}}async getCurrentUser(){try{let a=this.getAccessTokenFromStorage();if(!a||!await b.verifyToken(a))return null;let c=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!c.ok){if(401===c.status&&await this.refreshToken()){let a=this.getAccessTokenFromStorage();if(a){let b=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!b.ok)return null;let c=await b.json();if(c.user)return{id:c.user.id,email:c.user.email,name:c.user.name,role:c.user.role,unitId:c.user.unitId||void 0}}}return null}let d=await c.json();if(d.user)return{id:d.user.id,email:d.user.email,name:d.user.name,role:d.user.role,unitId:d.user.unitId||void 0};return null}catch(a){return console.error("Error in getCurrentUser:",a),null}}async getSession(){let a=this.getAccessTokenFromStorage();if(!a)return null;{let c=await b.verifyToken(a);if(!c){if(await this.refreshToken()){let a=this.getAccessTokenFromStorage();if(a){let c=await b.verifyToken(a);return c?{access_token:a,expires_at:c.exp}:null}}return null}return c?{access_token:a,expires_at:c.exp}:null}}async getUser(){return await this.getCurrentUser()}refreshTokensStore=new Map;generateMockRefreshToken(){return`mock_refresh_token_${Date.now()}_${Math.random().toString(36).substring(2,15)}`}async refreshToken(){try{let a=localStorage.getItem("refresh_token");if(!a)return!1;let b=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:a})});if(!b.ok)return this.removeAccessTokenFromStorage(),localStorage.removeItem("refresh_token"),this.refreshTokensStore.delete(a),!1;let c=await b.json();if(c.token)return this.setAccessTokenInStorage(c.token),!0;return!1}catch(a){return console.error("Error refreshing token:",a),!1}}async updatePassword(a){try{let b=await this.getAccessToken();if(!b)return{error:"User not authenticated"};let c=await fetch("/api/auth/update-password",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({newPassword:a})});if(!c.ok){if(401===c.status&&await this.refreshToken()){let b=await this.getAccessToken();if(b){let c=await fetch("/api/auth/update-password",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({newPassword:a})});if(!c.ok)return{error:(await c.json().catch(()=>({}))).error||"Failed to update password"};return{error:null}}}return{error:(await c.json().catch(()=>({}))).error||"Failed to update password"}}return{error:null}}catch(a){return console.error("Error updating password:",a),{error:"Failed to update password"}}}async resetPassword(a){try{let b=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})});if(!b.ok)return{error:(await b.json().catch(()=>({}))).error||"Failed to reset password"};return{error:null}}catch(a){return console.error("Error resetting password:",a),{error:"Failed to reset password"}}}async isAuthenticated(){try{let a=this.getAccessTokenFromStorage();if(!a)return!1;return!!await b.verifyToken(a)}catch(a){return console.error("Error in isAuthenticated:",a),!1}}async getAccessToken(){try{let a=this.getAccessTokenFromStorage();if(!a)return null;return await b.verifyToken(a)?a:null}catch(a){return console.error("Error getting access token:",a),null}}async getComprehensiveUserData(){try{let a=this.getCachedSession();if(a)return a;let b=await this.getAccessToken();if(!b)return!await this.isAuthenticated(),{authenticated:!1,user:null};let c=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"}});if(!c.ok){if(401===c.status||404===c.status){if(await this.refreshToken()){let a=await this.getAccessToken();if(a){let b=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!b.ok)return this.clearCachedSession(),{authenticated:!1,user:null};let c=await b.json();return this.setCachedSession(c),c}}return this.clearCachedSession(),{authenticated:!1,user:null}}let a=await c.json().catch(()=>({}));throw Error(a.error||`Failed to fetch user data: ${c.status} ${c.statusText}`)}let d=await c.json();return this.setCachedSession(d),d}catch(a){return console.error("Error fetching comprehensive user data:",a),a instanceof Error&&a.message.includes("No authentication token available"),this.clearCachedSession(),{authenticated:!1,user:null}}}clearCache(){this.clearCachedSession()}}let d=new c;a.s(["default",0,d],50889)},21937,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50889);let e={user:null,login:async()=>({success:!1,error:"Auth service not initialized"}),logout:async()=>{},isAuthenticated:!1,isLoading:!0,error:null},f=(0,c.createContext)(void 0);function g({children:a}){let[e,g]=(0,c.useState)(null),[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(!0),[l,m]=(0,c.useState)(null),[n]=(0,c.useState)(d.default);(0,c.useEffect)(()=>(k(!1),()=>{}),[]);let o=async(a,b)=>{k(!0),m(null);try{let c=await n.login(a,b);if(c.success&&c.user)return g(c.user),i(!0),k(!1),c;return m(c.error||"Login failed"),k(!1),c}catch(a){return console.error("Login error:",a),m("An error occurred during login"),k(!1),{success:!1,error:"An error occurred during login"}}},p=async()=>{k(!0);try{await n.logout(),g(null),i(!1),k(!1)}catch(a){console.error("Logout error:",a),g(null),i(!1),k(!1)}};return(0,b.jsx)(f.Provider,{value:{user:e,login:o,logout:p,isAuthenticated:h,isLoading:j,error:l},children:a})}function h(){let a=(0,c.useContext)(f);return void 0===a?e:a}a.s(["AuthProvider",()=>g,"useAuth",()=>h])}];

//# sourceMappingURL=_042b5041._.js.map