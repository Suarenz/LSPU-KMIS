module.exports=[18622,(e,r,t)=>{r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,r,t)=>{r.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,r,t)=>{r.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},29173,(e,r,t)=>{r.exports=e.x("@prisma/client",()=>require("@prisma/client"))},15270,e=>{"use strict";var r=e.i(29173);let t=globalThis.prisma||new r.PrismaClient({log:["query","info","warn","error"]});e.s(["default",0,t])},75188,e=>{"use strict";let r=new class{secret;constructor(){this.secret=process.env.JWT_SECRET||"6dFk5d0vbyLnZC0Amy83LtI47DsNr/KB4M+FgbUc6njd4cjk7XB2/8nTuhQDWW8OOgQ6fI74huxJE3a/RP2giw=="}stringToUint8Array(e){return new TextEncoder().encode(e)}uint8ArrayToBase64Url(e){let r="";for(let t=0;t<e.byteLength;t++)r+=String.fromCharCode(e[t]);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async importSecret(){let e=new TextEncoder().encode(this.secret);return await crypto.subtle.importKey("raw",e,{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"])}async generateToken(e){try{let r=Math.floor(Date.now()/1e3),t={...e,iat:r,exp:r+3600},n=this.uint8ArrayToBase64Url(this.stringToUint8Array(JSON.stringify({alg:"HS256",typ:"JWT"}))),s=this.uint8ArrayToBase64Url(this.stringToUint8Array(JSON.stringify(t))),o=`${n}.${s}`,i=await this.importSecret(),a=new TextEncoder().encode(o),l=await crypto.subtle.sign("HMAC",i,a),c=new Uint8Array(l),u=this.uint8ArrayToBase64Url(c);return`${o}.${u}`}catch(e){throw console.error("JWT token generation failed:",e),Error("Failed to generate JWT token")}}async verifyToken(e){try{if(!e||"string"!=typeof e||""===e.trim())return console.error("Invalid token provided for verification"),null;let r=e.split(".");if(3!==r.length)return console.error("Token format is invalid"),null;let[t,n,s]=r;if(!this.base64UrlDecode(t))return console.error("Failed to decode token header"),null;let o=this.base64UrlDecode(n);if(!o)return console.error("Failed to decode token payload"),null;let i=JSON.parse(o),a=Math.floor(Date.now()/1e3);if(i.exp&&i.exp<a)return console.error("Token has expired"),null;let l=await this.importSecret();if(!await this.verifySignature(`${t}.${n}`,s,l))return console.error("Token signature verification failed"),null;return i}catch(e){return console.error("Token verification failed:",e?.message||e),null}}async verifySignature(e,r,t){try{let n=this.base64UrlDecodeToUint8Array(r);if(!n)return!1;let s=new TextEncoder().encode(e),o=new Uint8Array(n.buffer,n.byteOffset,n.byteLength),i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);return await crypto.subtle.verify("HMAC",t,o,i)}catch(e){return console.error("Signature verification error:",e),!1}}decodeToken(e){try{if(!e||"string"!=typeof e||""===e.trim())return null;let r=e.split(".");if(3!==r.length)return console.error("Token format is invalid"),null;let t=r[1],n=this.base64UrlDecode(t);if(!n)return null;return JSON.parse(n)}catch(e){return console.error("Token decoding failed:",e?.message||e),null}}isTokenExpired(e){try{let r=this.decodeToken(e);if(!r||!r.exp)return!0;let t=Math.floor(Date.now()/1e3);return r.exp<t}catch(e){return console.error("Error checking token expiration:",e),!0}}base64UrlDecode(e){try{let r="=".repeat((4-e.length%4)%4),t=e.replace(/-/g,"+").replace(/_/g,"/")+r,n=atob(t);return decodeURIComponent(escape(n))}catch(e){return console.error("Base64 URL decode error:",e),null}}base64UrlDecodeToUint8Array(e){try{let r="=".repeat((4-e.length%4)%4),t=e.replace(/-/g,"+").replace(/_/g,"/")+r,n=atob(t),s=new Uint8Array(n.length);for(let e=0;e<n.length;e++)s[e]=n.charCodeAt(e);return s}catch(e){return console.error("Base64 URL decode to Uint8Array error:",e),null}}};e.s(["default",0,r])},81563,83274,e=>{"use strict";var r=e.i(89171),t=e.i(75188),n=e.i(15270);function s(e,r){return e===r}function o(e,r){return r.includes(e)}async function i(e,s){let i=e.headers.get("authorization"),a=null;if(i&&i.startsWith("Bearer "))a=i.substring(7);else{let r=e.cookies;a=r.get("access_token")?.value}if(!a)return e.nextUrl.pathname.startsWith("/api/")?r.NextResponse.json({error:"Authentication required"},{status:401}):r.NextResponse.redirect(new URL("/login",e.url));let l=await t.default.verifyToken(a);if(!l)return(console.error("Token verification failed:",a?a.substring(0,20)+"...":"null"),e.nextUrl.pathname.startsWith("/api/"))?r.NextResponse.json({error:"Invalid or expired token"},{status:401}):r.NextResponse.redirect(new URL("/",e.url));if(console.log("Decoded token:",l),!l.userId)return(console.error("Token does not contain userId:",l),e.nextUrl.pathname.startsWith("/api/"))?r.NextResponse.json({error:"Invalid token: missing user ID"},{status:401}):r.NextResponse.redirect(new URL("/login",e.url));let c=await n.default.user.findUnique({where:{id:l.userId},select:{id:!0,email:!0,name:!0,role:!0,unitId:!0}});return c?s&&s.length>0&&!o(c.role,s)?e.nextUrl.pathname.startsWith("/api/")?r.NextResponse.json({error:"User does not have required role to perform this action"},{status:403}):r.NextResponse.redirect(new URL("/unauthorized",e.url)):{user:c}:(console.error("User not found with ID from token:",l.userId),r.NextResponse.redirect(new URL("/login",e.url)))}e.s(["hasAnyRole",()=>o,"hasRole",()=>s],83274),e.s(["requireAuth",()=>i],81563)},18865,50674,e=>{"use strict";class r{static instance;config;requestCounts=new Map;constructor(){this.config={rateLimit:{maxRequests:parseInt(process.env.AI_MAX_REQUESTS_PER_HOUR||"60",10),windowMs:36e5},apiKeyRotationInterval:parseInt(process.env.API_KEY_ROTATION_INTERVAL_HOURS||"24",10),requestTimeout:parseInt(process.env.AI_REQUEST_TIMEOUT||"30000",10)}}static getInstance(){return r.instance||(r.instance=new r),r.instance}isRequestAllowed(e){let r=Date.now();this.config.rateLimit.windowMs;let t=this.requestCounts.get(e);return!t||t.resetTime<r?(this.requestCounts.set(e,{count:1,resetTime:r+this.config.rateLimit.windowMs}),!0):!(t.count>=this.config.rateLimit.maxRequests)&&(this.requestCounts.set(e,{count:t.count+1,resetTime:t.resetTime}),!0)}getRemainingRequests(e){let r=Date.now(),t=this.requestCounts.get(e);return!t||t.resetTime<r?this.config.rateLimit.maxRequests:Math.max(0,this.config.rateLimit.maxRequests-t.count)}getResetTime(e){let r=this.requestCounts.get(e);return r?r.resetTime:Date.now()+this.config.rateLimit.windowMs}getSecurityConfig(){return{...this.config}}validateApiKey(e){return e.trim().length>0}async healthCheck(){try{let e=process.env.AI_API_KEY;if(!e)return console.error("AI_API_KEY is not set"),!1;if(!e.trim())return console.error("AI_API_KEY is empty"),!1;return!0}catch(e){return console.error("AI API health check failed:",e),!1}}}e.s(["default",0,r],18865);class t{static instance;config;metrics=[];maxMetricsStored=1e3;constructor(){this.config={logPerformance:"true"===process.env.LOG_PERFORMANCE||!0,logErrors:"true"===process.env.LOG_ERRORS||!0,logUsage:"true"===process.env.LOG_USAGE||!0,performanceThreshold:parseInt(process.env.PERFORMANCE_THRESHOLD_MS||"5000",10)}}static getInstance(){return t.instance||(t.instance=new t),t.instance}logMetric(e){if(!this.config.logPerformance&&!this.config.logUsage)return;let r={...e,timestamp:new Date};this.metrics.push(r),this.metrics.length>this.maxMetricsStored&&(this.metrics=this.metrics.slice(-this.maxMetricsStored)),e.success?this.config.logPerformance&&console.log(`[PERFORMANCE] ${e.endpoint} took ${e.responseTime}ms for user ${e.userId||"unknown"}`):this.config.logErrors&&console.error(`[ERROR] ${e.endpoint} failed for user ${e.userId||"unknown"}: ${e.error}`),e.responseTime>this.config.performanceThreshold&&console.warn(`[PERFORMANCE ALERT] ${e.endpoint} exceeded threshold: ${e.responseTime}ms > ${this.config.performanceThreshold}ms`)}trackUsage(e,r,t){this.config.logUsage&&console.log(`[USAGE] User ${e} accessed ${r}${t?` using model ${t}`:""} at ${new Date().toISOString()}`)}trackGeneration(e,r,t,n,s,o){this.logMetric({endpoint:"ai-generation",responseTime:t,userId:e,query:r,success:n,error:s,model:o})}trackSearch(e,r,t,n,s){this.logMetric({endpoint:"search",responseTime:t,userId:e,query:r,success:n,error:s})}getPerformanceSummary(e){let r=this.metrics.filter(r=>r.endpoint===e);if(0===r.length)return{avgResponseTime:0,minResponseTime:0,maxResponseTime:0,totalRequests:0,successfulRequests:0,failedRequests:0,errorRate:0};let t=r.map(e=>e.responseTime),n=r.filter(e=>e.success).length,s=r.filter(e=>!e.success).length,o=t.reduce((e,r)=>e+r,0)/t.length,i=Math.min(...t),a=Math.max(...t),l=r.length;return{avgResponseTime:o,minResponseTime:i,maxResponseTime:a,totalRequests:l,successfulRequests:n,failedRequests:s,errorRate:s/l}}getAllMetrics(){return[...this.metrics]}clearMetrics(){this.metrics=[]}getConfig(){return{...this.config}}updateConfig(e){this.config={...this.config,...e}}}e.s(["default",0,t],50674)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__3895d85e._.js.map