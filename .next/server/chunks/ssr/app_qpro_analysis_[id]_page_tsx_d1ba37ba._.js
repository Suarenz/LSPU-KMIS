module.exports=[13955,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(21937),f=a.i(10815),g=a.i(40695),h=a.i(3130),i=a.i(96221),j=a.i(13749),k=a.i(92e3),l=a.i(54161),m=a.i(17171),n=a.i(77687),o=a.i(87682),p=a.i(53722),q=a.i(70106);let r=(0,q.default)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);var s=a.i(69439),t=a.i(50429),u=a.i(69520),v=a.i(16201),w=a.i(4720);let x=(0,q.default)("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),y={"KRA 1":"Development of New Curricula","KRA 2":"Accreditation","KRA 3":"Quality and Relevance of Instruction","KRA 4":"International Activities","KRA 5":"Research Outputs","KRA 6":"Extension Programs","KRA 7":"Community Partnerships","KRA 8":"Technology Transfer","KRA 9":"Revenue Generation","KRA 10":"Resource Mobilization","KRA 11":"Human Resource Management","KRA 12":"Student Development","KRA 13":"Health and Wellness","KRA 14":"Environmental Sustainability","KRA 15":"Quality Management","KRA 16":"Governance","KRA 17":"Digital Transformation",UNCLASSIFIED:"Uncategorized Activities"};function z({classifications:a,isApproved:c=!1}){let d=a.map(a=>{var b,c;return{...a,title:(b=a.id,c=a.title,y[b]||c||b)}}),e=d.reduce((a,b)=>a+b.count,0);return(0,b.jsxs)(h.Card,{className:"border rounded-lg bg-white",children:[(0,b.jsx)(h.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(h.CardTitle,{className:"flex items-center gap-2 text-base",children:[(0,b.jsx)(x,{className:"w-5 h-5 text-slate-600"}),"KRA Classification Review"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[e>0&&(0,b.jsxs)(l.Badge,{variant:"secondary",className:"text-slate-600",children:[e," Total Records"]}),c&&(0,b.jsxs)(l.Badge,{variant:"outline",className:"text-green-600 border-green-600",children:[(0,b.jsx)(v.CheckCircle,{className:"w-3 h-3 mr-1"}),"Verified"]})]})]})}),(0,b.jsx)(h.CardContent,{className:"space-y-2",children:0===d.length?(0,b.jsxs)("div",{className:"text-center py-6 text-slate-500",children:[(0,b.jsx)(w.FileText,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,b.jsx)("p",{className:"text-sm",children:"No KRA classifications found"})]}):d.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200 hover:bg-slate-100 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center",children:(0,b.jsx)(w.FileText,{className:"w-4 h-4 text-slate-600"})}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"font-medium text-sm text-slate-800",children:a.title}),a.kpiName&&(0,b.jsx)("span",{className:"text-xs text-slate-500",children:a.kpiName})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("span",{className:"block text-lg font-bold text-slate-900",children:a.count}),(0,b.jsx)("span",{className:"text-[10px] uppercase text-slate-500 font-semibold tracking-wider",children:1===a.count?"Record Found":"Records Found"})]})]},a.id))})]})}var A=a.i(4699),A=A,B=a.i(98091),B=B,C=a.i(24669);let D=(0,q.default)("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);var E=a.i(67453),F=a.i(41710);let G={MET:{color:"bg-green-100",textColor:"text-green-900",borderColor:"border-green-300",icon:E.CheckCircle2,label:"Target Met",badgeClass:"bg-green-600"},ON_TRACK:{color:"bg-blue-100",textColor:"text-blue-900",borderColor:"border-blue-300",icon:C.TrendingUp,label:"On Track",badgeClass:"bg-blue-600"},PARTIAL:{color:"bg-yellow-100",textColor:"text-yellow-900",borderColor:"border-yellow-300",icon:F.Clock,label:"Partial Progress",badgeClass:"bg-yellow-600"},NOT_STARTED:{color:"bg-red-100",textColor:"text-red-900",borderColor:"border-red-300",icon:k.AlertCircle,label:"Not Started",badgeClass:"bg-red-600"}};function H({kpi:a,expanded:c,onToggle:d}){let e,f,g,i,j,k=G[a.status],m=k.icon;return(0,b.jsxs)(h.Card,{className:`border-l-4 ${k.borderColor}`,children:[(0,b.jsx)(h.CardHeader,{className:"pb-3 cursor-pointer",onClick:d,children:(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start gap-2 sm:gap-3 sm:justify-between",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0 pr-2",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 mb-2",children:[(0,b.jsxs)("h3",{className:"font-semibold text-sm sm:text-base text-slate-900 truncate",children:[a.kraId," - ",a.kpiTitle]}),(0,b.jsx)(l.Badge,{className:`${k.badgeClass} text-white shrink-0 whitespace-nowrap`,children:k.label})]}),(0,b.jsx)("p",{className:"text-xs text-slate-600 line-clamp-1",children:a.kraTitle})]}),(0,b.jsx)("div",{className:"shrink-0 flex items-center justify-end",children:c?(0,b.jsx)(B.default,{className:"w-5 h-5 text-slate-400"}):(0,b.jsx)(A.default,{className:"w-5 h-5 text-slate-400"})})]})}),(0,b.jsxs)(h.CardContent,{className:"space-y-4 pt-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-slate-700",children:"Target Progress"}),(0,b.jsxs)("span",{className:`text-2xl sm:text-2xl font-bold ${k.textColor}`,children:[a.completionPercentage,"%"]})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[(0,b.jsx)("div",{className:"flex-1 bg-slate-200 rounded-full h-3 overflow-hidden",children:(0,b.jsx)("div",{className:`h-full transition-all rounded-full ${k.badgeClass}`,style:{width:`${Math.min(a.completionPercentage,100)}%`}})}),(0,b.jsx)("span",{className:"text-xs text-slate-600 font-medium shrink-0",children:(f=(e=Number.isFinite(a.totalTarget)&&Number.isFinite(a.totalReported)&&a.totalTarget>0&&a.totalTarget<=100&&a.totalReported>=0&&a.totalReported<=100)?`${a.totalReported.toFixed(2)}%`:String(a.totalReported),g=e?`${a.totalTarget.toFixed(2)}%`:String(a.totalTarget),i=Number(a.totalReported),j=Number(a.totalTarget),(0===i||Number.isNaN(i))&&(0===j||Number.isNaN(j))?"":`${f}/${g}`)})]})]}),(0,b.jsx)("div",{className:`p-3 rounded-lg ${k.color} border ${k.borderColor}`,children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(m,{className:"w-5 h-5 shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:`text-sm font-semibold ${k.textColor}`,children:k.label}),(0,b.jsx)("p",{className:"text-xs text-slate-700 mt-0.5 wrap-break-word",children:a.completionPercentage>=100?"Target achieved":`${100-a.completionPercentage}% remaining`})]})]})}),c&&(0,b.jsxs)("div",{className:"space-y-3 pt-3 border-t",children:[(0,b.jsxs)("h4",{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[(0,b.jsx)(D,{className:"w-4 h-4"}),"Activities (",a.activities.length,")"]}),(0,b.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:a.activities.map((a,c)=>(0,b.jsxs)("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 hover:border-slate-300 transition-colors",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 mb-3",children:[(0,b.jsx)("h5",{className:"text-sm font-medium text-slate-900 flex-1 min-w-0",children:a.title}),(0,b.jsx)(l.Badge,{variant:"outline",className:`text-xs shrink-0 whitespace-nowrap ${"MET"===a.status?"bg-green-50 text-green-700 border-green-200":"PARTIAL"===a.status?"bg-yellow-50 text-yellow-700 border-yellow-200":"bg-red-50 text-red-700 border-red-200"}`,children:a.status})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-2 mb-3 text-xs",children:[(0,b.jsxs)("div",{className:"bg-white p-2 rounded border border-slate-100",children:[(0,b.jsx)("p",{className:"text-slate-600 font-medium mb-0.5",children:"Target"}),(0,b.jsx)("p",{className:"font-semibold text-slate-900",children:a.target})]}),(0,b.jsxs)("div",{className:"bg-white p-2 rounded border border-slate-100",children:[(0,b.jsx)("p",{className:"text-slate-600 font-medium mb-0.5",children:"Reported"}),(0,b.jsx)("p",{className:"font-semibold text-slate-900",children:a.reported})]}),(0,b.jsxs)("div",{className:"bg-white p-2 rounded border border-slate-100",children:[(0,b.jsx)("p",{className:"text-slate-600 font-medium mb-0.5",children:"Achievement"}),(0,b.jsxs)("p",{className:"font-semibold text-slate-900",children:[a.achievement,"%"]})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 sm:gap-2 text-xs",children:[(0,b.jsx)("span",{className:"text-slate-600",children:"Progress"}),(0,b.jsxs)("span",{className:"text-slate-600 shrink-0",children:[(100*a.confidence).toFixed(0),"% confident"]})]}),(0,b.jsx)("div",{className:"flex-1 bg-slate-300 rounded h-1.5 overflow-hidden",children:(0,b.jsx)("div",{className:`h-full rounded ${"MET"===a.status?"bg-green-600":"PARTIAL"===a.status?"bg-yellow-600":"bg-red-600"}`,style:{width:`${Math.min(a.achievement,100)}%`}})})]})]},c))})]})]})]})}function I({kpiGroups:a,selectedQuarter:d,selectedYear:e=2025}){let[f,g]=(0,c.useState)(null),i=(0,c.useMemo)(()=>{let b=a.length,c=a.filter(a=>"MET"===a.status).length,d=a.filter(a=>"ON_TRACK"===a.status).length,e=a.filter(a=>"PARTIAL"===a.status).length,f=a.filter(a=>"NOT_STARTED"===a.status).length,g=a.reduce((a,b)=>a+b.completionPercentage,0)/b;return{total:b,met:c,onTrack:d,partial:e,notStarted:f,avgCompletion:g,totalActivities:a.reduce((a,b)=>a+b.activities.length,0)}},[a]);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsx)(h.CardTitle,{children:"KPI Performance Dashboard"})}),(0,b.jsx)(h.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[(0,b.jsxs)("div",{className:"p-3 bg-slate-50 rounded-lg",children:[(0,b.jsx)("p",{className:"text-xs text-slate-600 uppercase font-semibold",children:"Total KPIs"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-slate-900 mt-1",children:i.total})]}),(0,b.jsxs)("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[(0,b.jsx)("p",{className:"text-xs text-green-700 uppercase font-semibold",children:"Met"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-green-900 mt-1",children:i.met})]}),(0,b.jsxs)("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[(0,b.jsx)("p",{className:"text-xs text-blue-700 uppercase font-semibold",children:"On Track"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:i.onTrack})]}),(0,b.jsxs)("div",{className:"p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:[(0,b.jsx)("p",{className:"text-xs text-yellow-700 uppercase font-semibold",children:"Partial"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-yellow-900 mt-1",children:i.partial})]}),(0,b.jsxs)("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200",children:[(0,b.jsx)("p",{className:"text-xs text-red-700 uppercase font-semibold",children:"Not Started"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-red-900 mt-1",children:i.notStarted})]}),(0,b.jsxs)("div",{className:"p-3 bg-purple-50 rounded-lg border border-purple-200",children:[(0,b.jsx)("p",{className:"text-xs text-purple-700 uppercase font-semibold",children:"Avg Completion"}),(0,b.jsxs)("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:[i.avgCompletion.toFixed(0),"%"]})]})]})})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900 px-1",children:"KPI-Level Breakdown"}),a.map(a=>(0,b.jsx)(H,{kpi:a,expanded:f===a.kpiId,onToggle:()=>g(f===a.kpiId?null:a.kpiId)},a.kpiId))]})]})}var J=a.i(50889);function K(a){if(!a)return"";if("string"!=typeof a){if(Array.isArray(a))return a.map(a=>K(a)).join("\n");if("object"==typeof a){if(a.action)return`${a.action}${a.timeline?` (${a.timeline})`:""}`;if(a.recommendation)return a.recommendation;try{return JSON.stringify(a)}catch{}}return String(a)}let b=a;try{let a=JSON.parse(b);if(Array.isArray(a))return a.map(a=>"string"==typeof a?a:a?.action?a.action:a?.recommendation?a.recommendation:String(a)).join("\n• ");if("object"==typeof a&&null!==a){if(a.action)return a.action;if(a.recommendation)return a.recommendation}}catch{}return(b=(b=(b=(b=(b=b.replace(/^#{1,3}\s+/gm,"")).replace(/\*\*([^*]+)\*\*/g,"$1")).replace(/\*([^*]+)\*/g,"$1")).replace(/^\["|"\]$/g,"")).replace(/","/g,", ")).trim()}function L(a){if(!a)return null;let c=a.split("\n").filter(a=>a.trim()),d=[],e=[],f=null,g=()=>{e.length>0&&("numbered"===f?d.push((0,b.jsx)("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:e.map((a,c)=>(0,b.jsx)("li",{children:K(a)},c))},`ol-${d.length}`)):d.push((0,b.jsx)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:e.map((a,c)=>(0,b.jsx)("li",{children:K(a)},c))},`ul-${d.length}`)),e=[],f=null)};return c.forEach((a,c)=>{let h=a.trim();if(h.startsWith("###")||h.startsWith("##")||h.startsWith("#")){g();let a=h.replace(/^#{1,3}\s+/,"");d.push((0,b.jsx)("p",{className:"font-semibold mt-3 first:mt-0",children:K(a)},`h-${c}`));return}let i=h.match(/^\d+\.\s+(.+)/);if(i){"numbered"!==f&&(g(),f="numbered"),e.push(i[1]);return}let j=h.match(/^[-*]\s+(.+)/);if(j){"bullet"!==f&&(g(),f="bullet"),e.push(j[1]);return}g(),h&&d.push((0,b.jsx)("p",{className:"mb-2 last:mb-0",children:K(h)},`p-${c}`))}),g(),(0,b.jsx)("div",{className:"space-y-2",children:d})}let M={"KRA 1":"Development of New Curricula","KRA 2":"Accreditation","KRA 3":"Quality and Relevance of Instruction","KRA 4":"International Activities","KRA 5":"Research Outputs","KRA 6":"Extension Programs","KRA 7":"Community Partnerships","KRA 8":"Technology Transfer","KRA 9":"Revenue Generation","KRA 10":"Resource Mobilization","KRA 11":"Human Resource Management","KRA 12":"Student Development","KRA 13":"Health and Wellness","KRA 14":"Environmental Sustainability","KRA 15":"Quality Management","KRA 16":"Governance","KRA 17":"Digital Transformation",UNCLASSIFIED:"Uncategorized Activities"},N=[{id:"KRA 1",title:"Development of New Curricula Incorporating Emerging Technologies"},{id:"KRA 2",title:"Market-Driven Program Design and Implementation"},{id:"KRA 3",title:"Quality and Relevance of Instruction"},{id:"KRA 4",title:"College and Office International Activities and Projects"},{id:"KRA 5",title:"Research, Extension, and Innovation Productivity"},{id:"KRA 6",title:"Research, Extension, and Innovation Linkages"},{id:"KRA 7",title:"Research, Extension, and Innovation Resources"},{id:"KRA 8",title:"Service to the Community"},{id:"KRA 9",title:"Implementation of Sustainable Governance"},{id:"KRA 10",title:"Transforming into Green University"},{id:"KRA 11",title:"Judicious Management of Human Resources"},{id:"KRA 12",title:"Internationalized/Global University Stakeholders"},{id:"KRA 13",title:"Competitive Human Resources"},{id:"KRA 14",title:"Improved Satisfaction Rating of the Students, Faculty, and Personnel of the University"},{id:"KRA 15",title:"Certification and Compliance to Regulatory Requirements"},{id:"KRA 16",title:"Updating of Learning Materials and Facilities"},{id:"KRA 17",title:"Digital Transformation and Smart Campus Enablement"},{id:"KRA 18",title:"Risk Management and Compliance"},{id:"KRA 19",title:"Revenue Growth and Operational Efficiency"},{id:"KRA 20",title:"Related IGP Industry Engagement"},{id:"KRA 21",title:"Responsive Management of Resources"},{id:"KRA 22",title:"Management of Financial Resources"}];function O({analysisId:a}){let d,e,f,j,q,{toast:v}=(0,n.useToast)(),[w,x]=(0,c.useState)(null),[y,A]=(0,c.useState)(!0),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)({}),[F,G]=(0,c.useState)(new Set),[H,K]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let b=async()=>{try{A(!0),C(null);let b=await J.default.getAccessToken();if(!b)throw Error("Authentication required. Please log in again.");let c=await fetch(`/api/qpro/analyses/${a}`,{headers:{Authorization:`Bearer ${b}`}});if(!c.ok)throw Error("Failed to load analysis");let d=await c.json();x(d)}catch(a){C(a instanceof Error?a.message:"Failed to load analysis")}finally{A(!1)}};a&&b()},[a]);let O=async()=>{if(0===F.size)return void C("No KRA changes to regenerate");try{K(!0),C(null),v({title:"Regenerating Insights",description:`Analyzing ${F.size} activities with corrected KPI types...`,duration:3e3});let b=await J.default.getAccessToken();if(!b)throw Error("Authentication required");let c=w.organizedActivities.flatMap(a=>(a.activities||[]).map((b,c)=>({...b,name:b.title||`Activity ${c}`,kraId:D[`${a.kraId}-${c}`]||a.kraId,index:c}))).filter(a=>F.has(`${a.kraId}-${a.index}`)),d=await fetch("/api/qpro/regenerate-insights",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({analysisId:a,activities:c})});if(!d.ok){let a=await d.json();throw Error(a.error||"Failed to regenerate insights")}let e=await d.json();x(a=>{if(!a)return a;let b={...a};e.activities.forEach(a=>{b.organizedActivities=b.organizedActivities.map(b=>({...b,activities:(b.activities||[]).map(b=>b.title===a.name?{...b,target:void 0!==a.target?a.target:b.target,achievement:void 0!==a.achievement?a.achievement:b.achievement,status:a.status||b.status,aiInsight:a.aiInsight,prescriptiveAnalysis:a.prescriptiveAnalysis}:b)}))});let c={};return b.organizedActivities.forEach(a=>{c[a.kraId]||(c[a.kraId]={id:a.kraId,title:a.kraTitle,count:0,achievements:[]}),(a.activities||[]).forEach(b=>{c[a.kraId].count+=1,void 0!==b.achievement&&null!==b.achievement&&c[a.kraId].achievements.push(b.achievement)})}),b.kraClassifications=Object.values(c).map(a=>({id:a.id,title:a.title,count:a.count,achievementRate:a.achievements.length>0?a.achievements.reduce((a,b)=>a+b,0)/a.achievements.length:0,strategicAlignment:""})),b}),G(new Set),E({}),v({title:"Insights Regenerated",description:"Fresh analysis generated with updated KPI classifications.",duration:3e3})}catch(a){C(a instanceof Error?a.message:"Failed to regenerate insights")}finally{K(!1)}};if(y)return(0,b.jsx)(h.Card,{children:(0,b.jsx)(h.CardContent,{className:"flex items-center justify-center py-12",children:(0,b.jsx)(i.Loader2,{className:"w-5 h-5 animate-spin text-slate-400"})})});if(B)return(0,b.jsx)(h.Card,{children:(0,b.jsxs)(h.CardContent,{className:"flex items-start gap-3 py-6",children:[(0,b.jsx)(k.AlertCircle,{className:"w-5 h-5 text-red-600 shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-red-900",children:"Failed to load analysis"}),(0,b.jsx)("p",{className:"text-sm text-red-700 mt-1",children:B})]})]})});if(!w)return(0,b.jsx)(h.Card,{children:(0,b.jsx)(h.CardContent,{className:"text-center py-12 text-slate-600",children:"No analysis data available"})});if("PENDING"===w.status)return(0,b.jsx)(h.Card,{children:(0,b.jsxs)(h.CardContent,{className:"flex flex-col items-center justify-center py-12 gap-3",children:[(0,b.jsx)(i.Loader2,{className:"w-8 h-8 animate-spin text-blue-600"}),(0,b.jsx)("p",{className:"font-medium text-slate-900",children:"Analyzing document..."}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:"This may take a few minutes. Please wait."})]})});if("FAILED"===w.status)return(0,b.jsx)(h.Card,{children:(0,b.jsxs)(h.CardContent,{className:"flex items-start gap-3 py-6",children:[(0,b.jsx)(k.AlertCircle,{className:"w-5 h-5 text-red-600 shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-red-900",children:"Analysis failed"}),(0,b.jsx)("p",{className:"text-sm text-red-700 mt-1",children:"Could not process the document. Please try again."})]})]})});let P=w.organizedActivities.filter(a=>a.kpiId).map(a=>({kraId:a.kraId,kraTitle:a.kraTitle,kpiId:a.kpiId||"",kpiTitle:a.kpiTitle||"",activities:(a.activities||[]).map(a=>({title:a.title||"Unnamed",target:a.target||0,reported:a.reported||0,achievement:a.achievement||0,status:a.status||"NOT_STARTED",confidence:a.confidence||.5})),totalTarget:a.totalTarget||0,totalReported:a.totalReported||0,completionPercentage:a.completionPercentage||0,status:a.status||"NOT_STARTED"})),Q=P.length>0,R=w.organizedActivities.flatMap(a=>(a.activities||[]).map(b=>({...b,kraId:a.kraId,kraTitle:a.kraTitle}))),S=w.organizedActivities.length>0&&R.length>0;return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(h.CardTitle,{className:"text-2xl",children:w.title}),(0,b.jsxs)("p",{className:"text-sm text-slate-600 mt-1",children:["Uploaded"," ",new Date(w.uploadedDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]}),(0,b.jsx)(l.Badge,{className:"bg-green-100 text-green-800",children:w.status})]})}),(0,b.jsxs)(h.CardContent,{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"p-4 bg-slate-50 rounded-lg",children:[(0,b.jsx)("p",{className:"text-xs text-slate-600 uppercase font-semibold",children:"Overall Score"}),(0,b.jsxs)("p",{className:"text-3xl font-bold text-slate-900 mt-1",children:[w.achievementMetrics.overallScore,"%"]})]}),(0,b.jsxs)("div",{className:"p-4 bg-slate-50 rounded-lg",children:[(0,b.jsx)("p",{className:"text-xs text-slate-600 uppercase font-semibold",children:"Data Completeness"}),(0,b.jsxs)("p",{className:"text-3xl font-bold text-slate-900 mt-1",children:[w.achievementMetrics.completeness,"%"]})]}),(0,b.jsxs)("div",{className:"p-4 bg-slate-50 rounded-lg",children:[(0,b.jsx)("p",{className:"text-xs text-slate-600 uppercase font-semibold",children:"KRAs Covered"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-slate-900 mt-1",children:w.kraClassifications.length})]})]})]}),Q&&(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(I,{kpiGroups:P,selectedYear:Number(w?.year)||new Date().getFullYear()})}),!Q&&(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)(h.CardTitle,{className:"flex items-center gap-2 text-lg",children:[(0,b.jsx)(p.BookOpen,{className:"w-5 h-5"}),"Stage 1: Content Segmentation"]})}),(0,b.jsx)(h.CardContent,{className:"space-y-4",children:0===w.extractedSections.length?(0,b.jsx)("p",{className:"text-slate-600 text-sm",children:"No sections extracted"}):w.extractedSections.map((a,c)=>(0,b.jsxs)("div",{className:"p-4 bg-slate-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h4",{className:"font-semibold text-slate-900",children:a.title||a.type||"Unnamed Section"}),(0,b.jsx)(l.Badge,{variant:"outline",children:a.type})]}),(0,b.jsx)("div",{className:"text-sm text-slate-700 space-y-1",children:a.activities&&Array.isArray(a.activities)&&a.activities.length>0?(0,b.jsx)(b.Fragment,{children:a.activities.map((a,c)=>(0,b.jsxs)("p",{className:"text-slate-600",children:["• ",a]},c))}):(0,b.jsx)("p",{className:"text-slate-500 italic",children:"No activities in this section"})})]},c))})]}),w.kraClassifications.length>0&&(0,b.jsx)(z,{classifications:w.kraClassifications,isApproved:"APPROVED"===w.status||"COMPLETED"===w.status}),!Q&&(0,b.jsxs)(h.Card,{children:[(0,b.jsxs)(h.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(h.CardTitle,{className:"flex items-center gap-2 text-lg",children:[(0,b.jsx)(r,{className:"w-5 h-5"}),"Stage 3: Structured Data Organization"]}),F.size>0&&(0,b.jsxs)(g.Button,{onClick:O,disabled:H,className:"bg-indigo-600 hover:bg-indigo-700",size:"sm",children:[H?(0,b.jsx)(i.Loader2,{className:"w-4 h-4 animate-spin mr-2"}):(0,b.jsx)(u.RefreshCw,{className:"w-4 h-4 mr-2"}),H?"Regenerating...":`Regenerate (${F.size})`]})]}),F.size>0&&(0,b.jsxs)("p",{className:"text-sm text-indigo-600 mt-2",children:[F.size,' activity(ies) have changed KRA. Click "Regenerate" to update AI insights.']})]}),(0,b.jsx)(h.CardContent,{className:"space-y-4",children:S?w.organizedActivities.map(a=>{var c,d;let e=(c=a.kraId,d=a.kraTitle,M[c]||d||c);return(0,b.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h4",{className:"font-semibold text-slate-900",children:e}),(0,b.jsxs)(l.Badge,{variant:"outline",className:"text-slate-600",children:[a.activityCount," activities"]})]}),(0,b.jsx)("div",{className:"space-y-3",children:a.activities&&Array.isArray(a.activities)&&a.activities.length>0?(0,b.jsx)(b.Fragment,{children:a.activities.map((c,d)=>{let e=c.achievement??0,f=`${a.kraId}-${d}`,g=D[f]||a.kraId,h=F.has(f);return(0,b.jsx)("div",{className:`p-3 border rounded-lg ${h?"bg-indigo-50 border-indigo-300":"bg-slate-50"}`,children:(0,b.jsxs)("div",{className:"flex justify-between items-start gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)("p",{className:"font-medium text-slate-900",children:c.title||"Unnamed"}),c.unit&&(0,b.jsx)("p",{className:"text-slate-500 text-xs",children:c.unit}),(0,b.jsxs)("div",{className:"pt-2",children:[(0,b.jsx)(m.Label,{className:"text-xs text-slate-600 mb-1 block",children:"Assign KRA:"}),(0,b.jsxs)(o.Select,{value:g,onValueChange:a=>{E(b=>({...b,[f]:a})),G(a=>{let b=new Set(a);return b.add(f),b})},children:[(0,b.jsx)(o.SelectTrigger,{className:"h-8 text-sm w-full",children:(0,b.jsx)(o.SelectValue,{placeholder:"Select KRA"})}),(0,b.jsx)(o.SelectContent,{children:N.map(a=>(0,b.jsx)(o.SelectItem,{value:a.id,children:(0,b.jsxs)("span",{className:"text-sm",children:[(0,b.jsx)("strong",{children:a.id}),": ",a.title.substring(0,50),"..."]})},a.id))})]}),g&&g!==a.kraId&&(0,b.jsx)("p",{className:"text-xs text-indigo-600 mt-1 font-medium",children:"KRA Changed ✓"})]})]}),(0,b.jsxs)("div",{className:"text-right ml-4 shrink-0",children:[(0,b.jsxs)("span",{className:"block font-bold text-slate-900",children:[c.reported,e>0?"%":""]}),(0,b.jsx)("span",{className:`text-xs font-medium ${e>=100?"text-green-600":e>0?"text-yellow-600":"text-slate-500"}`,children:e>=100?"MET":e>0?`${Math.round(e)}%`:"Pending"})]})]})},d)})}):(0,b.jsx)("p",{className:"text-slate-500 italic",children:"No activities"})})]},a.kraId)}):(0,b.jsx)("p",{className:"text-slate-600 text-sm",children:"No activities organized yet"})})]}),(e="string"==typeof(d=w.prescriptiveAnalysis&&"object"==typeof w.prescriptiveAnalysis?w.prescriptiveAnalysis.documentInsight:null)&&d.trim()?d.trim():[w.alignment,w.opportunities,w.gaps].filter(a=>"string"==typeof a&&a.trim().length>0).filter(a=>!(a=>{if("string"!=typeof a)return!1;let b=a.trim();return!!b&&(b.startsWith("{")&&b.endsWith("}")||b.startsWith("[")&&b.endsWith("]"))})(a)).map(a=>a.trim()).join("\n\n"),f=(()=>{let a=w.prescriptiveAnalysis&&"object"==typeof w.prescriptiveAnalysis?w.prescriptiveAnalysis.prescriptiveAnalysis:null;if("string"==typeof a&&a.trim())return a.trim();if(Array.isArray(w.recommendations)&&w.recommendations.length>0)return w.recommendations.map(a=>{let b=[a.timeline,a.owner].filter(Boolean),c=b.length>0?` (${b.join(" • ")})`:"",d=a.priority?`[${a.priority}] `:"",e=a.title?.trim()?`${a.title.trim()}: `:"",f=a.description?.trim()?a.description.trim():"";return`- ${d}${e}${f}${c}`.trim()}).filter(a=>"-"!==a).join("\n");let b=function(a){if(!a)return null;if("string"==typeof a)return a;if("object"==typeof a){if(a.recommendations||a.content||a.analysis||a.text)return a.recommendations||a.content||a.analysis||a.text;let b=Object.keys(a);if(0===b.length)return null;let c=a[b.find(a=>a.length>1)||b[0]];return"object"==typeof c&&null!==c?c.recommendations||c.content||c.analysis?c.recommendations||c.content||c.analysis:JSON.stringify(c):String(c)}return null}(w.prescriptiveAnalysis)||"";return(a=>{if("string"!=typeof a)return!1;let b=a.trim().toLowerCase();return"null"===b||"undefined"===b})(b)?"":b})(),q=(j=(()=>{if(!w.prescriptiveAnalysis||"object"!=typeof w.prescriptiveAnalysis)return[];let a=w.prescriptiveAnalysis.prescriptiveItems;return Array.isArray(a)?a.filter(a=>a&&"object"==typeof a).slice(0,5).map(a=>({title:String(a.title||"").trim(),issue:String(a.issue||"").trim(),action:String(a.action||"").trim(),nextStep:a.nextStep?String(a.nextStep).trim():void 0})).filter(a=>a.title&&a.issue&&a.action):[]})()).length>0?j:f?(function(a){if("string"!=typeof a)return[];let b=a.replace(/\r\n/g,"\n").trim();if(!b)return[];let c=b.split("\n"),d=[],e=null,f=()=>{if(!e)return;let a=String(e.title||"").trim(),b=String(e.issue||"").trim(),c=String(e.action||"").trim(),f=e.nextStep?String(e.nextStep).trim():void 0;a&&b&&c&&d.push({title:a,issue:b,action:c,nextStep:f}),e=null};for(let a of c){let b=a.trim();if(!b)continue;let c=b.match(/^\d+\.\s+(.*)$/);if(c){f(),e={title:c[1].trim()};continue}let d=b.match(/^(?:-\s*)?(Issue|Action|Next\s*Step)\s*:\s*(.*)$/i);if(d&&e){let a=d[1].toLowerCase().replace(/\s+/g,""),b=d[2].trim();"issue"===a&&(e.issue=b),"action"===a&&(e.action=b),"nextstep"===a&&(e.nextStep=b);continue}}return f(),d})(f).slice(0,5):[],e||f||q.length>0?(0,b.jsxs)(h.Card,{className:"overflow-hidden",children:[(0,b.jsx)(h.CardHeader,{className:"bg-purple-50 border-b border-purple-200",children:(0,b.jsxs)(h.CardTitle,{className:"flex items-center gap-2 text-lg text-purple-900",children:[(0,b.jsx)(s.Lightbulb,{className:"w-5 h-5 text-purple-700"}),"Prescriptive Analysis"]})}),(0,b.jsxs)(h.CardContent,{className:"space-y-4 pt-6",children:[e&&(0,b.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,b.jsxs)("h4",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[(0,b.jsx)(t.Target,{className:"w-4 h-4"}),"Document Insight"]}),(0,b.jsx)("div",{className:"text-sm text-blue-800 prose prose-sm prose-blue max-w-none",children:L(e)})]}),(q.length>0||f)&&(0,b.jsxs)("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[(0,b.jsxs)("h4",{className:"font-semibold text-purple-900 mb-2 flex items-center gap-2",children:[(0,b.jsx)(s.Lightbulb,{className:"w-4 h-4"}),"Prescriptive Analysis"]}),(0,b.jsx)("div",{className:"text-sm text-purple-800 prose prose-sm prose-purple max-w-none",children:q.length>0?(0,b.jsx)("ol",{className:"list-decimal list-inside space-y-3",children:q.map((a,c)=>(0,b.jsxs)("li",{className:"",children:[(0,b.jsx)("span",{className:"font-semibold text-purple-900",children:a.title}),(0,b.jsxs)("ul",{className:"list-disc ml-6 mt-1 space-y-1",children:[(0,b.jsxs)("li",{children:[(0,b.jsx)("span",{className:"font-semibold",children:"Issue:"})," ",a.issue]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("span",{className:"font-semibold",children:"Action:"})," ",a.action]}),a.nextStep?(0,b.jsxs)("li",{children:[(0,b.jsx)("span",{className:"font-semibold",children:"Next Step:"})," ",a.nextStep]}):null]})]},c))}):L(f)})]})]})]}):null),(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsx)(h.CardTitle,{children:"Target Achievement Summary"})}),(0,b.jsxs)(h.CardContent,{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"p-4 bg-slate-50 rounded-lg",children:[(0,b.jsx)("p",{className:"text-xs text-slate-600 uppercase font-semibold mb-2",children:"Current State"}),(0,b.jsx)("p",{className:"text-slate-900 font-medium",children:w.achievementMetrics.currentState})]}),(0,b.jsxs)("div",{className:"p-4 bg-slate-50 rounded-lg",children:[(0,b.jsx)("p",{className:"text-xs text-slate-600 uppercase font-semibold mb-2",children:"Target State"}),(0,b.jsx)("p",{className:"text-slate-900 font-medium",children:w.achievementMetrics.targetState})]})]})]})]})}function P(){let a=(0,d.useParams)(),l=(0,d.useRouter)(),{isAuthenticated:m,isLoading:n}=(0,e.useAuth)(),o=a.id;return((0,c.useEffect)(()=>{n||m||l.push("/")},[n,m,l]),n)?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)(i.Loader2,{className:"w-8 h-8 animate-spin text-primary"})}):m?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.Navbar,{}),(0,b.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,b.jsx)("div",{className:"border-b bg-card",children:(0,b.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"QPRO Analysis Details"})})})}),(0,b.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)(g.Button,{variant:"ghost",onClick:()=>l.back(),className:"gap-2",children:[(0,b.jsx)(j.ChevronLeft,{className:"w-4 h-4"}),"Back"]}),o?(0,b.jsx)(O,{analysisId:o}):(0,b.jsx)(h.Card,{children:(0,b.jsxs)("div",{className:"flex items-start gap-3 p-6",children:[(0,b.jsx)(k.AlertCircle,{className:"w-5 h-5 text-red-600 shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-red-900",children:"Invalid Analysis ID"}),(0,b.jsx)("p",{className:"text-sm text-red-700 mt-1",children:"No analysis ID was provided"})]})]})})]})})]})]}):null}a.s(["default",()=>P],13955)}];

//# sourceMappingURL=app_qpro_analysis_%5Bid%5D_page_tsx_d1ba37ba._.js.map