module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},29173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},15270,e=>{"use strict";var t=e.i(29173);let r=globalThis.prisma||new t.PrismaClient({log:["query","info","warn","error"]});e.s(["default",0,r])},75188,e=>{"use strict";let t=new class{secret;constructor(){this.secret=process.env.JWT_SECRET||"6dFk5d0vbyLnZC0Amy83LtI47DsNr/KB4M+FgbUc6njd4cjk7XB2/8nTuhQDWW8OOgQ6fI74huxJE3a/RP2giw=="}stringToUint8Array(e){return new TextEncoder().encode(e)}uint8ArrayToBase64Url(e){let t="";for(let r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async importSecret(){let e=new TextEncoder().encode(this.secret);return await crypto.subtle.importKey("raw",e,{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"])}async generateToken(e){try{let t=Math.floor(Date.now()/1e3),r={...e,iat:t,exp:t+3600},i=this.uint8ArrayToBase64Url(this.stringToUint8Array(JSON.stringify({alg:"HS256",typ:"JWT"}))),o=this.uint8ArrayToBase64Url(this.stringToUint8Array(JSON.stringify(r))),n=`${i}.${o}`,s=await this.importSecret(),a=new TextEncoder().encode(n),d=await crypto.subtle.sign("HMAC",s,a),c=new Uint8Array(d),u=this.uint8ArrayToBase64Url(c);return`${n}.${u}`}catch(e){throw console.error("JWT token generation failed:",e),Error("Failed to generate JWT token")}}async verifyToken(e){try{if(!e||"string"!=typeof e||""===e.trim())return console.error("Invalid token provided for verification"),null;let t=e.split(".");if(3!==t.length)return console.error("Token format is invalid"),null;let[r,i,o]=t;if(!this.base64UrlDecode(r))return console.error("Failed to decode token header"),null;let n=this.base64UrlDecode(i);if(!n)return console.error("Failed to decode token payload"),null;let s=JSON.parse(n),a=Math.floor(Date.now()/1e3);if(s.exp&&s.exp<a)return console.error("Token has expired"),null;let d=await this.importSecret();if(!await this.verifySignature(`${r}.${i}`,o,d))return console.error("Token signature verification failed"),null;return s}catch(e){return console.error("Token verification failed:",e?.message||e),null}}async verifySignature(e,t,r){try{let i=this.base64UrlDecodeToUint8Array(t);if(!i)return!1;let o=new TextEncoder().encode(e),n=new Uint8Array(i.buffer,i.byteOffset,i.byteLength),s=new Uint8Array(o.buffer,o.byteOffset,o.byteLength);return await crypto.subtle.verify("HMAC",r,n,s)}catch(e){return console.error("Signature verification error:",e),!1}}decodeToken(e){try{if(!e||"string"!=typeof e||""===e.trim())return null;let t=e.split(".");if(3!==t.length)return console.error("Token format is invalid"),null;let r=t[1],i=this.base64UrlDecode(r);if(!i)return null;return JSON.parse(i)}catch(e){return console.error("Token decoding failed:",e?.message||e),null}}isTokenExpired(e){try{let t=this.decodeToken(e);if(!t||!t.exp)return!0;let r=Math.floor(Date.now()/1e3);return t.exp<r}catch(e){return console.error("Error checking token expiration:",e),!0}}base64UrlDecode(e){try{let t="=".repeat((4-e.length%4)%4),r=e.replace(/-/g,"+").replace(/_/g,"/")+t,i=atob(r);return decodeURIComponent(escape(i))}catch(e){return console.error("Base64 URL decode error:",e),null}}base64UrlDecodeToUint8Array(e){try{let t="=".repeat((4-e.length%4)%4),r=e.replace(/-/g,"+").replace(/_/g,"/")+t,i=atob(r),o=new Uint8Array(i.length);for(let e=0;e<i.length;e++)o[e]=i.charCodeAt(e);return o}catch(e){return console.error("Base64 URL decode to Uint8Array error:",e),null}}};e.s(["default",0,t])},81563,83274,e=>{"use strict";var t=e.i(89171),r=e.i(75188),i=e.i(15270);function o(e,t){return e===t}function n(e,t){return t.includes(e)}async function s(e,o){let s=e.headers.get("authorization"),a=null;if(s&&s.startsWith("Bearer "))a=s.substring(7);else{let t=e.cookies;a=t.get("access_token")?.value}if(!a)return e.nextUrl.pathname.startsWith("/api/")?t.NextResponse.json({error:"Authentication required"},{status:401}):t.NextResponse.redirect(new URL("/login",e.url));let d=await r.default.verifyToken(a);if(!d)return(console.error("Token verification failed:",a?a.substring(0,20)+"...":"null"),e.nextUrl.pathname.startsWith("/api/"))?t.NextResponse.json({error:"Invalid or expired token"},{status:401}):t.NextResponse.redirect(new URL("/",e.url));if(console.log("Decoded token:",d),!d.userId)return(console.error("Token does not contain userId:",d),e.nextUrl.pathname.startsWith("/api/"))?t.NextResponse.json({error:"Invalid token: missing user ID"},{status:401}):t.NextResponse.redirect(new URL("/login",e.url));let c=await i.default.user.findUnique({where:{id:d.userId},select:{id:!0,email:!0,name:!0,role:!0,unitId:!0}});return c?o&&o.length>0&&!n(c.role,o)?e.nextUrl.pathname.startsWith("/api/")?t.NextResponse.json({error:"User does not have required role to perform this action"},{status:403}):t.NextResponse.redirect(new URL("/unauthorized",e.url)):{user:c}:(console.error("User not found with ID from token:",d.userId),t.NextResponse.redirect(new URL("/login",e.url)))}e.s(["hasAnyRole",()=>n,"hasRole",()=>o],83274),e.s(["requireAuth",()=>s],81563)},2157,(e,t,r)=>{t.exports=e.x("node:fs",()=>require("node:fs"))},81111,(e,t,r)=>{t.exports=e.x("node:stream",()=>require("node:stream"))},68626,e=>{"use strict";var t=e.i(15270);let r=new(e.i(92674)).default,i=new class{async getDocuments(e=1,r=10,i,o,n,s,a="desc",d,c,u){let l={status:"ACTIVE"};if(i&&"all"!==i&&(l.category=i),d&&(l.unitId=d),c&&(l.year=c),u&&(l.quarter=u),o){let e={OR:[{title:{contains:o,mode:"insensitive"}},{description:{contains:o,mode:"insensitive"}},{tags:{array_contains:[o]}}]};Object.keys(l).length>1?(l.AND=l.AND||[],l.AND.push(e)):Object.assign(l,e)}if(n){let e=await t.default.user.findUnique({where:{id:n}});if(e&&"ADMIN"!==e.role&&"FACULTY"!==e.role){let t={OR:[{uploadedById:e.id},{permissions:{some:{userId:e.id,permission:{in:["READ","WRITE","ADMIN"]}}}}]};Object.keys(l).length>1?(l.AND=l.AND||[],l.AND.push(t)):Object.assign(l,t)}}try{let[i,o]=await Promise.all([t.default.document.findMany({where:l,skip:(e-1)*r,take:r,orderBy:s?{[s]:a}:{uploadedAt:"desc"},include:{uploadedByUser:!0,documentUnit:!0}}),t.default.document.count({where:l})]);return{documents:i.map(e=>({...e,tags:Array.isArray(e.tags)?e.tags:[],unitId:e.unitId??void 0,blobName:e.blobName??void 0,year:e.year??void 0,quarter:e.quarter??void 0,isQproDocument:e.isQproDocument??!1,versionNotes:e.versionNotes??void 0,uploadedBy:e.uploadedByUser?.name||e.uploadedBy,status:e.status,unit:e.documentUnit?{id:e.documentUnit.id,name:e.documentUnit.name,code:e.documentUnit.code,description:e.documentUnit.description||void 0,createdAt:e.documentUnit.createdAt,updatedAt:e.documentUnit.updatedAt}:void 0,uploadedAt:new Date(e.uploadedAt),createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),colivaraDocumentId:e.colivaraDocumentId??void 0,colivaraProcessingStatus:e.colivaraProcessingStatus??void 0,colivaraProcessedAt:e.colivaraProcessedAt?new Date(e.colivaraProcessedAt):void 0,colivaraChecksum:e.colivaraChecksum??void 0})),total:o}}catch(e){throw console.error("Database connection error in getDocuments:",e),e}}async getDocumentById(e,r){try{let i=await t.default.document.findUnique({where:{id:e},include:{uploadedByUser:!0,documentUnit:!0}});if(!i)return null;if(r){let o=await t.default.user.findUnique({where:{id:r}});if(o&&"ADMIN"!==o.role&&"FACULTY"!==o.role&&!await t.default.documentPermission.findFirst({where:{documentId:e,userId:o.id,permission:{in:["READ","WRITE","ADMIN"]}}})&&i.uploadedById!==o.id)return null}return{id:i.id,title:i.title,description:i.description,category:i.category,tags:Array.isArray(i.tags)?i.tags:[],uploadedBy:i.uploadedByUser?.name||i.uploadedBy,uploadedById:i.uploadedById,uploadedAt:new Date(i.uploadedAt),fileUrl:i.fileUrl,blobName:i.blobName??void 0,fileName:i.fileName,fileType:i.fileType,fileSize:i.fileSize,downloadsCount:i.downloadsCount||0,viewsCount:i.viewsCount||0,version:i.version||1,versionNotes:i.versionNotes||void 0,status:i.status,createdAt:new Date(i.createdAt),updatedAt:new Date(i.updatedAt),unitId:i.unitId||void 0,year:i.year??void 0,quarter:i.quarter??void 0,isQproDocument:i.isQproDocument??!1,unit:i.documentUnit?{id:i.documentUnit.id,name:i.documentUnit.name,code:i.documentUnit.code||"",description:i.documentUnit.description||void 0,createdAt:i.documentUnit.createdAt,updatedAt:i.documentUnit.updatedAt}:void 0,colivaraDocumentId:i.colivaraDocumentId??void 0,colivaraProcessingStatus:i.colivaraProcessingStatus??void 0,colivaraProcessedAt:i.colivaraProcessedAt?new Date(i.colivaraProcessedAt):void 0,colivaraChecksum:i.colivaraChecksum??void 0}}catch(e){throw console.error("Database connection error in getDocumentById:",e),e}}async createDocument(e,i,o,n,s,a,d,c,u,l,m,p,h,f){try{if(console.log("Creating document in database...",{title:e,description:i,category:o,tags:n,uploadedBy:s,fileUrl:a,fileName:d,fileType:c,fileSize:u,userId:l}),!l)throw console.error("No userId provided to createDocument function"),Error("User ID is required to upload documents");console.log("Attempting to find user with ID:",l);let g=await t.default.user.findUnique({where:{id:l}});if(!g)throw console.error("User not found with provided ID:",l),Error("Only admins and faculty can upload documents");if(console.log("User lookup result:",{user:!!g,role:g?.role,id:g?.id}),!g||!["ADMIN","FACULTY"].includes(g.role))throw console.error("User does not have required role to upload documents:",g?.role),Error("Only admins and faculty can upload documents");let v=await t.default.document.create({data:{title:e,description:i||"",category:o||"Uncategorized",tags:n||[],uploadedBy:g.name,uploadedById:g.id,fileUrl:a,blobName:h||void 0,fileName:d,fileType:c,fileSize:u,unitId:m||null,year:f?.year||null,quarter:f?.quarter||null,isQproDocument:f?.isQproDocument||!1,status:"ACTIVE",colivaraProcessingStatus:"PENDING"}});console.log("Document created:",v.id),await t.default.documentPermission.create({data:{documentId:v.id,userId:g.id,permission:"ADMIN"}}),console.log("Document permissions granted");let y=await t.default.document.findUnique({where:{id:v.id},include:{uploadedByUser:!0,documentUnit:!0}});if(!y)throw Error(`Document with id ${v.id} not found after creation`);if(f?.isQproDocument)console.log(`[EnhancedDocumentService] Skipping background Colivara processing for QPRO document ${v.id} - handled by upload route`);else try{r.processNewDocument(y,a,p)}catch(e){console.error(`Error triggering Colivara processing for document ${v.id}:`,e)}return{id:y.id,title:y.title,description:y.description,category:y.category,tags:Array.isArray(y.tags)?y.tags:[],uploadedBy:y.uploadedByUser?.name||y.uploadedBy,uploadedById:y.uploadedById,uploadedAt:new Date(y.uploadedAt),fileUrl:y.fileUrl,blobName:y.blobName??void 0,fileName:y.fileName,fileType:y.fileType,fileSize:y.fileSize,downloadsCount:y.downloadsCount||0,viewsCount:y.viewsCount||0,version:y.version||1,versionNotes:y.versionNotes??void 0,status:y.status,createdAt:new Date(y.createdAt),updatedAt:new Date(y.updatedAt),unitId:y.unitId??void 0,year:y.year??void 0,quarter:y.quarter??void 0,isQproDocument:y.isQproDocument??!1,unit:y.documentUnit?{id:y.documentUnit.id,name:y.documentUnit.name,code:y.documentUnit.code||"",description:y.documentUnit.description||void 0,createdAt:y.documentUnit.createdAt,updatedAt:y.documentUnit.updatedAt}:void 0,colivaraDocumentId:y.colivaraDocumentId??void 0,colivaraProcessingStatus:y.colivaraProcessingStatus??void 0,colivaraProcessedAt:y.colivaraProcessedAt?new Date(y.colivaraProcessedAt):void 0,colivaraChecksum:y.colivaraChecksum??void 0}}catch(e){throw console.error("Database connection error in createDocument:",e),e}}async updateDocument(e,i,o,n,s,a,d,c,u){try{let l=await t.default.document.findUnique({where:{id:e}});if(!l)return null;let m=null,p=null;if(d&&(p=await t.default.user.findUnique({where:{id:d}}))&&(m=await t.default.documentPermission.findFirst({where:{documentId:e,userId:p.id,permission:{in:["WRITE","ADMIN"]}}})),d&&!m&&p?.role!=="ADMIN"&&l.uploadedById!==p?.id)throw Error("User does not have permission to update this document");let h=await t.default.document.update({where:{id:e},data:{...i&&{title:i},...void 0!==o&&{description:o||""},...void 0!==n&&{category:n||"Uncategorized"},...void 0!==s&&{tags:s||[]},...void 0!==a&&{unitId:a},updatedAt:new Date},include:{uploadedByUser:!0,documentUnit:!0}});if(!h)throw Error(`Document with id ${e} not found after update`);if(c)try{r.handleDocumentUpdate(e,h,c,u)}catch(t){console.error(`Error triggering Colivara reprocessing for document ${e}:`,t)}return{id:h.id,title:h.title,description:h.description,category:h.category,tags:Array.isArray(h.tags)?h.tags:[],uploadedBy:h.uploadedByUser?.name||h.uploadedBy,uploadedById:h.uploadedById,uploadedAt:new Date(h.uploadedAt),fileUrl:h.fileUrl,fileName:h.fileName,fileType:h.fileType,fileSize:h.fileSize,downloadsCount:h.downloadsCount||0,viewsCount:h.viewsCount||0,version:h.version||1,versionNotes:h.versionNotes??void 0,status:h.status,createdAt:new Date(h.createdAt),updatedAt:new Date(h.updatedAt),unitId:h.unitId??void 0,unit:h.documentUnit?{id:h.documentUnit.id,name:h.documentUnit.name,code:h.documentUnit.code||"",description:h.documentUnit.description||void 0,createdAt:h.documentUnit.createdAt,updatedAt:h.documentUnit.updatedAt}:void 0,colivaraDocumentId:h.colivaraDocumentId??void 0,colivaraProcessingStatus:h.colivaraProcessingStatus??void 0,colivaraProcessedAt:h.colivaraProcessedAt?new Date(h.colivaraProcessedAt):void 0,colivaraChecksum:h.colivaraChecksum??void 0}}catch(e){throw console.error("Database connection error in updateDocument:",e),e}}async getDocumentsByUnit(e,t=1,r=10,i){return this.getDocuments(t,r,void 0,void 0,i,void 0,"desc",e)}async getAdminDocumentsByUnit(e,r=1,i=10,o){let n={status:"ACTIVE",unitId:e};if(o){let e=await t.default.user.findUnique({where:{id:o}});if(e&&"ADMIN"===e.role);else if(e&&"FACULTY"!==e.role){let t={OR:[{uploadedById:e.id},{permissions:{some:{userId:e.id,permission:{in:["READ","WRITE","ADMIN"]}}}}]};Object.keys(n).length>1?(n.AND=n.AND||[],n.AND.push(t)):Object.assign(n,t)}}try{let[e,o]=await Promise.all([t.default.document.findMany({where:n,skip:(r-1)*i,take:i,orderBy:{uploadedAt:"desc"},include:{uploadedByUser:!0,documentUnit:!0}}),t.default.document.count({where:n})]);return{documents:e.map(e=>({...e,tags:Array.isArray(e.tags)?e.tags:[],unitId:e.unitId??void 0,versionNotes:e.versionNotes??void 0,uploadedBy:e.uploadedByUser?.name||e.uploadedBy,status:e.status,unit:e.documentUnit?{id:e.documentUnit.id,name:e.documentUnit.name,code:e.documentUnit.code||"",description:e.documentUnit.description||void 0,createdAt:e.documentUnit.createdAt,updatedAt:e.documentUnit.updatedAt}:void 0,uploadedAt:new Date(e.uploadedAt),createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),colivaraDocumentId:e.colivaraDocumentId??void 0,colivaraProcessingStatus:e.colivaraProcessingStatus??void 0,colivaraProcessedAt:e.colivaraProcessedAt?new Date(e.colivaraProcessedAt):void 0,colivaraChecksum:e.colivaraChecksum??void 0})),total:o}}catch(e){throw console.error("Database connection error in getAdminDocumentsByUnit:",e),e}}async getUserUnitPermissions(e,t){return null}async searchDocuments(e,t,r,i,o,n=1,s=10){return this.getDocuments(n,s,r,e,o,void 0,"desc",t)}};e.s(["default",0,i])},61813,e=>{"use strict";var t=e.i(88461);let r=new class{maxCacheSize;metrics={hits:0,misses:0,totalRequests:0,averageResponseTime:0,hitRate:0};constructor(e=50){this.maxCacheSize=e}generateCacheKey(e,t,r,i){let o=(e||"").toLowerCase().trim(),n="{}";try{n=JSON.stringify("undefined"===i||null==i?{}:i)}catch(e){console.error("Error stringifying filters for cache key:",e),n="{}"}let s=[o,"undefined"===t||null==t?"all":t,"undefined"===r||null==r?"all":r,n].join("|"),a=0;for(let e=0;e<s.length;e++)a=(a<<5)-a+s.charCodeAt(e),a&=a;let d=o.substring(0,20).replace(/[^a-zA-Z0-9]/g,"_");return`search:${d}_${Math.abs(a).toString(36)}`}async getCachedResult(e,r,i,o){this.metrics.totalRequests++;let n=this.generateCacheKey(e,"undefined"===r?void 0:r,"undefined"===i?void 0:i,"undefined"===o?void 0:o),s=await t.redisService.get(n);return s?Date.now()-s.timestamp>s.ttl?(await t.redisService.del(n),this.metrics.misses++,this.updateHitRate(),null):(this.metrics.hits++,this.updateHitRate(),s.results):(this.metrics.misses++,this.updateHitRate(),null)}async setCachedResult(e,r,i,o,n,s=1800){let a="undefined"===i?void 0:i,d="undefined"===o?void 0:o,c="undefined"===n?void 0:n,u=this.generateCacheKey(e,a,d,c),l={query:e,unitId:a,category:d,filters:c,results:r,timestamp:Date.now(),ttl:1e3*s};await t.redisService.set(u,l,s)}async removeCachedResult(e,r,i,o){let n=this.generateCacheKey(e,"undefined"===r?void 0:r,"undefined"===i?void 0:i,"undefined"===o?void 0:o);await t.redisService.del(n)}async clearCache(){let e=await t.redisService.keys("search:*");e.length>0&&await t.redisService.redis.del(...e)}async invalidateCacheForDocument(e){await this.clearCache()}async invalidateCacheByQuery(e){let r=`*${e.toLowerCase()}*`,i=await t.redisService.keys(r);i.length>0&&await t.redisService.redis.del(...i)}async invalidateCacheByUnit(e){await this.clearCache()}async invalidateCacheByCategory(e){await this.clearCache()}async getCacheStats(){let e=await t.redisService.keys("search:*");return{size:e.length,keys:e}}async prewarmCache(e){for(let{query:t,results:r,unitId:i,category:o,filters:n}of e){let e="undefined"===i?void 0:i,s="undefined"===o?void 0:o,a="undefined"===n?void 0:n;await this.setCachedResult(t,r,e,s,a)}}getFrequentQueries(e=10){return[]}updateHitRate(){this.metrics.totalRequests>0&&(this.metrics.hitRate=this.metrics.hits/this.metrics.totalRequests)}getCacheMetrics(){return{...this.metrics}}resetMetrics(){this.metrics={hits:0,misses:0,totalRequests:0,averageResponseTime:0,hitRate:0}}};e.s(["searchCacheService",0,r])},18865,50674,e=>{"use strict";class t{static instance;config;requestCounts=new Map;constructor(){this.config={rateLimit:{maxRequests:parseInt(process.env.AI_MAX_REQUESTS_PER_HOUR||"60",10),windowMs:36e5},apiKeyRotationInterval:parseInt(process.env.API_KEY_ROTATION_INTERVAL_HOURS||"24",10),requestTimeout:parseInt(process.env.AI_REQUEST_TIMEOUT||"30000",10)}}static getInstance(){return t.instance||(t.instance=new t),t.instance}isRequestAllowed(e){let t=Date.now();this.config.rateLimit.windowMs;let r=this.requestCounts.get(e);return!r||r.resetTime<t?(this.requestCounts.set(e,{count:1,resetTime:t+this.config.rateLimit.windowMs}),!0):!(r.count>=this.config.rateLimit.maxRequests)&&(this.requestCounts.set(e,{count:r.count+1,resetTime:r.resetTime}),!0)}getRemainingRequests(e){let t=Date.now(),r=this.requestCounts.get(e);return!r||r.resetTime<t?this.config.rateLimit.maxRequests:Math.max(0,this.config.rateLimit.maxRequests-r.count)}getResetTime(e){let t=this.requestCounts.get(e);return t?t.resetTime:Date.now()+this.config.rateLimit.windowMs}getSecurityConfig(){return{...this.config}}validateApiKey(e){return e.trim().length>0}async healthCheck(){try{let e=process.env.AI_API_KEY;if(!e)return console.error("AI_API_KEY is not set"),!1;if(!e.trim())return console.error("AI_API_KEY is empty"),!1;return!0}catch(e){return console.error("AI API health check failed:",e),!1}}}e.s(["default",0,t],18865);class r{static instance;config;metrics=[];maxMetricsStored=1e3;constructor(){this.config={logPerformance:"true"===process.env.LOG_PERFORMANCE||!0,logErrors:"true"===process.env.LOG_ERRORS||!0,logUsage:"true"===process.env.LOG_USAGE||!0,performanceThreshold:parseInt(process.env.PERFORMANCE_THRESHOLD_MS||"5000",10)}}static getInstance(){return r.instance||(r.instance=new r),r.instance}logMetric(e){if(!this.config.logPerformance&&!this.config.logUsage)return;let t={...e,timestamp:new Date};this.metrics.push(t),this.metrics.length>this.maxMetricsStored&&(this.metrics=this.metrics.slice(-this.maxMetricsStored)),e.success?this.config.logPerformance&&console.log(`[PERFORMANCE] ${e.endpoint} took ${e.responseTime}ms for user ${e.userId||"unknown"}`):this.config.logErrors&&console.error(`[ERROR] ${e.endpoint} failed for user ${e.userId||"unknown"}: ${e.error}`),e.responseTime>this.config.performanceThreshold&&console.warn(`[PERFORMANCE ALERT] ${e.endpoint} exceeded threshold: ${e.responseTime}ms > ${this.config.performanceThreshold}ms`)}trackUsage(e,t,r){this.config.logUsage&&console.log(`[USAGE] User ${e} accessed ${t}${r?` using model ${r}`:""} at ${new Date().toISOString()}`)}trackGeneration(e,t,r,i,o,n){this.logMetric({endpoint:"ai-generation",responseTime:r,userId:e,query:t,success:i,error:o,model:n})}trackSearch(e,t,r,i,o){this.logMetric({endpoint:"search",responseTime:r,userId:e,query:t,success:i,error:o})}getPerformanceSummary(e){let t=this.metrics.filter(t=>t.endpoint===e);if(0===t.length)return{avgResponseTime:0,minResponseTime:0,maxResponseTime:0,totalRequests:0,successfulRequests:0,failedRequests:0,errorRate:0};let r=t.map(e=>e.responseTime),i=t.filter(e=>e.success).length,o=t.filter(e=>!e.success).length,n=r.reduce((e,t)=>e+t,0)/r.length,s=Math.min(...r),a=Math.max(...r),d=t.length;return{avgResponseTime:n,minResponseTime:s,maxResponseTime:a,totalRequests:d,successfulRequests:i,failedRequests:o,errorRate:o/d}}getAllMetrics(){return[...this.metrics]}clearMetrics(){this.metrics=[]}getConfig(){return{...this.config}}updateConfig(e){this.config={...this.config,...e}}}e.s(["default",0,r],50674)},19124,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__81ca4e96._.js"].map(t=>e.l(t))).then(()=>t(18870)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__60a95a29._.js.map