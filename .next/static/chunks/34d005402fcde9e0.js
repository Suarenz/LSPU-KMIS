(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,46186,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(18566),i=e.i(91432),l=e.i(63780),r=e.i(67881),n=e.i(70065),c=e.i(31278),d=e.i(73375),o=e.i(63209),m=e.i(94179),x=e.i(10708),h=e.i(20682),p=e.i(62870),u=e.i(10980),g=e.i(75254);let f=(0,g.default)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);var j=e.i(41240),N=e.i(20278),b=e.i(16715),v=e.i(69638),y=e.i(78583);let A=(0,g.default)("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),C={"KRA 1":"Development of New Curricula","KRA 2":"Accreditation","KRA 3":"Quality and Relevance of Instruction","KRA 4":"International Activities","KRA 5":"Research Outputs","KRA 6":"Extension Programs","KRA 7":"Community Partnerships","KRA 8":"Technology Transfer","KRA 9":"Revenue Generation","KRA 10":"Resource Mobilization","KRA 11":"Human Resource Management","KRA 12":"Student Development","KRA 13":"Health and Wellness","KRA 14":"Environmental Sustainability","KRA 15":"Quality Management","KRA 16":"Governance","KRA 17":"Digital Transformation",UNCLASSIFIED:"Uncategorized Activities"};function R({classifications:e,isApproved:s=!1}){let a=e.map(e=>{var t,s;return{...e,title:(t=e.id,s=e.title,C[t]||s||t)}}),i=a.reduce((e,t)=>e+t.count,0);return(0,t.jsxs)(n.Card,{className:"border rounded-lg bg-white",children:[(0,t.jsx)(n.CardHeader,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.CardTitle,{className:"flex items-center gap-2 text-base",children:[(0,t.jsx)(A,{className:"w-5 h-5 text-slate-600"}),"KRA Classification Review"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[i>0&&(0,t.jsxs)(m.Badge,{variant:"secondary",className:"text-slate-600",children:[i," Total Records"]}),s&&(0,t.jsxs)(m.Badge,{variant:"outline",className:"text-green-600 border-green-600",children:[(0,t.jsx)(v.CheckCircle,{className:"w-3 h-3 mr-1"}),"Verified"]})]})]})}),(0,t.jsx)(n.CardContent,{className:"space-y-2",children:0===a.length?(0,t.jsxs)("div",{className:"text-center py-6 text-slate-500",children:[(0,t.jsx)(y.FileText,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{className:"text-sm",children:"No KRA classifications found"})]}):a.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200 hover:bg-slate-100 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center",children:(0,t.jsx)(y.FileText,{className:"w-4 h-4 text-slate-600"})}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium text-sm text-slate-800",children:e.title}),e.kpiName&&(0,t.jsx)("span",{className:"text-xs text-slate-500",children:e.kpiName})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("span",{className:"block text-lg font-bold text-slate-900",children:e.count}),(0,t.jsx)("span",{className:"text-[10px] uppercase text-slate-500 font-semibold tracking-wider",children:1===e.count?"Record Found":"Records Found"})]})]},e.id))})]})}var w=e.i(31171),w=w,k=e.i(99219),k=k,T=e.i(25652);let S=(0,g.default)("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);var K=e.i(95468),I=e.i(3116);let $={MET:{color:"bg-green-100",textColor:"text-green-900",borderColor:"border-green-300",icon:K.CheckCircle2,label:"Target Met",badgeClass:"bg-green-600"},ON_TRACK:{color:"bg-blue-100",textColor:"text-blue-900",borderColor:"border-blue-300",icon:T.TrendingUp,label:"On Track",badgeClass:"bg-blue-600"},PARTIAL:{color:"bg-yellow-100",textColor:"text-yellow-900",borderColor:"border-yellow-300",icon:I.Clock,label:"Partial Progress",badgeClass:"bg-yellow-600"},NOT_STARTED:{color:"bg-red-100",textColor:"text-red-900",borderColor:"border-red-300",icon:o.AlertCircle,label:"Not Started",badgeClass:"bg-red-600"}};function P({kpi:e,expanded:s,onToggle:a}){let i,l,r,c,d,o=$[e.status],x=o.icon;return(0,t.jsxs)(n.Card,{className:`border-l-4 ${o.borderColor}`,children:[(0,t.jsx)(n.CardHeader,{className:"pb-3 cursor-pointer",onClick:a,children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start gap-2 sm:gap-3 sm:justify-between",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0 pr-2",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 mb-2",children:[(0,t.jsxs)("h3",{className:"font-semibold text-sm sm:text-base text-slate-900 truncate",children:[e.kraId," - ",e.kpiTitle]}),(0,t.jsx)(m.Badge,{className:`${o.badgeClass} text-white shrink-0 whitespace-nowrap`,children:o.label})]}),(0,t.jsx)("p",{className:"text-xs text-slate-600 line-clamp-1",children:e.kraTitle})]}),(0,t.jsx)("div",{className:"shrink-0 flex items-center justify-end",children:s?(0,t.jsx)(k.default,{className:"w-5 h-5 text-slate-400"}):(0,t.jsx)(w.default,{className:"w-5 h-5 text-slate-400"})})]})}),(0,t.jsxs)(n.CardContent,{className:"space-y-4 pt-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-slate-700",children:"Target Progress"}),(0,t.jsxs)("span",{className:`text-2xl sm:text-2xl font-bold ${o.textColor}`,children:[e.completionPercentage,"%"]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[(0,t.jsx)("div",{className:"flex-1 bg-slate-200 rounded-full h-3 overflow-hidden",children:(0,t.jsx)("div",{className:`h-full transition-all rounded-full ${o.badgeClass}`,style:{width:`${Math.min(e.completionPercentage,100)}%`}})}),(0,t.jsx)("span",{className:"text-xs text-slate-600 font-medium shrink-0",children:(l=(i=Number.isFinite(e.totalTarget)&&Number.isFinite(e.totalReported)&&e.totalTarget>0&&e.totalTarget<=100&&e.totalReported>=0&&e.totalReported<=100)?`${e.totalReported.toFixed(2)}%`:String(e.totalReported),r=i?`${e.totalTarget.toFixed(2)}%`:String(e.totalTarget),c=Number(e.totalReported),d=Number(e.totalTarget),(0===c||Number.isNaN(c))&&(0===d||Number.isNaN(d))?"":`${l}/${r}`)})]})]}),(0,t.jsx)("div",{className:`p-3 rounded-lg ${o.color} border ${o.borderColor}`,children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(x,{className:"w-5 h-5 shrink-0 mt-0.5"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:`text-sm font-semibold ${o.textColor}`,children:o.label}),(0,t.jsx)("p",{className:"text-xs text-slate-700 mt-0.5 wrap-break-word",children:e.completionPercentage>=100?"Target achieved":`${100-e.completionPercentage}% remaining`})]})]})}),s&&(0,t.jsxs)("div",{className:"space-y-3 pt-3 border-t",children:[(0,t.jsxs)("h4",{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[(0,t.jsx)(S,{className:"w-4 h-4"}),"Activities (",e.activities.length,")"]}),(0,t.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:e.activities.map((e,s)=>(0,t.jsxs)("div",{className:"p-3 bg-slate-50 rounded-lg border border-slate-200 hover:border-slate-300 transition-colors",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 mb-3",children:[(0,t.jsx)("h5",{className:"text-sm font-medium text-slate-900 flex-1 min-w-0",children:e.title}),(0,t.jsx)(m.Badge,{variant:"outline",className:`text-xs shrink-0 whitespace-nowrap ${"MET"===e.status?"bg-green-50 text-green-700 border-green-200":"PARTIAL"===e.status?"bg-yellow-50 text-yellow-700 border-yellow-200":"bg-red-50 text-red-700 border-red-200"}`,children:e.status})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-2 mb-3 text-xs",children:[(0,t.jsxs)("div",{className:"bg-white p-2 rounded border border-slate-100",children:[(0,t.jsx)("p",{className:"text-slate-600 font-medium mb-0.5",children:"Target"}),(0,t.jsx)("p",{className:"font-semibold text-slate-900",children:e.target})]}),(0,t.jsxs)("div",{className:"bg-white p-2 rounded border border-slate-100",children:[(0,t.jsx)("p",{className:"text-slate-600 font-medium mb-0.5",children:"Reported"}),(0,t.jsx)("p",{className:"font-semibold text-slate-900",children:e.reported})]}),(0,t.jsxs)("div",{className:"bg-white p-2 rounded border border-slate-100",children:[(0,t.jsx)("p",{className:"text-slate-600 font-medium mb-0.5",children:"Achievement"}),(0,t.jsxs)("p",{className:"font-semibold text-slate-900",children:[e.achievement,"%"]})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 sm:gap-2 text-xs",children:[(0,t.jsx)("span",{className:"text-slate-600",children:"Progress"}),(0,t.jsxs)("span",{className:"text-slate-600 shrink-0",children:[(100*e.confidence).toFixed(0),"% confident"]})]}),(0,t.jsx)("div",{className:"flex-1 bg-slate-300 rounded h-1.5 overflow-hidden",children:(0,t.jsx)("div",{className:`h-full rounded ${"MET"===e.status?"bg-green-600":"PARTIAL"===e.status?"bg-yellow-600":"bg-red-600"}`,style:{width:`${Math.min(e.achievement,100)}%`}})})]})]},s))})]})]})]})}function E({kpiGroups:e,selectedQuarter:a,selectedYear:i=2025}){let[l,r]=(0,s.useState)(null),c=(0,s.useMemo)(()=>{let t=e.length,s=e.filter(e=>"MET"===e.status).length,a=e.filter(e=>"ON_TRACK"===e.status).length,i=e.filter(e=>"PARTIAL"===e.status).length,l=e.filter(e=>"NOT_STARTED"===e.status).length,r=e.reduce((e,t)=>e+t.completionPercentage,0)/t;return{total:t,met:s,onTrack:a,partial:i,notStarted:l,avgCompletion:r,totalActivities:e.reduce((e,t)=>e+t.activities.length,0)}},[e]);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(n.Card,{children:[(0,t.jsx)(n.CardHeader,{children:(0,t.jsx)(n.CardTitle,{children:"KPI Performance Dashboard"})}),(0,t.jsx)(n.CardContent,{children:(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[(0,t.jsxs)("div",{className:"p-3 bg-slate-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-slate-600 uppercase font-semibold",children:"Total KPIs"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-slate-900 mt-1",children:c.total})]}),(0,t.jsxs)("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:[(0,t.jsx)("p",{className:"text-xs text-green-700 uppercase font-semibold",children:"Met"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-green-900 mt-1",children:c.met})]}),(0,t.jsxs)("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[(0,t.jsx)("p",{className:"text-xs text-blue-700 uppercase font-semibold",children:"On Track"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:c.onTrack})]}),(0,t.jsxs)("div",{className:"p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:[(0,t.jsx)("p",{className:"text-xs text-yellow-700 uppercase font-semibold",children:"Partial"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-yellow-900 mt-1",children:c.partial})]}),(0,t.jsxs)("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200",children:[(0,t.jsx)("p",{className:"text-xs text-red-700 uppercase font-semibold",children:"Not Started"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-red-900 mt-1",children:c.notStarted})]}),(0,t.jsxs)("div",{className:"p-3 bg-purple-50 rounded-lg border border-purple-200",children:[(0,t.jsx)("p",{className:"text-xs text-purple-700 uppercase font-semibold",children:"Avg Completion"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:[c.avgCompletion.toFixed(0),"%"]})]})]})})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-slate-900 px-1",children:"KPI-Level Breakdown"}),e.map(e=>(0,t.jsx)(P,{kpi:e,expanded:l===e.kpiId,onToggle:()=>r(l===e.kpiId?null:e.kpiId)},e.kpiId))]})]})}var M=e.i(60865);function D(e){if(!e)return"";if("string"!=typeof e){if(Array.isArray(e))return e.map(e=>D(e)).join("\n");if("object"==typeof e){if(e.action)return`${e.action}${e.timeline?` (${e.timeline})`:""}`;if(e.recommendation)return e.recommendation;try{return JSON.stringify(e)}catch{}}return String(e)}let t=e;try{let e=JSON.parse(t);if(Array.isArray(e))return e.map(e=>"string"==typeof e?e:e?.action?e.action:e?.recommendation?e.recommendation:String(e)).join("\n• ");if("object"==typeof e&&null!==e){if(e.action)return e.action;if(e.recommendation)return e.recommendation}}catch{}return(t=(t=(t=(t=(t=t.replace(/^#{1,3}\s+/gm,"")).replace(/\*\*([^*]+)\*\*/g,"$1")).replace(/\*([^*]+)\*/g,"$1")).replace(/^\["|"\]$/g,"")).replace(/","/g,", ")).trim()}function z(e){if(!e)return null;let s=e.split("\n").filter(e=>e.trim()),a=[],i=[],l=null,r=()=>{i.length>0&&("numbered"===l?a.push((0,t.jsx)("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:i.map((e,s)=>(0,t.jsx)("li",{children:D(e)},s))},`ol-${a.length}`)):a.push((0,t.jsx)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:i.map((e,s)=>(0,t.jsx)("li",{children:D(e)},s))},`ul-${a.length}`)),i=[],l=null)};return s.forEach((e,s)=>{let n=e.trim();if(n.startsWith("###")||n.startsWith("##")||n.startsWith("#")){r();let e=n.replace(/^#{1,3}\s+/,"");a.push((0,t.jsx)("p",{className:"font-semibold mt-3 first:mt-0",children:D(e)},`h-${s}`));return}let c=n.match(/^\d+\.\s+(.+)/);if(c){"numbered"!==l&&(r(),l="numbered"),i.push(c[1]);return}let d=n.match(/^[-*]\s+(.+)/);if(d){"bullet"!==l&&(r(),l="bullet"),i.push(d[1]);return}r(),n&&a.push((0,t.jsx)("p",{className:"mb-2 last:mb-0",children:D(n)},`p-${s}`))}),r(),(0,t.jsx)("div",{className:"space-y-2",children:a})}let F={"KRA 1":"Development of New Curricula","KRA 2":"Accreditation","KRA 3":"Quality and Relevance of Instruction","KRA 4":"International Activities","KRA 5":"Research Outputs","KRA 6":"Extension Programs","KRA 7":"Community Partnerships","KRA 8":"Technology Transfer","KRA 9":"Revenue Generation","KRA 10":"Resource Mobilization","KRA 11":"Human Resource Management","KRA 12":"Student Development","KRA 13":"Health and Wellness","KRA 14":"Environmental Sustainability","KRA 15":"Quality Management","KRA 16":"Governance","KRA 17":"Digital Transformation",UNCLASSIFIED:"Uncategorized Activities"},O=[{id:"KRA 1",title:"Development of New Curricula Incorporating Emerging Technologies"},{id:"KRA 2",title:"Market-Driven Program Design and Implementation"},{id:"KRA 3",title:"Quality and Relevance of Instruction"},{id:"KRA 4",title:"College and Office International Activities and Projects"},{id:"KRA 5",title:"Research, Extension, and Innovation Productivity"},{id:"KRA 6",title:"Research, Extension, and Innovation Linkages"},{id:"KRA 7",title:"Research, Extension, and Innovation Resources"},{id:"KRA 8",title:"Service to the Community"},{id:"KRA 9",title:"Implementation of Sustainable Governance"},{id:"KRA 10",title:"Transforming into Green University"},{id:"KRA 11",title:"Judicious Management of Human Resources"},{id:"KRA 12",title:"Internationalized/Global University Stakeholders"},{id:"KRA 13",title:"Competitive Human Resources"},{id:"KRA 14",title:"Improved Satisfaction Rating of the Students, Faculty, and Personnel of the University"},{id:"KRA 15",title:"Certification and Compliance to Regulatory Requirements"},{id:"KRA 16",title:"Updating of Learning Materials and Facilities"},{id:"KRA 17",title:"Digital Transformation and Smart Campus Enablement"},{id:"KRA 18",title:"Risk Management and Compliance"},{id:"KRA 19",title:"Revenue Growth and Operational Efficiency"},{id:"KRA 20",title:"Related IGP Industry Engagement"},{id:"KRA 21",title:"Responsive Management of Resources"},{id:"KRA 22",title:"Management of Financial Resources"}];function L({analysisId:e}){let a,i,l,d,g,{toast:v}=(0,h.useToast)(),[y,A]=(0,s.useState)(null),[C,w]=(0,s.useState)(!0),[k,T]=(0,s.useState)(null),[S,K]=(0,s.useState)({}),[I,$]=(0,s.useState)(new Set),[P,D]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let t=async()=>{try{w(!0),T(null);let t=await M.default.getAccessToken();if(!t)throw Error("Authentication required. Please log in again.");let s=await fetch(`/api/qpro/analyses/${e}`,{headers:{Authorization:`Bearer ${t}`}});if(!s.ok)throw Error("Failed to load analysis");let a=await s.json();A(a)}catch(e){T(e instanceof Error?e.message:"Failed to load analysis")}finally{w(!1)}};e&&t()},[e]);let L=async()=>{if(0===I.size)return void T("No KRA changes to regenerate");try{D(!0),T(null),v({title:"Regenerating Insights",description:`Analyzing ${I.size} activities with corrected KPI types...`,duration:3e3});let t=await M.default.getAccessToken();if(!t)throw Error("Authentication required");let s=y.organizedActivities.flatMap(e=>(e.activities||[]).map((t,s)=>({...t,name:t.title||`Activity ${s}`,kraId:S[`${e.kraId}-${s}`]||e.kraId,index:s}))).filter(e=>I.has(`${e.kraId}-${e.index}`)),a=await fetch("/api/qpro/regenerate-insights",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({analysisId:e,activities:s})});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to regenerate insights")}let i=await a.json();A(e=>{if(!e)return e;let t={...e};i.activities.forEach(e=>{t.organizedActivities=t.organizedActivities.map(t=>({...t,activities:(t.activities||[]).map(t=>t.title===e.name?{...t,target:void 0!==e.target?e.target:t.target,achievement:void 0!==e.achievement?e.achievement:t.achievement,status:e.status||t.status,aiInsight:e.aiInsight,prescriptiveAnalysis:e.prescriptiveAnalysis}:t)}))});let s={};return t.organizedActivities.forEach(e=>{s[e.kraId]||(s[e.kraId]={id:e.kraId,title:e.kraTitle,count:0,achievements:[]}),(e.activities||[]).forEach(t=>{s[e.kraId].count+=1,void 0!==t.achievement&&null!==t.achievement&&s[e.kraId].achievements.push(t.achievement)})}),t.kraClassifications=Object.values(s).map(e=>({id:e.id,title:e.title,count:e.count,achievementRate:e.achievements.length>0?e.achievements.reduce((e,t)=>e+t,0)/e.achievements.length:0,strategicAlignment:""})),t}),$(new Set),K({}),v({title:"Insights Regenerated",description:"Fresh analysis generated with updated KPI classifications.",duration:3e3})}catch(e){T(e instanceof Error?e.message:"Failed to regenerate insights")}finally{D(!1)}};if(C)return(0,t.jsx)(n.Card,{children:(0,t.jsx)(n.CardContent,{className:"flex items-center justify-center py-12",children:(0,t.jsx)(c.Loader2,{className:"w-5 h-5 animate-spin text-slate-400"})})});if(k)return(0,t.jsx)(n.Card,{children:(0,t.jsxs)(n.CardContent,{className:"flex items-start gap-3 py-6",children:[(0,t.jsx)(o.AlertCircle,{className:"w-5 h-5 text-red-600 shrink-0 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-red-900",children:"Failed to load analysis"}),(0,t.jsx)("p",{className:"text-sm text-red-700 mt-1",children:k})]})]})});if(!y)return(0,t.jsx)(n.Card,{children:(0,t.jsx)(n.CardContent,{className:"text-center py-12 text-slate-600",children:"No analysis data available"})});if("PENDING"===y.status)return(0,t.jsx)(n.Card,{children:(0,t.jsxs)(n.CardContent,{className:"flex flex-col items-center justify-center py-12 gap-3",children:[(0,t.jsx)(c.Loader2,{className:"w-8 h-8 animate-spin text-blue-600"}),(0,t.jsx)("p",{className:"font-medium text-slate-900",children:"Analyzing document..."}),(0,t.jsx)("p",{className:"text-sm text-slate-600",children:"This may take a few minutes. Please wait."})]})});if("FAILED"===y.status)return(0,t.jsx)(n.Card,{children:(0,t.jsxs)(n.CardContent,{className:"flex items-start gap-3 py-6",children:[(0,t.jsx)(o.AlertCircle,{className:"w-5 h-5 text-red-600 shrink-0 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-red-900",children:"Analysis failed"}),(0,t.jsx)("p",{className:"text-sm text-red-700 mt-1",children:"Could not process the document. Please try again."})]})]})});let H=y.organizedActivities.filter(e=>e.kpiId).map(e=>({kraId:e.kraId,kraTitle:e.kraTitle,kpiId:e.kpiId||"",kpiTitle:e.kpiTitle||"",activities:(e.activities||[]).map(e=>({title:e.title||"Unnamed",target:e.target||0,reported:e.reported||0,achievement:e.achievement||0,status:e.status||"NOT_STARTED",confidence:e.confidence||.5})),totalTarget:e.totalTarget||0,totalReported:e.totalReported||0,completionPercentage:e.completionPercentage||0,status:e.status||"NOT_STARTED"})),B=H.length>0,U=y.organizedActivities.flatMap(e=>(e.activities||[]).map(t=>({...t,kraId:e.kraId,kraTitle:e.kraTitle}))),G=y.organizedActivities.length>0&&U.length>0;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(n.Card,{children:[(0,t.jsx)(n.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(n.CardTitle,{className:"text-2xl",children:y.title}),(0,t.jsxs)("p",{className:"text-sm text-slate-600 mt-1",children:["Uploaded"," ",new Date(y.uploadedDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]}),(0,t.jsx)(m.Badge,{className:"bg-green-100 text-green-800",children:y.status})]})}),(0,t.jsxs)(n.CardContent,{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-slate-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-slate-600 uppercase font-semibold",children:"Overall Score"}),(0,t.jsxs)("p",{className:"text-3xl font-bold text-slate-900 mt-1",children:[y.achievementMetrics.overallScore,"%"]})]}),(0,t.jsxs)("div",{className:"p-4 bg-slate-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-slate-600 uppercase font-semibold",children:"Data Completeness"}),(0,t.jsxs)("p",{className:"text-3xl font-bold text-slate-900 mt-1",children:[y.achievementMetrics.completeness,"%"]})]}),(0,t.jsxs)("div",{className:"p-4 bg-slate-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-slate-600 uppercase font-semibold",children:"KRAs Covered"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-slate-900 mt-1",children:y.kraClassifications.length})]})]})]}),B&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(E,{kpiGroups:H,selectedYear:Number(y?.year)||new Date().getFullYear()})}),!B&&(0,t.jsxs)(n.Card,{children:[(0,t.jsx)(n.CardHeader,{children:(0,t.jsxs)(n.CardTitle,{className:"flex items-center gap-2 text-lg",children:[(0,t.jsx)(u.BookOpen,{className:"w-5 h-5"}),"Stage 1: Content Segmentation"]})}),(0,t.jsx)(n.CardContent,{className:"space-y-4",children:0===y.extractedSections.length?(0,t.jsx)("p",{className:"text-slate-600 text-sm",children:"No sections extracted"}):y.extractedSections.map((e,s)=>(0,t.jsxs)("div",{className:"p-4 bg-slate-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h4",{className:"font-semibold text-slate-900",children:e.title||e.type||"Unnamed Section"}),(0,t.jsx)(m.Badge,{variant:"outline",children:e.type})]}),(0,t.jsx)("div",{className:"text-sm text-slate-700 space-y-1",children:e.activities&&Array.isArray(e.activities)&&e.activities.length>0?(0,t.jsx)(t.Fragment,{children:e.activities.map((e,s)=>(0,t.jsxs)("p",{className:"text-slate-600",children:["• ",e]},s))}):(0,t.jsx)("p",{className:"text-slate-500 italic",children:"No activities in this section"})})]},s))})]}),y.kraClassifications.length>0&&(0,t.jsx)(R,{classifications:y.kraClassifications,isApproved:"APPROVED"===y.status||"COMPLETED"===y.status}),!B&&(0,t.jsxs)(n.Card,{children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.CardTitle,{className:"flex items-center gap-2 text-lg",children:[(0,t.jsx)(f,{className:"w-5 h-5"}),"Stage 3: Structured Data Organization"]}),I.size>0&&(0,t.jsxs)(r.Button,{onClick:L,disabled:P,className:"bg-indigo-600 hover:bg-indigo-700",size:"sm",children:[P?(0,t.jsx)(c.Loader2,{className:"w-4 h-4 animate-spin mr-2"}):(0,t.jsx)(b.RefreshCw,{className:"w-4 h-4 mr-2"}),P?"Regenerating...":`Regenerate (${I.size})`]})]}),I.size>0&&(0,t.jsxs)("p",{className:"text-sm text-indigo-600 mt-2",children:[I.size,' activity(ies) have changed KRA. Click "Regenerate" to update AI insights.']})]}),(0,t.jsx)(n.CardContent,{className:"space-y-4",children:G?y.organizedActivities.map(e=>{var s,a;let i=(s=e.kraId,a=e.kraTitle,F[s]||a||s);return(0,t.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h4",{className:"font-semibold text-slate-900",children:i}),(0,t.jsxs)(m.Badge,{variant:"outline",className:"text-slate-600",children:[e.activityCount," activities"]})]}),(0,t.jsx)("div",{className:"space-y-3",children:e.activities&&Array.isArray(e.activities)&&e.activities.length>0?(0,t.jsx)(t.Fragment,{children:e.activities.map((s,a)=>{let i=s.achievement??0,l=`${e.kraId}-${a}`,r=S[l]||e.kraId,n=I.has(l);return(0,t.jsx)("div",{className:`p-3 border rounded-lg ${n?"bg-indigo-50 border-indigo-300":"bg-slate-50"}`,children:(0,t.jsxs)("div",{className:"flex justify-between items-start gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,t.jsx)("p",{className:"font-medium text-slate-900",children:s.title||"Unnamed"}),s.unit&&(0,t.jsx)("p",{className:"text-slate-500 text-xs",children:s.unit}),(0,t.jsxs)("div",{className:"pt-2",children:[(0,t.jsx)(x.Label,{className:"text-xs text-slate-600 mb-1 block",children:"Assign KRA:"}),(0,t.jsxs)(p.Select,{value:r,onValueChange:e=>{K(t=>({...t,[l]:e})),$(e=>{let t=new Set(e);return t.add(l),t})},children:[(0,t.jsx)(p.SelectTrigger,{className:"h-8 text-sm w-full",children:(0,t.jsx)(p.SelectValue,{placeholder:"Select KRA"})}),(0,t.jsx)(p.SelectContent,{children:O.map(e=>(0,t.jsx)(p.SelectItem,{value:e.id,children:(0,t.jsxs)("span",{className:"text-sm",children:[(0,t.jsx)("strong",{children:e.id}),": ",e.title.substring(0,50),"..."]})},e.id))})]}),r&&r!==e.kraId&&(0,t.jsx)("p",{className:"text-xs text-indigo-600 mt-1 font-medium",children:"KRA Changed ✓"})]})]}),(0,t.jsxs)("div",{className:"text-right ml-4 shrink-0",children:[(0,t.jsxs)("span",{className:"block font-bold text-slate-900",children:[s.reported,i>0?"%":""]}),(0,t.jsx)("span",{className:`text-xs font-medium ${i>=100?"text-green-600":i>0?"text-yellow-600":"text-slate-500"}`,children:i>=100?"MET":i>0?`${Math.round(i)}%`:"Pending"})]})]})},a)})}):(0,t.jsx)("p",{className:"text-slate-500 italic",children:"No activities"})})]},e.kraId)}):(0,t.jsx)("p",{className:"text-slate-600 text-sm",children:"No activities organized yet"})})]}),(i="string"==typeof(a=y.prescriptiveAnalysis&&"object"==typeof y.prescriptiveAnalysis?y.prescriptiveAnalysis.documentInsight:null)&&a.trim()?a.trim():[y.alignment,y.opportunities,y.gaps].filter(e=>"string"==typeof e&&e.trim().length>0).filter(e=>!(e=>{if("string"!=typeof e)return!1;let t=e.trim();return!!t&&(t.startsWith("{")&&t.endsWith("}")||t.startsWith("[")&&t.endsWith("]"))})(e)).map(e=>e.trim()).join("\n\n"),l=(()=>{let e=y.prescriptiveAnalysis&&"object"==typeof y.prescriptiveAnalysis?y.prescriptiveAnalysis.prescriptiveAnalysis:null;if("string"==typeof e&&e.trim())return e.trim();if(Array.isArray(y.recommendations)&&y.recommendations.length>0)return y.recommendations.map(e=>{let t=[e.timeline,e.owner].filter(Boolean),s=t.length>0?` (${t.join(" • ")})`:"",a=e.priority?`[${e.priority}] `:"",i=e.title?.trim()?`${e.title.trim()}: `:"",l=e.description?.trim()?e.description.trim():"";return`- ${a}${i}${l}${s}`.trim()}).filter(e=>"-"!==e).join("\n");let t=function(e){if(!e)return null;if("string"==typeof e)return e;if("object"==typeof e){if(e.recommendations||e.content||e.analysis||e.text)return e.recommendations||e.content||e.analysis||e.text;let t=Object.keys(e);if(0===t.length)return null;let s=e[t.find(e=>e.length>1)||t[0]];return"object"==typeof s&&null!==s?s.recommendations||s.content||s.analysis?s.recommendations||s.content||s.analysis:JSON.stringify(s):String(s)}return null}(y.prescriptiveAnalysis)||"";return(e=>{if("string"!=typeof e)return!1;let t=e.trim().toLowerCase();return"null"===t||"undefined"===t})(t)?"":t})(),g=(d=(()=>{if(!y.prescriptiveAnalysis||"object"!=typeof y.prescriptiveAnalysis)return[];let e=y.prescriptiveAnalysis.prescriptiveItems;return Array.isArray(e)?e.filter(e=>e&&"object"==typeof e).slice(0,5).map(e=>({title:String(e.title||"").trim(),issue:String(e.issue||"").trim(),action:String(e.action||"").trim(),nextStep:e.nextStep?String(e.nextStep).trim():void 0})).filter(e=>e.title&&e.issue&&e.action):[]})()).length>0?d:l?(function(e){if("string"!=typeof e)return[];let t=e.replace(/\r\n/g,"\n").trim();if(!t)return[];let s=t.split("\n"),a=[],i=null,l=()=>{if(!i)return;let e=String(i.title||"").trim(),t=String(i.issue||"").trim(),s=String(i.action||"").trim(),l=i.nextStep?String(i.nextStep).trim():void 0;e&&t&&s&&a.push({title:e,issue:t,action:s,nextStep:l}),i=null};for(let e of s){let t=e.trim();if(!t)continue;let s=t.match(/^\d+\.\s+(.*)$/);if(s){l(),i={title:s[1].trim()};continue}let a=t.match(/^(?:-\s*)?(Issue|Action|Next\s*Step)\s*:\s*(.*)$/i);if(a&&i){let e=a[1].toLowerCase().replace(/\s+/g,""),t=a[2].trim();"issue"===e&&(i.issue=t),"action"===e&&(i.action=t),"nextstep"===e&&(i.nextStep=t);continue}}return l(),a})(l).slice(0,5):[],i||l||g.length>0?(0,t.jsxs)(n.Card,{className:"overflow-hidden",children:[(0,t.jsx)(n.CardHeader,{className:"bg-purple-50 border-b border-purple-200",children:(0,t.jsxs)(n.CardTitle,{className:"flex items-center gap-2 text-lg text-purple-900",children:[(0,t.jsx)(j.Lightbulb,{className:"w-5 h-5 text-purple-700"}),"Prescriptive Analysis"]})}),(0,t.jsxs)(n.CardContent,{className:"space-y-4 pt-6",children:[i&&(0,t.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,t.jsxs)("h4",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[(0,t.jsx)(N.Target,{className:"w-4 h-4"}),"Document Insight"]}),(0,t.jsx)("div",{className:"text-sm text-blue-800 prose prose-sm prose-blue max-w-none",children:z(i)})]}),(g.length>0||l)&&(0,t.jsxs)("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[(0,t.jsxs)("h4",{className:"font-semibold text-purple-900 mb-2 flex items-center gap-2",children:[(0,t.jsx)(j.Lightbulb,{className:"w-4 h-4"}),"Prescriptive Analysis"]}),(0,t.jsx)("div",{className:"text-sm text-purple-800 prose prose-sm prose-purple max-w-none",children:g.length>0?(0,t.jsx)("ol",{className:"list-decimal list-inside space-y-3",children:g.map((e,s)=>(0,t.jsxs)("li",{className:"",children:[(0,t.jsx)("span",{className:"font-semibold text-purple-900",children:e.title}),(0,t.jsxs)("ul",{className:"list-disc ml-6 mt-1 space-y-1",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Issue:"})," ",e.issue]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Action:"})," ",e.action]}),e.nextStep?(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Next Step:"})," ",e.nextStep]}):null]})]},s))}):z(l)})]})]})]}):null),(0,t.jsxs)(n.Card,{children:[(0,t.jsx)(n.CardHeader,{children:(0,t.jsx)(n.CardTitle,{children:"Target Achievement Summary"})}),(0,t.jsxs)(n.CardContent,{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-slate-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-slate-600 uppercase font-semibold mb-2",children:"Current State"}),(0,t.jsx)("p",{className:"text-slate-900 font-medium",children:y.achievementMetrics.currentState})]}),(0,t.jsxs)("div",{className:"p-4 bg-slate-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-slate-600 uppercase font-semibold mb-2",children:"Target State"}),(0,t.jsx)("p",{className:"text-slate-900 font-medium",children:y.achievementMetrics.targetState})]})]})]})]})}function H(){let e=(0,a.useParams)(),m=(0,a.useRouter)(),{isAuthenticated:x,isLoading:h}=(0,i.useAuth)(),p=e.id;return((0,s.useEffect)(()=>{h||x||m.push("/")},[h,x,m]),h)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)(c.Loader2,{className:"w-8 h-8 animate-spin text-primary"})}):x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Navbar,{}),(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("div",{className:"border-b bg-card",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"QPRO Analysis Details"})})})}),(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(r.Button,{variant:"ghost",onClick:()=>m.back(),className:"gap-2",children:[(0,t.jsx)(d.ChevronLeft,{className:"w-4 h-4"}),"Back"]}),p?(0,t.jsx)(L,{analysisId:p}):(0,t.jsx)(n.Card,{children:(0,t.jsxs)("div",{className:"flex items-start gap-3 p-6",children:[(0,t.jsx)(o.AlertCircle,{className:"w-5 h-5 text-red-600 shrink-0 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-red-900",children:"Invalid Analysis ID"}),(0,t.jsx)("p",{className:"text-sm text-red-700 mt-1",children:"No analysis ID was provided"})]})]})})]})})]})]}):null}e.s(["default",()=>H],46186)}]);