module.exports=[83522,e=>{"use strict";function r(e){if(null==e)return null;if("number"==typeof e)return Number.isFinite(e)?e:null;let r=String(e).replace(/,/g,"").trim();if(!r)return null;let t=Number(r);return Number.isFinite(t)?t:null}function t(e){return String(e||"").replace(/\s+/g,"")}function a(e){let r=String(e||"").trim().replace(/\s+/g," "),t=r.match(/^KRA\s*(\d+)$/i);return t?`KRA ${t[1]}`:r}function n(e,n,s,i){let c=function(e,r,n){if(!r||!n)return null;let s=e?.kras||[],i=a(r),c=s.find(e=>a(e.kra_id)===i);if(!c?.initiatives)return null;let l=t(String(n)),o=c.initiatives.find(e=>t(String(e.id))===l);if(!o){let e=String(n).match(/KPI(\d+)/i);e&&(o=c.initiatives.find(r=>String(r.id).includes(`KPI${e[1]}`)))}return o||null}(e,n,s),l=c?.targets?.type??null,o="string"==typeof c?.targets?.unit_basis?c.targets.unit_basis:null,u=c?.targets?.target_scope==="PER_UNIT"?"PER_UNIT":"INSTITUTIONAL";return{targetType:l,targetValue:function(e,t){if(!Array.isArray(e)||0===e.length)return null;let a=e.find(e=>Number(e?.year)===t),n=r(a?.target_value);if(null!==n)return n;let s=e.map(e=>({year:Number(e?.year),target:r(e?.target_value)})).filter(e=>Number.isFinite(e.year)&&null!==e.target),i=s.filter(e=>e.year<=t).sort((e,r)=>r.year-e.year);if(i.length>0)return i[0].target;let c=s.sort((e,r)=>e.year-r.year);return c.length>0?c[0].target:null}(c?.targets?.timeline_data||[],i),targetScope:u,unitBasis:o}}function s(e){return e.reduce((e,r)=>e+("number"==typeof r&&Number.isFinite(r)?r:0),0)}function i(e){let{targetType:t,targetValue:a,targetScope:n="INSTITUTIONAL",unitMultiplier:i,activities:c}=e,l=String(t||"").toLowerCase(),o="PER_UNIT"===n?a*("number"==typeof i&&Number.isFinite(i)?i:1):a;if("percentage"===l){let e,t=0===(e=c.map(e=>{let t=r(e.reported);if(null===t)return null;if(t>=0&&t<=100)return t;let a=r(e.target);if(null!==a&&a>0&&t>=0){let e=t/a*100;if(e>=0&&e<=100)return e}return null}).filter(e=>"number"==typeof e&&Number.isFinite(e))).length?0:e.reduce((e,r)=>e+r,0)/e.length;return{totalReported:t,totalTarget:o,achievementPercent:o>0?t/o*100:0}}if("financial"===l||"count"===l){let e=s(c.map(e=>r(e.reported)));0===e&&c.length>0&&"count"===l&&(e=c.length);let t=o>0?e/o*100:0;return{totalReported:e,totalTarget:o,achievementPercent:t}}if("milestone"===l||"text_condition"===l){let e=c.some(e=>{let r=e.reported;return"number"==typeof r?r>0:"string"==typeof r&&r.trim().length>0});return{totalReported:+!!e,totalTarget:1,achievementPercent:100*!!e}}let u=s(c.map(e=>r(e.reported)));0===u&&c.length>0&&(u=c.length);let g=o>0?u/o*100:0;return{totalReported:u,totalTarget:o,achievementPercent:g}}e.s(["computeAggregatedAchievement",()=>i,"getInitiativeTargetMeta",()=>n,"normalizeKraId",()=>a])},73716,e=>{"use strict";var r=e.i(88461);let t=new class{config={uploadCacheTtl:3600,analysisCacheTtl:86400,processingStatusTtl:1800};constructor(e){e&&(this.config={...this.config,...e})}generateUploadCacheKey(e){return`qpro:upload:${e}`}generateAnalysisCacheKey(e){return`qpro:analysis:${e}`}generateProcessingStatusCacheKey(e){return`qpro:processing:${e}`}generateUserAnalysesCacheKey(e){return`qpro:user:${e}:analyses`}async cacheUpload(e){try{let t=this.generateUploadCacheKey(e.documentId);await r.redisService.set(t,e,this.config.uploadCacheTtl),console.log(`[QPRO Cache] Cached upload for document: ${e.documentId}`)}catch(e){console.error("[QPRO Cache] Error caching upload:",e)}}async getUploadCache(e){try{let t=this.generateUploadCacheKey(e),a=await r.redisService.get(t);return a&&console.log(`[QPRO Cache] Hit for upload: ${e}`),a}catch(e){return console.error("[QPRO Cache] Error retrieving upload cache:",e),null}}async cacheAnalysis(e){try{let t=this.generateAnalysisCacheKey(e.documentId),a={...e,timestamp:Date.now()};await r.redisService.set(t,a,this.config.analysisCacheTtl),console.log(`[QPRO Cache] Cached analysis for document: ${e.documentId}`)}catch(e){console.error("[QPRO Cache] Error caching analysis:",e)}}async getAnalysisCache(e){try{let t=this.generateAnalysisCacheKey(e),a=await r.redisService.get(t);return a&&console.log(`[QPRO Cache] Hit for analysis: ${e}`),a}catch(e){return console.error("[QPRO Cache] Error retrieving analysis cache:",e),null}}async updateProcessingStatus(e,t,a){try{let n=this.generateProcessingStatusCacheKey(e),s={analysisId:e,status:t,progress:a||0,timestamp:Date.now()};await r.redisService.set(n,s,this.config.processingStatusTtl),console.log(`[QPRO Cache] Updated processing status for analysis: ${e} - ${t}`)}catch(e){console.error("[QPRO Cache] Error updating processing status:",e)}}async getProcessingStatus(e){try{let t=this.generateProcessingStatusCacheKey(e),a=await r.redisService.get(t);if(a)return console.log(`[QPRO Cache] Hit for processing status: ${e}`),{status:a.status,progress:a.progress};return null}catch(e){return console.error("[QPRO Cache] Error retrieving processing status:",e),null}}async cacheUserAnalyses(e,t){try{let a=this.generateUserAnalysesCacheKey(e);await r.redisService.set(a,{analyses:t,timestamp:Date.now()},this.config.analysisCacheTtl),console.log(`[QPRO Cache] Cached ${t.length} analyses for user: ${e}`)}catch(e){console.error("[QPRO Cache] Error caching user analyses:",e)}}async getUserAnalysesCache(e){try{let t=this.generateUserAnalysesCacheKey(e),a=await r.redisService.get(t);if(a)return console.log(`[QPRO Cache] Hit for user analyses: ${e}`),a.analyses;return null}catch(e){return console.error("[QPRO Cache] Error retrieving user analyses cache:",e),null}}async invalidateUploadCache(e){try{let t=this.generateUploadCacheKey(e);await r.redisService.del(t),console.log(`[QPRO Cache] Invalidated upload cache for document: ${e}`)}catch(e){console.error("[QPRO Cache] Error invalidating upload cache:",e)}}async invalidateAnalysisCache(e){try{let t=this.generateAnalysisCacheKey(e);await r.redisService.del(t),console.log(`[QPRO Cache] Invalidated analysis cache for document: ${e}`)}catch(e){console.error("[QPRO Cache] Error invalidating analysis cache:",e)}}async invalidateProcessingStatus(e){try{let t=this.generateProcessingStatusCacheKey(e);await r.redisService.del(t),console.log(`[QPRO Cache] Invalidated processing status for analysis: ${e}`)}catch(e){console.error("[QPRO Cache] Error invalidating processing status:",e)}}async invalidateUserAnalysesCache(e){try{let t=this.generateUserAnalysesCacheKey(e);await r.redisService.del(t),console.log(`[QPRO Cache] Invalidated user analyses cache for user: ${e}`)}catch(e){console.error("[QPRO Cache] Error invalidating user analyses cache:",e)}}async invalidateAllUserCaches(e){try{let t=`qpro:user:${e}:*`,a=await r.redisService.keys(t);if(a.length>0){for(let e of a)await r.redisService.del(e);console.log(`[QPRO Cache] Invalidated ${a.length} caches for user: ${e}`)}}catch(e){console.error("[QPRO Cache] Error invalidating all user caches:",e)}}async getCacheStats(){try{let e=await r.redisService.keys("qpro:*");return{size:e.length,keys:e}}catch(e){return console.error("[QPRO Cache] Error getting cache stats:",e),{size:0,keys:[]}}}};e.s(["qproCacheService",0,t])}];

//# sourceMappingURL=lib_de85ac59._.js.map