module.exports=[18622,(e,r,t)=>{r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,r,t)=>{r.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,r,t)=>{r.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},29173,(e,r,t)=>{r.exports=e.x("@prisma/client",()=>require("@prisma/client"))},15270,e=>{"use strict";var r=e.i(29173);let t=globalThis.prisma||new r.PrismaClient({log:["query","info","warn","error"]});e.s(["default",0,t])},75188,e=>{"use strict";let r=new class{secret;constructor(){this.secret=process.env.JWT_SECRET||"6dFk5d0vbyLnZC0Amy83LtI47DsNr/KB4M+FgbUc6njd4cjk7XB2/8nTuhQDWW8OOgQ6fI74huxJE3a/RP2giw=="}stringToUint8Array(e){return new TextEncoder().encode(e)}uint8ArrayToBase64Url(e){let r="";for(let t=0;t<e.byteLength;t++)r+=String.fromCharCode(e[t]);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async importSecret(){let e=new TextEncoder().encode(this.secret);return await crypto.subtle.importKey("raw",e,{name:"HMAC",hash:"SHA-256"},!1,["sign","verify"])}async generateToken(e){try{let r=Math.floor(Date.now()/1e3),t={...e,iat:r,exp:r+3600},n=this.uint8ArrayToBase64Url(this.stringToUint8Array(JSON.stringify({alg:"HS256",typ:"JWT"}))),i=this.uint8ArrayToBase64Url(this.stringToUint8Array(JSON.stringify(t))),a=`${n}.${i}`,o=await this.importSecret(),l=new TextEncoder().encode(a),s=await crypto.subtle.sign("HMAC",o,l),u=new Uint8Array(s),c=this.uint8ArrayToBase64Url(u);return`${a}.${c}`}catch(e){throw console.error("JWT token generation failed:",e),Error("Failed to generate JWT token")}}async verifyToken(e){try{if(!e||"string"!=typeof e||""===e.trim())return console.error("Invalid token provided for verification"),null;let r=e.split(".");if(3!==r.length)return console.error("Token format is invalid"),null;let[t,n,i]=r;if(!this.base64UrlDecode(t))return console.error("Failed to decode token header"),null;let a=this.base64UrlDecode(n);if(!a)return console.error("Failed to decode token payload"),null;let o=JSON.parse(a),l=Math.floor(Date.now()/1e3);if(o.exp&&o.exp<l)return console.error("Token has expired"),null;let s=await this.importSecret();if(!await this.verifySignature(`${t}.${n}`,i,s))return console.error("Token signature verification failed"),null;return o}catch(e){return console.error("Token verification failed:",e?.message||e),null}}async verifySignature(e,r,t){try{let n=this.base64UrlDecodeToUint8Array(r);if(!n)return!1;let i=new TextEncoder().encode(e),a=new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);return await crypto.subtle.verify("HMAC",t,a,o)}catch(e){return console.error("Signature verification error:",e),!1}}decodeToken(e){try{if(!e||"string"!=typeof e||""===e.trim())return null;let r=e.split(".");if(3!==r.length)return console.error("Token format is invalid"),null;let t=r[1],n=this.base64UrlDecode(t);if(!n)return null;return JSON.parse(n)}catch(e){return console.error("Token decoding failed:",e?.message||e),null}}isTokenExpired(e){try{let r=this.decodeToken(e);if(!r||!r.exp)return!0;let t=Math.floor(Date.now()/1e3);return r.exp<t}catch(e){return console.error("Error checking token expiration:",e),!0}}base64UrlDecode(e){try{let r="=".repeat((4-e.length%4)%4),t=e.replace(/-/g,"+").replace(/_/g,"/")+r,n=atob(t);return decodeURIComponent(escape(n))}catch(e){return console.error("Base64 URL decode error:",e),null}}base64UrlDecodeToUint8Array(e){try{let r="=".repeat((4-e.length%4)%4),t=e.replace(/-/g,"+").replace(/_/g,"/")+r,n=atob(t),i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);return i}catch(e){return console.error("Base64 URL decode to Uint8Array error:",e),null}}};e.s(["default",0,r])},81563,83274,e=>{"use strict";var r=e.i(89171),t=e.i(75188),n=e.i(15270);function i(e,r){return e===r}function a(e,r){return r.includes(e)}async function o(e,i){let o=e.headers.get("authorization"),l=null;if(o&&o.startsWith("Bearer "))l=o.substring(7);else{let r=e.cookies;l=r.get("access_token")?.value}if(!l)return e.nextUrl.pathname.startsWith("/api/")?r.NextResponse.json({error:"Authentication required"},{status:401}):r.NextResponse.redirect(new URL("/login",e.url));let s=await t.default.verifyToken(l);if(!s)return(console.error("Token verification failed:",l?l.substring(0,20)+"...":"null"),e.nextUrl.pathname.startsWith("/api/"))?r.NextResponse.json({error:"Invalid or expired token"},{status:401}):r.NextResponse.redirect(new URL("/",e.url));if(console.log("Decoded token:",s),!s.userId)return(console.error("Token does not contain userId:",s),e.nextUrl.pathname.startsWith("/api/"))?r.NextResponse.json({error:"Invalid token: missing user ID"},{status:401}):r.NextResponse.redirect(new URL("/login",e.url));let u=await n.default.user.findUnique({where:{id:s.userId},select:{id:!0,email:!0,name:!0,role:!0,unitId:!0}});return u?i&&i.length>0&&!a(u.role,i)?e.nextUrl.pathname.startsWith("/api/")?r.NextResponse.json({error:"User does not have required role to perform this action"},{status:403}):r.NextResponse.redirect(new URL("/unauthorized",e.url)):{user:u}:(console.error("User not found with ID from token:",s.userId),r.NextResponse.redirect(new URL("/login",e.url)))}e.s(["hasAnyRole",()=>a,"hasRole",()=>i],83274),e.s(["requireAuth",()=>o],81563)},51615,(e,r,t)=>{r.exports=e.x("node:buffer",()=>require("node:buffer"))},2157,(e,r,t)=>{r.exports=e.x("node:fs",()=>require("node:fs"))},81111,(e,r,t)=>{r.exports=e.x("node:stream",()=>require("node:stream"))},83522,e=>{"use strict";function r(e){if(null==e)return null;if("number"==typeof e)return Number.isFinite(e)?e:null;let r=String(e).replace(/,/g,"").trim();if(!r)return null;let t=Number(r);return Number.isFinite(t)?t:null}function t(e){return String(e||"").replace(/\s+/g,"")}function n(e){let r=String(e||"").trim().replace(/\s+/g," "),t=r.match(/^KRA\s*(\d+)$/i);return t?`KRA ${t[1]}`:r}function i(e,i,a,o){let l=function(e,r,i){if(!r||!i)return null;let a=e?.kras||[],o=n(r),l=a.find(e=>n(e.kra_id)===o);if(!l?.initiatives)return null;let s=t(String(i)),u=l.initiatives.find(e=>t(String(e.id))===s);if(!u){let e=String(i).match(/KPI(\d+)/i);e&&(u=l.initiatives.find(r=>String(r.id).includes(`KPI${e[1]}`)))}return u||null}(e,i,a),s=l?.targets?.type??null,u="string"==typeof l?.targets?.unit_basis?l.targets.unit_basis:null,c=l?.targets?.target_scope==="PER_UNIT"?"PER_UNIT":"INSTITUTIONAL";return{targetType:s,targetValue:function(e,t){if(!Array.isArray(e)||0===e.length)return null;let n=e.find(e=>Number(e?.year)===t),i=r(n?.target_value);if(null!==i)return i;let a=e.map(e=>({year:Number(e?.year),target:r(e?.target_value)})).filter(e=>Number.isFinite(e.year)&&null!==e.target),o=a.filter(e=>e.year<=t).sort((e,r)=>r.year-e.year);if(o.length>0)return o[0].target;let l=a.sort((e,r)=>e.year-r.year);return l.length>0?l[0].target:null}(l?.targets?.timeline_data||[],o),targetScope:c,unitBasis:u}}function a(e){return e.reduce((e,r)=>e+("number"==typeof r&&Number.isFinite(r)?r:0),0)}function o(e){let{targetType:t,targetValue:n,targetScope:i="INSTITUTIONAL",unitMultiplier:o,activities:l}=e,s=String(t||"").toLowerCase(),u="PER_UNIT"===i?n*("number"==typeof o&&Number.isFinite(o)?o:1):n;if("percentage"===s){let e,t=0===(e=l.map(e=>{let t=r(e.reported);if(null===t)return null;if(t>=0&&t<=100)return t;let n=r(e.target);if(null!==n&&n>0&&t>=0){let e=t/n*100;if(e>=0&&e<=100)return e}return null}).filter(e=>"number"==typeof e&&Number.isFinite(e))).length?0:e.reduce((e,r)=>e+r,0)/e.length;return{totalReported:t,totalTarget:u,achievementPercent:u>0?t/u*100:0}}if("financial"===s||"count"===s){let e=a(l.map(e=>r(e.reported)));0===e&&l.length>0&&"count"===s&&(e=l.length);let t=u>0?e/u*100:0;return{totalReported:e,totalTarget:u,achievementPercent:t}}if("milestone"===s||"text_condition"===s){let e=l.some(e=>{let r=e.reported;return"number"==typeof r?r>0:"string"==typeof r&&r.trim().length>0});return{totalReported:+!!e,totalTarget:1,achievementPercent:100*!!e}}let c=a(l.map(e=>r(e.reported)));0===c&&l.length>0&&(c=l.length);let d=u>0?c/u*100:0;return{totalReported:c,totalTarget:u,achievementPercent:d}}e.s(["computeAggregatedAchievement",()=>o,"getInitiativeTargetMeta",()=>i,"normalizeKraId",()=>n])},24868,(e,r,t)=>{r.exports=e.x("fs/promises",()=>require("fs/promises"))},74382,e=>{"use strict";var r=e.i(24868),t=e.i(14747);let n=new class{cachedPlan=null;async getStrategicPlan(){if(this.cachedPlan)return this.cachedPlan;try{let n=[];try{let{fileURLToPath:r}=e.r(92509),i=r(module.url||module.__filename||"");if(i){let e=t.default.dirname(i);n.push(t.default.join(e,"..","data","strategic_plan.json"))}}catch(e){}n.push(t.default.join(process.cwd(),"lib","data","strategic_plan.json")),n.push(t.default.join(process.cwd(),"strategic_plan.json"));let i=null,a=null;for(let e of n)try{await r.default.access(e),i=await r.default.readFile(e,"utf-8");break}catch(e){a=e}if(!i)throw a||Error("strategic_plan.json not found");return this.cachedPlan=JSON.parse(i),this.cachedPlan}catch(e){throw console.error("Error loading strategic plan:",e),Error("Failed to load strategic plan")}}async getKRA(e){return(await this.getStrategicPlan()).kras.find(r=>r.kra_id===e)||null}async getInitiative(e,r){let t=await this.getKRA(e);return t&&t.initiatives.find(e=>e.id===r)||null}async getTargetType(e,r){let t=await this.getInitiative(e,r);return t?t.targets.type:null}async getAllKRAsWithTypes(){let e=await this.getStrategicPlan(),r=[];for(let t of e.kras)for(let e of t.initiatives)r.push({kraId:t.kra_id,kraTitle:t.kra_title,initiativeId:e.id,targetType:e.targets.type});return r}invalidateCache(){this.cachedPlan=null}};e.s(["default",0,n,"strategicPlanService",0,n])},34695,e=>{e.v(e=>Promise.resolve().then(()=>e(23257)))},99606,e=>{e.v(r=>Promise.all(["server/chunks/[root-of-the-server]__56cd2238._.js"].map(r=>e.l(r))).then(()=>r(92674)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__53fe0a12._.js.map