module.exports=[6713,e=>{"use strict";var t,n,s,o,i,a,r,l,c,u,d,h,g,f,m,p,E,C,y,w,R,O,T,v,A=e.i(47909),I=e.i(74017),S=e.i(96250),N=e.i(59756),_=e.i(61916),L=e.i(14444),b=e.i(37092),x=e.i(69741),D=e.i(16795),M=e.i(87718),U=e.i(95169),k=e.i(47587),P=e.i(66012),H=e.i(70101),G=e.i(26937),$=e.i(10372),F=e.i(93695);e.i(52474);var j=e.i(220),B=e.i(89171);(t=g||(g={})).STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object",(n=f||(f={})).LANGUAGE_UNSPECIFIED="language_unspecified",n.PYTHON="python",(s=m||(m={})).OUTCOME_UNSPECIFIED="outcome_unspecified",s.OUTCOME_OK="outcome_ok",s.OUTCOME_FAILED="outcome_failed",s.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded";let Y=["user","model","function","system"];(o=p||(p={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",o.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",o.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",o.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",o.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",o.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",(i=E||(E={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE",(a=C||(C={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",a.NEGLIGIBLE="NEGLIGIBLE",a.LOW="LOW",a.MEDIUM="MEDIUM",a.HIGH="HIGH",(r=y||(y={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",r.SAFETY="SAFETY",r.OTHER="OTHER",(l=w||(w={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",l.STOP="STOP",l.MAX_TOKENS="MAX_TOKENS",l.SAFETY="SAFETY",l.RECITATION="RECITATION",l.LANGUAGE="LANGUAGE",l.BLOCKLIST="BLOCKLIST",l.PROHIBITED_CONTENT="PROHIBITED_CONTENT",l.SPII="SPII",l.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",l.OTHER="OTHER",(c=R||(R={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",c.RETRIEVAL_QUERY="RETRIEVAL_QUERY",c.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",c.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",c.CLASSIFICATION="CLASSIFICATION",c.CLUSTERING="CLUSTERING",(u=O||(O={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",u.AUTO="AUTO",u.ANY="ANY",u.NONE="NONE",(d=T||(T={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",d.MODE_DYNAMIC="MODE_DYNAMIC";class q extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class K extends q{constructor(e,t){super(e),this.response=t}}class V extends q{constructor(e,t,n,s){super(e),this.status=t,this.statusText=n,this.errorDetails=s}}class X extends q{}class W extends q{}(h=v||(v={})).GENERATE_CONTENT="generateContent",h.STREAM_GENERATE_CONTENT="streamGenerateContent",h.COUNT_TOKENS="countTokens",h.EMBED_CONTENT="embedContent",h.BATCH_EMBED_CONTENTS="batchEmbedContents";class J{constructor(e,t,n,s,o){this.model=e,this.task=t,this.apiKey=n,this.stream=s,this.requestOptions=o}toString(){var e,t;let n=(null==(e=this.requestOptions)?void 0:e.apiVersion)||"v1beta",s=(null==(t=this.requestOptions)?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com",o=`${s}/${n}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}async function Q(e){var t,n;let s,o=new Headers;o.append("Content-Type","application/json"),o.append("x-goog-api-client",(n=e.requestOptions,s=[],(null==n?void 0:n.apiClient)&&s.push(n.apiClient),s.push("genai-js/0.24.1"),s.join(" "))),o.append("x-goog-api-key",e.apiKey);let i=null==(t=e.requestOptions)?void 0:t.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(e){throw new X(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${e.message}`)}for(let[e,t]of i.entries()){if("x-goog-api-key"===e)throw new X(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new X(`Header name ${e} can only be set using the apiClient field`);o.append(e,t)}}return o}async function z(e,t,n,s,o,i){let a=new J(e,t,n,s,i);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},function(e){let t={};if((null==e?void 0:e.signal)!==void 0||(null==e?void 0:e.timeout)>=0){let n=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>n.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}(i)),{method:"POST",headers:await Q(a),body:o})}}async function Z(e,t,n,s,o,i={},a=fetch){let{url:r,fetchOptions:l}=await z(e,t,n,s,o,i);return ee(r,l,a)}async function ee(e,t,n=fetch){let s;try{s=await n(e,t)}catch(n){var o=n,i=e;let t=o;throw"AbortError"===t.name?(t=new W(`Request aborted when fetching ${i.toString()}: ${o.message}`)).stack=o.stack:o instanceof V||o instanceof X||((t=new q(`Error fetching from ${i.toString()}: ${o.message}`)).stack=o.stack),t}return s.ok||await et(s,e),s}async function et(e,t){let n,s="";try{let t=await e.json();s=t.error.message,t.error.details&&(s+=` ${JSON.stringify(t.error.details)}`,n=t.error.details)}catch(e){}throw new V(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${s}`,e.status,e.statusText,n)}function en(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),ei(e.candidates[0]))throw new K(`${ea(e)}`,e);return function(e){var t,n,s,o;let i=[];if(null==(n=null==(t=e.candidates)?void 0:t[0].content)?void 0:n.parts)for(let t of null==(o=null==(s=e.candidates)?void 0:s[0].content)?void 0:o.parts)t.text&&i.push(t.text),t.executableCode&&i.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&i.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}(e)}if(e.promptFeedback)throw new K(`Text not available. ${ea(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ei(e.candidates[0]))throw new K(`${ea(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),es(e)[0]}if(e.promptFeedback)throw new K(`Function call not available. ${ea(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ei(e.candidates[0]))throw new K(`${ea(e)}`,e);return es(e)}if(e.promptFeedback)throw new K(`Function call not available. ${ea(e)}`,e)},e}function es(e){var t,n,s,o;let i=[];if(null==(n=null==(t=e.candidates)?void 0:t[0].content)?void 0:n.parts)for(let t of null==(o=null==(s=e.candidates)?void 0:s[0].content)?void 0:o.parts)t.functionCall&&i.push(t.functionCall);return i.length>0?i:void 0}let eo=[w.RECITATION,w.SAFETY,w.LANGUAGE];function ei(e){return!!e.finishReason&&eo.includes(e.finishReason)}function ea(e){var t,n,s;let o="";if((!e.candidates||0===e.candidates.length)&&e.promptFeedback)o+="Response was blocked",(null==(t=e.promptFeedback)?void 0:t.blockReason)&&(o+=` due to ${e.promptFeedback.blockReason}`),(null==(n=e.promptFeedback)?void 0:n.blockReasonMessage)&&(o+=`: ${e.promptFeedback.blockReasonMessage}`);else if(null==(s=e.candidates)?void 0:s[0]){let t=e.candidates[0];ei(t)&&(o+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(o+=`: ${t.finishMessage}`))}return o}function er(e){return this instanceof er?(this.v=e,this):new er(e)}"function"==typeof SuppressedError&&SuppressedError;let el=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function ec(e){let t=[],n=e.getReader();for(;;){let{done:e,value:s}=await n.read();if(e)return en(function(e){let t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(let t of e){if(t.candidates){let e=0;for(let s of t.candidates)if(n.candidates||(n.candidates=[]),n.candidates[e]||(n.candidates[e]={index:e}),n.candidates[e].citationMetadata=s.citationMetadata,n.candidates[e].groundingMetadata=s.groundingMetadata,n.candidates[e].finishReason=s.finishReason,n.candidates[e].finishMessage=s.finishMessage,n.candidates[e].safetyRatings=s.safetyRatings,s.content&&s.content.parts){n.candidates[e].content||(n.candidates[e].content={role:s.content.role||"user",parts:[]});let t={};for(let o of s.content.parts)o.text&&(t.text=o.text),o.functionCall&&(t.functionCall=o.functionCall),o.executableCode&&(t.executableCode=o.executableCode),o.codeExecutionResult&&(t.codeExecutionResult=o.codeExecutionResult),0===Object.keys(t).length&&(t.text=""),n.candidates[e].content.parts.push(t)}e++}t.usageMetadata&&(n.usageMetadata=t.usageMetadata)}return n}(t));t.push(s)}}async function eu(e,t,n,s){return function(e){let t,[n,s]=(t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})).getReader(),new ReadableStream({start(e){let n="";return function s(){return t.read().then(({value:t,done:o})=>{let i;if(o)return n.trim()?void e.error(new q("Failed to parse stream")):void e.close();let a=(n+=t).match(el);for(;a;){try{i=JSON.parse(a[1])}catch(t){e.error(new q(`Error parsing JSON response: "${a[1]}"`));return}e.enqueue(i),a=(n=n.substring(a[0].length)).match(el)}return s()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new W("Request aborted when reading from the stream"):new q("Error reading from the stream")})}()}})).tee();return{stream:function(e){return function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var s,o=n.apply(e,t||[]),i=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(e){o[e]&&(s[e]=function(t){return new Promise(function(n,s){i.push([e,t,n,s])>1||r(e,t)})})}function r(e,t){try{var n;(n=o[e](t)).value instanceof er?Promise.resolve(n.value.v).then(l,c):u(i[0][2],n)}catch(e){u(i[0][3],e)}}function l(e){r("next",e)}function c(e){r("throw",e)}function u(e,t){e(t),i.shift(),i.length&&r(i[0][0],i[0][1])}}(this,arguments,function*(){let t=e.getReader();for(;;){let{value:e,done:n}=yield er(t.read());if(n)break;yield yield er(en(e))}})}(n),response:ec(s)}}(await Z(t,v.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),s))}async function ed(e,t,n,s){let o=await Z(t,v.GENERATE_CONTENT,e,!1,JSON.stringify(n),s);return{response:en(await o.json())}}function eh(e){if(null!=e){if("string"==typeof e)return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)if(!e.role)return{role:"system",parts:e.parts};else return e}}function eg(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(let n of e)"string"==typeof n?t.push({text:n}):t.push(n);var n=t;let s={role:"user",parts:[]},o={role:"function",parts:[]},i=!1,a=!1;for(let e of n)"functionResponse"in e?(o.parts.push(e),a=!0):(s.parts.push(e),i=!0);if(i&&a)throw new q("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!a)throw new q("No content is provided for sending chat message.");return i?s:o}function ef(e){let t;return t=e.contents?e:{contents:[eg(e)]},e.systemInstruction&&(t.systemInstruction=eh(e.systemInstruction)),t}let em=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],ep={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function eE(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;let n=null==(t=e.candidates[0])?void 0:t.content;if(void 0===n||void 0===n.parts||0===n.parts.length)return!1;for(let e of n.parts)if(void 0===e||0===Object.keys(e).length||void 0!==e.text&&""===e.text)return!1;return!0}let eC="SILENT_ERROR";class ey{constructor(e,t,n,s={}){this.model=t,this.params=n,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(!function(e){let t=!1;for(let n of e){let{role:e,parts:s}=n;if(!t&&"user"!==e)throw new q(`First content should be with role 'user', got ${e}`);if(!Y.includes(e))throw new q(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(Y)}`);if(!Array.isArray(s))throw new q("Content should have 'parts' property with an array of Parts");if(0===s.length)throw new q("Each Content should have at least one part");let o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let e of s)for(let t of em)t in e&&(o[t]+=1);let i=ep[e];for(let t of em)if(!i.includes(t)&&o[t]>0)throw new q(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,s,o,i,a,r;let l;await this._sendPromise;let c=eg(e),u={safetySettings:null==(n=this.params)?void 0:n.safetySettings,generationConfig:null==(s=this.params)?void 0:s.generationConfig,tools:null==(o=this.params)?void 0:o.tools,toolConfig:null==(i=this.params)?void 0:i.toolConfig,systemInstruction:null==(a=this.params)?void 0:a.systemInstruction,cachedContent:null==(r=this.params)?void 0:r.cachedContent,contents:[...this._history,c]},d=Object.assign(Object.assign({},this._requestOptions),t);return this._sendPromise=this._sendPromise.then(()=>ed(this._apiKey,this.model,u,d)).then(e=>{var t;if(eE(e.response)){this._history.push(c);let n=Object.assign({parts:[],role:"model"},null==(t=e.response.candidates)?void 0:t[0].content);this._history.push(n)}else{let t=ea(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}l=e}).catch(e=>{throw this._sendPromise=Promise.resolve(),e}),await this._sendPromise,l}async sendMessageStream(e,t={}){var n,s,o,i,a,r;await this._sendPromise;let l=eg(e),c={safetySettings:null==(n=this.params)?void 0:n.safetySettings,generationConfig:null==(s=this.params)?void 0:s.generationConfig,tools:null==(o=this.params)?void 0:o.tools,toolConfig:null==(i=this.params)?void 0:i.toolConfig,systemInstruction:null==(a=this.params)?void 0:a.systemInstruction,cachedContent:null==(r=this.params)?void 0:r.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),t),d=eu(this._apiKey,this.model,c,u);return this._sendPromise=this._sendPromise.then(()=>d).catch(e=>{throw Error(eC)}).then(e=>e.response).then(e=>{if(eE(e)){this._history.push(l);let t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{let t=ea(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==eC&&console.error(e)}),d}}async function ew(e,t,n,s){return(await Z(t,v.COUNT_TOKENS,e,!1,JSON.stringify(n),s)).json()}async function eR(e,t,n,s){return(await Z(t,v.EMBED_CONTENT,e,!1,JSON.stringify(n),s)).json()}async function eO(e,t,n,s){let o=n.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await Z(t,v.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:o}),s)).json()}class eT{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=eh(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;let s=ef(e),o=Object.assign(Object.assign({},this._requestOptions),t);return ed(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(n=this.cachedContent)?void 0:n.name},s),o)}async generateContentStream(e,t={}){var n;let s=ef(e),o=Object.assign(Object.assign({},this._requestOptions),t);return eu(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(n=this.cachedContent)?void 0:n.name},s),o)}startChat(e){var t;return new ey(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(t=this.cachedContent)?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let n=function(e,t){var n;let s={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null==(n=null==t?void 0:t.cachedContent)?void 0:n.name,contents:[]},o=null!=e.generateContentRequest;if(e.contents){if(o)throw new X("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=e.contents}else if(o)s=Object.assign(Object.assign({},s),e.generateContentRequest);else{let t=eg(e);s.contents=[t]}return{generateContentRequest:s}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return ew(this.apiKey,this.model,n,s)}async embedContent(e,t={}){let n="string"==typeof e||Array.isArray(e)?{content:eg(e)}:e,s=Object.assign(Object.assign({},this._requestOptions),t);return eR(this.apiKey,this.model,n,s)}async batchEmbedContents(e,t={}){let n=Object.assign(Object.assign({},this._requestOptions),t);return eO(this.apiKey,this.model,e,n)}}class ev{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new q("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new eT(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new X("Cached content must contain a `name` field.");if(!e.model)throw new X("Cached content must contain a `model` field.");for(let n of["model","systemInstruction"])if((null==t?void 0:t[n])&&e[n]&&(null==t?void 0:t[n])!==e[n]){if("model"===n&&(t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue;throw new X(`Different value for "${n}" specified in modelParams (${t[n]}) and cachedContent (${e[n]})`)}let s=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new eT(this.apiKey,s,n)}}var eA=e.i(18865),eI=e.i(50674);let eS=class{genAI;model;config;configService;monitoringService;constructor(e){const t=process.env.GOOGLE_AI_API_KEY||e?.apiKey||"";if(!t)throw Error("Google AI API key is required for Gemini Generation Service");this.config={apiKey:t,model:e?.model||"gemini-2.0-flash-001",generationConfig:e?.generationConfig||{temperature:.2,maxOutputTokens:8192,topP:.95,topK:40},safetySettings:e?.safetySettings||[{category:p.HARM_CATEGORY_HATE_SPEECH,threshold:E.BLOCK_MEDIUM_AND_ABOVE},{category:p.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:E.BLOCK_MEDIUM_AND_ABOVE},{category:p.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:E.BLOCK_MEDIUM_AND_ABOVE},{category:p.HARM_CATEGORY_HARASSMENT,threshold:E.BLOCK_MEDIUM_AND_ABOVE}]};try{this.config.model&&this.config.model.includes("4o")&&(this.config.generationConfig=this.config.generationConfig||{},this.config.generationConfig.maxOutputTokens=Math.min(this.config.generationConfig.maxOutputTokens||4096,4096))}catch(e){}this.genAI=new ev(this.config.apiKey),this.model=this.genAI.getGenerativeModel({model:this.config.model,safetySettings:[{category:p.HARM_CATEGORY_HARASSMENT,threshold:E.BLOCK_NONE},{category:p.HARM_CATEGORY_HATE_SPEECH,threshold:E.BLOCK_NONE},{category:p.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:E.BLOCK_NONE},{category:p.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:E.BLOCK_NONE}]}),this.configService=eA.default.getInstance(),this.monitoringService=eI.default.getInstance()}async generateResponse(e,t,n={},s){let o=Date.now();try{let i,a=s||"anonymous";if(!this.configService.isRequestAllowed(a)){let t=this.configService.getRemainingRequests(a),n=this.configService.getResetTime(a),i=new Date(n).toLocaleTimeString(),r=Error(`Rate limit exceeded. You can make ${t} more requests after ${i}.`);throw this.monitoringService.trackGeneration(s||"unknown",e,Date.now()-o,!1,r.message,this.config.model),r}let r=n.maxResults||6,l=t.slice(0,r);if(0===l.length)return this.monitoringService.trackGeneration(s||"unknown",e,Date.now()-o,!0,void 0,this.config.model),"I couldn't find any relevant documents to answer your query. Please try a different search term.";let c=e.toLowerCase().includes("list")||e.toLowerCase().includes("all")||e.toLowerCase().includes("every")||e.toLowerCase().includes("faculty")||e.toLowerCase().includes("training")||e.toLowerCase().includes("seminar")||e.toLowerCase().includes("attended")||e.toLowerCase().includes("presentation")||e.toLowerCase().includes("research")||e.toLowerCase().includes("what")&&e.toLowerCase().includes("training")||e.toLowerCase().includes("what")&&e.toLowerCase().includes("seminar")||e.toLowerCase().includes("which")&&e.toLowerCase().includes("training")||e.toLowerCase().includes("which")&&e.toLowerCase().includes("seminar")?t.slice(0,6):l,u=c.some(e=>e.visualContent||e.screenshots&&e.screenshots.length>0);return i=n.textOnly||!u?await this.generateTextOnlyResponse(e,c,n):await this.generateMultimodalResponse(e,c,n),this.monitoringService.trackGeneration(s||"unknown",e,Date.now()-o,!0,void 0,this.config.model),i}catch(t){throw console.error("Error generating response with Gemini:",t),this.monitoringService.trackGeneration(s||"unknown",e,Date.now()-o,!1,t instanceof Error?t.message:"Unknown error",this.config.model),t}}async generateTextOnlyResponse(e,t,n){let s=t.map((e,t)=>{let n=e.content||e.snippet||"",s=e.title||"Untitled Document",o=e.pageNumbers?.length?` (pages: ${e.pageNumbers.join(", ")})`:"",i=e.confidenceScore?` (relevance: ${(100*e.confidenceScore).toFixed(1)}%)`:"",a=e.screenshots&&e.screenshots.length>0,r=`Document ${t+1}: ${s}${o}${i}
`;return a&&(r+=`[VISUAL DATA: This document contains ${e.screenshots.length} image(s). Read any tables, numbers, or text visually present in the images.]
`),r+=`Content: ${n}
`}).join("\n---\n"),o=e.toLowerCase().includes("list")||e.toLowerCase().includes("all")||e.toLowerCase().includes("every")||e.toLowerCase().includes("faculty")||e.toLowerCase().includes("training")||e.toLowerCase().includes("seminar")||e.toLowerCase().includes("attended")||e.toLowerCase().includes("presentation")||e.toLowerCase().includes("research")||e.toLowerCase().includes("what")&&e.toLowerCase().includes("training")||e.toLowerCase().includes("what")&&e.toLowerCase().includes("seminar")||e.toLowerCase().includes("which")&&e.toLowerCase().includes("training")||e.toLowerCase().includes("which")&&e.toLowerCase().includes("seminar"),i=n.customPrompt||`Based on the following documents, provide a clear, direct answer to the user's query. If the documents don't contain the information needed to answer the query, state this clearly.

Documents:
${s}

User Query: ${e}

${o?'### SPECIAL INSTRUCTION FOR COMPREHENSIVE QUERIES: When the user asks for a list of items (such as faculty and their trainings/seminars), you MUST provide ALL the information found in the documents. Do not summarize or abbreviate. If multiple documents contain relevant information, combine and present ALL the data from all documents. Use a clear format like bullet points or structured lists to make the information easy to read. CRITICAL: If you state that you are providing a list, you MUST actually provide the complete list content. Do not just say "Here is the list..." without providing the actual items in the list. READ EVERY DOCUMENT CAREFULLY and extract ALL relevant information BEFORE forming your response. Do not stop at the first few items you find - continue reading through all documents to ensure you have collected all relevant information.':""}

Please provide a straightforward, direct answer to the query based on the provided documents. Focus on information that directly addresses the question. If the information is not available in the documents, say so clearly.`,a=await this.model.generateContent({contents:[{role:"user",parts:[{text:i}]}],generationConfig:this.config.generationConfig,safetySettings:this.config.safetySettings});return(await a.response).text()}async generateMultimodalResponse(e,t,n){let s=e.toLowerCase().includes("list")||e.toLowerCase().includes("all")||e.toLowerCase().includes("every")||e.toLowerCase().includes("faculty")||e.toLowerCase().includes("training")||e.toLowerCase().includes("seminar")||e.toLowerCase().includes("attended")||e.toLowerCase().includes("presentation")||e.toLowerCase().includes("research")||e.toLowerCase().includes("what")&&e.toLowerCase().includes("training")||e.toLowerCase().includes("what")&&e.toLowerCase().includes("seminar")||e.toLowerCase().includes("which")&&e.toLowerCase().includes("training")||e.toLowerCase().includes("which")&&e.toLowerCase().includes("seminar"),o=[];for(let n of(o.push({text:`
You are an intelligent assistant capable of reading documents and extracting specific details.
Your goal is to answer the user's question accurately based ONLY on the provided document images.

### DATA EXTRACTION RULES:
1. **Read the Visuals:** The documents may contain tables, lists, or spreadsheets. Scan them carefully row-by-row.
2. **Be Thorough:** If the user asks for a list (e.g., "all faculty"), extract EVERY name you see in the document images. Do not summarize.
3. ** OCR Handling:** If text is slightly blurry, use your best judgment to correct obvious spelling errors (e.g., interpret "M@rk" as "Mark").

### OUTPUT FORMATTING:
If the data involves multiple items (like names and trainings), you must use a **Nested Bullet List** format:

* **Name of Person**
  * Training Title A
  * Training Title B

If the answer is simple text, use a natural paragraph.

${s?'### SPECIAL INSTRUCTION FOR COMPREHENSIVE QUERIES: When the user asks for a list of items (such as faculty and their trainings/seminars), you MUST provide ALL the information found in the documents. Do not summarize or abbreviate. If multiple documents contain relevant information, combine and present ALL the data from all documents. Use a clear format like bullet points or structured lists to make the information easy to read. CRITICAL: If you state that you are providing a list, you MUST actually provide the complete list content. Do not just say "Here is the list..." without providing the actual items in the list. READ EVERY DOCUMENT CAREFULLY and extract ALL relevant information BEFORE forming your response. Do not stop at the first few items you find - continue reading through all documents to ensure you have collected all relevant information.':""}
-------------------------------------------------------
`}),t.slice(0,6))){let t=n.screenshots&&n.screenshots.length>0,s=n.extractedText&&n.extractedText.trim().length>0;if(o.push({text:`

=== Document: "${n.title}" ===
`}),t&&n.screenshots){for(let e of n.screenshots){let t="image/jpeg";"string"==typeof e&&(e.startsWith("iVBOR")?t="image/png":e.startsWith("/9j/")?t="image/jpeg":e.startsWith("iVBO")&&(t="image/png")),console.log(`Sending to Gemini as: ${t}`),o.push({inlineData:{data:e,mimeType:t}})}o.push({text:`
[VISUAL CONTENT: The above image contains the document content. Extract relevant information to answer: "${e}"]
`})}s?o.push({text:`
[TEXT CONTENT: ${n.extractedText}]
`}):o.push({text:`
[NO TEXT EXTRACTED: Focus on visual content to answer: "${e}"]
`})}o.push({text:`

${s?'### SPECIAL INSTRUCTION FOR COMPREHENSIVE QUERIES: When the user asks for a list of items (such as faculty and their trainings/seminars), you MUST provide ALL the information found in the documents. Do not summarize or abbreviate. If multiple documents contain relevant information, combine and present ALL the data from all documents. Use a clear format like bullet points or structured lists to make the information easy to read. CRITICAL: If you state that you are providing a list, you MUST actually provide the complete list content. Do not just say "Here is the list..." without providing the actual items in the list. READ EVERY DOCUMENT CAREFULLY and extract ALL relevant information BEFORE forming your response. Do not stop at the first few items you find - continue reading through all documents to ensure you have collected all relevant information.':""}

Based on the above documents, provide a clear, direct answer to this query: "${e}". Answer the question directly using specific information from the documents. If the documents don't contain the answer, say so clearly.`});let i=await this.model.generateContent({contents:[{role:"user",parts:o}],generationConfig:this.config.generationConfig,safetySettings:this.config.safetySettings});return(await i.response).text()}async generateInsights(e,t,n){let s=Date.now();try{let o=n||"anonymous";if(!this.configService.isRequestAllowed(o)){let t=this.configService.getRemainingRequests(o),i=this.configService.getResetTime(o),a=new Date(i).toLocaleTimeString(),r=Error(`Rate limit exceeded. You can make ${t} more requests after ${a}.`);throw this.monitoringService.trackGeneration(n||"unknown",e,Date.now()-s,!1,r.message,this.config.model),r}let i=t.slice(0,6);if(0===i.length)return this.monitoringService.trackGeneration(n||"unknown",e,Date.now()-s,!0,void 0,this.config.model),{summary:"No relevant documents found to generate insights.",keyPoints:[],sources:[]};let a=[];for(let t of(a.push({text:`
 You are an intelligent assistant capable of reading documents and extracting specific details.
 Your goal is to answer the user's question accurately based ONLY on the provided document images.

 ### DATA EXTRACTION RULES:
 1. **Read the Visuals:** The documents may contain tables, lists, or spreadsheets. Scan them carefully row-by-row.
 2. **Be Thorough:** If the user asks for a list (e.g., "all faculty"), extract EVERY name you see in the document images. Do not summarize.
 3. ** OCR Handling:** If text is slightly blurry, use your best judgment to correct obvious spelling errors (e.g., interpret "M@rk" as "Mark").

 ### OUTPUT FORMATTING:
 If the data involves multiple items (like names and trainings), you must use a **Nested Bullet List** format:

 * **Name of Person**
   * Training Title A
   * Training Title B

 If the answer is simple text, use a natural paragraph.
 -------------------------------------------------------
 `}),i)){let n=t.screenshots&&t.screenshots.length>0,s=t.extractedText&&t.extractedText.trim().length>0,o=t.title||"Untitled Document",i=t.confidenceScore||0;if(a.push({text:`

=== Document: "${o}" (relevance: ${(100*i).toFixed(1)}%) ===
`}),n&&t.screenshots){for(let e of t.screenshots){let t="image/jpeg";"string"==typeof e&&(e.startsWith("iVBOR")?t="image/png":e.startsWith("/9j/")?t="image/jpeg":e.startsWith("iVBO")&&(t="image/png")),console.log(`Sending to Gemini as: ${t}`),a.push({inlineData:{data:e,mimeType:t}})}a.push({text:`
[VISUAL CONTENT: The above image contains document information. Extract data relevant to: "${e}"]
`})}s?a.push({text:`
[TEXT CONTENT: ${t.extractedText}]
`}):a.push({text:`
[NO TEXT EXTRACTED: Focus on visual content to answer: "${e}"]
`})}let r=e.toLowerCase().includes("list")||e.toLowerCase().includes("all")||e.toLowerCase().includes("every")||e.toLowerCase().includes("faculty")||e.toLowerCase().includes("training")||e.toLowerCase().includes("seminar")||e.toLowerCase().includes("attended")||e.toLowerCase().includes("presentation")||e.toLowerCase().includes("research")||e.toLowerCase().includes("what")&&e.toLowerCase().includes("training")||e.toLowerCase().includes("what")&&e.toLowerCase().includes("seminar")||e.toLowerCase().includes("which")&&e.toLowerCase().includes("training")||e.toLowerCase().includes("which")&&e.toLowerCase().includes("seminar");a.push({text:`

${r?'### SPECIAL INSTRUCTION FOR COMPREHENSIVE QUERIES: When the user asks for a list of items (such as faculty and their trainings/seminars), you MUST provide ALL the information found in the documents. Do not summarize or abbreviate. If multiple documents contain relevant information, combine and present ALL the data from all documents. Use a clear format like bullet points or structured lists to make the information easy to read. CRITICAL: If you state that you are providing a list, you MUST actually provide the complete list content. Do not just say "Here is the list..." without providing the actual items in the list. READ EVERY DOCUMENT CAREFULLY and extract ALL relevant information BEFORE forming your response. Do not stop at the first few items you find - continue reading through all documents to ensure you have collected all relevant information.':""}

Based on the above documents, provide a clear, direct answer to "${e}". Format your response as JSON with the following structure: { "summary": "Direct answer to the user's query based on document content", "keyPoints": ["Concise points that directly address the query", "Relevant information from documents"], "sources": [ { "title": "Document title", "documentId": "Document ID if available", "confidence": "Confidence score between 0 and 1" } ] }`});let l=await this.model.generateContent({contents:[{role:"user",parts:a}],generationConfig:{...this.config.generationConfig,responseMimeType:"application/json"},safetySettings:this.config.safetySettings}),c=(await l.response).text();try{let t=JSON.parse(c);return this.monitoringService.trackGeneration(n||"unknown",e,Date.now()-s,!0,void 0,this.config.model),t}catch(o){console.error("Error parsing Gemini JSON response:",o);let t={summary:c.substring(0,500)+(c.length>500?"...":""),keyPoints:[c.substring(0,200)],sources:i.map(e=>({title:e.title||"Untitled Document",documentId:e.documentId||"",confidence:e.confidenceScore||0}))};return this.monitoringService.trackGeneration(n||"unknown",e,Date.now()-s,!0,"Fallback due to JSON parsing error",this.config.model),t}}catch(t){throw console.error("Error generating insights with Gemini:",t),this.monitoringService.trackGeneration(n||"unknown",e,Date.now()-s,!1,t instanceof Error?t.message:"Unknown error",this.config.model),t}}async healthCheck(){let e=Date.now();try{return await this.model.generateContent({contents:[{role:"user",parts:[{text:"Hello"}]}],generationConfig:{temperature:0,maxOutputTokens:5},safetySettings:this.config.safetySettings}),this.monitoringService.logMetric({endpoint:"gemini-health-check",responseTime:Date.now()-e,success:!0,model:this.config.model}),!0}catch(t){return console.error("Gemini service health check failed:",t),this.monitoringService.logMetric({endpoint:"gemini-health-check",responseTime:Date.now()-e,success:!1,error:t instanceof Error?t.message:"Unknown error",model:this.config.model}),!1}}};var eN=e.i(92674),e_=e.i(81563);let eL=new eS,eb=new eN.default;async function ex(e){try{let t=await (0,e_.requireAuth)(e);if("status"in t)return t;let{user:n}=t,{query:s,searchResults:o,generationType:i="text-only",maxResults:a=5,customPrompt:r}=await e.json();if(!s)return B.NextResponse.json({error:"Query parameter is required"},{status:400});if(!Array.isArray(o)||0===o.length)return B.NextResponse.json({error:"Search results are required and must be an array"},{status:400});let l=n.id;try{let e;return e="multimodal"===i?await eL.generateResponse(s,o,{textOnly:!1,maxResults:a,customPrompt:r},l):await eL.generateResponse(s,o,{textOnly:!0,maxResults:a,customPrompt:r},l),B.NextResponse.json({query:s,generatedResponse:e,generationType:i,searchResultsUsed:o.length,userId:l,timestamp:new Date().toISOString()})}catch(e){return console.error("Gemini generation failed:",e),B.NextResponse.json({error:"Failed to generate response with Gemini AI",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}catch(e){return console.error("Error in generation API:",e),B.NextResponse.json({error:"Internal server error during generation"},{status:500})}}async function eD(e){try{let t=await (0,e_.requireAuth)(e);if("status"in t)return t;let n=await eL.healthCheck(),s=await eb.validateApiKey();return B.NextResponse.json({status:"healthy",services:{gemini:n,colivara:s},timestamp:new Date().toISOString()})}catch(e){return console.error("Health check failed:",e),B.NextResponse.json({status:"unhealthy",error:e instanceof Error?e.message:"Health check failed"},{status:500})}}e.s(["GET",()=>eD,"POST",()=>ex],98188);var eM=e.i(98188);let eU=new A.AppRouteRouteModule({definition:{kind:I.RouteKind.APP_ROUTE,page:"/api/generate/route",pathname:"/api/generate",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/generate/route.ts",nextConfigOutput:"standalone",userland:eM}),{workAsyncStorage:ek,workUnitAsyncStorage:eP,serverHooks:eH}=eU;function eG(){return(0,S.patchFetch)({workAsyncStorage:ek,workUnitAsyncStorage:eP})}async function e$(e,t,n){eU.isDev&&(0,N.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/generate/route";s=s.replace(/\/index$/,"")||"/";let o=await eU.prepare(e,t,{srcPage:s,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:i,params:a,nextConfig:r,parsedUrl:l,isDraftMode:c,prerenderManifest:u,routerServerContext:d,isOnDemandRevalidate:h,revalidateOnlyGenerated:g,resolvedPathname:f,clientReferenceManifest:m,serverActionsManifest:p}=o,E=(0,x.normalizeAppPath)(s),C=!!(u.dynamicRoutes[E]||u.routes[f]),y=async()=>((null==d?void 0:d.render404)?await d.render404(e,t,l,!1):t.end("This page could not be found"),null);if(C&&!c){let e=!!u.routes[f],t=u.dynamicRoutes[E];if(t&&!1===t.fallback&&!e){if(r.experimental.adapterPath)return await y();throw new F.NoFallbackError}}let w=null;!C||eU.isDev||c||(w="/index"===(w=f)?"/":w);let R=!0===eU.isDev||!C,O=C&&!R;p&&m&&(0,L.setReferenceManifestsSingleton)({page:s,clientReferenceManifest:m,serverActionsManifest:p,serverModuleMap:(0,b.createServerModuleMap)({serverActionsManifest:p})});let T=e.method||"GET",v=(0,_.getTracer)(),A=v.getActiveScopeSpan(),S={params:a,prerenderManifest:u,renderOpts:{experimental:{authInterrupts:!!r.experimental.authInterrupts},cacheComponents:!!r.cacheComponents,supportsDynamicResponse:R,incrementalCache:(0,N.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:r.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,s)=>eU.onRequestError(e,t,s,d)},sharedContext:{buildId:i}},B=new D.NodeNextRequest(e),Y=new D.NodeNextResponse(t),q=M.NextRequestAdapter.fromNodeNextRequest(B,(0,M.signalFromNodeResponse)(t));try{let o=async e=>eU.handle(q,S).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=v.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==U.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=n.get("next.route");if(o){let t=`${T} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${T} ${s}`)}),i=!!(0,N.getRequestMeta)(e,"minimalMode"),a=async a=>{var l,f;let m=async({previousCacheEntry:r})=>{try{if(!i&&h&&g&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(a);e.fetchMetrics=S.renderOpts.fetchMetrics;let l=S.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let c=S.renderOpts.collectedTags;if(!C)return await (0,P.sendResponse)(B,Y,s,S.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,H.toNodeOutgoingHttpHeaders)(s.headers);c&&(t[$.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==S.renderOpts.collectedRevalidate&&!(S.renderOpts.collectedRevalidate>=$.INFINITE_CACHE)&&S.renderOpts.collectedRevalidate,o=void 0===S.renderOpts.collectedExpire||S.renderOpts.collectedExpire>=$.INFINITE_CACHE?void 0:S.renderOpts.collectedExpire;return{value:{kind:j.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:o}}}}catch(t){throw(null==r?void 0:r.isStale)&&await eU.onRequestError(e,t,{routerKind:"App Router",routePath:s,routeType:"route",revalidateReason:(0,k.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:h})},d),t}},p=await eU.handleResponse({req:e,nextConfig:r,cacheKey:w,routeKind:I.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:u,isRoutePPREnabled:!1,isOnDemandRevalidate:h,revalidateOnlyGenerated:g,responseGenerator:m,waitUntil:n.waitUntil,isMinimalMode:i});if(!C)return null;if((null==p||null==(l=p.value)?void 0:l.kind)!==j.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(f=p.value)?void 0:f.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",h?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),c&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let E=(0,H.fromNodeOutgoingHttpHeaders)(p.value.headers);return i&&C||E.delete($.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||E.get("Cache-Control")||E.set("Cache-Control",(0,G.getCacheControlHeader)(p.cacheControl)),await (0,P.sendResponse)(B,Y,new Response(p.value.body,{headers:E,status:p.value.status||200})),null};A?await a(A):await v.withPropagatedContext(e.headers,()=>v.trace(U.BaseServerSpan.handleRequest,{spanName:`${T} ${s}`,kind:_.SpanKind.SERVER,attributes:{"http.method":T,"http.target":e.url}},a))}catch(t){if(t instanceof F.NoFallbackError||await eU.onRequestError(e,t,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,k.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:h})}),C)throw t;return await (0,P.sendResponse)(B,Y,new Response(null,{status:500})),null}}e.s(["handler",()=>e$,"patchFetch",()=>eG,"routeModule",()=>eU,"serverHooks",()=>eH,"workAsyncStorage",()=>ek,"workUnitAsyncStorage",()=>eP],6713)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_04d884c6.js.map