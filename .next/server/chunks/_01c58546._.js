module.exports=[10859,(e,t,r)=>{"use strict";var i=Object.prototype.hasOwnProperty,n="~";function a(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,i,a){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new s(r,i||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function u(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(n=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)i.call(e,t)&&r.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,s=Array(a);i<a;i++)s[i]=r[i].fn;return s},u.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,i,a,s){var o=n?n+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,a),!0;case 6:return c.fn.call(c.context,t,r,i,a,s),!0}for(u=1,l=Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var p,h=c.length;for(u=0;u<h;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,i);break;default:if(!l)for(p=1,l=Array(d-1);p<d;p++)l[p-1]=arguments[p];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return l(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||l(this,a);else{for(var o=0,u=[],c=s.length;o<c;o++)(s[o].fn!==t||i&&!s[o].once||r&&s[o].context!==r)&&u.push(s[o]);u.length?this._events[a]=1===u.length?u[0]:u:l(this,a)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&l(this,t)):(this._events=new a,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,t.exports=u},52933,(e,t,r)=>{"use strict";t.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},41165,(e,t,r)=>{"use strict";let i=e.r(52933);class n extends Error{constructor(e){super(e),this.name="TimeoutError"}}let a=(e,t,r)=>new Promise((a,s)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void a(e);let o=setTimeout(()=>{if("function"==typeof r){try{a(r())}catch(e){s(e)}return}let i="string"==typeof r?r:`Promise timed out after ${t} milliseconds`,o=r instanceof Error?r:new n(i);"function"==typeof e.cancel&&e.cancel(),s(o)},t);i(e.then(a,s),()=>{clearTimeout(o)})});t.exports=a,t.exports.default=a,t.exports.TimeoutError=n},841,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){let i=0,n=e.length;for(;n>0;){let a=n/2|0,s=i+a;0>=r(e[s],t)?(i=++s,n-=a+1):n=a}return i}},61816,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let i=e.r(841);r.default=class{constructor(){this._queue=[]}enqueue(e,t){let r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(r);let n=i.default(this._queue,r,(e,t)=>t.priority-e.priority);this._queue.splice(n,0,r)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}},75482,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let i=e.r(10859),n=e.r(41165),a=e.r(61816),s=()=>{},o=new n.TimeoutError;r.default=class extends i{constructor(e){var t,r,i,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:a.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!=(r=null==(t=e.intervalCap)?void 0:t.toString())?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!=(n=null==(i=e.interval)?void 0:i.toString())?n:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,i)=>{let a=async()=>{this._pendingCount++,this._intervalCount++;try{let a=void 0===this._timeout&&void 0===t.timeout?e():n.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&i(o)});r(await a)}catch(e){i(e)}this._next()};this._queue.enqueue(a,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},57006,(e,t,r)=>{"use strict";t.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||0x1fffffffffffff,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},17518,(e,t,r)=>{"use strict";t.exports="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{}},66216,(e,t,r)=>{"use strict";let{MAX_SAFE_COMPONENT_LENGTH:i,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:a}=e.r(57006),s=e.r(17518),o=(r=t.exports={}).re=[],l=r.safeRe=[],u=r.src=[],c=r.safeSrc=[],d=r.t={},p=0,h="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",a],[h,n]],f=(e,t,r)=>{let i=(e=>{for(let[t,r]of m)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e})(t),n=p++;s(e,n,t),d[e]=n,u[n]=t,c[n]=i,o[n]=new RegExp(t,r?"g":void 0),l[n]=new RegExp(i,r?"g":void 0)};f("NUMERICIDENTIFIER","0|[1-9]\\d*"),f("NUMERICIDENTIFIERLOOSE","\\d+"),f("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),f("MAINVERSION",`(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})`),f("MAINVERSIONLOOSE",`(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASEIDENTIFIER",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIER]})`),f("PRERELEASEIDENTIFIERLOOSE",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIERLOOSE]})`),f("PRERELEASE",`(?:-(${u[d.PRERELEASEIDENTIFIER]}(?:\\.${u[d.PRERELEASEIDENTIFIER]})*))`),f("PRERELEASELOOSE",`(?:-?(${u[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[d.PRERELEASEIDENTIFIERLOOSE]})*))`),f("BUILDIDENTIFIER",`${h}+`),f("BUILD",`(?:\\+(${u[d.BUILDIDENTIFIER]}(?:\\.${u[d.BUILDIDENTIFIER]})*))`),f("FULLPLAIN",`v?${u[d.MAINVERSION]}${u[d.PRERELEASE]}?${u[d.BUILD]}?`),f("FULL",`^${u[d.FULLPLAIN]}$`),f("LOOSEPLAIN",`[v=\\s]*${u[d.MAINVERSIONLOOSE]}${u[d.PRERELEASELOOSE]}?${u[d.BUILD]}?`),f("LOOSE",`^${u[d.LOOSEPLAIN]}$`),f("GTLT","((?:<|>)?=?)"),f("XRANGEIDENTIFIERLOOSE",`${u[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),f("XRANGEIDENTIFIER",`${u[d.NUMERICIDENTIFIER]}|x|X|\\*`),f("XRANGEPLAIN",`[v=\\s]*(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:${u[d.PRERELEASE]})?${u[d.BUILD]}?)?)?`),f("XRANGEPLAINLOOSE",`[v=\\s]*(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:${u[d.PRERELEASELOOSE]})?${u[d.BUILD]}?)?)?`),f("XRANGE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAIN]}$`),f("XRANGELOOSE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAINLOOSE]}$`),f("COERCEPLAIN",`(^|[^\\d])(\\d{1,${i}})(?:\\.(\\d{1,${i}}))?(?:\\.(\\d{1,${i}}))?`),f("COERCE",`${u[d.COERCEPLAIN]}(?:$|[^\\d])`),f("COERCEFULL",u[d.COERCEPLAIN]+`(?:${u[d.PRERELEASE]})?`+`(?:${u[d.BUILD]})?`+"(?:$|[^\\d])"),f("COERCERTL",u[d.COERCE],!0),f("COERCERTLFULL",u[d.COERCEFULL],!0),f("LONETILDE","(?:~>?)"),f("TILDETRIM",`(\\s*)${u[d.LONETILDE]}\\s+`,!0),r.tildeTrimReplace="$1~",f("TILDE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAIN]}$`),f("TILDELOOSE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAINLOOSE]}$`),f("LONECARET","(?:\\^)"),f("CARETTRIM",`(\\s*)${u[d.LONECARET]}\\s+`,!0),r.caretTrimReplace="$1^",f("CARET",`^${u[d.LONECARET]}${u[d.XRANGEPLAIN]}$`),f("CARETLOOSE",`^${u[d.LONECARET]}${u[d.XRANGEPLAINLOOSE]}$`),f("COMPARATORLOOSE",`^${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]})$|^$`),f("COMPARATOR",`^${u[d.GTLT]}\\s*(${u[d.FULLPLAIN]})$|^$`),f("COMPARATORTRIM",`(\\s*)${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]}|${u[d.XRANGEPLAIN]})`,!0),r.comparatorTrimReplace="$1$2$3",f("HYPHENRANGE",`^\\s*(${u[d.XRANGEPLAIN]})\\s+-\\s+(${u[d.XRANGEPLAIN]})\\s*$`),f("HYPHENRANGELOOSE",`^\\s*(${u[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[d.XRANGEPLAINLOOSE]})\\s*$`),f("STAR","(<|>)?=?\\s*\\*"),f("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),f("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},24355,(e,t,r)=>{"use strict";let i=Object.freeze({loose:!0}),n=Object.freeze({});t.exports=e=>e?"object"!=typeof e?i:e:n},47277,(e,t,r)=>{"use strict";let i=/^[0-9]+$/,n=(e,t)=>{if("number"==typeof e&&"number"==typeof t)return e===t?0:e<t?-1:1;let r=i.test(e),n=i.test(t);return r&&n&&(e*=1,t*=1),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1};t.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},37898,(e,t,r)=>{"use strict";let i=e.r(17518),{MAX_LENGTH:n,MAX_SAFE_INTEGER:a}=e.r(57006),{safeRe:s,t:o}=e.r(66216),l=e.r(24355),{compareIdentifiers:u}=e.r(47277);class c{constructor(e,t){if(t=l(t),e instanceof c)if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;else e=e.version;else if("string"!=typeof e)throw TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>n)throw TypeError(`version is longer than ${n} characters`);i("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?s[o.LOOSE]:s[o.FULL]);if(!r)throw TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>a||this.major<0)throw TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){let t=+e;if(t>=0&&t<a)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(i("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return(e instanceof c||(e=new c(e,this.options)),this.major<e.major)?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:+(this.patch>e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return -1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],n=e.prerelease[t];if(i("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return -1;else if(r===n)continue;else return u(r,n)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{let r=this.build[t],n=e.build[t];if(i("build compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return -1;else if(r===n)continue;else return u(r,n)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&!1===r)throw Error("invalid increment argument: identifier is empty");if(t){let e=`-${t}`.match(this.options.loose?s[o.PRERELEASELOOSE]:s[o.PRERELEASE]);if(!e||e[1]!==t)throw Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(0===this.prerelease.length)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let e=+!!Number(r);if(0===this.prerelease.length)this.prerelease=[e];else{let i=this.prerelease.length;for(;--i>=0;)"number"==typeof this.prerelease[i]&&(this.prerelease[i]++,i=-2);if(-1===i){if(t===this.prerelease.join(".")&&!1===r)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let i=[t,e];!1===r&&(i=[t]),0===u(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}t.exports=c},16460,(e,t,r)=>{"use strict";let i=e.r(37898);t.exports=(e,t,r=!1)=>{if(e instanceof i)return e;try{return new i(e,t)}catch(e){if(!r)return null;throw e}}},77156,(e,t,r)=>{"use strict";let i=e.r(16460);t.exports=(e,t)=>{let r=i(e,t);return r?r.version:null}},79839,(e,t,r)=>{"use strict";let i=e.r(16460);t.exports=(e,t)=>{let r=i(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},5025,(e,t,r)=>{"use strict";let i=e.r(37898);t.exports=(e,t,r,n,a)=>{"string"==typeof r&&(a=n,n=r,r=void 0);try{return new i(e instanceof i?e.version:e,r).inc(t,n,a).version}catch(e){return null}}},87740,(e,t,r)=>{"use strict";let i=e.r(16460);t.exports=(e,t)=>{let r=i(e,null,!0),n=i(t,null,!0),a=r.compare(n);if(0===a)return null;let s=a>0,o=s?r:n,l=s?n:r,u=!!o.prerelease.length;if(l.prerelease.length&&!u){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(o))return l.minor&&!l.patch?"minor":"patch"}let c=u?"pre":"";return r.major!==n.major?c+"major":r.minor!==n.minor?c+"minor":r.patch!==n.patch?c+"patch":"prerelease"}},55631,(e,t,r)=>{"use strict";let i=e.r(37898);t.exports=(e,t)=>new i(e,t).major},66406,(e,t,r)=>{"use strict";let i=e.r(37898);t.exports=(e,t)=>new i(e,t).minor},76569,(e,t,r)=>{"use strict";let i=e.r(37898);t.exports=(e,t)=>new i(e,t).patch},91870,(e,t,r)=>{"use strict";let i=e.r(16460);t.exports=(e,t)=>{let r=i(e,t);return r&&r.prerelease.length?r.prerelease:null}},1070,(e,t,r)=>{"use strict";let i=e.r(37898);t.exports=(e,t,r)=>new i(e,r).compare(new i(t,r))},42836,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t,r)=>i(t,e,r)},39246,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t)=>i(e,t,!0)},50764,(e,t,r)=>{"use strict";let i=e.r(37898);t.exports=(e,t,r)=>{let n=new i(e,r),a=new i(t,r);return n.compare(a)||n.compareBuild(a)}},49535,(e,t,r)=>{"use strict";let i=e.r(50764);t.exports=(e,t)=>e.sort((e,r)=>i(e,r,t))},71739,(e,t,r)=>{"use strict";let i=e.r(50764);t.exports=(e,t)=>e.sort((e,r)=>i(r,e,t))},45008,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t,r)=>i(e,t,r)>0},80169,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t,r)=>0>i(e,t,r)},39027,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t,r)=>0===i(e,t,r)},19849,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t,r)=>0!==i(e,t,r)},53425,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t,r)=>i(e,t,r)>=0},24891,(e,t,r)=>{"use strict";let i=e.r(1070);t.exports=(e,t,r)=>0>=i(e,t,r)},40592,(e,t,r)=>{"use strict";let i=e.r(39027),n=e.r(19849),a=e.r(45008),s=e.r(53425),o=e.r(80169),l=e.r(24891);t.exports=(e,t,r,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return i(e,r,u);case"!=":return n(e,r,u);case">":return a(e,r,u);case">=":return s(e,r,u);case"<":return o(e,r,u);case"<=":return l(e,r,u);default:throw TypeError(`Invalid operator: ${t}`)}}},70537,(e,t,r)=>{"use strict";let i=e.r(37898),n=e.r(16460),{safeRe:a,t:s}=e.r(66216);t.exports=(e,t)=>{if(e instanceof i)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){let i,n=t.includePrerelease?a[s.COERCERTLFULL]:a[s.COERCERTL];for(;(i=n.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&i.index+i[0].length===r.index+r[0].length||(r=i),n.lastIndex=i.index+i[1].length+i[2].length;n.lastIndex=-1}else r=e.match(t.includePrerelease?a[s.COERCEFULL]:a[s.COERCE]);if(null===r)return null;let o=r[2],l=r[3]||"0",u=r[4]||"0",c=t.includePrerelease&&r[5]?`-${r[5]}`:"",d=t.includePrerelease&&r[6]?`+${r[6]}`:"";return n(`${o}.${l}.${u}${c}${d}`,t)}},3228,(e,t,r)=>{"use strict";t.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(void 0!==t)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){let e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},51532,(e,t,r)=>{"use strict";let i=/\s+/g;class n{constructor(e,t){if(t=s(t),e instanceof n)if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;else return new n(e.raw,t);if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(i," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter(e=>!y(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1){for(const e of this.set)if(1===e.length&&_(e[0])){this.set=[e];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let t=((this.options.includePrerelease&&f)|(this.options.loose&&g))+":"+e,r=a.get(t);if(r)return r;let i=this.options.loose,n=i?c[d.HYPHENRANGELOOSE]:c[d.HYPHENRANGE];l("hyphen replace",e=e.replace(n,A(this.options.includePrerelease))),l("comparator trim",e=e.replace(c[d.COMPARATORTRIM],p)),l("tilde trim",e=e.replace(c[d.TILDETRIM],h)),l("caret trim",e=e.replace(c[d.CARETTRIM],m));let s=e.split(" ").map(e=>b(e,this.options)).join(" ").split(/\s+/).map(e=>T(e,this.options));i&&(s=s.filter(e=>(l("loose invalid filter",e,this.options),!!e.match(c[d.COMPARATORLOOSE])))),l("range list",s);let u=new Map;for(let e of s.map(e=>new o(e,this.options))){if(y(e))return[e];u.set(e.value,e)}u.size>1&&u.has("")&&u.delete("");let _=[...u.values()];return a.set(t,_),_}intersects(e,t){if(!(e instanceof n))throw TypeError("a Range is required");return this.set.some(r=>v(r,t)&&e.set.some(e=>v(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(N(this.set[t],e,this.options))return!0;return!1}}t.exports=n;let a=new(e.r(3228)),s=e.r(24355),o=e.r(54409),l=e.r(17518),u=e.r(37898),{safeRe:c,t:d,comparatorTrimReplace:p,tildeTrimReplace:h,caretTrimReplace:m}=e.r(66216),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:g}=e.r(57006),y=e=>"<0.0.0-0"===e.value,_=e=>""===e.value,v=(e,t)=>{let r=!0,i=e.slice(),n=i.pop();for(;r&&i.length;)r=i.every(e=>n.intersects(e,t)),n=i.pop();return r},b=(e,t)=>(l("comp",e=e.replace(c[d.BUILD],""),t),l("caret",e=k(e,t)),l("tildes",e=$(e,t)),l("xrange",e=O(e,t)),l("stars",e=E(e,t)),e),w=e=>!e||"x"===e.toLowerCase()||"*"===e,$=(e,t)=>e.trim().split(/\s+/).map(e=>x(e,t)).join(" "),x=(e,t)=>{let r=t.loose?c[d.TILDELOOSE]:c[d.TILDE];return e.replace(r,(t,r,i,n,a)=>{let s;return l("tilde",e,t,r,i,n,a),w(r)?s="":w(i)?s=`>=${r}.0.0 <${+r+1}.0.0-0`:w(n)?s=`>=${r}.${i}.0 <${r}.${+i+1}.0-0`:a?(l("replaceTilde pr",a),s=`>=${r}.${i}.${n}-${a} <${r}.${+i+1}.0-0`):s=`>=${r}.${i}.${n} <${r}.${+i+1}.0-0`,l("tilde return",s),s})},k=(e,t)=>e.trim().split(/\s+/).map(e=>I(e,t)).join(" "),I=(e,t)=>{l("caret",e,t);let r=t.loose?c[d.CARETLOOSE]:c[d.CARET],i=t.includePrerelease?"-0":"";return e.replace(r,(t,r,n,a,s)=>{let o;return l("caret",e,t,r,n,a,s),w(r)?o="":w(n)?o=`>=${r}.0.0${i} <${+r+1}.0.0-0`:w(a)?o="0"===r?`>=${r}.${n}.0${i} <${r}.${+n+1}.0-0`:`>=${r}.${n}.0${i} <${+r+1}.0.0-0`:s?(l("replaceCaret pr",s),o="0"===r?"0"===n?`>=${r}.${n}.${a}-${s} <${r}.${n}.${+a+1}-0`:`>=${r}.${n}.${a}-${s} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${a}-${s} <${+r+1}.0.0-0`):(l("no pr"),o="0"===r?"0"===n?`>=${r}.${n}.${a}${i} <${r}.${n}.${+a+1}-0`:`>=${r}.${n}.${a}${i} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${a} <${+r+1}.0.0-0`),l("caret return",o),o})},O=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map(e=>S(e,t)).join(" ")),S=(e,t)=>{e=e.trim();let r=t.loose?c[d.XRANGELOOSE]:c[d.XRANGE];return e.replace(r,(r,i,n,a,s,o)=>{l("xRange",e,r,i,n,a,s,o);let u=w(n),c=u||w(a),d=c||w(s);return"="===i&&d&&(i=""),o=t.includePrerelease?"-0":"",u?r=">"===i||"<"===i?"<0.0.0-0":"*":i&&d?(c&&(a=0),s=0,">"===i?(i=">=",c?(n=+n+1,a=0):a=+a+1,s=0):"<="===i&&(i="<",c?n=+n+1:a=+a+1),"<"===i&&(o="-0"),r=`${i+n}.${a}.${s}${o}`):c?r=`>=${n}.0.0${o} <${+n+1}.0.0-0`:d&&(r=`>=${n}.${a}.0${o} <${n}.${+a+1}.0-0`),l("xRange return",r),r})},E=(e,t)=>(l("replaceStars",e,t),e.trim().replace(c[d.STAR],"")),T=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(c[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),A=e=>(t,r,i,n,a,s,o,l,u,c,d,p)=>(r=w(i)?"":w(n)?`>=${i}.0.0${e?"-0":""}`:w(a)?`>=${i}.${n}.0${e?"-0":""}`:s?`>=${r}`:`>=${r}${e?"-0":""}`,l=w(u)?"":w(c)?`<${+u+1}.0.0-0`:w(d)?`<${u}.${+c+1}.0-0`:p?`<=${u}.${c}.${d}-${p}`:e?`<${u}.${c}.${+d+1}-0`:`<=${l}`,`${r} ${l}`.trim()),N=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==o.ANY&&e[r].semver.prerelease.length>0){let i=e[r].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0}},54409,(e,t,r)=>{"use strict";let i=Symbol("SemVer ANY");class n{static get ANY(){return i}constructor(e,t){if(t=a(t),e instanceof n)if(!!t.loose===e.loose)return e;else e=e.value;u("comparator",e=e.trim().split(/\s+/).join(" "),t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===i?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(e){let t=this.options.loose?s[o.COMPARATORLOOSE]:s[o.COMPARATOR],r=e.match(t);if(!r)throw TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new c(r[2],this.options.loose):this.semver=i}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===i||e===i)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=a(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">"))}}t.exports=n;let a=e.r(24355),{safeRe:s,t:o}=e.r(66216),l=e.r(40592),u=e.r(17518),c=e.r(37898),d=e.r(51532)},21152,(e,t,r)=>{"use strict";let i=e.r(51532);t.exports=(e,t,r)=>{try{t=new i(t,r)}catch(e){return!1}return t.test(e)}},81400,(e,t,r)=>{"use strict";let i=e.r(51532);t.exports=(e,t)=>new i(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},52862,(e,t,r)=>{"use strict";let i=e.r(37898),n=e.r(51532);t.exports=(e,t,r)=>{let a=null,s=null,o=null;try{o=new n(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!a||-1===s.compare(e))&&(s=new i(a=e,r))}),a}},67359,(e,t,r)=>{"use strict";let i=e.r(37898),n=e.r(51532);t.exports=(e,t,r)=>{let a=null,s=null,o=null;try{o=new n(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!a||1===s.compare(e))&&(s=new i(a=e,r))}),a}},14757,(e,t,r)=>{"use strict";let i=e.r(37898),n=e.r(51532),a=e.r(45008);t.exports=(e,t)=>{e=new n(e,t);let r=new i("0.0.0");if(e.test(r)||(r=new i("0.0.0-0"),e.test(r)))return r;r=null;for(let t=0;t<e.set.length;++t){let n=e.set[t],s=null;n.forEach(e=>{let t=new i(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":(!s||a(t,s))&&(s=t);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${e.operator}`)}}),s&&(!r||a(r,s))&&(r=s)}return r&&e.test(r)?r:null}},25537,(e,t,r)=>{"use strict";let i=e.r(51532);t.exports=(e,t)=>{try{return new i(e,t).range||"*"}catch(e){return null}}},92538,(e,t,r)=>{"use strict";let i=e.r(37898),n=e.r(54409),{ANY:a}=n,s=e.r(51532),o=e.r(21152),l=e.r(45008),u=e.r(80169),c=e.r(24891),d=e.r(53425);t.exports=(e,t,r,p)=>{let h,m,f,g,y;switch(e=new i(e,p),t=new s(t,p),r){case">":h=l,m=c,f=u,g=">",y=">=";break;case"<":h=u,m=d,f=l,g="<",y="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,p))return!1;for(let r=0;r<t.set.length;++r){let i=t.set[r],s=null,o=null;if(i.forEach(e=>{e.semver===a&&(e=new n(">=0.0.0")),s=s||e,o=o||e,h(e.semver,s.semver,p)?s=e:f(e.semver,o.semver,p)&&(o=e)}),s.operator===g||s.operator===y||(!o.operator||o.operator===g)&&m(e,o.semver)||o.operator===y&&f(e,o.semver))return!1}return!0}},12352,(e,t,r)=>{"use strict";let i=e.r(92538);t.exports=(e,t,r)=>i(e,t,">",r)},65212,(e,t,r)=>{"use strict";let i=e.r(92538);t.exports=(e,t,r)=>i(e,t,"<",r)},86081,(e,t,r)=>{"use strict";let i=e.r(51532);t.exports=(e,t,r)=>(e=new i(e,r),t=new i(t,r),e.intersects(t,r))},96485,(e,t,r)=>{"use strict";let i=e.r(21152),n=e.r(1070);t.exports=(e,t,r)=>{let a=[],s=null,o=null,l=e.sort((e,t)=>n(e,t,r));for(let e of l)i(e,t,r)?(o=e,s||(s=e)):(o&&a.push([s,o]),o=null,s=null);s&&a.push([s,null]);let u=[];for(let[e,t]of a)e===t?u.push(e):t||e!==l[0]?t?e===l[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");let c=u.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return c.length<d.length?c:t}},69641,(e,t,r)=>{"use strict";let i=e.r(51532),n=e.r(54409),{ANY:a}=n,s=e.r(21152),o=e.r(1070),l=[new n(">=0.0.0-0")],u=[new n(">=0.0.0")],c=(e,t,r)=>{let i,n,c,h,m,f,g;if(e===t)return!0;if(1===e.length&&e[0].semver===a)if(1===t.length&&t[0].semver===a)return!0;else e=r.includePrerelease?l:u;if(1===t.length&&t[0].semver===a)if(r.includePrerelease)return!0;else t=u;let y=new Set;for(let t of e)">"===t.operator||">="===t.operator?i=d(i,t,r):"<"===t.operator||"<="===t.operator?n=p(n,t,r):y.add(t.semver);if(y.size>1)return null;if(i&&n&&((c=o(i.semver,n.semver,r))>0||0===c&&(">="!==i.operator||"<="!==n.operator)))return null;for(let e of y){if(i&&!s(e,String(i),r)||n&&!s(e,String(n),r))return null;for(let i of t)if(!s(e,String(i),r))return!1;return!0}let _=!!n&&!r.includePrerelease&&!!n.semver.prerelease.length&&n.semver,v=!!i&&!r.includePrerelease&&!!i.semver.prerelease.length&&i.semver;for(let e of(_&&1===_.prerelease.length&&"<"===n.operator&&0===_.prerelease[0]&&(_=!1),t)){if(g=g||">"===e.operator||">="===e.operator,f=f||"<"===e.operator||"<="===e.operator,i){if(v&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===v.major&&e.semver.minor===v.minor&&e.semver.patch===v.patch&&(v=!1),">"===e.operator||">="===e.operator){if((h=d(i,e,r))===e&&h!==i)return!1}else if(">="===i.operator&&!s(i.semver,String(e),r))return!1}if(n){if(_&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===_.major&&e.semver.minor===_.minor&&e.semver.patch===_.patch&&(_=!1),"<"===e.operator||"<="===e.operator){if((m=p(n,e,r))===e&&m!==n)return!1}else if("<="===n.operator&&!s(n.semver,String(e),r))return!1}if(!e.operator&&(n||i)&&0!==c)return!1}return(!i||!f||!!n||0===c)&&(!n||!g||!!i||0===c)&&!v&&!_&&!0},d=(e,t,r)=>{if(!e)return t;let i=o(e.semver,t.semver,r);return i>0?e:i<0||">"===t.operator&&">="===e.operator?t:e},p=(e,t,r)=>{if(!e)return t;let i=o(e.semver,t.semver,r);return i<0?e:i>0||"<"===t.operator&&"<="===e.operator?t:e};t.exports=(e,t,r={})=>{if(e===t)return!0;e=new i(e,r),t=new i(t,r);let n=!1;e:for(let i of e.set){for(let e of t.set){let t=c(i,e,r);if(n=n||null!==t,t)continue e}if(n)return!1}return!0}},99136,(e,t,r)=>{"use strict";let i=e.r(66216),n=e.r(57006),a=e.r(37898),s=e.r(47277),o=e.r(16460),l=e.r(77156),u=e.r(79839),c=e.r(5025),d=e.r(87740),p=e.r(55631),h=e.r(66406),m=e.r(76569),f=e.r(91870),g=e.r(1070),y=e.r(42836),_=e.r(39246),v=e.r(50764),b=e.r(49535),w=e.r(71739),$=e.r(45008),x=e.r(80169),k=e.r(39027),I=e.r(19849),O=e.r(53425),S=e.r(24891),E=e.r(40592),T=e.r(70537),A=e.r(54409),N=e.r(51532),C=e.r(21152),P=e.r(81400),j=e.r(52862),R=e.r(67359),L=e.r(14757),U=e.r(25537),z=e.r(92538),M=e.r(12352),D=e.r(65212),Z=e.r(86081);t.exports={parse:o,valid:l,clean:u,inc:c,diff:d,major:p,minor:h,patch:m,prerelease:f,compare:g,rcompare:y,compareLoose:_,compareBuild:v,sort:b,rsort:w,gt:$,lt:x,eq:k,neq:I,gte:O,lte:S,cmp:E,coerce:T,Comparator:A,Range:N,satisfies:C,toComparators:P,maxSatisfying:j,minSatisfying:R,minVersion:L,validRange:U,outside:z,gtr:M,ltr:D,intersects:Z,simplifyRange:e.r(96485),subset:e.r(69641),SemVer:a,re:i.re,src:i.src,tokens:i.t,SEMVER_SPEC_VERSION:n.SEMVER_SPEC_VERSION,RELEASE_TYPES:n.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers}},48271,(e,t,r)=>{"use strict";var i=Object.prototype.hasOwnProperty,n="~";function a(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,i,a){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new s(r,i||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function u(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(n=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)i.call(e,t)&&r.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,s=Array(a);i<a;i++)s[i]=r[i].fn;return s},u.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,i,a,s){var o=n?n+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,a),!0;case 6:return c.fn.call(c.context,t,r,i,a,s),!0}for(u=1,l=Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var p,h=c.length;for(u=0;u<h;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,i);break;default:if(!l)for(p=1,l=Array(d-1);p<d;p++)l[p-1]=arguments[p];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return l(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||l(this,a);else{for(var o=0,u=[],c=s.length;o<c;o++)(s[o].fn!==t||i&&!s[o].once||r&&s[o].context!==r)&&u.push(s[o]);u.length?this._events[a]=1===u.length?u[0]:u:l(this,a)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&l(this,t)):(this._events=new a,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,t.exports=u},6920,(e,t,r)=>{"use strict";r.byteLength=function(e){var t=u(e),r=t[0],i=t[1];return(r+i)*3/4-i},r.toByteArray=function(e){var t,r,i=u(e),s=i[0],o=i[1],l=new a((s+o)*3/4-o),c=0,d=o>0?s-4:s;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,l[c++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,l[c++]=t>>8&255,l[c++]=255&t),l},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,a=[],s=0,o=r-n;s<o;s+=16383)a.push(function(e,t,r){for(var n,a=[],s=t;s<r;s+=3)n=(e[s]<<16&0xff0000)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(i[n>>18&63]+i[n>>12&63]+i[n>>6&63]+i[63&n]);return a.join("")}(e,s,s+16383>o?o:s+16383));return 1===n?a.push(i[(t=e[r-1])>>2]+i[t<<4&63]+"=="):2===n&&a.push(i[(t=(e[r-2]<<8)+e[r-1])>>10]+i[t>>4&63]+i[t<<2&63]+"="),a.join("")};for(var i=[],n=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,l=s.length;o<l;++o)i[o]=s[o],n[s.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var i=r===t?0:4-r%4;return[r,i]}n[45]=62,n[95]=63},52914,75736,40470,51191,60427,11614,69065,49835,29494,59952,22632,20204,37253,63025,40849,e=>{"use strict";let t,r,i,n,a,s,o,l,u,c,d,p,h,m;function f(e,t){return e.lc_error_code=t,e.message=`${e.message}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langchain/errors/${t}/
`,e}function g(e,t,r,i,n){if("m"===i)throw TypeError("Private method is not writable");if("a"===i&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r}function y(e,t,r,i){if("a"===r&&!i)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)}let _=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return _=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),r=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^r()&15>>e/4).toString(16))};function v(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let b=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class w extends Error{}class $ extends w{constructor(e,t,r,i){super(`${$.makeMessage(e,t,r)}`),this.status=e,this.headers=i,this.requestID=i?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,r){let i=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,r,i){if(!e||!i)return new k({message:r,cause:b(t)});let n=t?.error;return 400===e?new O(e,n,r,i):401===e?new S(e,n,r,i):403===e?new E(e,n,r,i):404===e?new T(e,n,r,i):409===e?new A(e,n,r,i):422===e?new N(e,n,r,i):429===e?new C(e,n,r,i):e>=500?new P(e,n,r,i):new $(e,n,r,i)}}class x extends ${constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class k extends ${constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class I extends k{constructor({message:e}={}){super({message:e??"Request timed out."})}}class O extends ${}class S extends ${}class E extends ${}class T extends ${}class A extends ${}class N extends ${}class C extends ${}class P extends ${}class j extends w{constructor(){super("Could not parse response content as the length limit was reached")}}class R extends w{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class L extends Error{constructor(e){super(e)}}let U=/^[a-z][a-z0-9+.-]*:/i,z=e=>(z=Array.isArray)(e),M=z;function D(e){return"object"!=typeof e?{}:e??{}}function Z(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let F=e=>new Promise(t=>setTimeout(t,e)),B="6.10.0",q=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",W=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function J(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function G(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return J({start(){},async pull(e){let{done:r,value:i}=await t.next();r?e.close():e.enqueue(i)},async cancel(){await t.return?.()}})}function H(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function V(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),r=t.cancel();t.releaseLock(),await r}let K=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),X="RFC3986",Y=e=>String(e),Q={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:Y},ee=(e,t)=>(ee=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),et=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function er(e,t){if(z(e)){let r=[];for(let i=0;i<e.length;i+=1)r.push(t(e[i]));return r}return t(e)}let ei={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},en=function(e,t){Array.prototype.push.apply(e,z(t)?t:[t])},ea={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,r,i,n)=>{if(0===e.length)return e;let a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===r)return escape(a).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let s="";for(let e=0;e<a.length;e+=1024){let t=a.length>=1024?a.slice(e,e+1024):a,r=[];for(let e=0;e<t.length;++e){let i=t.charCodeAt(e);if(45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122||"RFC1738"===n&&(40===i||41===i)){r[r.length]=t.charAt(e);continue}if(i<128){r[r.length]=et[i];continue}if(i<2048){r[r.length]=et[192|i>>6]+et[128|63&i];continue}if(i<55296||i>=57344){r[r.length]=et[224|i>>12]+et[128|i>>6&63]+et[128|63&i];continue}e+=1,i=65536+((1023&i)<<10|1023&t.charCodeAt(e)),r[r.length]=et[240|i>>18]+et[128|i>>12&63]+et[128|i>>6&63]+et[128|63&i]}s+=r.join("")}return s},encodeValuesOnly:!1,format:X,formatter:Y,indices:!1,serializeDate:e=>(r??(r=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},es={};function eo(e){let t;return(i??(i=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function el(e){let t;return(n??(n=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class eu{constructor(){rh.set(this,void 0),rm.set(this,void 0),g(this,rh,new Uint8Array,"f"),g(this,rm,null,"f")}decode(e){let t;if(null==e)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?eo(e):e;g(this,rh,function(e){let t=0;for(let r of e)t+=r.length;let r=new Uint8Array(t),i=0;for(let t of e)r.set(t,i),i+=t.length;return r}([y(this,rh,"f"),r]),"f");let i=[];for(;null!=(t=function(e,t){for(let r=t??0;r<e.length;r++){if(10===e[r])return{preceding:r,index:r+1,carriage:!1};if(13===e[r])return{preceding:r,index:r+1,carriage:!0}}return null}(y(this,rh,"f"),y(this,rm,"f")));){if(t.carriage&&null==y(this,rm,"f")){g(this,rm,t.index,"f");continue}if(null!=y(this,rm,"f")&&(t.index!==y(this,rm,"f")+1||t.carriage)){i.push(el(y(this,rh,"f").subarray(0,y(this,rm,"f")-1))),g(this,rh,y(this,rh,"f").subarray(y(this,rm,"f")),"f"),g(this,rm,null,"f");continue}let e=null!==y(this,rm,"f")?t.preceding-1:t.preceding,r=el(y(this,rh,"f").subarray(0,e));i.push(r),g(this,rh,y(this,rh,"f").subarray(t.index),"f"),g(this,rm,null,"f")}return i}flush(){return y(this,rh,"f").length?this.decode("\n"):[]}}rh=new WeakMap,rm=new WeakMap,eu.NEWLINE_CHARS=new Set(["\n","\r"]),eu.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let ec={off:0,error:200,warn:300,info:400,debug:500},ed=(e,t,r)=>{if(e){if(Object.prototype.hasOwnProperty.call(ec,e))return e;eg(r).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(ec))}`)}};function ep(){}function eh(e,t,r){return!t||ec[e]>ec[r]?ep:t[e].bind(t)}let em={error:ep,warn:ep,info:ep,debug:ep},ef=new WeakMap;function eg(e){let t=e.logger,r=e.logLevel??"off";if(!t)return em;let i=ef.get(t);if(i&&i[0]===r)return i[1];let n={error:eh("error",t,r),warn:eh("warn",t,r),info:eh("info",t,r),debug:eh("debug",t,r)};return ef.set(t,[r,n]),n}let ey=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class e_{constructor(e,t,r){this.iterator=e,rf.set(this,void 0),this.controller=t,g(this,rf,r,"f")}static fromSSEResponse(e,t,r){let i=!1,n=r?eg(r):console;async function*a(){if(i)throw new w("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let r=!1;try{for await(let i of ev(e,t))if(!r){if(i.data.startsWith("[DONE]")){r=!0;continue}if(null!==i.event&&i.event.startsWith("thread.")){let e;try{e=JSON.parse(i.data)}catch(e){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),e}if("error"==i.event)throw new $(void 0,e.error,e.message,void 0);yield{event:i.event,data:e}}else{let t;try{t=JSON.parse(i.data)}catch(e){throw n.error("Could not parse message into JSON:",i.data),n.error("From chunk:",i.raw),e}if(t&&t.error)throw new $(void 0,t.error,void 0,e.headers);yield t}}r=!0}catch(e){if(v(e))return;throw e}finally{r||t.abort()}}return new e_(a,t,r)}static fromReadableStream(e,t,r){let i=!1;async function*n(){let t=new eu;for await(let r of H(e))for(let e of t.decode(r))yield e;for(let e of t.flush())yield e}return new e_(async function*(){if(i)throw new w("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(v(e))return;throw e}finally{e||t.abort()}},t,r)}[(rf=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),i=i=>({next:()=>{if(0===i.length){let i=r.next();e.push(i),t.push(i)}return i.shift()}});return[new e_(()=>i(e),this.controller,y(this,rf,"f")),new e_(()=>i(t),this.controller,y(this,rf,"f"))]}toReadableStream(){let e,t=this;return J({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:r,done:i}=await e.next();if(i)return t.close();let n=eo(JSON.stringify(r)+"\n");t.enqueue(n)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*ev(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new w("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new w("Attempted to iterate over a response with no body")}let r=new ew,i=new eu;for await(let t of eb(H(e.body)))for(let e of i.decode(t)){let t=r.decode(e);t&&(yield t)}for(let e of i.flush()){let t=r.decode(e);t&&(yield t)}}async function*eb(e){let t=new Uint8Array;for await(let r of e){let e;if(null==r)continue;let i=r instanceof ArrayBuffer?new Uint8Array(r):"string"==typeof r?eo(r):r,n=new Uint8Array(t.length+i.length);for(n.set(t),n.set(i,t.length),t=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class ew{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){var t;let r;if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[i,n,a]=-1!==(r=(t=e).indexOf(":"))?[t.substring(0,r),":",t.substring(r+1)]:[t,"",""];return a.startsWith(" ")&&(a=a.substring(1)),"event"===i?this.event=a:"data"===i&&this.data.push(a),null}}async function e$(e,t){let{response:r,requestLogID:i,retryOfRequestLogID:n,startTime:a}=t,s=await (async()=>{if(t.options.stream)return(eg(e).debug("response",r.status,r.url,r.headers,r.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(r,t.controller,e):e_.fromSSEResponse(r,t.controller,e);if(204===r.status)return null;if(t.options.__binaryResponse)return r;let i=r.headers.get("content-type"),n=i?.split(";")[0]?.trim();return n?.includes("application/json")||n?.endsWith("+json")?ex(await r.json(),r):await r.text()})();return eg(e).debug(`[${i}] response parsed`,ey({retryOfRequestLogID:n,url:r.url,status:r.status,body:s,durationMs:Date.now()-a})),s}function ex(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class ek extends Promise{constructor(e,t,r=e$){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=r,rg.set(this,void 0),g(this,rg,e,"f")}_thenUnwrap(e){return new ek(y(this,rg,"f"),this.responsePromise,async(t,r)=>ex(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(y(this,rg,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}rg=new WeakMap;class eI{constructor(e,t,r,i){ry.set(this,void 0),g(this,ry,e,"f"),this.options=i,this.response=t,this.body=r}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new w("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await y(this,ry,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(ry=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class eO extends ek{constructor(e,t,r){super(e,t,async(e,t)=>new r(e,t.response,await e$(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class eS extends eI{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class eE extends eI{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...D(this.options.query),after:t}}:null}}class eT extends eI{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[],this.has_more=r.has_more||!1,this.last_id=r.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...D(this.options.query),after:e}}:null}}let eA=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function eN(e,t,r){return eA(),new File(e,t??"unknown_file",r)}function eC(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let eP=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],ej=async(e,t)=>eM(e.body)?{...e,body:await eU(e.body,t)}:e,eR=async(e,t)=>({...e,body:await eU(e.body,t)}),eL=new WeakMap,eU=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,r=eL.get(t);if(r)return r;let i=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,r=new FormData;if(r.toString()===await new e(r).text())return!1;return!0}catch{return!0}})();return eL.set(t,i),i}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let r=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>eD(r,e,t))),r},ez=e=>e instanceof Blob&&"name"in e,eM=e=>{if("object"==typeof e&&null!==e&&(e instanceof Response||eP(e)||ez(e)))return!0;if(Array.isArray(e))return e.some(eM);if(e&&"object"==typeof e){for(let t in e)if(eM(e[t]))return!0}return!1},eD=async(e,t,r)=>{if(void 0!==r){if(null==r)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(t,String(r));else if(r instanceof Response)e.append(t,eN([await r.blob()],eC(r)));else if(eP(r))e.append(t,eN([await new Response(G(r)).blob()],eC(r)));else if(ez(r))e.append(t,r,eC(r));else if(Array.isArray(r))await Promise.all(r.map(r=>eD(e,t+"[]",r)));else if("object"==typeof r)await Promise.all(Object.entries(r).map(([r,i])=>eD(e,`${t}[${r}]`,i)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}},eZ=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function eF(e,t,r){let i,n;if(eA(),null!=(i=e=await e)&&"object"==typeof i&&"string"==typeof i.name&&"number"==typeof i.lastModified&&eZ(i))return e instanceof File?e:eN([await e.arrayBuffer()],e.name);if(null!=(n=e)&&"object"==typeof n&&"string"==typeof n.url&&"function"==typeof n.blob){let i=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),eN(await eB(i),t,r)}let a=await eB(e);if(t||(t=eC(e)),!r?.type){let e=a.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(r={...r,type:e})}return eN(a,t,r)}async function eB(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(eZ(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(eP(e))for await(let r of e)t.push(...await eB(r));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class eq{constructor(e){this._client=e}}function eW(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let eJ=Object.freeze(Object.create(null)),eG=((e=eW)=>function(t,...r){let i;if(1===t.length)return t[0];let n=!1,a=[],s=t.reduce((t,i,s)=>{/[?#]/.test(i)&&(n=!0);let o=r[s],l=(n?encodeURIComponent:e)(""+o);return s!==r.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??eJ)??eJ)?.toString)&&(l=o+"",a.push({start:t.length+i.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+i+(s===r.length?"":l)},""),o=s.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(i=l.exec(o));)a.push({start:i.index,length:i[0].length,error:`Value "${i[0]}" can't be safely passed as a path parameter`});if(a.sort((e,t)=>e.start-t.start),a.length>0){let e=0,t=a.reduce((t,r)=>{let i=" ".repeat(r.start-e),n="^".repeat(r.length);return e=r.start+r.length,t+i+n},"");throw new w(`Path parameters result in path with invalid segments:
${a.map(e=>e.error).join("\n")}
${s}
${t}`)}return s})(eW);class eH extends eq{list(e,t={},r){return this._client.getAPIList(eG`/chat/completions/${e}/messages`,eE,{query:t,...r})}}function eV(e){return void 0!==e&&"function"in e&&void 0!==e.function}function eK(e){return e?.$brand==="auto-parseable-response-format"}function eX(e){return e?.$brand==="auto-parseable-tool"}function eY(e,t){let r=e.choices.map(e=>{var r,i;if("length"===e.finish_reason)throw new j;if("content_filter"===e.finish_reason)throw new R;return e0(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>{var r,i;let n;return r=t,i=e,n=r.tools?.find(e=>eV(e)&&e.function?.name===i.function.name),{...i,function:{...i.function,parsed_arguments:eX(n)?n.$parseRaw(i.function.arguments):n?.function.strict?JSON.parse(i.function.arguments):null}}})??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(r=t,i=e.message.content,r.response_format?.type!=="json_schema"?null:r.response_format?.type==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(i):JSON.parse(i):null):null}}});return{...e,choices:r}}function eQ(e){return!!eK(e.response_format)||(e.tools?.some(e=>eX(e)||"function"===e.type&&!0===e.function.strict)??!1)}function e0(e){for(let t of e||[])if("function"!==t.type)throw new w(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let e1=e=>e?.role==="assistant",e4=e=>e?.role==="tool";class e2{constructor(){r_.add(this),this.controller=new AbortController,rv.set(this,void 0),rb.set(this,()=>{}),rw.set(this,()=>{}),r$.set(this,void 0),rx.set(this,()=>{}),rk.set(this,()=>{}),rI.set(this,{}),rO.set(this,!1),rS.set(this,!1),rE.set(this,!1),rT.set(this,!1),g(this,rv,new Promise((e,t)=>{g(this,rb,e,"f"),g(this,rw,t,"f")}),"f"),g(this,r$,new Promise((e,t)=>{g(this,rx,e,"f"),g(this,rk,t,"f")}),"f"),y(this,rv,"f").catch(()=>{}),y(this,r$,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},y(this,r_,"m",rA).bind(this))},0)}_connected(){this.ended||(y(this,rb,"f").call(this),this._emit("connect"))}get ended(){return y(this,rO,"f")}get errored(){return y(this,rS,"f")}get aborted(){return y(this,rE,"f")}abort(){this.controller.abort()}on(e,t){return(y(this,rI,"f")[e]||(y(this,rI,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=y(this,rI,"f")[e];if(!r)return this;let i=r.findIndex(e=>e.listener===t);return i>=0&&r.splice(i,1),this}once(e,t){return(y(this,rI,"f")[e]||(y(this,rI,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{g(this,rT,!0,"f"),"error"!==e&&this.once("error",r),this.once(e,t)})}async done(){g(this,rT,!0,"f"),await y(this,r$,"f")}_emit(e,...t){if(y(this,rO,"f"))return;"end"===e&&(g(this,rO,!0,"f"),y(this,rx,"f").call(this));let r=y(this,rI,"f")[e];if(r&&(y(this,rI,"f")[e]=r.filter(e=>!e.once),r.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];y(this,rT,"f")||r?.length||Promise.reject(e),y(this,rw,"f").call(this,e),y(this,rk,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];y(this,rT,"f")||r?.length||Promise.reject(e),y(this,rw,"f").call(this,e),y(this,rk,"f").call(this,e),this._emit("end")}}_emitFinal(){}}rv=new WeakMap,rb=new WeakMap,rw=new WeakMap,r$=new WeakMap,rx=new WeakMap,rk=new WeakMap,rI=new WeakMap,rO=new WeakMap,rS=new WeakMap,rE=new WeakMap,rT=new WeakMap,r_=new WeakSet,rA=function(e){if(g(this,rS,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new x),e instanceof x)return g(this,rE,!0,"f"),this._emit("abort",e);if(e instanceof w)return this._emit("error",e);if(e instanceof Error){let t=new w(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new w(String(e)))};class e6 extends e2{constructor(){super(...arguments),rN.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),e4(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(e1(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new w("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),y(this,rN,"m",rC).call(this)}async finalMessage(){return await this.done(),y(this,rN,"m",rP).call(this)}async finalFunctionToolCall(){return await this.done(),y(this,rN,"m",rj).call(this)}async finalFunctionToolCallResult(){return await this.done(),y(this,rN,"m",rR).call(this)}async totalUsage(){return await this.done(),y(this,rN,"m",rL).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=y(this,rN,"m",rP).call(this);t&&this._emit("finalMessage",t);let r=y(this,rN,"m",rC).call(this);r&&this._emit("finalContent",r);let i=y(this,rN,"m",rj).call(this);i&&this._emit("finalFunctionToolCall",i);let n=y(this,rN,"m",rR).call(this);null!=n&&this._emit("finalFunctionToolCallResult",n),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",y(this,rN,"m",rL).call(this))}async _createChatCompletion(e,t,r){let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),y(this,rN,"m",rU).call(this,t);let n=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(eY(n,t))}async _runChatCompletion(e,t,r){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,r)}async _runTools(e,t,r){let i="tool",{tool_choice:n="auto",stream:a,...s}=t,o="string"!=typeof n&&"function"===n.type&&n?.function?.name,{maxChatCompletions:l=10}=r||{},u=t.tools.map(e=>{if(eX(e)){if(!e.$callback)throw new w("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),c={};for(let e of u)"function"===e.type&&(c[e.function.name||e.function.function.name]=e.function);let d="tools"in t?u.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...s,tool_choice:n,tools:d,messages:[...this.messages]},r),a=t.choices[0]?.message;if(!a)throw new w("missing message in ChatCompletion response");if(!a.tool_calls?.length)break;for(let e of a.tool_calls){let t;if("function"!==e.type)continue;let r=e.id,{name:n,arguments:a}=e.function,s=c[n];if(s){if(o&&o!==n){let e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:i,tool_call_id:r,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(c).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:r,content:e});continue}try{t="function"==typeof s.parse?await s.parse(a):a}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:i,tool_call_id:r,content:e});continue}let l=await s.function(t,this),u=y(this,rN,"m",rz).call(this,l);if(this._addMessage({role:i,tool_call_id:r,content:u}),o)return}}}}rN=new WeakSet,rC=function(){return y(this,rN,"m",rP).call(this).content??null},rP=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(e1(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new w("stream ended without producing a ChatCompletionMessage with role=assistant")},rj=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(e1(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},rR=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(e4(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},rL=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},rU=function(e){if(null!=e.n&&e.n>1)throw new w("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},rz=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class e9 extends e6{static runTools(e,t,r){let i=new e9,n={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,n)),i}_addMessage(e,t=!0){super._addMessage(e,t),e1(e)&&e.content&&this._emit("content",e.content)}}let e5=511;class e3 extends Error{}class e8 extends Error{}let e7=e=>(function(e,t=e5){var r,i;let n,a,s,o,l,u,c,d,p,h;if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return r=e.trim(),i=t,n=r.length,a=0,s=e=>{throw new e3(`${e} at position ${a}`)},o=e=>{throw new e8(`${e} at position ${a}`)},l=()=>(h(),a>=n&&s("Unexpected end of input"),'"'===r[a])?u():"{"===r[a]?c():"["===r[a]?d():"null"===r.substring(a,a+4)||16&i&&n-a<4&&"null".startsWith(r.substring(a))?(a+=4,null):"true"===r.substring(a,a+4)||32&i&&n-a<4&&"true".startsWith(r.substring(a))?(a+=4,!0):"false"===r.substring(a,a+5)||32&i&&n-a<5&&"false".startsWith(r.substring(a))?(a+=5,!1):"Infinity"===r.substring(a,a+8)||128&i&&n-a<8&&"Infinity".startsWith(r.substring(a))?(a+=8,1/0):"-Infinity"===r.substring(a,a+9)||256&i&&1<n-a&&n-a<9&&"-Infinity".startsWith(r.substring(a))?(a+=9,-1/0):"NaN"===r.substring(a,a+3)||64&i&&n-a<3&&"NaN".startsWith(r.substring(a))?(a+=3,NaN):p(),u=()=>{let e=a,t=!1;for(a++;a<n&&('"'!==r[a]||t&&"\\"===r[a-1]);)t="\\"===r[a]&&!t,a++;if('"'==r.charAt(a))try{return JSON.parse(r.substring(e,++a-Number(t)))}catch(e){o(String(e))}else if(1&i)try{return JSON.parse(r.substring(e,a-Number(t))+'"')}catch(t){return JSON.parse(r.substring(e,r.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},c=()=>{a++,h();let e={};try{for(;"}"!==r[a];){if(h(),a>=n&&8&i)return e;let t=u();h(),a++;try{let r=l();Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}catch(t){if(8&i)return e;throw t}h(),","===r[a]&&a++}}catch(t){if(8&i)return e;s("Expected '}' at end of object")}return a++,e},d=()=>{a++;let e=[];try{for(;"]"!==r[a];)e.push(l()),h(),","===r[a]&&a++}catch(t){if(4&i)return e;s("Expected ']' at end of array")}return a++,e},p=()=>{if(0===a){"-"===r&&2&i&&s("Not sure what '-' is");try{return JSON.parse(r)}catch(e){if(2&i)try{if("."===r[r.length-1])return JSON.parse(r.substring(0,r.lastIndexOf(".")));return JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch(e){}o(String(e))}}let e=a;for("-"===r[a]&&a++;r[a]&&!",]}".includes(r[a]);)a++;a!=n||2&i||s("Unterminated number literal");try{return JSON.parse(r.substring(e,a))}catch(t){"-"===r.substring(e,a)&&2&i&&s("Not sure what '-' is");try{return JSON.parse(r.substring(e,r.lastIndexOf("e")))}catch(e){o(String(e))}}},h=()=>{for(;a<n&&" \n\r	".includes(r[a]);)a++},l()})(e,2^e5);class te extends e6{constructor(e){super(),rM.add(this),rD.set(this,void 0),rZ.set(this,void 0),rF.set(this,void 0),g(this,rD,e,"f"),g(this,rZ,[],"f")}get currentChatCompletionSnapshot(){return y(this,rF,"f")}static fromReadableStream(e){let t=new te(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let i=new te(t);return i._run(()=>i._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,t,r){super._createChatCompletion;let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),y(this,rM,"m",rB).call(this);let n=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});for await(let e of(this._connected(),n))y(this,rM,"m",rW).call(this,e);if(n.controller.signal?.aborted)throw new x;return this._addChatCompletion(y(this,rM,"m",rH).call(this))}async _fromReadableStream(e,t){let r,i=t?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),y(this,rM,"m",rB).call(this),this._connected();let n=e_.fromReadableStream(e,this.controller);for await(let e of n)r&&r!==e.id&&this._addChatCompletion(y(this,rM,"m",rH).call(this)),y(this,rM,"m",rW).call(this,e),r=e.id;if(n.controller.signal?.aborted)throw new x;return this._addChatCompletion(y(this,rM,"m",rH).call(this))}[(rD=new WeakMap,rZ=new WeakMap,rF=new WeakMap,rM=new WeakSet,rB=function(){this.ended||g(this,rF,void 0,"f")},rq=function(e){let t=y(this,rZ,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},y(this,rZ,"f")[e.index]=t),t},rW=function(e){if(this.ended)return;let t=y(this,rM,"m",rK).call(this,e);for(let r of(this._emit("chunk",e,t),e.choices)){let e=t.choices[r.index];null!=r.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",r.delta.content,e.message.content),this._emit("content.delta",{delta:r.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=r.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:r.delta.refusal,snapshot:e.message.refusal}),r.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:r.logprobs?.content,snapshot:e.logprobs?.content??[]}),r.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:r.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let i=y(this,rM,"m",rq).call(this,e);for(let t of(e.finish_reason&&(y(this,rM,"m",rG).call(this,e),null!=i.current_tool_call_index&&y(this,rM,"m",rJ).call(this,e,i.current_tool_call_index)),r.delta.tool_calls??[]))i.current_tool_call_index!==t.index&&(y(this,rM,"m",rG).call(this,e),null!=i.current_tool_call_index&&y(this,rM,"m",rJ).call(this,e,i.current_tool_call_index)),i.current_tool_call_index=t.index;for(let t of r.delta.tool_calls??[]){let r=e.message.tool_calls?.[t.index];r?.type&&(r?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:r.function?.name,index:t.index,arguments:r.function.arguments,parsed_arguments:r.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):ti(r?.type))}}},rJ=function(e,t){if(y(this,rM,"m",rq).call(this,e).done_tool_calls.has(t))return;let r=e.message.tool_calls?.[t];if(!r)throw Error("no tool call snapshot");if(!r.type)throw Error("tool call snapshot missing `type`");if("function"===r.type){let e=y(this,rD,"f")?.tools?.find(e=>eV(e)&&e.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:t,arguments:r.function.arguments,parsed_arguments:eX(e)?e.$parseRaw(r.function.arguments):e?.function.strict?JSON.parse(r.function.arguments):null})}else ti(r.type)},rG=function(e){let t=y(this,rM,"m",rq).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let r=y(this,rM,"m",rV).call(this);this._emit("content.done",{content:e.message.content,parsed:r?r.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},rH=function(){if(this.ended)throw new w("stream has ended, this shouldn't happen");let e=y(this,rF,"f");if(!e)throw new w("request ended without sending any chunks");return g(this,rF,void 0,"f"),g(this,rZ,[],"f"),function(e,t){var r;let{id:i,choices:n,created:a,model:s,system_fingerprint:o,...l}=e;return r={...l,id:i,choices:n.map(({message:t,finish_reason:r,index:i,logprobs:n,...a})=>{if(!r)throw new w(`missing finish_reason for choice ${i}`);let{content:s=null,function_call:o,tool_calls:l,...u}=t,c=t.role;if(!c)throw new w(`missing role for choice ${i}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new w(`missing function_call.arguments for choice ${i}`);if(!l)throw new w(`missing function_call.name for choice ${i}`);return{...a,message:{content:s,function_call:{arguments:e,name:l},role:c,refusal:t.refusal??null},finish_reason:r,index:i,logprobs:n}}return l?{...a,index:i,finish_reason:r,logprobs:n,message:{...u,role:c,content:s,refusal:t.refusal??null,tool_calls:l.map((t,r)=>{let{function:n,type:a,id:s,...o}=t,{arguments:l,name:u,...c}=n||{};if(null==s)throw new w(`missing choices[${i}].tool_calls[${r}].id
${tt(e)}`);if(null==a)throw new w(`missing choices[${i}].tool_calls[${r}].type
${tt(e)}`);if(null==u)throw new w(`missing choices[${i}].tool_calls[${r}].function.name
${tt(e)}`);if(null==l)throw new w(`missing choices[${i}].tool_calls[${r}].function.arguments
${tt(e)}`);return{...o,id:s,type:a,function:{...c,name:u,arguments:l}}})}}:{...a,message:{...u,content:s,role:c,refusal:t.refusal??null},finish_reason:r,index:i,logprobs:n}}),created:a,model:s,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&eQ(t)?eY(r,t):{...r,choices:r.choices.map(e=>(e0(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,y(this,rD,"f"))},rV=function(){let e=y(this,rD,"f")?.response_format;return eK(e)?e:null},rK=function(e){var t,r,i,n;let a=y(this,rF,"f"),{choices:s,...o}=e;for(let{delta:s,finish_reason:l,index:u,logprobs:c=null,...d}of(a?Object.assign(a,o):a=g(this,rF,{...o,choices:[]},"f"),e.choices)){let e=a.choices[u];if(e||(e=a.choices[u]={finish_reason:l,index:u,message:{},logprobs:c,...d}),c)if(e.logprobs){let{content:i,refusal:n,...a}=c;tr(a),Object.assign(e.logprobs,a),i&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...i)),n&&((r=e.logprobs).refusal??(r.refusal=[]),e.logprobs.refusal.push(...n))}else e.logprobs=Object.assign({},c);if(l&&(e.finish_reason=l,y(this,rD,"f")&&eQ(y(this,rD,"f")))){if("length"===l)throw new j;if("content_filter"===l)throw new R}if(Object.assign(e,d),!s)continue;let{content:o,refusal:p,function_call:h,role:m,tool_calls:f,...g}=s;if(tr(g),Object.assign(e.message,g),p&&(e.message.refusal=(e.message.refusal||"")+p),m&&(e.message.role=m),h&&(e.message.function_call?(h.name&&(e.message.function_call.name=h.name),h.arguments&&((i=e.message.function_call).arguments??(i.arguments=""),e.message.function_call.arguments+=h.arguments)):e.message.function_call=h),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&y(this,rM,"m",rV).call(this)&&(e.message.parsed=e7(e.message.content))),f)for(let{index:t,id:r,type:i,function:a,...s}of(e.message.tool_calls||(e.message.tool_calls=[]),f)){let o=(n=e.message.tool_calls)[t]??(n[t]={});Object.assign(o,s),r&&(o.id=r),i&&(o.type=i),a&&(o.function??(o.function={name:a.name??"",arguments:""})),a?.name&&(o.function.name=a.name),a?.arguments&&(o.function.arguments+=a.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let r=e.tools?.find(e=>eV(e)&&e.function?.name===t.function.name);return eV(r)&&(eX(r)||r?.function.strict||!1)}(y(this,rD,"f"),o)&&(o.function.parsed_arguments=e7(o.function.arguments)))}}return a},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",r=>{let i=t.shift();i?i.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let i of(r=!0,t))i.reject(e);t.length=0}),this.on("error",e=>{for(let i of(r=!0,t))i.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new e_(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function tt(e){return JSON.stringify(e)}function tr(e){}function ti(e){}class tn extends te{static fromReadableStream(e){let t=new tn(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,r){let i=new tn(t),n={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,n)),i}}class ta extends eq{constructor(){super(...arguments),this.messages=new eH(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(eG`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(eG`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/chat/completions",eE,{query:e,...t})}delete(e,t){return this._client.delete(eG`/chat/completions/${e}`,t)}parse(e,t){for(let t of e.tools??[]){if("function"!==t.type)throw new w(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new w(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>eY(t,e))}runTools(e,t){return e.stream?tn.runTools(this._client,e,t):e9.runTools(this._client,e,t)}stream(e,t){return te.createChatCompletion(this._client,e,t)}}ta.Messages=eH;class ts extends eq{constructor(){super(...arguments),this.completions=new ta(this._client)}}ts.Completions=ta,e.s([],46285);let to=Symbol("brand.privateNullableHeaders"),tl=e=>{let t=new Headers,r=new Set;for(let i of e){let e=new Set;for(let[n,a]of function*(e){let t;if(!e)return;if(to in e){let{values:t,nulls:r}=e;for(let e of(yield*t.entries(),r))yield[e,null];return}let r=!1;for(let i of(e instanceof Headers?t=e.entries():M(e)?t=e:(r=!0,t=Object.entries(e??{})),t)){let e=i[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=M(i[1])?i[1]:[i[1]],n=!1;for(let i of t)void 0!==i&&(r&&!n&&(n=!0,yield[e,null]),yield[e,i])}}(i)){let i=n.toLowerCase();e.has(i)||(t.delete(n),e.add(i)),null===a?(t.delete(n),r.add(i)):(t.append(n,a),r.delete(i))}}return{[to]:!0,values:t,nulls:r}};class tu extends eq{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:tl([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class tc extends eq{create(e,t){return this._client.post("/audio/transcriptions",eR({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class td extends eq{create(e,t){return this._client.post("/audio/translations",eR({body:e,...t,__metadata:{model:e.model}},this._client))}}class tp extends eq{constructor(){super(...arguments),this.transcriptions=new tc(this._client),this.translations=new td(this._client),this.speech=new tu(this._client)}}tp.Transcriptions=tc,tp.Translations=td,tp.Speech=tu;class th extends eq{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(eG`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",eE,{query:e,...t})}cancel(e,t){return this._client.post(eG`/batches/${e}/cancel`,t)}}class tm extends eq{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:tl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(eG`/assistants/${e}`,{...t,headers:tl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(eG`/assistants/${e}`,{body:t,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",eE,{query:e,...t,headers:tl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(eG`/assistants/${e}`,{...t,headers:tl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class tf extends eq{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:tl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class tg extends eq{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:tl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class ty extends eq{constructor(){super(...arguments),this.sessions=new tf(this._client),this.transcriptionSessions=new tg(this._client)}}ty.Sessions=tf,ty.TranscriptionSessions=tg;class t_ extends eq{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:tl([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(eG`/chatkit/sessions/${e}/cancel`,{...t,headers:tl([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}class tv extends eq{retrieve(e,t){return this._client.get(eG`/chatkit/threads/${e}`,{...t,headers:tl([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",eT,{query:e,...t,headers:tl([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(eG`/chatkit/threads/${e}`,{...t,headers:tl([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},r){return this._client.getAPIList(eG`/chatkit/threads/${e}/items`,eT,{query:t,...r,headers:tl([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}}class tb extends eq{constructor(){super(...arguments),this.sessions=new t_(this._client),this.threads=new tv(this._client)}}tb.Sessions=t_,tb.Threads=tv;class tw extends eq{create(e,t,r){return this._client.post(eG`/threads/${e}/messages`,{body:t,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{thread_id:i}=t;return this._client.get(eG`/threads/${i}/messages/${e}`,{...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:i,...n}=t;return this._client.post(eG`/threads/${i}/messages/${e}`,{body:n,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(eG`/threads/${e}/messages`,eE,{query:t,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{thread_id:i}=t;return this._client.delete(eG`/threads/${i}/messages/${e}`,{...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}class t$ extends eq{retrieve(e,t,r){let{thread_id:i,run_id:n,...a}=t;return this._client.get(eG`/threads/${i}/runs/${n}/steps/${e}`,{query:a,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t,r){let{thread_id:i,...n}=t;return this._client.getAPIList(eG`/threads/${i}/runs/${e}/steps`,eE,{query:n,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}let tx=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class tk extends e2{constructor(){super(...arguments),rX.add(this),rQ.set(this,[]),r0.set(this,{}),r1.set(this,{}),r4.set(this,void 0),r2.set(this,void 0),r6.set(this,void 0),r9.set(this,void 0),r5.set(this,void 0),r3.set(this,void 0),r8.set(this,void 0),r7.set(this,void 0),ie.set(this,void 0)}[(rQ=new WeakMap,r0=new WeakMap,r1=new WeakMap,r4=new WeakMap,r2=new WeakMap,r6=new WeakMap,r9=new WeakMap,r5=new WeakMap,r3=new WeakMap,r8=new WeakMap,r7=new WeakMap,ie=new WeakMap,rX=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let i=t.shift();i?i.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let i of(r=!0,t))i.reject(e);t.length=0}),this.on("error",e=>{for(let i of(r=!0,t))i.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new rY;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let i=e_.fromReadableStream(e,this.controller);for await(let e of i)y(this,rX,"m",it).call(this,e);if(i.controller.signal?.aborted)throw new x;return this._addRun(y(this,rX,"m",ir).call(this))}toReadableStream(){return new e_(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,i){let n=new rY;return n._run(()=>n._runToolAssistantStream(e,t,r,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createToolAssistantStream(e,t,r,i){let n=i?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let a={...r,stream:!0},s=await e.submitToolOutputs(t,a,{...i,signal:this.controller.signal});for await(let e of(this._connected(),s))y(this,rX,"m",it).call(this,e);if(s.controller.signal?.aborted)throw new x;return this._addRun(y(this,rX,"m",ir).call(this))}static createThreadAssistantStream(e,t,r){let i=new rY;return i._run(()=>i._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,t,r,i){let n=new rY;return n._run(()=>n._runAssistantStream(e,t,r,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),n}currentEvent(){return y(this,r8,"f")}currentRun(){return y(this,r7,"f")}currentMessageSnapshot(){return y(this,r4,"f")}currentRunStepSnapshot(){return y(this,ie,"f")}async finalRunSteps(){return await this.done(),Object.values(y(this,r0,"f"))}async finalMessages(){return await this.done(),Object.values(y(this,r1,"f"))}async finalRun(){if(await this.done(),!y(this,r2,"f"))throw Error("Final run was not received.");return y(this,r2,"f")}async _createThreadAssistantStream(e,t,r){let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let n={...t,stream:!0},a=await e.createAndRun(n,{...r,signal:this.controller.signal});for await(let e of(this._connected(),a))y(this,rX,"m",it).call(this,e);if(a.controller.signal?.aborted)throw new x;return this._addRun(y(this,rX,"m",ir).call(this))}async _createAssistantStream(e,t,r,i){let n=i?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let a={...r,stream:!0},s=await e.create(t,a,{...i,signal:this.controller.signal});for await(let e of(this._connected(),s))y(this,rX,"m",it).call(this,e);if(s.controller.signal?.aborted)throw new x;return this._addRun(y(this,rX,"m",ir).call(this))}static accumulateDelta(e,t){for(let[r,i]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=i;continue}let t=e[r];if(null==t||"index"===r||"type"===r){e[r]=i;continue}if("string"==typeof t&&"string"==typeof i)t+=i;else if("number"==typeof t&&"number"==typeof i)t+=i;else if(Z(t)&&Z(i))t=this.accumulateDelta(t,i);else if(Array.isArray(t)&&Array.isArray(i)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...i);continue}for(let e of i){if(!Z(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let r=e.index;if(null==r)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof r)throw Error(`Expected array delta entry \`index\` property to be a number but got ${r}`);let i=t[r];null==i?t.push(e):t[r]=this.accumulateDelta(i,e)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${i}, accValue: ${t}`);e[r]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,i){return await this._createAssistantStream(t,e,r,i)}async _runToolAssistantStream(e,t,r,i){return await this._createToolAssistantStream(t,e,r,i)}}rY=tk,it=function(e){if(!this.ended)switch(g(this,r8,e,"f"),y(this,rX,"m",is).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":y(this,rX,"m",ic).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":y(this,rX,"m",ia).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":y(this,rX,"m",ii).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},ir=function(){if(this.ended)throw new w("stream has ended, this shouldn't happen");if(!y(this,r2,"f"))throw Error("Final run has not been received");return y(this,r2,"f")},ii=function(e){let[t,r]=y(this,rX,"m",il).call(this,e,y(this,r4,"f"));for(let e of(g(this,r4,t,"f"),y(this,r1,"f")[t.id]=t,r)){let r=t.content[e.index];r?.type=="text"&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let r of e.data.delta.content){if("text"==r.type&&r.text){let e=r.text,i=t.content[r.index];if(i&&"text"==i.type)this._emit("textDelta",e,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=y(this,r6,"f")){if(y(this,r9,"f"))switch(y(this,r9,"f").type){case"text":this._emit("textDone",y(this,r9,"f").text,y(this,r4,"f"));break;case"image_file":this._emit("imageFileDone",y(this,r9,"f").image_file,y(this,r4,"f"))}g(this,r6,r.index,"f")}g(this,r9,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==y(this,r6,"f")){let t=e.data.content[y(this,r6,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,y(this,r4,"f"));break;case"text":this._emit("textDone",t.text,y(this,r4,"f"))}}y(this,r4,"f")&&this._emit("messageDone",e.data),g(this,r4,void 0,"f")}},ia=function(e){let t=y(this,rX,"m",io).call(this,e);switch(g(this,ie,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&"tool_calls"==r.step_details.type&&r.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of r.step_details.tool_calls)e.index==y(this,r5,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(y(this,r3,"f")&&this._emit("toolCallDone",y(this,r3,"f")),g(this,r5,e.index,"f"),g(this,r3,t.step_details.tool_calls[e.index],"f"),y(this,r3,"f")&&this._emit("toolCallCreated",y(this,r3,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":g(this,ie,void 0,"f"),"tool_calls"==e.data.step_details.type&&y(this,r3,"f")&&(this._emit("toolCallDone",y(this,r3,"f")),g(this,r3,void 0,"f")),this._emit("runStepDone",e.data,t)}},is=function(e){y(this,rQ,"f").push(e),this._emit("event",e)},io=function(e){switch(e.event){case"thread.run.step.created":return y(this,r0,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=y(this,r0,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let i=rY.accumulateDelta(t,r.delta);y(this,r0,"f")[e.data.id]=i}return y(this,r0,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":y(this,r0,"f")[e.data.id]=e.data}if(y(this,r0,"f")[e.data.id])return y(this,r0,"f")[e.data.id];throw Error("No snapshot available")},il=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(let e of i.delta.content)if(e.index in t.content){let r=t.content[e.index];t.content[e.index]=y(this,rX,"m",iu).call(this,e,r)}else t.content[e.index]=e,r.push(e);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},iu=function(e,t){return rY.accumulateDelta(t,e)},ic=function(e){switch(g(this,r7,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":g(this,r2,e.data,"f"),y(this,r3,"f")&&(this._emit("toolCallDone",y(this,r3,"f")),g(this,r3,void 0,"f"))}};class tI extends eq{constructor(){super(...arguments),this.steps=new t$(this._client)}create(e,t,r){let{include:i,...n}=t;return this._client.post(eG`/threads/${e}/runs`,{query:{include:i},body:n,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}retrieve(e,t,r){let{thread_id:i}=t;return this._client.get(eG`/threads/${i}/runs/${e}`,{...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:i,...n}=t;return this._client.post(eG`/threads/${i}/runs/${e}`,{body:n,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(eG`/threads/${e}/runs`,eE,{query:t,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{thread_id:i}=t;return this._client.post(eG`/threads/${i}/runs/${e}/cancel`,{...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let i=await this.create(e,t,r);return await this.poll(i.id,{thread_id:e},r)}createAndStream(e,t,r){return tk.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let i=tl([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:n,response:a}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...i}}).withResponse();switch(n.status){case"queued":case"in_progress":case"cancelling":let s=5e3;if(r?.pollIntervalMs)s=r.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(s=t)}}await F(s);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return n}}}stream(e,t,r){return tk.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r){let{thread_id:i,...n}=t;return this._client.post(eG`/threads/${i}/runs/${e}/submit_tool_outputs`,{body:n,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,r){let i=await this.submitToolOutputs(e,t,r);return await this.poll(i.id,t,r)}submitToolOutputsStream(e,t,r){return tk.createToolAssistantStream(e,this._client.beta.threads.runs,t,r)}}tI.Steps=t$;class tO extends eq{constructor(){super(...arguments),this.runs=new tI(this._client),this.messages=new tw(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:tl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(eG`/threads/${e}`,{...t,headers:tl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(eG`/threads/${e}`,{body:t,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t){return this._client.delete(eG`/threads/${e}`,{...t,headers:tl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:tl([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.id,{thread_id:r.thread_id},t)}createAndRunStream(e,t){return tk.createThreadAssistantStream(e,this._client.beta.threads,t)}}tO.Runs=tI,tO.Messages=tw;class tS extends eq{constructor(){super(...arguments),this.realtime=new ty(this._client),this.chatkit=new tb(this._client),this.assistants=new tm(this._client),this.threads=new tO(this._client)}}tS.Realtime=ty,tS.ChatKit=tb,tS.Assistants=tm,tS.Threads=tO;class tE extends eq{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class tT extends eq{retrieve(e,t,r){let{container_id:i}=t;return this._client.get(eG`/containers/${i}/files/${e}/content`,{...r,headers:tl([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}}class tA extends eq{constructor(){super(...arguments),this.content=new tT(this._client)}create(e,t,r){return this._client.post(eG`/containers/${e}/files`,eR({body:t,...r},this._client))}retrieve(e,t,r){let{container_id:i}=t;return this._client.get(eG`/containers/${i}/files/${e}`,r)}list(e,t={},r){return this._client.getAPIList(eG`/containers/${e}/files`,eE,{query:t,...r})}delete(e,t,r){let{container_id:i}=t;return this._client.delete(eG`/containers/${i}/files/${e}`,{...r,headers:tl([{Accept:"*/*"},r?.headers])})}}tA.Content=tT;class tN extends eq{constructor(){super(...arguments),this.files=new tA(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(eG`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",eE,{query:e,...t})}delete(e,t){return this._client.delete(eG`/containers/${e}`,{...t,headers:tl([{Accept:"*/*"},t?.headers])})}}tN.Files=tA;class tC extends eq{create(e,t,r){let{include:i,...n}=t;return this._client.post(eG`/conversations/${e}/items`,{query:{include:i},body:n,...r})}retrieve(e,t,r){let{conversation_id:i,...n}=t;return this._client.get(eG`/conversations/${i}/items/${e}`,{query:n,...r})}list(e,t={},r){return this._client.getAPIList(eG`/conversations/${e}/items`,eT,{query:t,...r})}delete(e,t,r){let{conversation_id:i}=t;return this._client.delete(eG`/conversations/${i}/items/${e}`,r)}}class tP extends eq{constructor(){super(...arguments),this.items=new tC(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(eG`/conversations/${e}`,t)}update(e,t,r){return this._client.post(eG`/conversations/${e}`,{body:t,...r})}delete(e,t){return this._client.delete(eG`/conversations/${e}`,t)}}tP.Items=tC;class tj extends eq{create(e,t){let r=!!e.encoding_format,i=r?e.encoding_format:"base64";r&&eg(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let n=this._client.post("/embeddings",{body:{...e,encoding_format:i},...t});return r?n:(eg(this._client).debug("embeddings/decoding base64 embeddings from base64"),n._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),r=t.length,i=new Uint8Array(r);for(let e=0;e<r;e++)i[e]=t.charCodeAt(e);return Array.from(new Float32Array(i.buffer))}})(t)}),e)))}}class tR extends eq{retrieve(e,t,r){let{eval_id:i,run_id:n}=t;return this._client.get(eG`/evals/${i}/runs/${n}/output_items/${e}`,r)}list(e,t,r){let{eval_id:i,...n}=t;return this._client.getAPIList(eG`/evals/${i}/runs/${e}/output_items`,eE,{query:n,...r})}}class tL extends eq{constructor(){super(...arguments),this.outputItems=new tR(this._client)}create(e,t,r){return this._client.post(eG`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){let{eval_id:i}=t;return this._client.get(eG`/evals/${i}/runs/${e}`,r)}list(e,t={},r){return this._client.getAPIList(eG`/evals/${e}/runs`,eE,{query:t,...r})}delete(e,t,r){let{eval_id:i}=t;return this._client.delete(eG`/evals/${i}/runs/${e}`,r)}cancel(e,t,r){let{eval_id:i}=t;return this._client.post(eG`/evals/${i}/runs/${e}`,r)}}tL.OutputItems=tR;class tU extends eq{constructor(){super(...arguments),this.runs=new tL(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(eG`/evals/${e}`,t)}update(e,t,r){return this._client.post(eG`/evals/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/evals",eE,{query:e,...t})}delete(e,t){return this._client.delete(eG`/evals/${e}`,t)}}tU.Runs=tL;class tz extends eq{create(e,t){return this._client.post("/files",eR({body:e,...t},this._client))}retrieve(e,t){return this._client.get(eG`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",eE,{query:e,...t})}delete(e,t){return this._client.delete(eG`/files/${e}`,t)}content(e,t){return this._client.get(eG`/files/${e}/content`,{...t,headers:tl([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=18e5}={}){let i=new Set(["processed","error","deleted"]),n=Date.now(),a=await this.retrieve(e);for(;!a.status||!i.has(a.status);)if(await F(t),a=await this.retrieve(e),Date.now()-n>r)throw new I({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class tM extends eq{}class tD extends eq{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class tZ extends eq{constructor(){super(...arguments),this.graders=new tD(this._client)}}tZ.Graders=tD;class tF extends eq{create(e,t,r){return this._client.getAPIList(eG`/fine_tuning/checkpoints/${e}/permissions`,eS,{body:t,method:"post",...r})}retrieve(e,t={},r){return this._client.get(eG`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}delete(e,t,r){let{fine_tuned_model_checkpoint:i}=t;return this._client.delete(eG`/fine_tuning/checkpoints/${i}/permissions/${e}`,r)}}class tB extends eq{constructor(){super(...arguments),this.permissions=new tF(this._client)}}tB.Permissions=tF;class tq extends eq{list(e,t={},r){return this._client.getAPIList(eG`/fine_tuning/jobs/${e}/checkpoints`,eE,{query:t,...r})}}class tW extends eq{constructor(){super(...arguments),this.checkpoints=new tq(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(eG`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",eE,{query:e,...t})}cancel(e,t){return this._client.post(eG`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return this._client.getAPIList(eG`/fine_tuning/jobs/${e}/events`,eE,{query:t,...r})}pause(e,t){return this._client.post(eG`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(eG`/fine_tuning/jobs/${e}/resume`,t)}}tW.Checkpoints=tq;class tJ extends eq{constructor(){super(...arguments),this.methods=new tM(this._client),this.jobs=new tW(this._client),this.checkpoints=new tB(this._client),this.alpha=new tZ(this._client)}}tJ.Methods=tM,tJ.Jobs=tW,tJ.Checkpoints=tB,tJ.Alpha=tZ;class tG extends eq{}class tH extends eq{constructor(){super(...arguments),this.graderModels=new tG(this._client)}}tH.GraderModels=tG;class tV extends eq{createVariation(e,t){return this._client.post("/images/variations",eR({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",eR({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class tK extends eq{retrieve(e,t){return this._client.get(eG`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",eS,e)}delete(e,t){return this._client.delete(eG`/models/${e}`,t)}}class tX extends eq{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class tY extends eq{accept(e,t,r){return this._client.post(eG`/realtime/calls/${e}/accept`,{body:t,...r,headers:tl([{Accept:"*/*"},r?.headers])})}hangup(e,t){return this._client.post(eG`/realtime/calls/${e}/hangup`,{...t,headers:tl([{Accept:"*/*"},t?.headers])})}refer(e,t,r){return this._client.post(eG`/realtime/calls/${e}/refer`,{body:t,...r,headers:tl([{Accept:"*/*"},r?.headers])})}reject(e,t={},r){return this._client.post(eG`/realtime/calls/${e}/reject`,{body:t,...r,headers:tl([{Accept:"*/*"},r?.headers])})}}class tQ extends eq{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class t0 extends eq{constructor(){super(...arguments),this.clientSecrets=new tQ(this._client),this.calls=new tY(this._client)}}function t1(e,t){let r=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var r,i;let n=(r=e.tools??[],i=t.name,r.find(e=>"function"===e.type&&e.name===i));return{...t,...t,parsed_arguments:n?.$brand==="auto-parseable-tool"?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let r=e.content.map(e=>{var r,i;return"output_text"===e.type?{...e,parsed:(r=t,i=e.text,r.text?.format?.type!=="json_schema"?null:"$parseRaw"in r.text?.format?(r.text?.format).$parseRaw(i):JSON.parse(i))}:e});return{...e,content:r}}return e}),i=Object.assign({},e,{output:r});return Object.getOwnPropertyDescriptor(e,"output_text")||t4(i),Object.defineProperty(i,"output_parsed",{enumerable:!0,get(){for(let e of i.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),i}function t4(e){let t=[];for(let r of e.output)if("message"===r.type)for(let e of r.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}t0.ClientSecrets=tQ,t0.Calls=tY;class t2 extends e2{constructor(e){super(),id.add(this),ip.set(this,void 0),ih.set(this,void 0),im.set(this,void 0),g(this,ip,e,"f")}static createResponse(e,t,r){let i=new t2(t);return i._run(()=>i._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,t,r){let i,n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),y(this,id,"m",ig).call(this);let a=null;for await(let n of("response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected(),i))y(this,id,"m",iy).call(this,n,a);if(i.controller.signal?.aborted)throw new x;return y(this,id,"m",i_).call(this)}[(ip=new WeakMap,ih=new WeakMap,im=new WeakMap,id=new WeakSet,ig=function(){this.ended||g(this,ih,void 0,"f")},iy=function(e,t){if(this.ended)return;let r=(e,r)=>{(null==t||r.sequence_number>t)&&this._emit(e,r)},i=y(this,id,"m",iv).call(this,e);switch(r("event",e),e.type){case"response.output_text.delta":{let t=i.output[e.output_index];if(!t)throw new w(`missing output at index ${e.output_index}`);if("message"===t.type){let i=t.content[e.content_index];if(!i)throw new w(`missing content at index ${e.content_index}`);if("output_text"!==i.type)throw new w(`expected content to be 'output_text', got ${i.type}`);r("response.output_text.delta",{...e,snapshot:i.text})}break}case"response.function_call_arguments.delta":{let t=i.output[e.output_index];if(!t)throw new w(`missing output at index ${e.output_index}`);"function_call"===t.type&&r("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:r(e.type,e)}},i_=function(){if(this.ended)throw new w("stream has ended, this shouldn't happen");let e=y(this,ih,"f");if(!e)throw new w("request ended without sending any events");g(this,ih,void 0,"f");let t=function(e,t){var r;return t&&(r=t,eK(r.text?.format))?t1(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,y(this,ip,"f"));return g(this,im,t,"f"),t},iv=function(e){let t=y(this,ih,"f");if(!t){if("response.created"!==e.type)throw new w(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return g(this,ih,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let r=t.output[e.output_index];if(!r)throw new w(`missing output at index ${e.output_index}`);let i=r.type,n=e.part;"message"===i&&"reasoning_text"!==n.type?r.content.push(n):"reasoning"===i&&"reasoning_text"===n.type&&(r.content||(r.content=[]),r.content.push(n));break}case"response.output_text.delta":{let r=t.output[e.output_index];if(!r)throw new w(`missing output at index ${e.output_index}`);if("message"===r.type){let t=r.content[e.content_index];if(!t)throw new w(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new w(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let r=t.output[e.output_index];if(!r)throw new w(`missing output at index ${e.output_index}`);"function_call"===r.type&&(r.arguments+=e.delta);break}case"response.reasoning_text.delta":{let r=t.output[e.output_index];if(!r)throw new w(`missing output at index ${e.output_index}`);if("reasoning"===r.type){let t=r.content?.[e.content_index];if(!t)throw new w(`missing content at index ${e.content_index}`);if("reasoning_text"!==t.type)throw new w(`expected content to be 'reasoning_text', got ${t.type}`);t.text+=e.delta}break}case"response.completed":g(this,ih,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let i=t.shift();i?i.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let i of(r=!0,t))i.reject(e);t.length=0}),this.on("error",e=>{for(let i of(r=!0,t))i.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=y(this,im,"f");if(!e)throw new w("stream ended without producing a ChatCompletion");return e}}class t6 extends eq{list(e,t={},r){return this._client.getAPIList(eG`/responses/${e}/input_items`,eE,{query:t,...r})}}class t9 extends eq{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class t5 extends eq{constructor(){super(...arguments),this.inputItems=new t6(this._client),this.inputTokens=new t9(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&t4(e),e))}retrieve(e,t={},r){return this._client.get(eG`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&t4(e),e))}delete(e,t){return this._client.delete(eG`/responses/${e}`,{...t,headers:tl([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>t1(t,e))}stream(e,t){return t2.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(eG`/responses/${e}/cancel`,t)}compact(e={},t){return this._client.post("/responses/compact",{body:e,...t})}}t5.InputItems=t6,t5.InputTokens=t9;class t3 extends eq{create(e,t,r){return this._client.post(eG`/uploads/${e}/parts`,eR({body:t,...r},this._client))}}class t8 extends eq{constructor(){super(...arguments),this.parts=new t3(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(eG`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(eG`/uploads/${e}/complete`,{body:t,...r})}}t8.Parts=t3;let t7=async e=>{let t=await Promise.allSettled(e),r=t.filter(e=>"rejected"===e.status);if(r.length){for(let e of r)console.error(e.reason);throw Error(`${r.length} promise(s) failed - see the above errors`)}let i=[];for(let e of t)"fulfilled"===e.status&&i.push(e.value);return i};class re extends eq{create(e,t,r){return this._client.post(eG`/vector_stores/${e}/file_batches`,{body:t,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:i}=t;return this._client.get(eG`/vector_stores/${i}/file_batches/${e}`,{...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{vector_store_id:i}=t;return this._client.post(eG`/vector_stores/${i}/file_batches/${e}/cancel`,{...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let i=await this.create(e,t);return await this.poll(e,i.id,r)}listFiles(e,t,r){let{vector_store_id:i,...n}=t;return this._client.getAPIList(eG`/vector_stores/${i}/file_batches/${e}/files`,eE,{query:n,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async poll(e,t,r){let i=tl([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:n,response:a}=await this.retrieve(t,{vector_store_id:e},{...r,headers:i}).withResponse();switch(n.status){case"in_progress":let s=5e3;if(r?.pollIntervalMs)s=r.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(s=t)}}await F(s);break;case"failed":case"cancelled":case"completed":return n}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},i){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let n=Math.min(i?.maxConcurrency??5,t.length),a=this._client,s=t.values(),o=[...r];async function l(e){for(let t of e){let e=await a.files.create({file:t,purpose:"assistants"},i);o.push(e.id)}}let u=Array(n).fill(s).map(l);return await t7(u),await this.createAndPoll(e,{file_ids:o})}}class rt extends eq{create(e,t,r){return this._client.post(eG`/vector_stores/${e}/files`,{body:t,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:i}=t;return this._client.get(eG`/vector_stores/${i}/files/${e}`,{...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{vector_store_id:i,...n}=t;return this._client.post(eG`/vector_stores/${i}/files/${e}`,{body:n,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(eG`/vector_stores/${e}/files`,eE,{query:t,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{vector_store_id:i}=t;return this._client.delete(eG`/vector_stores/${i}/files/${e}`,{...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let i=await this.create(e,t,r);return await this.poll(e,i.id,r)}async poll(e,t,r){let i=tl([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let n=await this.retrieve(t,{vector_store_id:e},{...r,headers:i}).withResponse(),a=n.data;switch(a.status){case"in_progress":let s=5e3;if(r?.pollIntervalMs)s=r.pollIntervalMs;else{let e=n.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(s=t)}}await F(s);break;case"failed":case"completed":return a}}}async upload(e,t,r){let i=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:i.id},r)}async uploadAndPoll(e,t,r){let i=await this.upload(e,t,r);return await this.poll(e,i.id,r)}content(e,t,r){let{vector_store_id:i}=t;return this._client.getAPIList(eG`/vector_stores/${i}/files/${e}/content`,eS,{...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}class rr extends eq{constructor(){super(...arguments),this.files=new rt(this._client),this.fileBatches=new re(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:tl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(eG`/vector_stores/${e}`,{...t,headers:tl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(eG`/vector_stores/${e}`,{body:t,...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",eE,{query:e,...t,headers:tl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(eG`/vector_stores/${e}`,{...t,headers:tl([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,r){return this._client.getAPIList(eG`/vector_stores/${e}/search`,eS,{body:t,method:"post",...r,headers:tl([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}rr.Files=rt,rr.FileBatches=re;class ri extends eq{create(e,t){return this._client.post("/videos",ej({body:e,...t},this._client))}retrieve(e,t){return this._client.get(eG`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",eT,{query:e,...t})}delete(e,t){return this._client.delete(eG`/videos/${e}`,t)}downloadContent(e,t={},r){return this._client.get(eG`/videos/${e}/content`,{query:t,...r,headers:tl([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}remix(e,t,r){return this._client.post(eG`/videos/${e}/remix`,ej({body:t,...r},this._client))}}class rn extends eq{constructor(){super(...arguments),ib.add(this)}async unwrap(e,t,r=this._client.webhookSecret,i=300){return await this.verifySignature(e,t,r,i),JSON.parse(e)}async verifySignature(e,t,r=this._client.webhookSecret,i=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");y(this,ib,"m",iw).call(this,r);let n=tl([t]).values,a=y(this,ib,"m",i$).call(this,n,"webhook-signature"),s=y(this,ib,"m",i$).call(this,n,"webhook-timestamp"),o=y(this,ib,"m",i$).call(this,n,"webhook-id"),l=parseInt(s,10);if(isNaN(l))throw new L("Invalid webhook timestamp format");let u=Math.floor(Date.now()/1e3);if(u-l>i)throw new L("Webhook timestamp is too old");if(l>u+i)throw new L("Webhook timestamp is too new");let c=a.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),d=r.startsWith("whsec_")?Buffer.from(r.replace("whsec_",""),"base64"):Buffer.from(r,"utf-8"),p=o?`${o}.${s}.${e}`:`${s}.${e}`,h=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of c)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",h,t,new TextEncoder().encode(p)))return}catch{continue}throw new L("The given webhook signature does not match the expected signature")}}ib=new WeakSet,iw=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},i$=function(e,t){if(!e)throw Error("Headers are required");let r=e.get(t);if(null==r)throw Error(`Missing required header: ${t}`);return r},e.i(46285);class ra{constructor({baseURL:e=tx("OPENAI_BASE_URL"),apiKey:t=tx("OPENAI_API_KEY"),organization:r=tx("OPENAI_ORG_ID")??null,project:i=tx("OPENAI_PROJECT_ID")??null,webhookSecret:n=tx("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(ix.add(this),iI.set(this,void 0),this.completions=new tE(this),this.chat=new ts(this),this.embeddings=new tj(this),this.files=new tz(this),this.images=new tV(this),this.audio=new tp(this),this.moderations=new tX(this),this.models=new tK(this),this.fineTuning=new tJ(this),this.graders=new tH(this),this.vectorStores=new rr(this),this.webhooks=new rn(this),this.beta=new tS(this),this.batches=new th(this),this.uploads=new t8(this),this.responses=new t5(this),this.realtime=new t0(this),this.conversations=new tP(this),this.evals=new tU(this),this.containers=new tN(this),this.videos=new ri(this),void 0===t)throw new w("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const s={apiKey:t,organization:r,project:i,webhookSecret:n,...a,baseURL:e||"https://api.openai.com/v1"};s.dangerouslyAllowBrowser,this.baseURL=s.baseURL,this.timeout=s.timeout??ik.DEFAULT_TIMEOUT,this.logger=s.logger??console;const o="warn";this.logLevel=o,this.logLevel=ed(s.logLevel,"ClientOptions.logLevel",this)??ed(tx("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=s.fetchOptions,this.maxRetries=s.maxRetries??2,this.fetch=s.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),g(this,iI,K,"f"),this._options=s,this.apiKey="string"==typeof t?t:"Missing Key",this.organization=r,this.project=i,this.webhookSecret=n}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return tl([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let r,i=e,n=function(e=ea){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let r=e.charset||ea.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let i=X;if(void 0!==e.format){if(!ee(Q,e.format))throw TypeError("Unknown format option provided.");i=e.format}let n=Q[i],a=ea.filter;if(("function"==typeof e.filter||z(e.filter))&&(a=e.filter),t=e.arrayFormat&&e.arrayFormat in ei?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":ea.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let s=void 0===e.allowDots?!0==!!e.encodeDotInKeys||ea.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:ea.addQueryPrefix,allowDots:s,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:ea.allowEmptyArrays,arrayFormat:t,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:ea.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?ea.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:ea.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:ea.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:ea.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:ea.encodeValuesOnly,filter:a,format:i,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:ea.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:ea.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:ea.strictNullHandling}}(t);"function"==typeof n.filter?i=(0,n.filter)("",i):z(n.filter)&&(r=n.filter);let a=[];if("object"!=typeof i||null===i)return"";let s=ei[n.arrayFormat],o="comma"===s&&n.commaRoundTrip;r||(r=Object.keys(i)),n.sort&&r.sort(n.sort);let l=new WeakMap;for(let e=0;e<r.length;++e){let t=r[e];n.skipNulls&&null===i[t]||en(a,function e(t,r,i,n,a,s,o,l,u,c,d,p,h,m,f,g,y,_){var v,b;let w,$=t,x=_,k=0,I=!1;for(;void 0!==(x=x.get(es))&&!I;){let e=x.get(t);if(k+=1,void 0!==e)if(e===k)throw RangeError("Cyclic object value");else I=!0;void 0===x.get(es)&&(k=0)}if("function"==typeof c?$=c(r,$):$ instanceof Date?$=h?.($):"comma"===i&&z($)&&($=er($,function(e){return e instanceof Date?h?.(e):e})),null===$){if(s)return u&&!g?u(r,ea.encoder,y,"key",m):r;$=""}if("string"==typeof(v=$)||"number"==typeof v||"boolean"==typeof v||"symbol"==typeof v||"bigint"==typeof v||(b=$)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(u){let e=g?r:u(r,ea.encoder,y,"key",m);return[f?.(e)+"="+f?.(u($,ea.encoder,y,"value",m))]}return[f?.(r)+"="+f?.(String($))]}let O=[];if(void 0===$)return O;if("comma"===i&&z($))g&&u&&($=er($,u)),w=[{value:$.length>0?$.join(",")||null:void 0}];else if(z(c))w=c;else{let e=Object.keys($);w=d?e.sort(d):e}let S=l?String(r).replace(/\./g,"%2E"):String(r),E=n&&z($)&&1===$.length?S+"[]":S;if(a&&z($)&&0===$.length)return E+"[]";for(let r=0;r<w.length;++r){let v=w[r],b="object"==typeof v&&void 0!==v.value?v.value:$[v];if(o&&null===b)continue;let x=p&&l?v.replace(/\./g,"%2E"):v,I=z($)?"function"==typeof i?i(E,x):E:E+(p?"."+x:"["+x+"]");_.set(t,k);let S=new WeakMap;S.set(es,_),en(O,e(b,I,i,n,a,s,o,l,"comma"===i&&g&&z($)?null:u,c,d,p,h,m,f,g,y,S))}return O}(i[t],t,s,o,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}let u=a.join(n.delimiter),c=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?c+="utf8=%26%2310003%3B&":c+="utf8=%E2%9C%93&"),u.length>0?c+u:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${B}`}defaultIdempotencyKey(){return`stainless-node-retry-${_()}`}makeStatusError(e,t,r,i){return $.generate(e,t,r,i)}async _callApiKey(){let e,t=this._options.apiKey;if("function"!=typeof t)return!1;try{e=await t()}catch(e){if(e instanceof w)throw e;throw new w(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if("string"!=typeof e||!e)throw new w(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(e,t,r){let i=!y(this,ix,"m",iO).call(this)&&r||this.baseURL,n=new URL(U.test(e)?e:i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(a)&&(t={...a,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new ek(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){let i=await e,n=i.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(i);let{req:a,url:s,timeout:o}=await this.buildRequest(i,{retryCount:n-t});await this.prepareRequest(a,{url:s,options:i});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),u=void 0===r?"":`, retryOf: ${r}`,c=Date.now();if(eg(this).debug(`[${l}] sending request`,ey({retryOfRequestLogID:r,method:i.method,url:s,options:i,headers:a.headers})),i.signal?.aborted)throw new x;let d=new AbortController,p=await this.fetchWithTimeout(s,a,o,d).catch(b),h=Date.now();if(p instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(i.signal?.aborted)throw new x;let n=v(p)||/timed? ?out/i.test(String(p)+("cause"in p?String(p.cause):""));if(t)return eg(this).info(`[${l}] connection ${n?"timed out":"failed"} - ${e}`),eg(this).debug(`[${l}] connection ${n?"timed out":"failed"} (${e})`,ey({retryOfRequestLogID:r,url:s,durationMs:h-c,message:p.message})),this.retryRequest(i,t,r??l);if(eg(this).info(`[${l}] connection ${n?"timed out":"failed"} - error; no more retries left`),eg(this).debug(`[${l}] connection ${n?"timed out":"failed"} (error; no more retries left)`,ey({retryOfRequestLogID:r,url:s,durationMs:h-c,message:p.message})),n)throw new I;throw new k({cause:p})}let m=[...p.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),f=`[${l}${u}${m}] ${a.method} ${s} ${p.ok?"succeeded":"failed"} with status ${p.status} in ${h-c}ms`;if(!p.ok){let e=await this.shouldRetry(p);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await V(p.body),eg(this).info(`${f} - ${e}`),eg(this).debug(`[${l}] response error (${e})`,ey({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,durationMs:h-c})),this.retryRequest(i,t,r??l,p.headers)}let n=e?"error; no more retries left":"error; not retryable";eg(this).info(`${f} - ${n}`);let a=await p.text().catch(e=>b(e).message),s=(e=>{try{return JSON.parse(e)}catch(e){return}})(a),o=s?void 0:a;throw eg(this).debug(`[${l}] response error (${n})`,ey({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,message:o,durationMs:Date.now()-c})),this.makeStatusError(p.status,s,o,p.headers)}return eg(this).info(f),eg(this).debug(`[${l}] response start`,ey({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,durationMs:h-c})),{response:p,options:i,controller:d,requestLogID:l,retryOfRequestLogID:r,startTime:c}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){return new eO(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,r,i){let{signal:n,method:a,...s}=t||{};n&&n.addEventListener("abort",()=>i.abort());let o=setTimeout(()=>i.abort(),r),l=globalThis.ReadableStream&&s.body instanceof globalThis.ReadableStream||"object"==typeof s.body&&null!==s.body&&Symbol.asyncIterator in s.body,u={signal:i.signal,...l?{duplex:"half"}:{},method:"GET",...s};a&&(u.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,u)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,r,i){let n,a=i?.get("retry-after-ms");if(a){let e=parseFloat(a);Number.isNaN(e)||(n=e)}let s=i?.get("retry-after");if(s&&!n){let e=parseFloat(s);n=Number.isNaN(e)?Date.parse(s)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let r=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,r)}return await F(n),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:i,path:n,query:a,defaultBaseURL:s}=r,o=this.buildURL(n,a,s);"timeout"in r&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new w(`${e} must be an integer`);if(t<0)throw new w(`${e} must be a positive integer`)})("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let{bodyHeaders:l,body:u}=this.buildBody({options:r}),c=await this.buildHeaders({options:e,method:i,bodyHeaders:l,retryCount:t});return{req:{method:i,headers:c,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&u instanceof globalThis.ReadableStream&&{duplex:"half"},...u&&{body:u},...this.fetchOptions??{},...r.fetchOptions??{}},url:o,timeout:r.timeout}}async buildHeaders({options:e,method:r,bodyHeaders:i,retryCount:n}){let a={};this.idempotencyHeader&&"get"!==r&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);let s=tl([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...t??(t=(()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":B,"X-Stainless-OS":W(Deno.build.os),"X-Stainless-Arch":q(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":B,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":B,"X-Stainless-OS":W(globalThis.process.platform??"unknown"),"X-Stainless-Arch":q(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let r=t.exec(navigator.userAgent);if(r){let t=r[1]||0,i=r[2]||0,n=r[3]||0;return{browser:e,version:`${t}.${i}.${n}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":B,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":B,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,i,e.headers]);return this.validateHeaders(s),s.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=tl([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:G(e)}:y(this,iI,"f").call(this,{body:e,headers:r})}}function rs(e){let t;return e&&"object"==typeof e?(e.constructor.name===I.name&&"message"in e&&"string"==typeof e.message?(t=Error(e.message)).name="TimeoutError":e.constructor.name===x.name&&"message"in e&&"string"==typeof e.message?(t=Error(e.message)).name="AbortError":t="status"in e&&400===e.status&&"message"in e&&"string"==typeof e.message&&e.message.includes("tool_calls")?f(e,"INVALID_TOOL_RESULTS"):"status"in e&&401===e.status?f(e,"MODEL_AUTHENTICATION"):"status"in e&&429===e.status?f(e,"MODEL_RATE_LIMIT"):"status"in e&&404===e.status?f(e,"MODEL_NOT_FOUND"):e,t):e}ik=ra,iI=new WeakMap,ix=new WeakSet,iO=function(){return"https://api.openai.com/v1"!==this.baseURL},ra.OpenAI=ik,ra.DEFAULT_TIMEOUT=6e5,ra.OpenAIError=w,ra.APIError=$,ra.APIConnectionError=k,ra.APIConnectionTimeoutError=I,ra.APIUserAbortError=x,ra.NotFoundError=T,ra.ConflictError=A,ra.RateLimitError=C,ra.BadRequestError=O,ra.AuthenticationError=S,ra.InternalServerError=P,ra.PermissionDeniedError=E,ra.UnprocessableEntityError=N,ra.InvalidWebhookSignatureError=L,ra.toFile=eF,ra.Completions=tE,ra.Chat=ts,ra.Embeddings=tj,ra.Files=tz,ra.Images=tV,ra.Audio=tp,ra.Moderations=tX,ra.Models=tK,ra.FineTuning=tJ,ra.Graders=tH,ra.VectorStores=rr,ra.Webhooks=rn,ra.Beta=tS,ra.Batches=th,ra.Uploads=t8,ra.Responses=t5,ra.Realtime=t0,ra.Conversations=tP,ra.Evals=tU,ra.Containers=tN,ra.Videos=ri;var ro,rl,ru,rc,rd,rp,rh,rm,rf,rg,ry,r_,rv,rb,rw,r$,rx,rk,rI,rO,rS,rE,rT,rA,rN,rC,rP,rj,rR,rL,rU,rz,rM,rD,rZ,rF,rB,rq,rW,rJ,rG,rH,rV,rK,rX,rY,rQ,r0,r1,r4,r2,r6,r9,r5,r3,r8,r7,ie,it,ir,ii,ia,is,io,il,iu,ic,id,ip,ih,im,ig,iy,i_,iv,ib,iw,i$,ix,ik,iI,iO,iS,iE,iT,iA,iN,iC=Object.defineProperty,iP=(e,t)=>{for(var r in t)iC(e,r,{get:t[r],enumerable:!0})};function ij(e){return"object"==typeof e&&null!==e&&"type"in e&&"string"==typeof e.type&&"source_type"in e&&("url"===e.source_type||"base64"===e.source_type||"text"===e.source_type||"id"===e.source_type)}function iR(e){return ij(e)&&"url"===e.source_type&&"url"in e&&"string"==typeof e.url}function iL(e){return ij(e)&&"base64"===e.source_type&&"data"in e&&"string"==typeof e.data}function iU(e){return ij(e)&&"text"===e.source_type&&"text"in e&&"string"==typeof e.text}function iz(e){return ij(e)&&"id"===e.source_type&&"id"in e&&"string"==typeof e.id}function iM(e){if(ij(e)){if("url"===e.source_type)return{type:"image_url",image_url:{url:e.url}};if("base64"===e.source_type){if(!e.mime_type)throw Error("mime_type key is required for base64 data.");let t=e.mime_type;return{type:"image_url",image_url:{url:`data:${t};base64,${e.data}`}}}}throw Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function iD(e){let t=e.split(";")[0].split("/");if(2!==t.length)throw Error(`Invalid mime type: "${e}" - does not match type/subtype format.`);let r=t[0].trim(),i=t[1].trim();if(""===r||""===i)throw Error(`Invalid mime type: "${e}" - type or subtype is empty.`);let n={};for(let t of e.split(";").slice(1)){let r=t.split("=");if(2!==r.length)throw Error(`Invalid parameter syntax in mime type: "${e}".`);let i=r[0].trim(),a=r[1].trim();if(""===i)throw Error(`Invalid parameter syntax in mime type: "${e}".`);n[i]=a}return{type:r,subtype:i,parameters:n}}function iZ({dataUrl:e,asTypedArray:t=!1}){let r=e.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);if(r)return{mime_type:r[1].toLowerCase(),data:t?Uint8Array.from(atob(r[2]),e=>e.charCodeAt(0)):r[2]}}function iF(e,t){if("text"===e.type){if(!t.fromStandardTextBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardTextBlock\` method.`);return t.fromStandardTextBlock(e)}if("image"===e.type){if(!t.fromStandardImageBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardImageBlock\` method.`);return t.fromStandardImageBlock(e)}if("audio"===e.type){if(!t.fromStandardAudioBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardAudioBlock\` method.`);return t.fromStandardAudioBlock(e)}if("file"===e.type){if(!t.fromStandardFileBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardFileBlock\` method.`);return t.fromStandardFileBlock(e)}throw Error(`Unable to convert content block type '${e.type}' to provider-specific format: not recognized.`)}function iB(e){return"object"==typeof e&&null!==e&&"type"in e&&"content"in e&&("string"==typeof e.content||Array.isArray(e.content))}e.s(["__export",()=>iP],75736);let iq=/([\p{Alpha}\p{N}_]|$)/u;function iW(e,t){return t?.[e]||function(e,{separator:t="_",preserveConsecutiveUppercase:r=!1}={}){if("string"!=typeof e||"string"!=typeof t)throw TypeError("The `text` and `separator` arguments should be of type `string`");if(e.length<2)return r?e:e.toLowerCase();let i=`$1${t}$2`,n=e.replace(/([\p{Lowercase_Letter}\d])(\p{Uppercase_Letter})/gu,i);if(r){var a;return(a=n.replace(/((?<![\p{Uppercase_Letter}\d])[\p{Uppercase_Letter}\d](?![\p{Uppercase_Letter}\d]))/gu,e=>e.toLowerCase())).replace(/(?<!\p{Uppercase_Letter})(\p{Uppercase_Letter}+)(\p{Uppercase_Letter}\p{Lowercase_Letter}+)/gu,(e,r,i)=>r+t+i.toLowerCase())}return n.replace(/(\p{Uppercase_Letter})(\p{Uppercase_Letter}\p{Lowercase_Letter}+)/gu,i).toLowerCase()}(e)}function iJ(e){return Array.isArray(e)?[...e]:{...e}}function iG(e){let t=Object.getPrototypeOf(e);return"function"==typeof e.lc_name&&("function"!=typeof t.lc_name||e.lc_name()!==t.lc_name())?e.lc_name():e.name}RegExp(/[_.\- ]+/.source+iq.source,"gu"),RegExp(String.raw`\d+`+iq.source,"gu"),iP({},{Serializable:()=>iH,get_lc_unique_name:()=>iG});var iH=class e{lc_serializable=!1;lc_kwargs;static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,iG(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){void 0!==this.lc_serializable_keys?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([e])=>this.lc_serializable_keys?.includes(e))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable||this.lc_kwargs instanceof e||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let t={},r={},i=Object.keys(this.lc_kwargs).reduce((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e),{});for(let e=Object.getPrototypeOf(this);e;e=Object.getPrototypeOf(e))Object.assign(t,Reflect.get(e,"lc_aliases",this)),Object.assign(r,Reflect.get(e,"lc_secrets",this)),Object.assign(i,Reflect.get(e,"lc_attributes",this));return Object.keys(r).forEach(e=>{let t=this,r=i,[n,...a]=e.split(".").reverse();for(let e of a.reverse()){if(!(e in t)||void 0===t[e])return;e in r&&void 0!==r[e]||("object"==typeof t[e]&&null!=t[e]?r[e]={}:Array.isArray(t[e])&&(r[e]=[])),t=t[e],r=r[e]}n in t&&void 0!==t[n]&&(r[n]=r[n]||t[n])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:function(e,t,r){let i={};for(let n in e)Object.hasOwn(e,n)&&(i[t(n,r)]=e[n]);return i}(Object.keys(r).length?function(e,t){let r=iJ(e);for(let[e,i]of Object.entries(t)){let[t,...n]=e.split(".").reverse(),a=r;for(let e of n.reverse()){if(void 0===a[e])break;a[e]=iJ(a[e]),a=a[e]}void 0!==a[t]&&(a[t]={lc:1,type:"secret",id:[i]})}return r}(i,r):i,iW,t)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function iV(e,t){return iK(e)&&e.type===t}function iK(e){return"object"==typeof e&&null!==e}function iX(e){return Array.isArray(e)}function iY(e){return"string"==typeof e}function iQ(e){return"number"==typeof e}function i0(e){return e instanceof Uint8Array}function i1(e){try{return JSON.parse(e)}catch{return}}let i4=e=>e();function i2(e){if(iV(e,"document")&&iK(e.source)&&"type"in e.source){if("base64"===e.source.type&&iY(e.source.media_type)&&iY(e.source.data))return{type:"file",mimeType:e.source.media_type,data:e.source.data};else if("url"===e.source.type&&iY(e.source.url))return{type:"file",url:e.source.url};else if("file"===e.source.type&&iY(e.source.file_id))return{type:"file",fileId:e.source.file_id};else if("text"===e.source.type&&iY(e.source.data))return{type:"file",mimeType:String(e.source.media_type??"text/plain"),data:e.source.data}}else if(iV(e,"image")&&iK(e.source)&&"type"in e.source){if("base64"===e.source.type&&iY(e.source.media_type)&&iY(e.source.data))return{type:"image",mimeType:e.source.media_type,data:e.source.data};else if("url"===e.source.type&&iY(e.source.url))return{type:"image",url:e.source.url};else if("file"===e.source.type&&iY(e.source.file_id))return{type:"image",fileId:e.source.file_id}}}function i6(e){return Array.from(function*(){for(let t of e){let e=i2(t);e?yield e:yield t}}())}function i9(e){return Array.from(function*(){for(let r of"string"==typeof e.content?[{type:"text",text:e.content}]:e.content){if(iV(r,"text")&&iY(r.text)){let{text:e,citations:t,...i}=r;if(iX(t)&&t.length){let r=t.reduce((e,t)=>{let r=function(e){if("char_location"===e.type&&iY(e.document_title)&&iQ(e.start_char_index)&&iQ(e.end_char_index)&&iY(e.cited_text)){let{document_title:t,start_char_index:r,end_char_index:i,cited_text:n,...a}=e;return{...a,type:"citation",source:"char",title:t??void 0,startIndex:r,endIndex:i,citedText:n}}if("page_location"===e.type&&iY(e.document_title)&&iQ(e.start_page_number)&&iQ(e.end_page_number)&&iY(e.cited_text)){let{document_title:t,start_page_number:r,end_page_number:i,cited_text:n,...a}=e;return{...a,type:"citation",source:"page",title:t??void 0,startIndex:r,endIndex:i,citedText:n}}if("content_block_location"===e.type&&iY(e.document_title)&&iQ(e.start_block_index)&&iQ(e.end_block_index)&&iY(e.cited_text)){let{document_title:t,start_block_index:r,end_block_index:i,cited_text:n,...a}=e;return{...a,type:"citation",source:"block",title:t??void 0,startIndex:r,endIndex:i,citedText:n}}if("web_search_result_location"===e.type&&iY(e.url)&&iY(e.title)&&iY(e.encrypted_index)&&iY(e.cited_text)){let{url:t,title:r,encrypted_index:i,cited_text:n,...a}=e;return{...a,type:"citation",source:"url",url:t,title:r,startIndex:Number(i),endIndex:Number(i),citedText:n}}if("search_result_location"===e.type&&iY(e.source)&&iY(e.title)&&iQ(e.start_block_index)&&iQ(e.end_block_index)&&iY(e.cited_text)){let{source:t,title:r,start_block_index:i,end_block_index:n,cited_text:a,...s}=e;return{...s,type:"citation",source:"search",url:t,title:r??void 0,startIndex:i,endIndex:n,citedText:a}}}(t);return r?[...e,r]:e},[]);yield{...i,type:"text",text:e,annotations:r};continue}yield{...i,type:"text",text:e};continue}if(iV(r,"thinking")&&iY(r.thinking)){let{thinking:e,signature:t,...i}=r;yield{...i,type:"reasoning",reasoning:e,signature:t};continue}if(iV(r,"redacted_thinking")){yield{type:"non_standard",value:r};continue}else if(iV(r,"tool_use")&&iY(r.name)&&iY(r.id)){yield{type:"tool_call",id:r.id,name:r.name,args:r.input};continue}else if(iV(r,"input_json_delta")){var t;if(t=e,"function"==typeof t?._getType&&"function"==typeof t.concat&&"ai"===t._getType()&&e.tool_call_chunks?.length){let t=e.tool_call_chunks[0];yield{type:"tool_call_chunk",id:t.id,name:t.name,args:t.args,index:t.index};continue}}else if(iV(r,"server_tool_use")&&iY(r.name)&&iY(r.id)){let{name:e,id:t}=r;if("web_search"===e){let e=i4(()=>{if("string"==typeof r.input)return r.input;if(iK(r.input)&&iY(r.input.query))return r.input.query;if(iY(r.partial_json)){let e=i1(r.partial_json);if(e?.query)return e.query}return""});yield{id:t,type:"server_tool_call",name:"web_search",args:{query:e}};continue}if("code_execution"===r.name){let e=i4(()=>{if("string"==typeof r.input)return r.input;if(iK(r.input)&&iY(r.input.code))return r.input.code;if(iY(r.partial_json)){let e=i1(r.partial_json);if(e?.code)return e.code}return""});yield{id:t,type:"server_tool_call",name:"code_execution",args:{code:e}};continue}}else if(iV(r,"web_search_tool_result")&&iY(r.tool_use_id)&&iX(r.content)){let{content:e,tool_use_id:t}=r,i=e.reduce((e,t)=>iV(t,"web_search_result")?[...e,t.url]:e,[]);yield{type:"server_tool_call_result",name:"web_search",toolCallId:t,status:"success",output:{urls:i}};continue}else if(iV(r,"code_execution_tool_result")&&iY(r.tool_use_id)&&iK(r.content)){yield{type:"server_tool_call_result",name:"code_execution",toolCallId:r.tool_use_id,status:"success",output:r.content};continue}else if(iV(r,"mcp_tool_use")){yield{id:r.id,type:"server_tool_call",name:"mcp_tool_use",args:r.input};continue}else if(iV(r,"mcp_tool_result")&&iY(r.tool_use_id)&&iK(r.content)){yield{type:"server_tool_call_result",name:"mcp_tool_use",toolCallId:r.tool_use_id,status:"success",output:r.content};continue}else if(iV(r,"container_upload")){yield{type:"server_tool_call",name:"container_upload",args:r.input};continue}else if(iV(r,"search_result")){yield{id:r.id,type:"non_standard",value:r};continue}else if(iV(r,"tool_result")){yield{id:r.id,type:"non_standard",value:r};continue}else{let e=i2(r);if(e){yield e;continue}}yield{type:"non_standard",value:r}}}())}function i5(e){return iR(e)?{type:e.type,mimeType:e.mime_type,url:e.url,metadata:e.metadata}:iL(e)?{type:e.type,mimeType:e.mime_type??"application/octet-stream",data:e.data,metadata:e.metadata}:iz(e)?{type:e.type,mimeType:e.mime_type,fileId:e.id,metadata:e.metadata}:e}function i3(e){return e.map(i5)}function i8(e){let t=[];for(let r of e)(iV(r,"image_url")&&iK(r.image_url)||iV(r,"input_audio")&&iK(r.input_audio)||iV(r,"file")&&iK(r.file)?0:1)?t.push(r):t.push(function(e){if(iV(e,"image_url")&&iK(e.image_url)&&iY(e.image_url.url)){let t=iZ({dataUrl:e.image_url.url});return t?{type:"image",mimeType:t.mime_type,data:t.data}:{type:"image",url:e.image_url.url}}if(iV(e,"input_audio")&&iK(e.input_audio)&&iY(e.input_audio.data)&&iY(e.input_audio.format))return{type:"audio",data:e.input_audio.data,mimeType:`audio/${e.input_audio.format}`};if(iV(e,"file")&&iK(e.file)&&iY(e.file.data)){let t=iZ({dataUrl:e.file.data});if(t)return{type:"file",data:t.data,mimeType:t.mime_type};if(iY(e.file.file_id))return{type:"file",fileId:e.file.file_id}}return e}(r));return t}function i7(e){if("url_citation"===e.type){let{url:t,title:r,start_index:i,end_index:n}=e;return{type:"citation",url:t,title:r,startIndex:i,endIndex:n}}if("file_citation"===e.type){let{file_id:t,filename:r,index:i}=e;return{type:"citation",title:r,startIndex:i,endIndex:i,fileId:t}}return e}function ne(e){return Array.from(function*(){if(iK(e.additional_kwargs?.reasoning)&&iX(e.additional_kwargs.reasoning.summary)){let t=e.additional_kwargs.reasoning.summary.reduce((e,t)=>iK(t)&&iY(t.text)?`${e}${t.text}`:e,"");yield{type:"reasoning",reasoning:t}}for(let t of"string"==typeof e.content?[{type:"text",text:e.content}]:e.content)if(iV(t,"text")){let{text:e,annotations:r,...i}=t;Array.isArray(r)?yield{...i,type:"text",text:String(e),annotations:r.map(i7)}:yield{...i,type:"text",text:String(e)}}for(let t of e.tool_calls??[])yield{type:"tool_call",id:t.id,name:t.name,args:t.args};if(iK(e.additional_kwargs)&&iX(e.additional_kwargs.tool_outputs))for(let t of e.additional_kwargs.tool_outputs){if(iV(t,"web_search_call")){yield{id:t.id,type:"server_tool_call",name:"web_search",args:{query:t.query}};continue}if(iV(t,"file_search_call")){yield{id:t.id,type:"server_tool_call",name:"file_search",args:{query:t.query}};continue}if(iV(t,"computer_call")){yield{type:"non_standard",value:t};continue}else if(iV(t,"code_interpreter_call")){if(iY(t.code)&&(yield{id:t.id,type:"server_tool_call",name:"code_interpreter",args:{code:t.code}}),iX(t.outputs)){let e=i4(()=>{if("in_progress"!==t.status){if("completed"===t.status)return 0;if("incomplete"===t.status)return 127;if("interpreting"!==t.status&&"failed"===t.status)return 1}});for(let r of t.outputs)if(iV(r,"logs")){yield{type:"server_tool_call_result",toolCallId:t.id??"",status:"success",output:{type:"code_interpreter_output",returnCode:e??0,stderr:[0,void 0].includes(e)?void 0:String(r.logs),stdout:[0,void 0].includes(e)?String(r.logs):void 0}};continue}}continue}else if(iV(t,"mcp_call")){yield{id:t.id,type:"server_tool_call",name:"mcp_call",args:t.input};continue}else if(iV(t,"mcp_list_tools")){yield{id:t.id,type:"server_tool_call",name:"mcp_list_tools",args:t.input};continue}else if(iV(t,"mcp_approval_request")){yield{type:"non_standard",value:t};continue}else if(iV(t,"image_generation_call")){yield{type:"non_standard",value:t};continue}iK(t)&&(yield{type:"non_standard",value:t})}}())}let nt=Symbol.for("langchain.message");function nr(e,t){if("string"==typeof e)return""===e?t:"string"==typeof t?e+t:Array.isArray(t)&&0===t.length?e:Array.isArray(t)&&t.some(e=>ij(e))?[{type:"text",source_type:"text",text:e},...t]:[{type:"text",text:e},...t];return Array.isArray(t)?no(e,t)??[...e,...t]:""===t?e:Array.isArray(e)&&e.some(e=>ij(e))?[...e,{type:"file",source_type:"text",text:t}]:[...e,{type:"text",text:t}]}function ni(e,t){return"error"===e||"error"===t?"error":"success"}var nn=class extends iH{lc_namespace=["langchain_core","messages"];lc_serializable=!0;get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}[nt]=!0;id;name;content;additional_kwargs;response_metadata;_getType(){return this.type}getType(){return this._getType()}constructor(e){const t="string"==typeof e||Array.isArray(e)?{content:e}:e;t.additional_kwargs||(t.additional_kwargs={}),t.response_metadata||(t.response_metadata={}),super(t),this.name=t.name,void 0===t.content&&void 0!==t.contentBlocks?(this.content=t.contentBlocks,this.response_metadata={output_version:"v1",...t.response_metadata}):(void 0!==t.content?this.content=t.content??[]:this.content=[],this.response_metadata=t.response_metadata),this.additional_kwargs=t.additional_kwargs,this.id=t.id}get text(){return"string"==typeof this.content?this.content:Array.isArray(this.content)?this.content.map(e=>"string"==typeof e?e:"text"===e.type?e.text:"").join(""):""}get contentBlocks(){return[i3,i8,i6].reduce((e,t)=>t(e),"string"==typeof this.content?[{type:"text",text:this.content}]:this.content)}toDict(){return{type:this.getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}static isInstance(e){return"object"==typeof e&&null!==e&&nt in e&&!0===e[nt]&&iB(e)}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){var t,r;if(null===e)return this;let i=(t=this._printableFields,r=Math.max(4,e),JSON.stringify(function e(t,i){if("object"!=typeof t||null==t)return t;if(i>=r)return Array.isArray(t)?"[Array]":"[Object]";if(Array.isArray(t))return t.map(t=>e(t,i+1));let n={};for(let r of Object.keys(t))n[r]=e(t[r],i+1);return n}(t,0),null,2));return`${this.constructor.lc_name()} ${i}`}toFormattedString(e="pretty"){return function(e,t="pretty"){return"pretty"===t?function(e){let t=[],r=` ${e.type.charAt(0).toUpperCase()+e.type.slice(1)} Message `,i=Math.floor((80-r.length)/2),n="=".repeat(i),a=r.length%2==0?n:`${n}=`;if(t.push(`${n}${r}${a}`),"ai"===e.type&&e.tool_calls&&e.tool_calls.length>0)for(let r of(t.push("Tool Calls:"),e.tool_calls))for(let[e,i]of(t.push(`  ${r.name} (${r.id})`),t.push(` Call ID: ${r.id}`),t.push("  Args:"),Object.entries(r.args)))t.push(`    ${e}: ${i}`);return"tool"===e.type&&e.name&&t.push(`Name: ${e.name}`),"string"==typeof e.content&&e.content.trim()&&(t.length>1&&t.push(""),t.push(e.content)),t.join("\n")}(e):JSON.stringify(e)}(this,e)}};function na(e){return Array.isArray(e)&&e.every(e=>"number"==typeof e.index)}function ns(e={},t={}){let r={...e};for(let[e,i]of Object.entries(t))if(null==r[e])r[e]=i;else if(null==i)continue;else if(typeof r[e]!=typeof i||Array.isArray(r[e])!==Array.isArray(i))throw Error(`field[${e}] already exists in the message chunk, but with a different type.`);else if("string"==typeof r[e])if("type"===e)continue;else["id","name","output_version","model_provider"].includes(e)?i&&(r[e]=i):r[e]+=i;else if("object"!=typeof r[e]||Array.isArray(r[e]))if(Array.isArray(r[e]))r[e]=no(r[e],i);else{if(r[e]===i)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}else r[e]=ns(r[e],i);return r}function no(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;let r=[...e];for(let e of t)if("object"==typeof e&&null!==e&&"index"in e&&"number"==typeof e.index){let t=r.findIndex(t=>{let r="object"==typeof t,i="index"in t&&t.index===e.index,n="id"in t&&"id"in e&&t?.id===e?.id,a=!("id"in t)||!t?.id||!("id"in e)||!e?.id;return r&&i&&(n||a)});-1!==t&&"object"==typeof r[t]&&null!==r[t]?r[t]=ns(r[t],e):r.push(e)}else{if("object"==typeof e&&null!==e&&"text"in e&&""===e.text)continue;r.push(e)}return r}}function nl(e,t){if(!e&&!t)throw Error("Cannot merge two undefined objects.");if(!e||!t)return e||t;if(typeof e!=typeof t)throw Error(`Cannot merge objects of different types.
Left ${typeof e}
Right ${typeof t}`);if("string"==typeof e&&"string"==typeof t)return e+t;if(Array.isArray(e)&&Array.isArray(t))return no(e,t);if("object"==typeof e&&"object"==typeof t)return ns(e,t);else if(e===t)return e;else throw Error(`Can not merge objects of different types.
Left ${e}
Right ${t}`)}var nu=class e extends nn{static isInstance(t){if(!super.isInstance(t))return!1;let r=Object.getPrototypeOf(t);for(;null!==r;){if(r===e.prototype)return!0;r=Object.getPrototypeOf(r)}return!1}};function nc(e){return"string"==typeof e.role}function nd(e){return"function"==typeof e?._getType}function np(e){return nu.isInstance(e)}function nh(e,t){return ns(e??{},t??{})}function nm(e,t){let r={};return(e?.audio!==void 0||t?.audio!==void 0)&&(r.audio=(e?.audio??0)+(t?.audio??0)),(e?.image!==void 0||t?.image!==void 0)&&(r.image=(e?.image??0)+(t?.image??0)),(e?.video!==void 0||t?.video!==void 0)&&(r.video=(e?.video??0)+(t?.video??0)),(e?.document!==void 0||t?.document!==void 0)&&(r.document=(e?.document??0)+(t?.document??0)),(e?.text!==void 0||t?.text!==void 0)&&(r.text=(e?.text??0)+(t?.text??0)),r}function nf(e,t){var r,i,n,a;let s,o;return{input_tokens:(e?.input_tokens??0)+(t?.input_tokens??0),output_tokens:(e?.output_tokens??0)+(t?.output_tokens??0),total_tokens:(e?.total_tokens??0)+(t?.total_tokens??0),input_token_details:(s={...nm(r=e?.input_token_details,i=t?.input_token_details)},(r?.cache_read!==void 0||i?.cache_read!==void 0)&&(s.cache_read=(r?.cache_read??0)+(i?.cache_read??0)),(r?.cache_creation!==void 0||i?.cache_creation!==void 0)&&(s.cache_creation=(r?.cache_creation??0)+(i?.cache_creation??0)),s),output_token_details:(o={...nm(n=e?.output_token_details,a=t?.output_token_details)},(n?.reasoning!==void 0||a?.reasoning!==void 0)&&(o.reasoning=(n?.reasoning??0)+(a?.reasoning??0)),o)}}function ng(e){return null!=e&&"object"==typeof e&&"lc_direct_tool_output"in e&&!0===e.lc_direct_tool_output}e.s(["BaseMessage",()=>nn,"BaseMessageChunk",()=>nu,"_isMessageFieldWithRole",()=>nc,"_mergeDicts",()=>ns,"_mergeLists",()=>no,"_mergeObj",()=>nl,"_mergeStatus",()=>ni,"isBaseMessage",()=>nd,"isBaseMessageChunk",()=>np,"isOpenAIToolCallArray",()=>na,"mergeContent",()=>nr],40470),iP({},{ToolMessage:()=>ny,ToolMessageChunk:()=>n_,defaultToolCallParser:()=>nv,isDirectToolOutput:()=>ng,isToolMessage:()=>nb,isToolMessageChunk:()=>nw});var ny=class extends nn{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}lc_direct_tool_output=!0;type="tool";status;tool_call_id;metadata;artifact;constructor(e,t,r){const i="string"==typeof e||Array.isArray(e)?{content:e,name:r,tool_call_id:t}:e;super(i),this.tool_call_id=i.tool_call_id,this.artifact=i.artifact,this.status=i.status,this.metadata=i.metadata}static isInstance(e){return super.isInstance(e)&&"tool"===e.type}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},n_=class extends nu{type="tool";tool_call_id;status;artifact;constructor(e){super(e),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}concat(e){return new this.constructor({content:nr(this.content,e.content),additional_kwargs:ns(this.additional_kwargs,e.additional_kwargs),response_metadata:ns(this.response_metadata,e.response_metadata),artifact:nl(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:ni(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function nv(e){let t=[],r=[];for(let i of e)if(!i.function)continue;else{let e=i.function.name;try{let r=JSON.parse(i.function.arguments);t.push({name:e||"",args:r||{},id:i.id})}catch{r.push({name:e,args:i.function.arguments,id:i.id,error:"Malformed args."})}}return[t,r]}function nb(e){return"object"==typeof e&&null!==e&&"getType"in e&&"function"==typeof e.getType&&"tool"===e.getType()}function nw(e){return"tool"===e._getType()}var n$=class e extends nn{static lc_name(){return"ChatMessage"}type="generic";role;static _chatMessageClass(){return e}constructor(e,t){("string"==typeof e||Array.isArray(e))&&(e={content:e,role:t}),super(e),this.role=e.role}static isInstance(e){return super.isInstance(e)&&"generic"===e.type}get _printableFields(){return{...super._printableFields,role:this.role}}},nx=class extends nu{static lc_name(){return"ChatMessageChunk"}type="generic";role;constructor(e,t){("string"==typeof e||Array.isArray(e))&&(e={content:e,role:t}),super(e),this.role=e.role}concat(e){return new this.constructor({content:nr(this.content,e.content),additional_kwargs:ns(this.additional_kwargs,e.additional_kwargs),response_metadata:ns(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&"generic"===e.type}get _printableFields(){return{...super._printableFields,role:this.role}}};function nk(e){return"generic"===e._getType()}function nI(e){return"generic"===e._getType()}e.s(["ChatMessage",()=>n$,"ChatMessageChunk",()=>nx,"isChatMessage",()=>nk,"isChatMessageChunk",()=>nI],51191);var nO=class extends nn{static lc_name(){return"FunctionMessage"}type="function";name;constructor(e){super(e),this.name=e.name}},nS=class extends nu{static lc_name(){return"FunctionMessageChunk"}type="function";concat(e){return new this.constructor({content:nr(this.content,e.content),additional_kwargs:ns(this.additional_kwargs,e.additional_kwargs),response_metadata:ns(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}};function nE(e){return"function"===e._getType()}function nT(e){return"function"===e._getType()}var nA=class extends nn{static lc_name(){return"HumanMessage"}type="human";constructor(e){super(e)}static isInstance(e){return super.isInstance(e)&&"human"===e.type}},nN=class extends nu{static lc_name(){return"HumanMessageChunk"}type="human";constructor(e){super(e)}concat(e){return new this.constructor({content:nr(this.content,e.content),additional_kwargs:ns(this.additional_kwargs,e.additional_kwargs),response_metadata:ns(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&"human"===e.type}};function nC(e){return"human"===e.getType()}function nP(e){return"human"===e.getType()}e.s(["HumanMessage",()=>nA,"HumanMessageChunk",()=>nN,"isHumanMessage",()=>nC,"isHumanMessageChunk",()=>nP],60427);var nj=class extends nn{type="remove";id;constructor(e){super({...e,content:[]}),this.id=e.id}get _printableFields(){return{...super._printableFields,id:this.id}}static isInstance(e){return super.isInstance(e)&&"remove"===e.type}},nR=class e extends nn{static lc_name(){return"SystemMessage"}type="system";constructor(e){super(e)}concat(t){if("string"==typeof t)return new e({...this,content:nr(this.content,t)});if(e.isInstance(t))return new e({...this,additional_kwargs:{...this.additional_kwargs,...t.additional_kwargs},response_metadata:{...this.response_metadata,...t.response_metadata},content:nr(this.content,t.content)});throw Error("Unexpected chunk type for system message")}static isInstance(e){return super.isInstance(e)&&"system"===e.type}},nL=class extends nu{static lc_name(){return"SystemMessageChunk"}type="system";constructor(e){super(e)}concat(e){return new this.constructor({content:nr(this.content,e.content),additional_kwargs:ns(this.additional_kwargs,e.additional_kwargs),response_metadata:ns(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&"system"===e.type}};function nU(e){return"system"===e._getType()}function nz(e){return"system"===e._getType()}function nM(e,t){return e.lc_error_code=t,e.message=`${e.message}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langchain/errors/${t}/
`,e}function nD(e){return!!(e&&"object"==typeof e&&"type"in e&&"tool_call"===e.type)}e.s(["SystemMessage",()=>nR,"SystemMessageChunk",()=>nL,"isSystemMessage",()=>nU,"isSystemMessageChunk",()=>nz],11614),e.s(["coerceMessageLikeToMessage",()=>n4,"collapseToolCallChunks",()=>n8,"convertToChunk",()=>n3,"getBufferString",()=>n2,"iife",()=>nQ,"mapChatMessagesToStoredMessages",()=>n5,"mapStoredMessageToChatMessage",()=>n6,"mapStoredMessagesToChatMessages",()=>n9],29494),e.s(["addLangChainErrorFields",()=>nM],69065);var nZ=class extends Error{output;constructor(e,t){super(e),this.output=t}};function nF(e,t=nB){let r=(e=e.trim()).indexOf("```");if(-1===r)return t(e);let i=e.substring(r+3);i.startsWith("json\n")?i=i.substring(5):i.startsWith("json")?i=i.substring(4):i.startsWith("\n")&&(i=i.substring(1));let n=i.indexOf("```"),a=i;return -1!==n&&(a=i.substring(0,n)),t(a.trim())}function nB(e){try{if(void 0===e)return null;return function(e){try{return JSON.parse(e)}catch{}let t=e.trim();if(0===t.length)throw Error("Unexpected end of JSON input");let r=0;function i(){for(;r<t.length&&/\s/.test(t[r]);)r+=1}function n(){if('"'!==t[r])throw Error(`Expected '"' at position ${r}, got '${t[r]}'`);r+=1;let e="",i=!1;for(;r<t.length;){let n=t[r];if(i){if("n"===n)e+="\n";else if("t"===n)e+="	";else if("r"===n)e+="\r";else if("\\"===n)e+="\\";else if('"'===n)e+='"';else if("b"===n)e+="\b";else if("f"===n)e+="\f";else if("/"===n)e+="/";else if("u"===n){let i=t.substring(r+1,r+5);if(/^[0-9A-Fa-f]{0,4}$/.test(i))4===i.length?e+=String.fromCharCode(Number.parseInt(i,16)):e+=`u${i}`,r+=i.length;else throw Error(`Invalid unicode escape sequence '\\u${i}' at position ${r}`)}else throw Error(`Invalid escape sequence '\\${n}' at position ${r}`);i=!1}else if("\\"===n)i=!0;else{if('"'===n)return r+=1,e;e+=n}r+=1}return i&&(e+="\\"),e}let a=function e(){if(i(),r>=t.length)throw Error(`Unexpected end of input at position ${r}`);let a=t[r];if("{"===a){if("{"!==t[r])throw Error(`Expected '{' at position ${r}, got '${t[r]}'`);let a={};if(r+=1,i(),r>=t.length)return a;if("}"===t[r])return r+=1,a;for(;r<t.length&&(i(),!(r>=t.length));){let s=n();if(i(),r>=t.length)break;if(":"!==t[r])throw Error(`Expected ':' at position ${r}, got '${t[r]}'`);if(r+=1,i(),r>=t.length||(a[s]=e(),i(),r>=t.length))break;if("}"===t[r]){r+=1;break}if(","===t[r]){r+=1;continue}throw Error(`Expected ',' or '}' at position ${r}, got '${t[r]}'`)}return a}if("["===a){if("["!==t[r])throw Error(`Expected '[' at position ${r}, got '${t[r]}'`);let n=[];if(r+=1,i(),r>=t.length)return n;if("]"===t[r])return r+=1,n;for(;r<t.length&&(i(),!(r>=t.length))&&(n.push(e()),i(),!(r>=t.length));){;if("]"===t[r]){r+=1;break}if(","===t[r]){r+=1;continue}throw Error(`Expected ',' or ']' at position ${r}, got '${t[r]}'`)}return n}if('"'===a)return n();if("null".startsWith(t.substring(r,r+4)))return r+=Math.min(4,t.length-r),null;if("true".startsWith(t.substring(r,r+4)))return r+=Math.min(4,t.length-r),!0;if("false".startsWith(t.substring(r,r+5)))return r+=Math.min(5,t.length-r),!1;if("-"===a||a>="0"&&a<="9"){let e=r,i="";if("-"===t[r]&&(i+="-",r+=1),r<t.length&&"0"===t[r]&&(i+="0",t[r+=1]>="0"&&t[r]<="9"))throw Error(`Invalid number at position ${e}`);if(r<t.length&&t[r]>="1"&&t[r]<="9")for(;r<t.length&&t[r]>="0"&&t[r]<="9";)i+=t[r],r+=1;if(r<t.length&&"."===t[r])for(i+=".",r+=1;r<t.length&&t[r]>="0"&&t[r]<="9";)i+=t[r],r+=1;if(r<t.length&&("e"===t[r]||"E"===t[r]))for(i+=t[r],(r+=1)<t.length&&("+"===t[r]||"-"===t[r])&&(i+=t[r],r+=1);r<t.length&&t[r]>="0"&&t[r]<="9";)i+=t[r],r+=1;if("-"===i)return -0;let n=Number.parseFloat(i);if(Number.isNaN(n))throw r=e,Error(`Invalid number '${i}' at position ${e}`);return n}throw Error(`Unexpected character '${a}' at position ${r}`)}();if(i(),r<t.length)throw Error(`Unexpected character '${t[r]}' at position ${r}`);return a}(e)}catch{return null}}function nq(e){switch(e){case"csv":return"text/csv";case"doc":case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"html":return"text/html";case"md":return"text/markdown";case"pdf":return"application/pdf";case"txt":return"text/plain";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"gif":return"image/gif";case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";case"flv":return"video/flv";case"mkv":return"video/mkv";case"mov":return"video/mov";case"mp4":return"video/mp4";case"mpeg":return"video/mpeg";case"mpg":return"video/mpg";case"three_gp":return"video/three_gp";case"webm":return"video/webm";case"wmv":return"video/wmv";default:return"application/octet-stream"}}function nW(e){return Array.from(function*(){for(let t of"string"==typeof e.content?[{type:"text",text:e.content}]:e.content){if(iV(t,"cache_point")){yield{type:"non_standard",value:t};continue}if(iV(t,"citations_content")&&iK(t.citationsContent)){let e=iX(t.citationsContent.content)?t.citationsContent.content.reduce((e,t)=>iK(t)&&iY(t.text)?e+t.text:e,""):"",r=iX(t.citationsContent.citations)?t.citationsContent.citations.reduce((e,t)=>{if(iK(t)){let r=iX(t.sourceContent)?t.sourceContent.reduce((e,t)=>iK(t)&&iY(t.text)?e+t.text:e,""):"",i=i4(()=>{if(iK(t.location)){let e=t.location.documentChar||t.location.documentPage||t.location.documentChunk;if(iK(e))return{source:iQ(e.documentIndex)?e.documentIndex.toString():void 0,startIndex:iQ(e.start)?e.start:void 0,endIndex:iQ(e.end)?e.end:void 0}}return{}});e.push({type:"citation",citedText:r,...i})}return e},[]):[];yield{type:"text",text:e,annotations:r};continue}if(iV(t,"document")&&iK(t.document)){yield function(e){if(iK(e.document)&&iK(e.document.source)){let t=nq(iK(e.document)&&iY(e.document.format)?e.document.format:"");if(iK(e.document.source)){if(iK(e.document.source.s3Location)&&iY(e.document.source.s3Location.uri))return{type:"file",mimeType:t,fileId:e.document.source.s3Location.uri};if(i0(e.document.source.bytes))return{type:"file",mimeType:t,data:e.document.source.bytes};if(iY(e.document.source.text))return{type:"file",mimeType:t,data:Buffer.from(e.document.source.text).toString("base64")};if(iX(e.document.source.content))return{type:"file",mimeType:t,data:e.document.source.content.reduce((e,t)=>iK(t)&&iY(t.text)?e+t.text:e,"")}}}return{type:"non_standard",value:e}}(t);continue}else if(iV(t,"guard_content")){yield{type:"non_standard",value:t};continue}else if(iV(t,"image")&&iK(t.image)){yield function(e){if(iV(e,"image")&&iK(e.image)){let t=nq(iK(e.image)&&iY(e.image.format)?e.image.format:"");if(iK(e.image.source)){if(iK(e.image.source.s3Location)&&iY(e.image.source.s3Location.uri))return{type:"image",mimeType:t,fileId:e.image.source.s3Location.uri};if(i0(e.image.source.bytes))return{type:"image",mimeType:t,data:e.image.source.bytes}}}return{type:"non_standard",value:e}}(t);continue}else if(iV(t,"reasoning_content")&&iY(t.reasoningText)){yield{type:"reasoning",reasoning:t.reasoningText};continue}else if(iV(t,"text")&&iY(t.text)){yield{type:"text",text:t.text};continue}else if(iV(t,"tool_result")){yield{type:"non_standard",value:t};continue}else if(iV(t,"tool_call"))continue;else if(iV(t,"video")&&iK(t.video)){yield function(e){if(iV(e,"video")&&iK(e.video)){let t=nq(iK(e.video)&&iY(e.video.format)?e.video.format:"");if(iK(e.video.source)){if(iK(e.video.source.s3Location)&&iY(e.video.source.s3Location.uri))return{type:"video",mimeType:t,fileId:e.video.source.s3Location.uri};if(i0(e.video.source.bytes))return{type:"video",mimeType:t,data:e.video.source.bytes}}}return{type:"non_standard",value:e}}(t);continue}yield{type:"non_standard",value:t}}}())}function nJ(e){return Array.from(function*(){for(let t of"string"==typeof e.content?[{type:"text",text:e.content}]:e.content){if(iV(t,"text")&&iY(t.text)){yield{type:"text",text:t.text};continue}if(iV(t,"inlineData")&&iK(t.inlineData)&&iY(t.inlineData.mimeType)&&iY(t.inlineData.data)){yield{type:"file",mimeType:t.inlineData.mimeType,data:t.inlineData.data};continue}if(iV(t,"functionCall")&&iK(t.functionCall)&&iY(t.functionCall.name)&&iK(t.functionCall.args)){yield{type:"tool_call",id:e.id,name:t.functionCall.name,args:t.functionCall.args};continue}else if(iV(t,"functionResponse")){yield{type:"non_standard",value:t};continue}else if(iV(t,"fileData")&&iK(t.fileData)&&iY(t.fileData.mimeType)&&iY(t.fileData.fileUri)){yield{type:"file",mimeType:t.fileData.mimeType,fileId:t.fileData.fileUri};continue}else if(iV(t,"executableCode")){yield{type:"non_standard",value:t};continue}else if(iV(t,"codeExecutionResult")){yield{type:"non_standard",value:t};continue}yield{type:"non_standard",value:t}}}())}function nG(e){return Array.from(function*(){let t="string"==typeof e.content?[{type:"text",text:e.content}]:e.content;for(let r of t){if(iV(r,"reasoning")&&iY(r.reasoning)){let i=i4(()=>{let i=t.indexOf(r);if(iX(e.additional_kwargs?.signatures)&&i>=0)return e.additional_kwargs.signatures.at(i)});iY(i)?yield{type:"reasoning",reasoning:r.reasoning,signature:i}:yield{type:"reasoning",reasoning:r.reasoning};continue}if(iV(r,"text")&&iY(r.text)){yield{type:"text",text:r.text};continue}if(iV(r,"image_url")){if(iY(r.image_url))if(r.image_url.startsWith("data:")){let e=/^data:([^;]+);base64,(.+)$/,t=r.image_url.match(e);t?yield{type:"image",data:t[2],mimeType:t[1]}:yield{type:"image",url:r.image_url}}else yield{type:"image",url:r.image_url};continue}else if(iV(r,"media")&&iY(r.mimeType)&&iY(r.data)){yield{type:"file",mimeType:r.mimeType,data:r.data};continue}yield{type:"non_standard",value:r}}}())}function nH(e){return globalThis.lc_block_translators_registry.get(e)}e.s(["AIMessage",()=>nV,"AIMessageChunk",()=>nY,"isAIMessage",()=>nK,"isAIMessageChunk",()=>nX],49835),globalThis.lc_block_translators_registry??=new Map([["anthropic",{translateContent:i9,translateContentChunk:i9}],["bedrock-converse",{translateContent:nW,translateContentChunk:nW}],["google-genai",{translateContent:nJ,translateContentChunk:nJ}],["google-vertexai",{translateContent:nG,translateContentChunk:nG}],["openai",{translateContent:e=>{if("string"==typeof e.content){let t=[];for(let r of("string"==typeof e.content?t.push({type:"text",text:e.content}):t.push(...i8(e.content)),e.tool_calls??[]))t.push({type:"tool_call",id:r.id,name:r.name,args:r.args});return t}return ne(e)},translateContentChunk:e=>{if("string"==typeof e.content){let t=[];for(let r of("string"==typeof e.content?t.push({type:"text",text:e.content}):t.push(...i8(e.content)),e.tool_calls??[]))t.push({type:"tool_call",id:r.id,name:r.name,args:r.args});return t}return Array.from(function*(){for(let t of(yield*ne(e),e.tool_call_chunks??[]))yield{type:"tool_call_chunk",id:t.id,name:t.name,args:t.args}}())}}]]);var nV=class extends nn{type="ai";tool_calls=[];invalid_tool_calls=[];usage_metadata;get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e){let t;if("string"==typeof e||Array.isArray(e))t={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:{}};else{t=e;const r=t.additional_kwargs?.tool_calls,i=t.tool_calls;null!=r&&r.length>0&&(void 0===i||0===i.length)&&console.warn("New LangChain packages are available that more efficiently handle tool calling.\n\nPlease upgrade your packages to versions that set message tool calls. e.g., `pnpm install @langchain/anthropic`, pnpm install @langchain/openai`, etc.");try{if(null!=r&&void 0===i){const[e,i]=nv(r);t.tool_calls=e??[],t.invalid_tool_calls=i??[]}else t.tool_calls=t.tool_calls??[],t.invalid_tool_calls=t.invalid_tool_calls??[]}catch{t.tool_calls=[],t.invalid_tool_calls=[]}if(void 0!==t.response_metadata&&"output_version"in t.response_metadata&&"v1"===t.response_metadata.output_version&&(t.contentBlocks=t.content,t.content=void 0),void 0!==t.contentBlocks){t.contentBlocks.push(...t.tool_calls.map(e=>({type:"tool_call",id:e.id,name:e.name,args:e.args})));const e=t.contentBlocks.filter(e=>"tool_call"===e.type).filter(e=>!t.tool_calls?.some(t=>t.id===e.id&&t.name===e.name));e.length>0&&(t.tool_calls=e.map(e=>({type:"tool_call",id:e.id,name:e.name,args:e.args})))}}super(t),"string"!=typeof t&&(this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=t.usage_metadata}static lc_name(){return"AIMessage"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&"v1"===this.response_metadata.output_version)return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&"string"==typeof this.response_metadata.model_provider){let e=nH(this.response_metadata.model_provider);if(e)return e.translateContent(this)}let e=super.contentBlocks;if(this.tool_calls){let t=this.tool_calls.filter(t=>!e.some(e=>e.id===t.id&&e.name===t.name));e.push(...t.map(e=>({...e,type:"tool_call",id:e.id,name:e.name,args:e.args})))}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}static isInstance(e){return super.isInstance(e)&&"ai"===e.type}};function nK(e){return"ai"===e._getType()}function nX(e){return"ai"===e._getType()}var nY=class extends nu{type="ai";tool_calls=[];invalid_tool_calls=[];tool_call_chunks=[];usage_metadata;constructor(e){let t;super(t="string"==typeof e||Array.isArray(e)?{content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]}:void 0===e.tool_call_chunks||0===e.tool_call_chunks.length?{...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0}:{...e,...n8(e.tool_call_chunks??[]),usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&"v1"===this.response_metadata.output_version)return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&"string"==typeof this.response_metadata.model_provider){let e=nH(this.response_metadata.model_provider);if(e)return e.translateContent(this)}let e=super.contentBlocks;if(this.tool_calls&&"string"!=typeof this.content){let t=this.content.filter(e=>"tool_call"===e.type).map(e=>e.id);for(let r of this.tool_calls)r.id&&!t.includes(r.id)&&e.push({...r,type:"tool_call",id:r.id,name:r.name,args:r.args})}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let t={content:nr(this.content,e.content),additional_kwargs:ns(this.additional_kwargs,e.additional_kwargs),response_metadata:nh(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){let r=no(this.tool_call_chunks,e.tool_call_chunks);void 0!==r&&r.length>0&&(t.tool_call_chunks=r)}return(void 0!==this.usage_metadata||void 0!==e.usage_metadata)&&(t.usage_metadata=nf(this.usage_metadata,e.usage_metadata)),new this.constructor(t)}static isInstance(e){return super.isInstance(e)&&"ai"===e.type}};let nQ=e=>e();function n0(e){return nD(e)?e:"string"==typeof e.id&&"function"===e.type&&"object"==typeof e.function&&null!==e.function&&"arguments"in e.function&&"string"==typeof e.function.arguments&&"name"in e.function&&"string"==typeof e.function.name?{id:e.id,args:JSON.parse(e.function.arguments),name:e.function.name,type:"tool_call"}:e}function n1(e){let t,r;if("object"==typeof e&&null!=e&&1===e.lc&&Array.isArray(e.id)&&null!=e.kwargs&&"object"==typeof e.kwargs){let i=e.id.at(-1);t="HumanMessage"===i||"HumanMessageChunk"===i?"user":"AIMessage"===i||"AIMessageChunk"===i?"assistant":"SystemMessage"===i||"SystemMessageChunk"===i?"system":"FunctionMessage"===i||"FunctionMessageChunk"===i?"function":"ToolMessage"===i||"ToolMessageChunk"===i?"tool":"unknown",r=e.kwargs}else{let{type:i,...n}=e;t=i,r=n}if("human"===t||"user"===t)return new nA(r);if("ai"===t||"assistant"===t){let{tool_calls:e,...t}=r;if(!Array.isArray(e))return new nV(r);let i=e.map(n0);return new nV({...t,tool_calls:i})}if("system"===t)return new nR(r);if("developer"===t)return new nR({...r,additional_kwargs:{...r.additional_kwargs,__openai_role__:"developer"}});if("tool"===t&&"tool_call_id"in r)return new ny({...r,content:r.content,tool_call_id:r.tool_call_id,name:r.name});if("remove"===t&&"id"in r&&"string"==typeof r.id)return new nj({...r,id:r.id});throw nM(Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(e,null,2)}`),"MESSAGE_COERCION_FAILURE")}function n4(e){if("string"==typeof e)return new nA(e);if(nd(e))return e;if(Array.isArray(e)){let[t,r]=e;return n1({type:t,content:r})}if(!nc(e))return n1(e);{let{role:t,...r}=e;return n1({...r,type:t})}}function n2(e,t="Human",r="AI"){let i=[];for(let n of e){let e;if("human"===n._getType())e=t;else if("ai"===n._getType())e=r;else if("system"===n._getType())e="System";else if("tool"===n._getType())e="Tool";else if("generic"===n._getType())e=n.role;else throw Error(`Got unsupported message type: ${n._getType()}`);let a=n.name?`${n.name}, `:"",s="string"==typeof n.content?n.content:JSON.stringify(n.content,null,2);i.push(`${e}: ${a}${s}`)}return i.join("\n")}function n6(e){let t=void 0!==e.data?e:{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}};switch(t.type){case"human":return new nA(t.data);case"ai":return new nV(t.data);case"system":return new nR(t.data);case"function":if(void 0===t.data.name)throw Error("Name must be defined for function messages");return new nO(t.data);case"tool":if(void 0===t.data.tool_call_id)throw Error("Tool call ID must be defined for tool messages");return new ny(t.data);case"generic":if(void 0===t.data.role)throw Error("Role must be defined for chat messages");return new n$(t.data);default:throw Error(`Got unexpected type: ${t.type}`)}}function n9(e){return e.map(n6)}function n5(e){return e.map(e=>e.toDict())}function n3(e){let t=e._getType();if("human"===t)return new nN({...e});if("ai"===t){let t={...e};return"tool_calls"in t&&(t={...t,tool_call_chunks:t.tool_calls?.map(e=>({...e,type:"tool_call_chunk",index:void 0,args:JSON.stringify(e.args)}))}),new nY({...t})}if("system"===t)return new nL({...e});if("function"===t)return new nS({...e});if(n$.isInstance(e))return new nx({...e});else throw Error("Unknown message type.")}function n8(e){let t=e.reduce((e,t)=>{let r=e.findIndex(([e])=>"id"in t&&t.id&&"index"in t&&void 0!==t.index?t.id===e.id&&t.index===e.index:"id"in t&&t.id?t.id===e.id:"index"in t&&void 0!==t.index&&t.index===e.index);return -1!==r?e[r].push(t):e.push([t]),e},[]),r=[],i=[];for(let e of t){let t=null,n=e[0]?.name??"",a=e.map(e=>e.args||"").join("").trim(),s=a.length?a:"{}",o=e[0]?.id;try{if(t=nB(s),!o||null===t||"object"!=typeof t||Array.isArray(t))throw Error("Malformed tool call chunk args.");r.push({name:n,args:t,id:o,type:"tool_call"})}catch{i.push({name:n,args:s,id:o,error:"Malformed args.",type:"invalid_tool_call"})}}return{tool_call_chunks:e,tool_calls:r,invalid_tool_calls:i}}let n7=Object.prototype.toString,ae=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function at(e,t,{min:r=0,allowInfinity:i=!1}={}){if(void 0!==t){if("number"!=typeof t||Number.isNaN(t))throw TypeError(`Expected \`${e}\` to be a number${i?" or Infinity":""}.`);if(!i&&!Number.isFinite(t))throw TypeError(`Expected \`${e}\` to be a finite number.`);if(t<r)throw TypeError(`Expected \`${e}\` to be \u2265 ${r}.`)}}var ar=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}};function ai(e,t){return Number.isFinite(t)?t-(performance.now()-e):t}async function an({error:e,attemptNumber:t,retriesConsumed:r,startTime:i,options:n}){let a,s=e instanceof Error?e:TypeError(`Non-error was thrown: "${e}". You should only throw errors.`);if(s instanceof ar)throw s.originalError;let o=Number.isFinite(n.retries)?Math.max(0,n.retries-r):n.retries,l=n.maxRetryTime??1/0,u=Object.freeze({error:s,attemptNumber:t,retriesLeft:o,retriesConsumed:r});if(await n.onFailedAttempt(u),0>=ai(i,l))throw s;let c=await n.shouldConsumeRetry(u),d=ai(i,l);if(d<=0||o<=0)throw s;if(s instanceof TypeError&&!function(e){if(!(e&&"[object Error]"===n7.call(e)&&"TypeError"===e.name&&"string"==typeof e.message))return!1;let{message:t,stack:r}=e;return"Load failed"===t?void 0===r||"__sentry_captured__"in e:!!t.startsWith("error sending request for url")||ae.has(t)}(s)){if(c)throw s;return n.signal?.throwIfAborted(),!1}if(!await n.shouldRetry(u))throw s;if(!c)return n.signal?.throwIfAborted(),!1;let p=Math.min((a=Math.max(1,r+1),Math.min(Math.round((n.randomize?Math.random()+1:1)*n.minTimeout*n.factor**(a-1)),n.maxTimeout)),d);return p>0&&await new Promise((e,t)=>{let r=()=>{clearTimeout(i),n.signal?.removeEventListener("abort",r),t(n.signal.reason)},i=setTimeout(()=>{n.signal?.removeEventListener("abort",r),e()},p);n.unref&&i.unref?.(),n.signal?.addEventListener("abort",r,{once:!0})}),n.signal?.throwIfAborted(),!0}async function aa(e,t={}){var r=(t={...t}).retries;if("number"==typeof r){if(r<0)throw TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(r))throw TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(void 0!==r)throw TypeError("Expected `retries` to be a number or Infinity.");if(Object.hasOwn(t,"forever"))throw Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");t.retries??=10,t.factor??=2,t.minTimeout??=1e3,t.maxTimeout??=1/0,t.maxRetryTime??=1/0,t.randomize??=!1,t.onFailedAttempt??=()=>{},t.shouldRetry??=()=>!0,t.shouldConsumeRetry??=()=>!0,at("factor",t.factor,{min:0,allowInfinity:!1}),at("minTimeout",t.minTimeout,{min:0,allowInfinity:!1}),at("maxTimeout",t.maxTimeout,{min:0,allowInfinity:!0}),at("maxRetryTime",t.maxRetryTime,{min:0,allowInfinity:!0}),t.factor>0||(t.factor=1),t.signal?.throwIfAborted();let i=0,n=0,a=performance.now();for(;!Number.isFinite(t.retries)||n<=t.retries;){i++;try{t.signal?.throwIfAborted();let r=await e(i);return t.signal?.throwIfAborted(),r}catch(e){await an({error:e,attemptNumber:i,retriesConsumed:n,startTime:a,options:t})&&n++}}throw Error("Retry attempts exhausted without throwing an error.")}let as=Symbol.for("ls:tracing_async_local_storage"),ao=Symbol.for("lc:context_variables"),al=()=>globalThis[as];iP({},{getEnv:()=>am,getEnvironmentVariable:()=>ag,getRuntimeEnvironment:()=>af,isBrowser:()=>au,isDeno:()=>ap,isJsDom:()=>ad,isNode:()=>ah,isWebWorker:()=>ac});let au=()=>!1,ac=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,ad=()=>"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom"),ap=()=>"undefined"!=typeof Deno,ah=()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node&&!ap(),am=()=>au()?"browser":ah()?"node":ac()?"webworker":ad()?"jsdom":ap()?"deno":"other";function af(){return void 0===a&&(a={library:"langchain-js",runtime:am()}),a}function ag(e){try{if("undefined"!=typeof process)return process.env?.[e];if(ap())return Deno?.env.get(e);return}catch{return}}var ay=e.i(29674);e.s(["v4",()=>ay.default],59952);var ay=ay;iP({},{BaseCallbackHandler:()=>ab,callbackHandlerPrefersStreaming:()=>av,isBaseCallbackHandler:()=>aw});var a_=class{};function av(e){return"lc_prefer_streaming"in e&&e.lc_prefer_streaming}var ab=class extends a_{lc_serializable=!1;get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,iG(this.constructor)]}lc_kwargs;ignoreLLM=!1;ignoreChain=!1;ignoreAgent=!1;ignoreRetriever=!1;ignoreCustomEvent=!1;raiseError=!1;awaitHandlers="false"===ag("LANGCHAIN_CALLBACKS_BACKGROUND");constructor(e){super(),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return iH.prototype.toJSON.call(this)}toJSONNotImplemented(){return iH.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends ab{name=ay.default();constructor(){super(),Object.assign(this,e)}}return new t}};let aw=e=>void 0!==e&&"function"==typeof e.copy&&"string"==typeof e.name&&"boolean"==typeof e.awaitHandlers;var ay=ay;let a$="gen_ai.request.model",ax="gen_ai.usage.input_tokens",ak="gen_ai.usage.output_tokens",aI="gen_ai.usage.total_tokens",aO="langsmith.span.tags";e.s(["__version__",()=>aj],49753);let aS=Symbol.for("ls:fetch_implementation"),aE=()=>aM("PROJECT")??az("LANGCHAIN_SESSION")??"default";var aT=e.i(84630),aT=aT,aT=aT;let aA={};function aN(e){aA[e]||(console.warn(e),aA[e]=!0)}let aC=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function aP(e,t){if(!aC.test(e))throw Error(void 0!==t?`Invalid UUID for ${t}: ${e}`:`Invalid UUID: ${e}`);return e}let aj="0.3.82",aR=()=>s||(s="undefined"!=typeof Bun?"bun":"undefined"==typeof process||void 0===process.versions||void 0===process.versions.node||"undefined"!=typeof Deno?"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name?"webworker":"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom")?"jsdom":"undefined"!=typeof Deno?"deno":"other":"node");function aL(){return void 0===o&&(o={library:"langsmith",runtime:aR(),sdk:"langsmith-js",sdk_version:aj,...function(){if(void 0!==l)return l;let e={};for(let t of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let r=az(t);void 0!==r&&(e[t]=r)}return l=e,e}()}),o}function aU(){let e=function(){let e={};try{if("undefined"!=typeof process&&process.env)for(let[t,r]of Object.entries(process.env))(t.startsWith("LANGCHAIN_")||t.startsWith("LANGSMITH_"))&&null!=r&&((t.toLowerCase().includes("key")||t.toLowerCase().includes("secret")||t.toLowerCase().includes("token"))&&"string"==typeof r?e[t]=r.slice(0,2)+"*".repeat(r.length-4)+r.slice(-2):e[t]=r)}catch(e){}return e}(),t={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[i,n]of Object.entries(e))"string"!=typeof n||r.includes(i)||i.toLowerCase().includes("key")||i.toLowerCase().includes("secret")||i.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===i?t.revision_id=n:t[i]=n);return t}function az(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}function aM(e){return az(`LANGSMITH_${e}`)||az(`LANGCHAIN_${e}`)}function aD(){return"true"===az("OTEL_ENABLED")||"true"===aM("OTEL_ENABLED")}class aZ{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){let r;if(!this.hasWarned&&aD()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0),1===t.length&&"function"==typeof t[0]?r=t[0]:2===t.length&&"function"==typeof t[1]?r=t[1]:3===t.length&&"function"==typeof t[2]&&(r=t[2]),"function"==typeof r)return r()}}let aF=Symbol.for("ls:otel_trace"),aB=Symbol.for("ls:otel_context"),aq=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),aW=new class{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new aZ})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}},aJ=new class{active(){return{}}with(e,t){return t()}},aG=new class{getTraceInstance(){return globalThis[aF]??aW}getContextInstance(){return globalThis[aB]??aJ}initializeGlobalInstances(e){void 0===globalThis[aF]&&(globalThis[aF]=e.trace),void 0===globalThis[aB]&&(globalThis[aB]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[aq]=e}getDefaultOTLPTracerComponents(){return globalThis[aq]??void 0}};function aH(){return aG.getTraceInstance()}let aV={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};class aK{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(let r of e)try{if(!r.run)continue;if("post"===r.operation){let e=this.createSpanForRun(r,r.run,t.get(r.id));e&&!r.run.end_time&&this.spans.set(r.id,e)}else this.updateSpanForRun(r,r.run)}catch(e){console.error(`Error processing operation ${r.id}:`,e)}}createSpanForRun(e,t,r){let i=r&&aH().getSpan(r);if(i)try{return this.finishSpanSetup(i,t,e)}catch(t){console.error(`Failed to create span for run ${e.id}:`,t);return}}finishSpanSetup(e,t,r){return this.setSpanAttributes(e,t,r),t.error?(e.setStatus({code:2}),e.recordException(Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{let r=this.spans.get(e.id);if(!r)return void console.debug(`No span found for run ${e.id} during update`);this.setSpanAttributes(r,t,e),t.error?(r.setStatus({code:2}),r.recordException(Error(t.error))):r.setStatus({code:1});let i=t.end_time;i&&(r.end(new Date(i)),this.spans.delete(e.id))}catch(t){console.error(`Failed to update span for run ${e.id}:`,t)}}extractModelName(e){if(e.extra?.metadata){let t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){let e=t.invocation_params;if(e.model)return e.model;if(e.model_name)return e.model_name}}}setSpanAttributes(e,t,r){if("run_type"in t&&t.run_type){var i;e.setAttribute("langsmith.span.kind",t.run_type);let r=aV[i=t.run_type||"chain"]||i;e.setAttribute("gen_ai.operation.name",r)}"name"in t&&t.name&&e.setAttribute("langsmith.trace.name",t.name),"session_id"in t&&t.session_id&&e.setAttribute("langsmith.trace.session_id",t.session_id),"session_name"in t&&t.session_name&&e.setAttribute("langsmith.trace.session_name",t.session_name),this.setGenAiSystem(e,t);let n=this.extractModelName(t);for(let[r,i]of(n&&e.setAttribute(a$,n),"prompt_tokens"in t&&"number"==typeof t.prompt_tokens&&e.setAttribute(ax,t.prompt_tokens),"completion_tokens"in t&&"number"==typeof t.completion_tokens&&e.setAttribute(ak,t.completion_tokens),"total_tokens"in t&&"number"==typeof t.total_tokens&&e.setAttribute(aI,t.total_tokens),this.setInvocationParameters(e,t),Object.entries(t.extra?.metadata||{})))null!=i&&e.setAttribute(`langsmith.metadata.${r}`,String(i));let a=t.tags;if(a&&Array.isArray(a)?e.setAttribute(aO,a.join(", ")):a&&e.setAttribute(aO,String(a)),"serialized"in t&&"object"==typeof t.serialized){let r=t.serialized;r.name&&e.setAttribute("gen_ai.serialized.name",String(r.name)),r.signature&&e.setAttribute("gen_ai.serialized.signature",String(r.signature)),r.doc&&e.setAttribute("gen_ai.serialized.doc",String(r.doc))}this.setIOAttributes(e,r)}setGenAiSystem(e,t){let r="langchain",i=this.extractModelName(t);if(i){let e=i.toLowerCase();e.includes("anthropic")||e.startsWith("claude")?r="anthropic":e.includes("bedrock")?r="aws.bedrock":e.includes("azure")&&e.includes("openai")?r="az.ai.openai":e.includes("azure")&&e.includes("inference")?r="az.ai.inference":e.includes("cohere")?r="cohere":e.includes("deepseek")?r="deepseek":e.includes("gemini")?r="gemini":e.includes("groq")?r="groq":e.includes("watson")||e.includes("ibm")?r="ibm.watsonx.ai":e.includes("mistral")?r="mistral_ai":e.includes("gpt")||e.includes("openai")?r="openai":e.includes("perplexity")||e.includes("sonar")?r="perplexity":e.includes("vertex")?r="vertex_ai":(e.includes("xai")||e.includes("grok"))&&(r="xai")}e.setAttribute("gen_ai.system",r)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;let r=t.extra.metadata.invocation_params;void 0!==r.max_tokens&&e.setAttribute("gen_ai.request.max_tokens",r.max_tokens),void 0!==r.temperature&&e.setAttribute("gen_ai.request.temperature",r.temperature),void 0!==r.top_p&&e.setAttribute("gen_ai.request.top_p",r.top_p),void 0!==r.frequency_penalty&&e.setAttribute("gen_ai.request.frequency_penalty",r.frequency_penalty),void 0!==r.presence_penalty&&e.setAttribute("gen_ai.request.presence_penalty",r.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{let r=t.run.inputs;"object"==typeof r&&null!==r&&(r.model&&Array.isArray(r.messages)&&e.setAttribute(a$,r.model),void 0!==r.stream&&e.setAttribute("langsmith.request.streaming",r.stream),r.extra_headers&&e.setAttribute("langsmith.request.headers",JSON.stringify(r.extra_headers)),r.extra_query&&e.setAttribute("gen_ai.request.extra_query",JSON.stringify(r.extra_query)),r.extra_body&&e.setAttribute("gen_ai.request.extra_body",JSON.stringify(r.extra_body))),e.setAttribute("gen_ai.prompt",JSON.stringify(r))}catch(e){console.debug(`Failed to process inputs for run ${t.id}`,e)}if(t.run.outputs)try{let r=t.run.outputs,i=this.getUnifiedRunTokens(r);if(i&&(e.setAttribute(ax,i[0]),e.setAttribute(ak,i[1]),e.setAttribute(aI,i[0]+i[1])),r&&"object"==typeof r){if(r.model&&e.setAttribute("gen_ai.response.model",String(r.model)),r.id&&e.setAttribute("gen_ai.response.id",r.id),r.choices&&Array.isArray(r.choices)){let t=r.choices.map(e=>e.finish_reason).filter(e=>e).map(String);t.length>0&&e.setAttribute("gen_ai.response.finish_reasons",t.join(", "))}if(r.service_tier&&e.setAttribute("gen_ai.response.service_tier",r.service_tier),r.system_fingerprint&&e.setAttribute("gen_ai.response.system_fingerprint",r.system_fingerprint),r.usage_metadata&&"object"==typeof r.usage_metadata){let t=r.usage_metadata;t.input_token_details&&e.setAttribute("gen_ai.usage.input_token_details",JSON.stringify(t.input_token_details)),t.output_token_details&&e.setAttribute("gen_ai.usage.output_token_details",JSON.stringify(t.output_token_details))}}e.setAttribute("gen_ai.completion",JSON.stringify(r))}catch(e){console.debug(`Failed to process outputs for run ${t.id}`,e)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;for(let r of Object.keys(e)){let i=e[r];if(i&&"object"==typeof i&&((t=this.extractUnifiedRunTokens(i.usage_metadata))||1===i.lc&&i.kwargs&&"object"==typeof i.kwargs&&(t=this.extractUnifiedRunTokens(i.kwargs.usage_metadata))))return t}let r=e.generations||[];if(!Array.isArray(r))return null;for(let e of Array.isArray(r[0])?r.flat():r)if("object"==typeof e&&e.message&&"object"==typeof e.message&&e.message.kwargs&&"object"==typeof e.message.kwargs&&(t=this.extractUnifiedRunTokens(e.message.kwargs.usage_metadata)))return t;return null}extractUnifiedRunTokens(e){return e&&"object"==typeof e&&"number"==typeof e.input_tokens&&"number"==typeof e.output_tokens?[e.input_tokens,e.output_tokens]:null}}let aX=Object.prototype.toString,aY=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function aQ(e,t,{min:r=0,allowInfinity:i=!1}={}){if(void 0!==t){if("number"!=typeof t||Number.isNaN(t))throw TypeError(`Expected \`${e}\` to be a number${i?" or Infinity":""}.`);if(!i&&!Number.isFinite(t))throw TypeError(`Expected \`${e}\` to be a finite number.`);if(t<r)throw TypeError(`Expected \`${e}\` to be \u2265 ${r}.`)}}class a0 extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}function a1(e,t){return Number.isFinite(t)?t-(performance.now()-e):t}async function a4({error:e,attemptNumber:t,retriesConsumed:r,startTime:i,options:n}){let a,s=e instanceof Error?e:TypeError(`Non-error was thrown: "${e}". You should only throw errors.`);if(s instanceof a0)throw s.originalError;let o=Number.isFinite(n.retries)?Math.max(0,n.retries-r):n.retries,l=n.maxRetryTime??1/0,u=Object.freeze({error:s,attemptNumber:t,retriesLeft:o,retriesConsumed:r});if(await n.onFailedAttempt(u),0>=a1(i,l))throw s;let c=await n.shouldConsumeRetry(u),d=a1(i,l);if(d<=0||o<=0)throw s;if(s instanceof TypeError&&!function(e){if(!(e&&"[object Error]"===aX.call(e)&&"TypeError"===e.name&&"string"==typeof e.message))return!1;let{message:t,stack:r}=e;return"Load failed"===t?void 0===r||"__sentry_captured__"in e:!!t.startsWith("error sending request for url")||aY.has(t)}(s)){if(c)throw s;return n.signal?.throwIfAborted(),!1}if(!await n.shouldRetry(u))throw s;if(!c)return n.signal?.throwIfAborted(),!1;let p=Math.min((a=Math.max(1,r+1),Math.min(Math.round((n.randomize?Math.random()+1:1)*n.minTimeout*n.factor**(a-1)),n.maxTimeout)),d);return p>0&&await new Promise((e,t)=>{let r=()=>{clearTimeout(i),n.signal?.removeEventListener("abort",r),t(n.signal.reason)},i=setTimeout(()=>{n.signal?.removeEventListener("abort",r),e()},p);n.unref&&i.unref?.(),n.signal?.addEventListener("abort",r,{once:!0})}),n.signal?.throwIfAborted(),!0}async function a2(e,t={}){var r=(t={...t}).retries;if("number"==typeof r){if(r<0)throw TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(r))throw TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(void 0!==r)throw TypeError("Expected `retries` to be a number or Infinity.");if(Object.hasOwn(t,"forever"))throw Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");t.retries??=10,t.factor??=2,t.minTimeout??=1e3,t.maxTimeout??=1/0,t.maxRetryTime??=1/0,t.randomize??=!1,t.onFailedAttempt??=()=>{},t.shouldRetry??=()=>!0,t.shouldConsumeRetry??=()=>!0,aQ("factor",t.factor,{min:0,allowInfinity:!1}),aQ("minTimeout",t.minTimeout,{min:0,allowInfinity:!1}),aQ("maxTimeout",t.maxTimeout,{min:0,allowInfinity:!0}),aQ("maxRetryTime",t.maxRetryTime,{min:0,allowInfinity:!0}),t.factor>0||(t.factor=1),t.signal?.throwIfAborted();let i=0,n=0,a=performance.now();for(;!Number.isFinite(t.retries)||n<=t.retries;){i++;try{t.signal?.throwIfAborted();let r=await e(i);return t.signal?.throwIfAborted(),r}catch(e){await a4({error:e,attemptNumber:i,retriesConsumed:n,startTime:a,options:t})&&n++}}throw Error("Retry attempts exhausted without throwing an error.")}var a6=e.i(75482);let a9=[408,425,429,500,502,503,504];class a5{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxQueueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.maxQueueSizeBytes=e.maxQueueSizeBytes,"default"in a6.default?this.queue=new a6.default.default({concurrency:this.maxConcurrency}):this.queue=new a6.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){return this.callWithOptions({},e,...t)}callWithOptions(e,t,...r){let i=e.sizeBytes??0;if(void 0!==this.maxQueueSizeBytes&&i>0&&this.queueSizeBytes+i>this.maxQueueSizeBytes)return Promise.reject(Error(`Queue size limit (${this.maxQueueSizeBytes} bytes) exceeded. Current queue size: ${this.queueSizeBytes} bytes, attempted addition: ${i} bytes.`));i>0&&(this.queueSizeBytes+=i);let n=this.onFailedResponseHook,a=this.queue.add(()=>a2(()=>t(...r).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{async onFailedAttempt({error:e}){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||"TimeoutError"===e.name||e.message.startsWith("AbortError")||e?.code==="ECONNABORTED")throw e;let t=e?.response;if(n&&await n(t))return;let r=t?.status??e?.status;if(r&&!a9.includes(+r))throw e},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0});return(i>0&&(a=a.finally(()=>{this.queueSizeBytes-=i})),e.signal)?Promise.race([a,new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):a}}function a3(e){return"function"==typeof e?._getType}function a8(e){let t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}function a7(e){if(!e||e.split("/").length>2||e.startsWith("/")||e.endsWith("/")||e.split(":").length>2)throw Error(`Invalid identifier format: ${e}`);let[t,r]=e.split(":"),i=r||"latest";if(t.includes("/")){let[r,n]=t.split("/",2);if(!r||!n)throw Error(`Invalid identifier format: ${e}`);return[r,n,i]}if(!t)throw Error(`Invalid identifier format: ${e}`);return["-",t,i]}e.i(99136);class se extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function st(e,t,r){let i;if(e.ok){r&&(i=await e.text());return}if(403===e.status)try{let t=await e.json(),r=t?.error;"org_scoped_key_requires_workspace"===r&&(i="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch(r){let t=Error(`${e.status} ${e.statusText}`);throw t.status=e?.status,t}if(void 0===i)try{i=await e.text()}catch(e){i=""}let n=`Failed to ${t}. Received status [${e.status}]: ${e.statusText}. Message: ${i}`;if(409===e.status)throw new se(n);let a=Error(n);throw a.status=e.status,a}let sr="ERR_CONFLICTING_ENDPOINTS";class si extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:sr}),this.name="ConflictingEndpointsError"}}var sn={result:"[Circular]"},sa=[],ss=[];let so=new TextEncoder;function sl(e){return so.encode(e)}function su(e){if(e&&"object"==typeof e&&null!==e){if(e instanceof Map)return Object.fromEntries(e);else if(e instanceof Set)return Array.from(e);else if(e instanceof Date)return e.toISOString();else if(e instanceof RegExp)return e.toString();else if(e instanceof Error)return{name:e.name,message:e.message}}else if("bigint"==typeof e)return e.toString();return e}function sc(e,t,r,i,n){try{let t=JSON.stringify(e,function(e,t){if(r){let i=r.call(this,e,t);if(void 0!==i)return i}return su(t)},i);return sl(t)}catch(o){let s;if(!o.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${t?`
Context: ${t}`:""}`),sl("[Unserializable]");"true"!==aM("SUPPRESS_CIRCULAR_JSON_WARNINGS")&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${t?`
Context: ${t}`:""}`),void 0===n&&(n={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),function e(t,r,i,n,a,s,o){if(s+=1,"object"==typeof t&&null!==t){for(l=0;l<n.length;l++)if(n[l]===t)return void sd(sn,t,r,a);if(void 0!==o.depthLimit&&s>o.depthLimit||void 0!==o.edgesLimit&&i+1>o.edgesLimit)return void sd("[...]",t,r,a);if(n.push(t),Array.isArray(t))for(l=0;l<t.length;l++)e(t[l],l,l,n,t,s,o);else{var l,u=Object.keys(t=su(t));for(l=0;l<u.length;l++){var c=u[l];e(t[c],c,l,n,t,s,o)}}n.pop()}}(e,"",0,[],void 0,0,n);try{var a;s=0===ss.length?JSON.stringify(e,r,i):JSON.stringify(e,(a=r,a=void 0!==a?a:function(e,t){return t},function(e,t){if(ss.length>0)for(var r=0;r<ss.length;r++){var i=ss[r];if(i[1]===e&&i[0]===t){t=i[2],ss.splice(r,1);break}}return a.call(this,e,t)}),i)}catch(e){return sl("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==sa.length;){let e=sa.pop();4===e.length?Object.defineProperty(e[0],e[1],e[3]):e[0][e[1]]=e[2]}}return sl(s)}}function sd(e,t,r,i){var n=Object.getOwnPropertyDescriptor(i,r);void 0!==n.get?n.configurable?(Object.defineProperty(i,r,{value:e}),sa.push([i,r,t,n])):ss.push([t,r,e]):(i[r]=e,sa.push([i,r,t]))}function sp(e,t){let r=aL(),i=t??aU(),n=e.extra??{},a=n.metadata;return e.extra={...n,runtime:{...r,...n?.runtime},metadata:{...i,...i.revision_id||"revision_id"in e&&e.revision_id?{revision_id:("revision_id"in e?e.revision_id:void 0)??i.revision_id}:{},...a}},e}async function sh(e){let t=[];for await(let r of e)t.push(r);return t}function sm(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}let sf=async e=>{if(e?.status===429){let t=1e3*parseInt(e.headers.get("retry-after")??"10",10);if(t>0)return await new Promise(e=>setTimeout(e,t)),!0}return!1};function sg(e){return"number"==typeof e?Number(e.toFixed(4)):e}let sy="https://api.smith.langchain.com";class s_{constructor(e){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"maxSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSizeBytes=e??0x40000000}peek(){return this.items[0]}push(e){let t,r=new Promise(e=>{t=e}),i=sc(e.item,`Serializing run with id: ${e.item.id}`).length;return this.sizeBytes+i>this.maxSizeBytes&&this.items.length>0?(console.warn(`AutoBatchQueue size limit (${this.maxSizeBytes} bytes) exceeded. Dropping run with id: ${e.item.id}. Current queue size: ${this.sizeBytes} bytes, attempted addition: ${i} bytes.`),t()):(this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:r,size:i}),this.sizeBytes+=i),r}pop({upToSizeBytes:e,upToSize:t}){if(e<1)throw Error("Number of bytes to pop off may not be less than 1.");let r=[],i=0;for(;i+(this.peek()?.size??0)<e&&this.items.length>0&&r.length<t;){let e=this.items.shift();e&&(r.push(e),i+=e.size,this.sizeBytes-=e.size)}if(0===r.length&&this.items.length>0){let e=this.items.shift();r.push(e),i+=e.size,this.sizeBytes-=e.size}return[r.map(e=>({action:e.action,item:e.payload,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,size:e.size})),()=>r.forEach(e=>e.itemPromiseResolve())]}}class sv{get _fetch(){let e;return this.fetchImplementation||(e=this.debug,async(...t)=>{if(e||"true"===aM("DEBUG")){let[e,r]=t;console.log(` ${r?.method||"GET"} ${e}`)}let r=await (globalThis[aS]??((...e)=>fetch(...e)))(...t);return(e||"true"===aM("DEBUG"))&&console.log(` ${r.status} ${r.statusText} ${r.url}`),r})}constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:"false"===az("LANGSMITH_TRACING_BACKGROUND")}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedLSEnvVarsForMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:"true"===az("LANGSMITH_DEBUG")});const t=sv.getDefaultClientConfig();if(this.tracingSampleRate=(e=>{let t=e?.toString()??aM("TRACING_SAMPLING_RATE");if(void 0===t)return;let r=parseFloat(t);if(r<0||r>1)throw Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${r}`);return r})(e.tracingSamplingRate),this.apiUrl=sm(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=sm(e.apiKey??t.apiKey),this.webUrl=sm(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=sm(e.workspaceId??aM("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new a5({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation;const r=e.maxIngestMemoryBytes??0x40000000;this.batchIngestCaller=new a5({maxRetries:4,maxConcurrency:this.traceBatchConcurrency,maxQueueSizeBytes:r,...e.callerOptions??{},onFailedResponseHook:sf,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.autoBatchQueue=new s_(r),this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.batchSizeLimit=e.batchSizeLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,aD()&&(this.langSmithToOTELTranslator=new aK),this.cachedLSEnvVarsForMetadata=aU()}static getDefaultClientConfig(){let e=aM("API_KEY");return{apiUrl:aM("ENDPOINT")??sy,apiKey:e,webUrl:void 0,hideInputs:"true"===aM("HIDE_INPUTS"),hideOutputs:"true"===aM("HIDE_OUTPUTS")}}getHostUrl(){let e;if(this.webUrl)return this.webUrl;if("localhost"===(e=this.apiUrl.replace("http://","").replace("https://","").split("/")[0].split(":")[0])||"127.0.0.1"===e||"::1"===e)return this.webUrl="http://localhost:3000",this.webUrl;if(this.apiUrl.endsWith("/api/v1"))return this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl;if(this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api"))return this.webUrl=this.apiUrl.replace("/api",""),this.webUrl;if(this.apiUrl.split(".",1)[0].includes("dev"))return this.webUrl="https://dev.smith.langchain.com",this.webUrl;else if(this.apiUrl.split(".",1)[0].includes("eu"))return this.webUrl="https://eu.smith.langchain.com",this.webUrl;else if(this.apiUrl.split(".",1)[0].includes("beta"))return this.webUrl="https://beta.smith.langchain.com",this.webUrl;else return this.webUrl="https://smith.langchain.com",this.webUrl}get headers(){let e={"User-Agent":`langsmith-js/${aj}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return"/v1"!==this.apiUrl.slice(-3)&&"/v1/"!==this.apiUrl.slice(-4)?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}async processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){let t={...e};return void 0!==t.inputs&&(t.inputs=await this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",i=`${this.apiUrl}${e}?${r}`;return await this.caller.call(async()=>{let t=await this._fetch(i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(t,`fetch ${e}`),t})}async _get(e,t){return(await this._getResponse(e,t)).json()}async *_getPaginated(e,t=new URLSearchParams,r){let i=Number(t.get("offset"))||0,n=Number(t.get("limit"))||100;for(;;){t.set("offset",String(i)),t.set("limit",String(n));let a=`${this.apiUrl}${e}?${t}`,s=await this.caller.call(async()=>{let t=await this._fetch(a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(t,`fetch ${e}`),t}),o=r?r(await s.json()):await s.json();if(0===o.length||(yield o,o.length<n))break;i+=o.length}}async *_getCursorPaginatedList(e,t=null,r="POST",i="runs"){let n=t?{...t}:{};for(;;){let t=JSON.stringify(n),a=await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:t});return await st(i,`fetch ${e}`),i}),s=await a.json();if(!s||!s[i])break;yield s[i];let o=s.cursors;if(!o||!o.next)break;n.cursor=o.next}}_shouldSample(){return void 0===this.tracingSampleRate||Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){let t=[];for(let r of e)this.filteredPostUuids.has(r.trace_id)?r.id===r.trace_id&&this.filteredPostUuids.delete(r.trace_id):t.push(r);return t}{let t=[];for(let r of e){let e=r.trace_id??r.id;this.filteredPostUuids.has(e)||(r.id===e?this._shouldSample()?t.push(r):this.filteredPostUuids.add(e):t.push(r))}return t}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??0x1800000}async _getBatchSizeLimit(){let e=await this._ensureServerInfo();return this.batchSizeLimit??e.batch_ingest_config?.size_limit??100}async _getDatasetExamplesMultiPartSupport(){let e=await this._ensureServerInfo();return e.instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t}){let r=[];for(;this.autoBatchQueue.items.length>0;){let[i,n]=this.autoBatchQueue.pop({upToSizeBytes:e,upToSize:t});if(!i.length){n();break}let a=i.reduce((e,t)=>{let r=t.apiUrl??this.apiUrl,i=t.apiKey??this.apiKey,n=t.apiKey===this.apiKey&&t.apiUrl===this.apiUrl?"default":`${r}|${i}`;return e[n]||(e[n]=[]),e[n].push(t),e},{}),s=[];for(let[e,t]of Object.entries(a)){let r=this._processBatch(t,{apiUrl:"default"===e?void 0:e.split("|")[0],apiKey:"default"===e?void 0:e.split("|")[1]});s.push(r)}let o=Promise.all(s).finally(n);r.push(o)}return Promise.all(r)}async _processBatch(e,t){if(!e.length)return;let r=e.reduce((e,t)=>e+(t.size??0),0);try{if(void 0!==this.langSmithToOTELTranslator)this._sendBatchToOTELTranslator(e);else{let i={runCreates:e.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:e.filter(e=>"update"===e.action).map(e=>e.item)},n=await this._ensureServerInfo();if(n?.batch_ingest_config?.use_multipart_endpoint){let e=n?.instance_flags?.gzip_body_enabled;await this.multipartIngestRuns(i,{...t,useGzip:e,sizeBytes:r})}else await this.batchIngestRuns(i,{...t,sizeBytes:r})}}catch(e){console.error("Error exporting batch:",e)}}_sendBatchToOTELTranslator(e){if(void 0!==this.langSmithToOTELTranslator){let t=new Map,r=[];for(let i of e)i.item.id&&i.otelContext&&(t.set(i.item.id,i.otelContext),"create"===i.action?r.push({operation:"post",id:i.item.id,trace_id:i.item.trace_id??i.item.id,run:i.item}):r.push({operation:"patch",id:i.item.id,trace_id:i.item.trace_id??i.item.id,run:i.item}));this.langSmithToOTELTranslator.exportBatch(r,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=sp(e.item,this.cachedLSEnvVarsForMetadata);let t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;let r=await this._getBatchSizeLimitBytes(),i=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>r||this.autoBatchQueue.items.length>i)&&this.drainAutoBatchQueue({batchSizeLimitBytes:r,batchSizeLimit:i}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:r,batchSizeLimit:i})},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){let e=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4),...this.fetchOptions});return await st(e,"get server info"),e}),t=await e.json();return this.debug&&console.log("\n=== LangSmith Server Configuration ===\n"+JSON.stringify(t,null,2)+"\n"),t}async _ensureServerInfo(){return void 0===this._getServerInfoPromise&&(this._getServerInfoPromise=(async()=>{if(void 0===this._serverInfo)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(void 0===this._serverInfo&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let e=await this._getBatchSizeLimitBytes(),t=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t})}_cloneCurrentOTELContext(){let e=aH(),t=aG.getContextInstance();if(void 0!==this.langSmithToOTELTranslator){let r=e.getActiveSpan();if(r)return e.setSpan(t.active(),r)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;let r={...this.headers,"Content-Type":"application/json"},i=e.project_name;delete e.project_name;let n=await this.prepareRunCreateOrUpdateInputs({session_name:i,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==n.trace_id&&void 0!==n.dotted_order){let e=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:n,otelContext:e,apiKey:t?.apiKey,apiUrl:t?.apiUrl}).catch(console.error);return}let a=sp(n,this.cachedLSEnvVarsForMetadata);t?.apiKey!==void 0&&(r["x-api-key"]=t.apiKey),t?.workspaceId!==void 0&&(r["x-tenant-id"]=t.workspaceId);let s=sc(a,`Creating run with id: ${a.id}`);await this.caller.call(async()=>{let e=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await st(e,"create run",!0),e})}async batchIngestRuns({runCreates:e,runUpdates:t},r){if(void 0===e&&void 0===t)return;let i=await Promise.all(e?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]),n=await Promise.all(t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]);if(i.length>0&&n.length>0){let e=i.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of n)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);i=Object.values(e),n=t}let a={post:i,patch:n};if(!a.post.length&&!a.patch.length)return;let s={post:[],patch:[]};for(let e of["post","patch"]){let t=a[e].reverse(),r=t.pop();for(;void 0!==r;)s[e].push(r),r=t.pop()}if(s.post.length>0||s.patch.length>0){let e=s.post.map(e=>e.id).concat(s.patch.map(e=>e.id)).join(",");await this._postBatchIngestRuns(sc(s,`Ingesting runs with ids: ${e}`),r)}}async _postBatchIngestRuns(e,t){let r={...this.headers,"Content-Type":"application/json",Accept:"application/json"};t?.apiKey!==void 0&&(r["x-api-key"]=t.apiKey),await this.batchIngestCaller.callWithOptions({sizeBytes:t?.sizeBytes},async()=>{let i=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await st(i,"batch create run",!0),i})}async multipartIngestRuns({runCreates:e,runUpdates:t},r){if(void 0===e&&void 0===t)return;let i={},n=[];for(let t of e??[]){let e=await this.prepareRunCreateOrUpdateInputs(t);void 0!==e.id&&void 0!==e.attachments&&(i[e.id]=e.attachments),delete e.attachments,n.push(e)}let a=[];for(let e of t??[])a.push(await this.prepareRunCreateOrUpdateInputs(e));if(void 0!==n.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(void 0!==a.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(n.length>0&&a.length>0){let e=n.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of a)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);n=Object.values(e),a=t}if(0===n.length&&0===a.length)return;let s=[],o=[];for(let[e,t]of[["post",n],["patch",a]])for(let r of t){let{inputs:t,outputs:n,events:a,extra:l,error:u,serialized:c,attachments:d,...p}=r,h={inputs:t,outputs:n,events:a,extra:l,error:u,serialized:c},m=sc(p,`Serializing for multipart ingestion of run with id: ${p.id}`);for(let[t,r]of(o.push({name:`${e}.${p.id}`,payload:new Blob([m],{type:`application/json; length=${m.length}`})}),Object.entries(h))){if(void 0===r)continue;let i=sc(r,`Serializing ${t} for multipart ingestion of run with id: ${p.id}`);o.push({name:`${e}.${p.id}.${t}`,payload:new Blob([i],{type:`application/json; length=${i.length}`})})}if(void 0!==p.id){let e=i[p.id];if(e)for(let[t,r]of(delete i[p.id],Object.entries(e))){let e,i;if(Array.isArray(r)?[e,i]=r:(e=r.mimeType,i=r.data),t.includes(".")){console.warn(`Skipping attachment '${t}' for run ${p.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}o.push({name:`attachment.${p.id}.${t}`,payload:new Blob([i],{type:`${e}; length=${i.byteLength}`})})}}s.push(`trace=${p.trace_id},id=${p.id}`)}await this._sendMultipartRequest(o,s.join("; "),r)}async _createNodeFetchBody(e,t){let r=[];for(let i of e)r.push(new Blob([`--${t}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${i.name}"\r
`,`Content-Type: ${i.payload.type}\r
\r
`])),r.push(i.payload),r.push(new Blob(["\r\n"]));r.push(new Blob([`--${t}--\r
`]));let i=new Blob(r);return await i.arrayBuffer()}async _createMultipartStream(e,t){let r=new TextEncoder;return new ReadableStream({async start(i){let n=async e=>{"string"==typeof e?i.enqueue(r.encode(e)):i.enqueue(e)};for(let r of e){await n(`--${t}\r
`),await n(`Content-Disposition: form-data; name="${r.name}"\r
`),await n(`Content-Type: ${r.payload.type}\r
\r
`);let e=r.payload.stream().getReader();try{let t;for(;!(t=await e.read()).done;)i.enqueue(t.value)}finally{e.releaseLock()}await n("\r\n")}await n(`--${t}--\r
`),i.close()}})}async _sendMultipartRequest(e,t,r){let i,n="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=!!(i=globalThis[aS])&&"function"==typeof i&&"Headers"in i&&"Request"in i&&"Response"in i,s=()=>this._createNodeFetchBody(e,n),o=()=>this._createMultipartStream(e,n),l=async e=>this.batchIngestCaller.callWithOptions({sizeBytes:r?.sizeBytes},async()=>{let t=await e(),i={...this.headers,"Content-Type":`multipart/form-data; boundary=${n}`};r?.apiKey!==void 0&&(i["x-api-key"]=r.apiKey);let a=t;r?.useGzip&&"object"==typeof t&&"pipeThrough"in t&&(a=t.pipeThrough(new CompressionStream("gzip")),i["Content-Encoding"]="gzip");let s=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:i,body:a,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(s,"Failed to send multipart request",!0),s});try{let e,i=!1;a||this.multipartStreamingDisabled||"bun"===aR()?e=await l(s):(i=!0,e=await l(o)),(!this.multipartStreamingDisabled||i)&&422===e.status&&(r?.apiUrl??this.apiUrl)!==sy&&(console.warn(`Streaming multipart upload to ${r?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,e=await l(s))}catch(e){console.warn(`${e.message.trim()}

Context: ${t}`)}}async updateRun(e,t,r){aP(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));let i={...t,id:e};if(!this._filterForSampling([i],!0).length)return;if(this.autoBatchTracing&&void 0!==i.trace_id&&void 0!==i.dotted_order){let e=this._cloneCurrentOTELContext();return void 0!==t.end_time&&void 0===i.parent_run_id&&this.blockOnRootRunFinalization&&!this.manualFlushMode?void await this.processRunOperation({action:"update",item:i,otelContext:e,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error):void this.processRunOperation({action:"update",item:i,otelContext:e,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error)}let n={...this.headers,"Content-Type":"application/json"};r?.apiKey!==void 0&&(n["x-api-key"]=r.apiKey),r?.workspaceId!==void 0&&(n["x-tenant-id"]=r.workspaceId);let a=sc(t,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{let t=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await st(t,"update run",!0),t})}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){aP(e);let r=await this._get(`/runs/${e}`);return t&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:aM("PROJECT")||"default"})).id;let i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){let t=await this.readRun(e);if(!t.app_path)throw Error(`Run ${e} has no app_path`);let r=this.getHostUrl();return`${r}${t.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await sh(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),r={},i={};for(let n of(t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")),t)){if(null===n.parent_run_id||void 0===n.parent_run_id)throw Error(`Child run ${n.id} has no parent`);n.dotted_order?.startsWith(e.dotted_order??"")&&n.id!==e.id&&(n.parent_run_id in r||(r[n.parent_run_id]=[]),r[n.parent_run_id].push(n),i[n.id]=n)}for(let t in e.child_runs=r[e.id]||[],r)t!==e.id&&(i[t].child_runs=r[t]);return e}async *listRuns(e){let{projectId:t,projectName:r,parentRunId:i,traceId:n,referenceExampleId:a,startTime:s,executionOrder:o,isRoot:l,runType:u,error:c,id:d,query:p,filter:h,traceFilter:m,treeFilter:f,limit:g,select:y,order:_}=e,v=[];if(t&&(v=Array.isArray(t)?t:[t]),r){let e=Array.isArray(r)?r:[r],t=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));v.push(...t)}let b={session:v.length?v:null,run_type:u,reference_example:a,query:p,filter:h,trace_filter:m,tree_filter:f,execution_order:o,parent_run:i,start_time:s?s.toISOString():null,error:c,id:d,limit:g,trace:n,select:y||["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l,order:_};b.select.includes("child_run_ids")&&aN("Deprecated: 'child_run_ids' in the listRuns select parameter is deprecated and will be removed in a future version.");let w=0;for await(let e of this._getCursorPaginatedList("/runs/query",b))if(g){if(w>=g)break;if(e.length+w>g){let t=e.slice(0,g-w);yield*t;break}w+=e.length,yield*e}else yield*e}async *listGroupRuns(e){let{projectId:t,projectName:r,groupBy:i,filter:n,startTime:a,endTime:s,limit:o,offset:l}=e,u={session_id:t||(await this.readProject({projectName:r})).id,group_by:i,filter:n,start_time:a?a.toISOString():null,end_time:s?s.toISOString():null,limit:Number(o)||100},c=Number(l)||0,d="/runs/group",p=`${this.apiUrl}${d}`;for(;;){let e=JSON.stringify(Object.fromEntries(Object.entries({...u,offset:c}).filter(([e,t])=>void 0!==t))),t=await this.caller.call(async()=>{let t=await this._fetch(p,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await st(t,`Failed to fetch ${d}`),t}),{groups:r,total:i}=await t.json();if(0===r.length)break;for(let e of r)yield e;if((c+=r.length)>=i)break}}async getRunStats({id:e,trace:t,parentRun:r,runType:i,projectNames:n,projectIds:a,referenceExampleIds:s,startTime:o,endTime:l,error:u,query:c,filter:d,traceFilter:p,treeFilter:h,isRoot:m,dataSourceType:f}){let g=a||[];n&&(g=[...a||[],...await Promise.all(n.map(e=>this.readProject({projectName:e}).then(e=>e.id)))]);let y=JSON.stringify(Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:i,session:g,reference_example:s,start_time:o,end_time:l,error:u,query:c,filter:d,trace_filter:p,tree_filter:h,is_root:m,data_source_type:f}).filter(([e,t])=>void 0!==t))),_=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:y});return await st(e,"get run stats"),e});return await _.json()}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||ay.default()};aP(e);let i=JSON.stringify(r),n=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await st(t,"share run"),t}),a=await n.json();if(null===a||!("share_token"in a))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){aP(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(t,"unshare run",!0),t})}async readRunSharedLink(e){aP(e);let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(t,"read run shared link"),t}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(void 0!==t)for(let e of t)r.append("id",e);aP(e);let i=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(t,"list shared runs"),t});return await i.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),aP(e);let r=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(t,"read dataset shared schema"),t}),i=await r.json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async shareDataset(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let r={dataset_id:e};aP(e);let i=JSON.stringify(r),n=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await st(t,"share dataset"),t}),a=await n.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){aP(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(t,"unshare dataset",!0),t})}async readSharedDataset(e){aP(e);let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(t,"read shared dataset"),t});return await t.json()}async listSharedExamples(e,t){let r={};t?.exampleIds&&(r.id=t.exampleIds);let i=new URLSearchParams;Object.entries(r).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>i.append(e,t)):i.append(e,t)});let n=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/examples?${i.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(t,"list shared examples"),t}),a=await n.json();if(!n.ok){if("detail"in a)throw Error(`Failed to list shared examples.
Status: ${n.status}
Message: ${Array.isArray(a.detail)?a.detail.join("\n"):"Unspecified error"}`);throw Error(`Failed to list shared examples: ${n.status} ${n.statusText}`)}return a.map(e=>({...e,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:i=!1,projectExtra:n=null,referenceDatasetId:a=null}){let s=`${this.apiUrl}/sessions${i?"?upsert=true":""}`,o=n||{};r&&(o.metadata=r);let l={name:e,extra:o,description:t};null!==a&&(l.reference_dataset_id=a);let u=JSON.stringify(l),c=await this.caller.call(async()=>{let e=await this._fetch(s,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await st(e,"create project"),e});return await c.json()}async updateProject(e,{name:t=null,description:r=null,metadata:i=null,projectExtra:n=null,endTime:a=null}){let s=`${this.apiUrl}/sessions/${e}`,o=n;i&&(o={...o||{},metadata:i});let l=JSON.stringify({name:t,extra:o,description:r,end_time:a?new Date(a).toISOString():null}),u=await this.caller.call(async()=>{let e=await this._fetch(s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await st(e,"update project"),e});return await u.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions",i=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)aP(e),r+=`/${e}`;else if(void 0!==t)i.append("name",t);else throw Error("Must provide projectName or projectId");let n=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${r}?${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(e,"has project"),e});try{let e=await n.json();if(!n.ok)return!1;if(Array.isArray(e))return e.length>0;return!0}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let i,n="/sessions",a=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)aP(e),n+=`/${e}`;else if(void 0!==t)a.append("name",t);else throw Error("Must provide projectName or projectId");void 0!==r&&a.append("include_stats",r.toString());let s=await this._get(n,a);if(Array.isArray(s)){if(0===s.length)throw Error(`Project[id=${e}, name=${t}] not found`);i=s[0]}else i=s;return i}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either projectName or projectId");let r=await this.readProject({projectId:e,projectName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either datasetName or datasetId");let r=await this.readDataset({datasetId:e,datasetName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/datasets/${r.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:i,referenceDatasetName:n,includeStats:a,datasetVersion:s,referenceFree:o,metadata:l}={}){let u=new URLSearchParams;if(void 0!==e)for(let t of e)u.append("id",t);if(void 0!==t&&u.append("name",t),void 0!==r&&u.append("name_contains",r),void 0!==i)u.append("reference_dataset",i);else if(void 0!==n){let e=await this.readDataset({datasetName:n});u.append("reference_dataset",e.id)}for await(let e of(void 0!==a&&u.append("include_stats",a.toString()),void 0!==s&&u.append("dataset_version",s),void 0!==o&&u.append("reference_free",o.toString()),void 0!==l&&u.append("metadata",JSON.stringify(l)),this._getPaginated("/sessions",u)))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");aP(r=void 0===e?(await this.readProject({projectName:t})).id:e),await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(e,`delete session ${r} (${t})`,!0),e})}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:i,description:n,dataType:a,name:s}){let o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach(e=>{l.append("input_keys",e)}),i.forEach(e=>{l.append("output_keys",e)}),n&&l.append("description",n),a&&l.append("data_type",a),s&&l.append("name",s);let u=await this.caller.call(async()=>{let e=await this._fetch(o,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await st(e,"upload CSV"),e});return await u.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:i,outputsSchema:n,metadata:a}={}){let s={name:e,description:t,extra:a?{metadata:a}:void 0};r&&(s.data_type=r),i&&(s.inputs_schema_definition=i),n&&(s.outputs_schema_definition=n);let o=JSON.stringify(s),l=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await st(e,"create dataset"),e});return await l.json()}async readDataset({datasetId:e,datasetName:t}){let r,i="/datasets",n=new URLSearchParams({limit:"1"});if(e&&t)throw Error("Must provide either datasetName or datasetId, not both");if(e)aP(e),i+=`/${e}`;else if(t)n.append("name",t);else throw Error("Must provide datasetName or datasetId");let a=await this._get(i,n);if(Array.isArray(a)){if(0===a.length)throw Error(`Dataset[id=${e}, name=${t}] not found`);r=a[0]}else r=a;return r}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:i}){let n=e;if(void 0===n&&void 0===t)throw Error("Must provide either datasetName or datasetId");if(void 0!==n&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");void 0===n&&(n=(await this.readDataset({datasetName:t})).id);let a=new URLSearchParams({from_version:"string"==typeof r?r:r.toISOString(),to_version:"string"==typeof i?i:i.toISOString()});return await this._get(`/datasets/${n}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else if(void 0!==t)e=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide either datasetName or datasetId");let r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map(e=>JSON.parse(e))}async *listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:i,datasetNameContains:n,metadata:a}={}){let s=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(let e of r)s.append("id",e);for await(let e of(void 0!==i&&s.append("name",i),void 0!==n&&s.append("name_contains",n),void 0!==a&&s.append("metadata",JSON.stringify(a)),this._getPaginated("/datasets",s)))yield*e}async updateDataset(e){let{datasetId:t,datasetName:r,...i}=e;if(!t&&!r)throw Error("Must provide either datasetName or datasetId");let n=t??(await this.readDataset({datasetName:r})).id;aP(n);let a=JSON.stringify(i),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${n}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await st(e,"update dataset"),e});return await s.json()}async updateDatasetTag(e){let{datasetId:t,datasetName:r,asOf:i,tag:n}=e;if(!t&&!r)throw Error("Must provide either datasetName or datasetId");let a=t??(await this.readDataset({datasetName:r})).id;aP(a);let s=JSON.stringify({as_of:"string"==typeof i?i:i.toISOString(),tag:n});await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${a}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await st(e,"update dataset tags",!0),e})}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",i=e;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(i=(await this.readDataset({datasetName:t})).id),void 0!==i)aP(i),r+=`/${i}`;else throw Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(e,`delete ${r}`,!0),e})}async indexDataset({datasetId:e,datasetName:t,tag:r}){let i=e;if(i||t)if(i&&t)throw Error("Must provide either datasetName or datasetId, not both");else i||(i=(await this.readDataset({datasetName:t})).id);else throw Error("Must provide either datasetName or datasetId");aP(i);let n=JSON.stringify({tag:r}),a=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${i}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await st(e,"index dataset"),e});await a.json()}async similarExamples(e,t,r,{filter:i}={}){let n={limit:r,inputs:e};void 0!==i&&(n.filter=i),aP(t);let a=JSON.stringify(n),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${t}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:a});return await st(e,"fetch similar examples"),e});return(await s.json()).examples}async createExample(e,t,r){let i;if(sb(e)&&(void 0!==t||void 0!==r))throw Error("Cannot provide outputs or options when using ExampleCreate object");let n=t?r?.datasetId:e.dataset_id,a=t?r?.datasetName:e.dataset_name;if(void 0===n&&void 0===a)throw Error("Must provide either datasetName or datasetId");if(void 0!==n&&void 0!==a)throw Error("Must provide either datasetName or datasetId, not both");void 0===n&&(n=(await this.readDataset({datasetName:a})).id);let s=(t?r?.createdAt:e.created_at)||new Date;i=sb(e)?e:{inputs:e,outputs:t,created_at:s?.toISOString(),id:r?.exampleId,metadata:r?.metadata,split:r?.split,source_run_id:r?.sourceRunId,use_source_run_io:r?.useSourceRunIO,use_source_run_attachments:r?.useSourceRunAttachments,attachments:r?.attachments};let o=await this._uploadExamplesMultipart(n,[i]);return await this.readExample(o.example_ids?.[0]??ay.default())}async createExamples(e){if(Array.isArray(e)){if(0===e.length)return[];let t=e[0].dataset_id,r=e[0].dataset_name;if(void 0===t&&void 0===r)throw Error("Must provide either datasetName or datasetId");if(void 0!==t&&void 0!==r)throw Error("Must provide either datasetName or datasetId, not both");void 0===t&&(t=(await this.readDataset({datasetName:r})).id);let i=await this._uploadExamplesMultipart(t,e);return await Promise.all(i.example_ids.map(e=>this.readExample(e)))}let{inputs:t,outputs:r,metadata:i,splits:n,sourceRunIds:a,useSourceRunIOs:s,useSourceRunAttachments:o,attachments:l,exampleIds:u,datasetId:c,datasetName:d}=e;if(void 0===t)throw Error("Must provide inputs when using legacy parameters");let p=c;if(void 0===p&&void 0===d)throw Error("Must provide either datasetName or datasetId");if(void 0!==p&&void 0!==d)throw Error("Must provide either datasetName or datasetId, not both");void 0===p&&(p=(await this.readDataset({datasetName:d})).id);let h=t.map((e,t)=>({dataset_id:p,inputs:e,outputs:r?.[t],metadata:i?.[t],split:n?.[t],id:u?.[t],attachments:l?.[t],source_run_id:a?.[t],use_source_run_io:s?.[t],use_source_run_attachments:o?.[t]})),m=await this._uploadExamplesMultipart(p,h);return await Promise.all(m.example_ids.map(e=>this.readExample(e)))}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let i=e.map(e=>a3(e)?a8(e):e),n=a3(t)?a8(t):t;return this.createExample({input:i},{output:n},r)}async readExample(e){aP(e);let t=`/examples/${e}`,{attachment_urls:r,...i}=await this._get(t);return r&&(i.attachments=Object.entries(r).reduce((e,[t,r])=>(e[t.slice(11)]={presigned_url:r.presigned_url,mime_type:r.mime_type},e),{})),i}async *listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:i,splits:n,inlineS3Urls:a,metadata:s,limit:o,offset:l,filter:u,includeAttachments:c}={}){let d;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)d=e;else if(void 0!==t)d=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide a datasetName or datasetId");let p=new URLSearchParams({dataset:d}),h=i?"string"==typeof i?i:i?.toISOString():void 0;if(h&&p.append("as_of",h),p.append("inline_s3_urls",(a??!0).toString()),void 0!==r)for(let e of r)p.append("id",e);if(void 0!==n)for(let e of n)p.append("splits",e);if(void 0!==s){let e=JSON.stringify(s);p.append("metadata",e)}void 0!==o&&p.append("limit",o.toString()),void 0!==l&&p.append("offset",l.toString()),void 0!==u&&p.append("filter",u),!0===c&&["attachment_urls","outputs","metadata"].forEach(e=>p.append("select",e));let m=0;for await(let e of this._getPaginated("/examples",p)){for(let t of e){let{attachment_urls:e,...r}=t;e&&(r.attachments=Object.entries(e).reduce((e,[t,r])=>(e[t.slice(11)]={presigned_url:r.presigned_url,mime_type:r.mime_type||void 0},e),{})),yield r,m++}if(void 0!==o&&m>=o)break}}async deleteExample(e){aP(e);let t=`/examples/${e}`;await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(e,`delete ${t}`,!0),e})}async updateExample(e,t){let r,i,n;return aP(r=t?e:e.id),n=void 0!==(i=t?{id:r,...t}:e).dataset_id?i.dataset_id:(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(n,[i])}async updateExamples(e){let t;return t=void 0===e[0].dataset_id?(await this.readExample(e[0].id)).dataset_id:e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:i}){let n;if(aP(n=e||(await this.readDataset({datasetName:t})).id),r&&i||!r&&!i)throw Error("Exactly one of asOf and tag must be specified.");let a=new URLSearchParams;void 0!==r&&a.append("as_of","string"==typeof r?r:r.toISOString()),void 0!==i&&a.append("tag",i);let s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${n}/version?${a.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(e,"read dataset version"),e});return await s.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let i;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");aP(i=void 0===e?(await this.readDataset({datasetName:t})).id:e);let n=new URLSearchParams,a=r?"string"==typeof r?r:r?.toISOString():void 0;return a&&n.append("as_of",a),await this._get(`/datasets/${i}/splits`,n)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:i,remove:n=!1}){let a;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");aP(a=void 0===e?(await this.readDataset({datasetName:t})).id:e);let s=JSON.stringify({split_name:r,examples:i.map(e=>(aP(e),e)),remove:n});await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await st(e,"update dataset splits",!0),e})}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:i,referenceExample:n}={loadChildRuns:!1}){let a;if(aN("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."),"string"==typeof e)a=await this.readRun(e,{loadChildRuns:i});else if("object"==typeof e&&"id"in e)a=e;else throw Error(`Invalid run type: ${typeof e}`);null!==a.reference_example_id&&void 0!==a.reference_example_id&&(n=await this.readExample(a.reference_example_id));let s=await t.evaluateRun(a,n),[o,l]=await this._logEvaluationFeedback(s,a,r);return l[0]}async createFeedback(e,t,{score:r,value:i,correction:n,comment:a,sourceInfo:s,feedbackSourceType:o="api",sourceRunId:l,feedbackId:u,feedbackConfig:c,projectId:d,comparativeExperimentId:p}){if(!e&&!d)throw Error("One of runId or projectId must be provided");if(e&&d)throw Error("Only one of runId or projectId can be provided");let h={type:o??"api",metadata:s??{}};void 0===l||h?.metadata===void 0||h.metadata.__run||(h.metadata.__run={run_id:l}),h?.metadata!==void 0&&h.metadata.__run?.run_id!==void 0&&aP(h.metadata.__run.run_id);let m={id:u??ay.default(),run_id:e,key:t,score:sg(r),value:i,correction:n,comment:a,feedback_source:h,comparative_experiment_id:p,feedbackConfig:c,session_id:d},f=JSON.stringify(m),g=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{let e=await this._fetch(g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:f});return await st(e,"create feedback",!0),e}),m}async updateFeedback(e,{score:t,value:r,correction:i,comment:n}){let a={};null!=t&&(a.score=sg(t)),null!=r&&(a.value=r),null!=i&&(a.correction=i),null!=n&&(a.comment=n),aP(e);let s=JSON.stringify(a);await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await st(t,"update feedback",!0),t})}async readFeedback(e){aP(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){aP(e);let t=`/feedback/${e}`;await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(e,`delete ${t}`,!0),e})}async *listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let i=new URLSearchParams;if(e)for(let t of e)aP(t),i.append("run",t);if(t)for(let e of t)i.append("key",e);if(r)for(let e of r)i.append("source",e);for await(let e of this._getPaginated("/feedback",i))yield*e}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:i}={}){let n={run_id:e,feedback_key:t,feedback_config:i};r?"string"==typeof r?n.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(n.expires_in=r):n.expires_in={hours:3};let a=JSON.stringify(n),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await st(e,"create presigned feedback token"),e});return await s.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:i,description:n,metadata:a,id:s}){if(0===t.length)throw Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!r)throw Error("A reference dataset is required");let o={id:s,name:e,experiment_ids:t,reference_dataset_id:r,description:n,created_at:(i??new Date)?.toISOString(),extra:{}};a&&(o.extra.metadata=a);let l=JSON.stringify(o);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await st(e,"create comparative experiment"),e})).json()}async *listPresignedFeedbackTokens(e){aP(e);let t=new URLSearchParams({run_id:e});for await(let e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){return"results"in e?e.results:Array.isArray(e)?e:[e]}async _logEvaluationFeedback(e,t,r){let i=this._selectEvalResults(e),n=[];for(let e of i){let i=r||{};e.evaluatorInfo&&(i={...e.evaluatorInfo,...i});let a=null;e.targetRunId?a=e.targetRunId:t&&(a=t.id),n.push(await this.createFeedback(a,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:i,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"}))}return[i,n]}async logEvaluationFeedback(e,t,r){let[i]=await this._logEvaluationFeedback(e,t,r);return i}async *listAnnotationQueues(e={}){let{queueIds:t,name:r,nameContains:i,limit:n}=e,a=new URLSearchParams;t&&t.forEach((e,t)=>{aP(e,`queueIds[${t}]`),a.append("ids",e)}),r&&a.append("name",r),i&&a.append("name_contains",i),a.append("limit",(void 0!==n?Math.min(n,100):100).toString());let s=0;for await(let e of this._getPaginated("/annotation-queues",a))if(yield*e,s++,void 0!==n&&s>=n)break}async createAnnotationQueue(e){let{name:t,description:r,queueId:i,rubricInstructions:n}=e,a=JSON.stringify(Object.fromEntries(Object.entries({name:t,description:r,id:i||ay.default(),rubric_instructions:n}).filter(([e,t])=>void 0!==t)));return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await st(e,"create annotation queue"),e})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${aP(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(t,"read annotation queue"),t})).json()}async updateAnnotationQueue(e,t){let{name:r,description:i,rubricInstructions:n}=t,a=JSON.stringify({name:r,description:i,rubric_instructions:n});await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${aP(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await st(t,"update annotation queue",!0),t})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${aP(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(t,"delete annotation queue",!0),t})}async addRunsToAnnotationQueue(e,t){let r=JSON.stringify(t.map((e,t)=>aP(e,`runIds[${t}]`).toString()));await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${aP(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await st(t,"add runs to annotation queue",!0),t})}async getRunFromAnnotationQueue(e,t){let r=`/annotation-queues/${aP(e,"queueId")}/run`;return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(e,"get run from annotation queue"),e})).json()}async deleteRunFromAnnotationQueue(e,t){await this.caller.call(async()=>{let r=await this._fetch(`${this.apiUrl}/annotation-queues/${aP(e,"queueId")}/runs/${aP(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(r,"delete run from annotation queue",!0),r})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${aP(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(t,"get size from annotation queue"),t})).json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return"-"==e||t.tenant_handle===e}async _ownerConflictError(e,t){let r=await this._getSettings();return Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(t,"get latest commit hash"),t}),r=await t.json();if(0!==r.commits.length)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[r,i,n]=a7(e),a=JSON.stringify({like:t});return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/likes/${r}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await st(e,`${t?"like":"unlike"} prompt`),e})).json()}async _getPromptUrl(e){let[t,r,i]=a7(e);if(await this._currentTenantIsOwner(t)){let e=await this._getSettings();return"latest"!==i?`${this.getHostUrl()}/prompts/${r}/${i.substring(0,8)}?organizationId=${e.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${e.id}`}return"latest"!==i?`${this.getHostUrl()}/hub/${t}/${r}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async *listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,e=>e.commits))yield*t}async *listPrompts(e){let t=new URLSearchParams;for await(let r of(t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query),this._getPaginated("/repos",t,e=>e.repos)))yield*r}async getPrompt(e){let[t,r,i]=a7(e),n=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return e?.status===404?null:(await st(e,"get prompt"),e)}),a=await n?.json();return a?.repo?a.repo:null}async createPrompt(e,t){let r=await this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[i,n,a]=a7(e);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("create a prompt",i);let s=JSON.stringify({repo_handle:n,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic}),o=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await st(e,"create prompt"),e}),{repo:l}=await o.json();return l}async createCommit(e,t,r){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[i,n,a]=a7(e),s=r?.parentCommitHash!=="latest"&&r?.parentCommitHash?r?.parentCommitHash:await this._getLatestCommitHash(`${i}/${n}`),o=JSON.stringify({manifest:JSON.parse(JSON.stringify(t)),parent_commit:s}),l=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/commits/${i}/${n}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await st(e,"create commit"),e}),u=await l.json();return this._getPromptUrl(`${i}/${n}${u.commit_hash?`:${u.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let r=new FormData;for(let e of t){let t=e.id,i=new Blob([sc({...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split}},`Serializing body for example with id: ${t}`)],{type:"application/json"});if(r.append(t,i),e.inputs){let i=new Blob([sc(e.inputs,`Serializing inputs for example with id: ${t}`)],{type:"application/json"});r.append(`${t}.inputs`,i)}if(e.outputs){let i=new Blob([sc(e.outputs,`Serializing outputs whle updating example with id: ${t}`)],{type:"application/json"});r.append(`${t}.outputs`,i)}if(e.attachments)for(let[i,n]of Object.entries(e.attachments)){let e,a;Array.isArray(n)?[e,a]=n:(e=n.mimeType,a=n.data);let s=new Blob([a],{type:`${e}; length=${a.byteLength}`});r.append(`${t}.attachment.${i}`,s)}if(e.attachments_operations){let i=new Blob([sc(e.attachments_operations,`Serializing attachments while updating example with id: ${t}`)],{type:"application/json"});r.append(`${t}.attachments_operations`,i)}}let i=e??t[0]?.dataset_id;return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${i}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await st(e,"update examples"),e})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let r=new FormData;for(let e of t){let t=(e.id??ay.default()).toString(),i=new Blob([sc({created_at:e.created_at,...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split},...e.source_run_id&&{source_run_id:e.source_run_id},...e.use_source_run_io&&{use_source_run_io:e.use_source_run_io},...e.use_source_run_attachments&&{use_source_run_attachments:e.use_source_run_attachments}},`Serializing body for uploaded example with id: ${t}`)],{type:"application/json"});if(r.append(t,i),e.inputs){let i=new Blob([sc(e.inputs,`Serializing inputs for uploaded example with id: ${t}`)],{type:"application/json"});r.append(`${t}.inputs`,i)}if(e.outputs){let i=new Blob([sc(e.outputs,`Serializing outputs for uploaded example with id: ${t}`)],{type:"application/json"});r.append(`${t}.outputs`,i)}if(e.attachments)for(let[i,n]of Object.entries(e.attachments)){let e,a;Array.isArray(n)?[e,a]=n:(e=n.mimeType,a=n.data);let s=new Blob([a],{type:`${e}; length=${a.byteLength}`});r.append(`${t}.attachment.${i}`,s)}}return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await st(t,"upload examples"),t})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[r,i]=a7(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);let n={};if(t?.description!==void 0&&(n.description=t.description),t?.readme!==void 0&&(n.readme=t.readme),t?.tags!==void 0&&(n.tags=t.tags),t?.isPublic!==void 0&&(n.is_public=t.isPublic),t?.isArchived!==void 0&&(n.is_archived=t.isArchived),0===Object.keys(n).length)throw Error("No valid update options provided");let a=JSON.stringify(n);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${r}/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await st(e,"update prompt"),e})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[t,r,i]=a7(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(e,"delete prompt"),e})).json()}async pullPromptCommit(e,t){let[r,i,n]=a7(e),a=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/commits/${r}/${i}/${n}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await st(e,"pull prompt commit"),e}),s=await a.json();return{owner:r,repo:i,commit_hash:s.commit_hash,manifest:s.manifest,examples:s.examples}}async _pullPrompt(e,t){return JSON.stringify((await this.pullPromptCommit(e,{includeModel:t?.includeModel})).manifest)}async pushPrompt(e,t){return(await this.promptExists(e)?t&&Object.keys(t).some(e=>"object"!==e)&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object)?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:r=this.apiUrl,datasetName:i}=t,[n,a]=this.parseTokenOrUrl(e,r),s=new sv({apiUrl:n,apiKey:"placeholder"}),o=await s.readSharedDataset(a),l=i||o.name;try{if(await this.hasDataset({datasetId:l}))return void console.log(`Dataset ${l} already exists in your tenant. Skipping.`)}catch(e){}let u=await s.listSharedExamples(a),c=await this.createDataset(l,{description:o.description,dataType:o.data_type||"kv",inputsSchema:o.inputs_schema_definition??void 0,outputsSchema:o.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(e=>e.inputs),outputs:u.flatMap(e=>e.outputs?[e.outputs]:[]),datasetId:c.id})}catch(e){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),e}}parseTokenOrUrl(e,t,r=2,i="dataset"){try{return aP(e),[t,e]}catch(e){}try{let n=new URL(e).pathname.split("/").filter(e=>""!==e);if(n.length>=r){let e=n[n.length-r];return[t,e]}throw Error(`Invalid public ${i} URL: ${e}`)}catch(t){throw Error(`Invalid public ${i} URL or token: ${e}`)}}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),void 0!==this.langSmithToOTELTranslator&&await aG.getDefaultOTLPTracerComponents()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}}function sb(e){return"dataset_id"in e||"dataset_name"in e}let sw=Symbol.for("lc:context_variables"),s$=Symbol.for("langsmith:replica_trace_roots");function sx(e,t){if(sw in e)return e[sw][t]}var sk=e.i(58982),sk=sk;let sI="6ba7b810-9dad-11d1-80b4-00c04fd430c8";function sO(e){let t=Object.keys(e).sort().map(t=>`${t}:${e[t]??""}`).join("|");return(0,sk.default)(t,sI)}function sS(e,t=1){let r=t.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${r}Z`}function sE(e,t,r=1){let i=sS(e,r);return{dottedOrder:i.replace(/[-:.]/g,"")+t,microsecondPrecisionDatestring:i}}class sT{constructor(e,t,r,i){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=r,this.replicas=i}static fromHeader(e){let t,r,i=e.split(","),n={},a=[];for(let e of i){let[i,s]=e.split("="),o=decodeURIComponent(s);"langsmith-metadata"===i?n=JSON.parse(o):"langsmith-tags"===i?a=o.split(","):"langsmith-project"===i?t=o:"langsmith-replicas"===i&&(r=JSON.parse(o))}return new sT(n,a,t,r)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class sA{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"distributedParentId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function(e){return null!=e&&"function"==typeof e.createChild&&"function"==typeof e.postRun}(e))return void Object.assign(this,{...e});const t=sA.getDefaultConfig(),{metadata:r,...i}=e,n=i.client??sA.getSharedClient(),a={...r,...i?.extra?.metadata};if(i.extra={...i.extra,metadata:a},"id"in i&&null==i.id&&delete i.id,Object.assign(this,{...t,...i,client:n}),this.execution_order??=1,this.child_execution_order??=1,this.dotted_order||(this._serialized_start_time=sS(this.start_time,this.execution_order)),this.id||(this.id=function(e){let t="string"==typeof e?Date.parse(e):e;return(0,aT.default)({msecs:t,seq:0})}(this._serialized_start_time??this.start_time)),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=function(e){return e?e.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):function(){let e=az("LANGSMITH_RUNS_ENDPOINTS");if(!e)return[];try{let r=JSON.parse(e);if(Array.isArray(r)){let e=[];for(let t of r){if("object"!=typeof t||null===t){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof t}`);continue}if("string"!=typeof t.api_url){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof t.api_url}`);continue}if("string"!=typeof t.api_key){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof t.api_key}`);continue}e.push({apiUrl:t.api_url.replace(/\/$/,""),apiKey:t.api_key})}return e}if("object"!=typeof r||null===r)return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof r}`),[];{var t=r;if(Object.keys(t).length>0&&aM("ENDPOINT"))throw new si;let e=[];for(let[t,i]of Object.entries(r)){let r=t.replace(/\/$/,"");if("string"==typeof i)e.push({apiUrl:r,apiKey:i});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${t}: expected string, got ${typeof i}`);continue}}return e}}catch(e){if("object"==typeof e&&null!==e&&e.code===sr)throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}()}(this.replicas),!this.dotted_order){const{dottedOrder:e}=sE(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){let e=Date.now();return{run_type:"chain",project_name:aE(),child_runs:[],api_url:az("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:az("LANGCHAIN_API_KEY"),caller_options:{},start_time:e,serialized:{},inputs:{},extra:{}}}static getSharedClient(){return sA.sharedClient||(sA.sharedClient=new sv),sA.sharedClient}createChild(e){var t,r;let i=this.child_execution_order+1,n=this.replicas?.map(e=>{let{reroot:t,...r}=e;return r}),a=e.replicas??n,s=new sA({...e,parent_run:this,project_name:this.project_name,replicas:a,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:i,child_execution_order:i});sw in this&&(s[sw]=this[sw]);let o=Symbol.for("lc:child_config"),l=e.extra?.[o]??this.extra[o];if(null!=(t=l)&&"object"==typeof t.callbacks&&(sC(t.callbacks?.handlers)||sC(t.callbacks))){let e={...l},t="object"==typeof(r=e.callbacks)&&null!=r&&Array.isArray(r.handlers)?e.callbacks.copy?.():void 0;t&&(Object.assign(t,{_parentRunId:s.id}),t.handlers?.find(sN)?.updateFromRunTree?.(s),e.callbacks=t),s.extra[o]=e}let u=new Set,c=this;for(;null!=c&&!u.has(c.id);)u.add(c.id),c.child_execution_order=Math.max(c.child_execution_order,i),c=c.parent_run;return this.child_runs.push(s),s}async end(e,t,r=Date.now(),i){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,i&&Object.keys(i).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...i}}:{metadata:i})}_convertToCreate(e,t,r=!0){let i,n,a=e.extra??{};if(a?.runtime?.library===void 0&&(a.runtime||(a.runtime={}),t))for(let[e,r]of Object.entries(t))a.runtime[e]||(a.runtime[e]=r);return r?(n=e.parent_run?.id??e.parent_run_id,i=[]):(i=e.child_runs.map(e=>this._convertToCreate(e,t,r)),n=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:a,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:n,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_sliceParentId(e,t){if(t.dotted_order){let r=t.dotted_order.split("."),i=null;for(let t=0;t<r.length;t++)if(r[t].slice(-36)===e){i=t;break}if(null!==i){let e=r.slice(i+1);t.dotted_order=e.join("."),e.length>0?t.trace_id=e[0].slice(-36):t.trace_id=t.id}}t.parent_run_id===e&&(t.parent_run_id=void 0)}_setReplicaTraceRoot(e,t){let r,i=sx(this,s$)??{};for(let n of(i[e]=t,(r=sw in this?this[sw]:{})[s$]=i,this[sw]=r,this.child_runs))n._setReplicaTraceRoot(e,t)}_remapForProject(e){let t,r,i,n,{projectName:a,runtimeEnv:s,excludeChildRuns:o=!0,reroot:l=!1,distributedParentId:u,apiUrl:c,apiKey:d,workspaceId:p}=e,h=this._convertToCreate(this,s,o);if(a===this.project_name)return{...h,session_name:a};if(l){if(u)this._sliceParentId(u,h);else if(h.parent_run_id=void 0,h.dotted_order){let e=h.dotted_order.split(".");e.length>0&&(h.dotted_order=e[e.length-1],h.trace_id=h.id)}let e=sO({projectName:a,apiUrl:c,apiKey:d,workspaceId:p});this._setReplicaTraceRoot(e,h.id)}if(!l&&(t=(sx(this,s$)??{})[sO({projectName:a,apiUrl:c,apiKey:d,workspaceId:p})])&&(h.trace_id=t,h.dotted_order)){let e=h.dotted_order.split("."),r=null;for(let i=0;i<e.length;i++)if(e[i].slice(-36)===t){r=i;break}null!==r&&(h.dotted_order=e.slice(r).join("."))}let m=h.id,f=(0,sk.default)(`${m}:${a}`,sI);return r=h.trace_id?(0,sk.default)(`${h.trace_id}:${a}`,sI):f,h.parent_run_id&&(i=(0,sk.default)(`${h.parent_run_id}:${a}`,sI)),h.dotted_order&&(n=h.dotted_order.split(".").map(e=>{let t=e.slice(-36),r=(0,sk.default)(`${t}:${a}`,sI);return e.slice(0,-36)+r}).join(".")),{...h,id:f,trace_id:r,parent_run_id:i,dotted_order:n,session_name:a}}async postRun(e=!0){try{let t=aL();if(this.replicas&&this.replicas.length>0)for(let{projectName:e,apiKey:r,apiUrl:i,workspaceId:n,reroot:a}of this.replicas){let s=this._remapForProject({projectName:e??this.project_name,runtimeEnv:t,excludeChildRuns:!0,reroot:a,distributedParentId:this.distributedParentId,apiUrl:i,apiKey:r,workspaceId:n});await this.client.createRun(s,{apiKey:r,apiUrl:i,workspaceId:n})}else{let r=this._convertToCreate(this,t,e);await this.client.createRun(r)}if(!e)for(let e of(aN("Posting with excludeChildRuns=false is deprecated and will be removed in a future version."),this.child_runs))await e.postRun(!1)}catch(e){console.error(`Error in postRun for run ${this.id}:`,e)}}async patchRun(e){if(this.replicas&&this.replicas.length>0)for(let{projectName:t,apiKey:r,apiUrl:i,workspaceId:n,updates:a,reroot:s}of this.replicas){let o=this._remapForProject({projectName:t??this.project_name,runtimeEnv:void 0,excludeChildRuns:!0,reroot:s,distributedParentId:this.distributedParentId,apiUrl:i,apiKey:r,workspaceId:n}),l={id:o.id,name:o.name,run_type:o.run_type,start_time:o.start_time,outputs:o.outputs,error:o.error,parent_run_id:o.parent_run_id,session_name:o.session_name,reference_example_id:o.reference_example_id,end_time:o.end_time,dotted_order:o.dotted_order,trace_id:o.trace_id,events:o.events,tags:o.tags,extra:o.extra,attachments:this.attachments,...a};e?.excludeInputs||(l.inputs=o.inputs),await this.client.updateRun(o.id,l,{apiKey:r,apiUrl:i,workspaceId:n})}else try{let t={name:this.name,run_type:this.run_type,start_time:this._serialized_start_time??this.start_time,end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e?.excludeInputs||(t.inputs=this.inputs),await this.client.updateRun(this.id,t)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),"string"==typeof e?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var r;let i,n,a,s=e?.callbacks,o=void 0!==r?r:!!["TRACING_V2","TRACING"].find(e=>"true"===aM(e));if(s){let e=s?.getParentRunId?.()??"",t=s?.handlers?.find(e=>e?.name=="langchain_tracer");i=t?.getRun?.(e),n=t?.projectName,a=t?.client,o=o||!!t}return i?new sA({name:i.name,id:i.id,trace_id:i.trace_id,dotted_order:i.dotted_order,client:a,tracingEnabled:o,project_name:n,tags:[...new Set((i?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...i?.extra?.metadata,...e?.metadata}}}).createChild(t):new sA({...t,client:a,tracingEnabled:o,project_name:n})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let r="get"in e&&"function"==typeof e.get?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,i=r["langsmith-trace"];if(!i||"string"!=typeof i)return;let n=i.trim(),a=n.split(".").map(e=>{let[t,r]=e.split("Z");return{strTime:t,time:Date.parse(t+"Z"),uuid:r}}),s=a[0].uuid,o={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:a.at(-1)?.uuid,trace_id:s,dotted_order:n};if(r.baggage&&"string"==typeof r.baggage){let e=sT.fromHeader(r.baggage);o.metadata=e.metadata,o.tags=e.tags,o.project_name=e.project_name,o.replicas=e.replicas}let l=new sA(o);return l.distributedParentId=l.id,l}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new sT(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(let[r,i]of Object.entries(t))e.set(r,i);return t}}function sN(e){return"object"==typeof e&&null!=e&&"string"==typeof e.name&&"langchain_tracer"===e.name}function sC(e){return Array.isArray(e)&&e.some(e=>sN(e))}function sP(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}function sj(e){return"function"==typeof e._addRunToRunMap}Object.defineProperty(sA,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null}),iP({},{BaseTracer:()=>sR,isBaseTracer:()=>sj});var sR=class extends ab{runMap=new Map;runTreeMap=new Map;usesRunTreeMap=!1;constructor(e){super(...arguments)}copy(){return this}getRunById(e){if(void 0!==e)return this.usesRunTreeMap?(e=>{if(e)return e.events=e.events??[],e.child_runs=e.child_runs??[],e})(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let{dottedOrder:t,microsecondPrecisionDatestring:r}=sE(new Date(e.start_time).getTime(),e.id,e.execution_order),i={...e},n=this.getRunById(i.parent_run_id);if(void 0!==i.parent_run_id?n&&(this._addChildRun(n,i),n.child_execution_order=Math.max(n.child_execution_order,i.child_execution_order),i.trace_id=n.trace_id,void 0!==n.dotted_order&&(i.dotted_order=[n.dotted_order,t].join("."),i._serialized_start_time=r)):(i.trace_id=i.id,i.dotted_order=t,i._serialized_start_time=r),this.usesRunTreeMap){let e=function e(t,r){if(t)return new sA({...t,start_time:t._serialized_start_time??t.start_time,parent_run:e(r),child_runs:t.child_runs.map(t=>e(t)).filter(e=>void 0!==e),extra:{...t.extra,runtime:af()},tracingEnabled:!1})}(i,n);void 0!==e&&this.runTreeMap.set(i.id,e)}else this.runMap.set(i.id,i);return i}async _endTrace(e){let t=void 0!==e.parent_run_id&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await this.onRunUpdate?.(e),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){let t=void 0!==e&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,i,n,a,s,o){let l=this._getExecutionOrder(i),u=Date.now(),c=s?{...n,metadata:s}:n,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:a||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,t,r,i,n,a,s,o){let l=this.getRunById(r)??this._createRunForLLMStart(e,t,r,i,n,a,s,o);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}_createRunForChatModelStart(e,t,r,i,n,a,s,o){let l=this._getExecutionOrder(i),u=Date.now(),c=s?{...n,metadata:s}:n,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:a||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,t,r,i,n,a,s,o){let l=this.getRunById(r)??this._createRunForChatModelStart(e,t,r,i,n,a,s,o);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}async handleLLMEnd(e,t,r,i,n){let a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...n},await this.onLLMEnd?.(a),await this._endTrace(a),a}async handleLLMError(e,t,r,i,n){let a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...n},await this.onLLMError?.(a),await this._endTrace(a),a}_createRunForChainStart(e,t,r,i,n,a,s,o){let l=this._getExecutionOrder(i),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:n||[]};return this._addRunToRunMap(c)}async handleChainStart(e,t,r,i,n,a,s,o){let l=this.getRunById(r)??this._createRunForChainStart(e,t,r,i,n,a,s,o);return await this.onRunCreate?.(l),await this.onChainStart?.(l),l}async handleChainEnd(e,t,r,i,n){let a=this.getRunById(t);if(!a)throw Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=sP(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),n?.inputs!==void 0&&(a.inputs=sP(n.inputs,"input")),await this.onChainEnd?.(a),await this._endTrace(a),a}async handleChainError(e,t,r,i,n){let a=this.getRunById(t);if(!a)throw Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),n?.inputs!==void 0&&(a.inputs=sP(n.inputs,"input")),await this.onChainError?.(a),await this._endTrace(a),a}_createRunForToolStart(e,t,r,i,n,a,s){let o=this._getExecutionOrder(i),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:n||[]};return this._addRunToRunMap(u)}async handleToolStart(e,t,r,i,n,a,s){let o=this.getRunById(r)??this._createRunForToolStart(e,t,r,i,n,a,s);return await this.onRunCreate?.(o),await this.onToolStart?.(o),o}async handleToolEnd(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r))}async handleAgentEnd(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}_createRunForRetrieverStart(e,t,r,i,n,a,s){let o=this._getExecutionOrder(i),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:n||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,t,r,i,n,a,s){let o=this.getRunById(r)??this._createRunForRetrieverStart(e,t,r,i,n,a,s);return await this.onRunCreate?.(o),await this.onRetrieverStart?.(o),o}async handleRetrieverEnd(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,i,n,a){let s=this.getRunById(r);if(!s||s?.run_type!=="llm")throw Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a?.chunk}}),await this.onLLMNewToken?.(s,e,{chunk:a?.chunk}),s}};let sL=(e=0)=>t=>`\u001B[${t+e}m`,sU=(e=0)=>t=>`\u001B[${38+e};5;${t}m`,sz=(e=0)=>(t,r,i)=>`\u001B[${38+e};2;${t};${r};${i}m`,sM={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};Object.keys(sM.modifier),[...Object.keys(sM.color),...Object.keys(sM.bgColor)];let sD=function(){let e=new Map;for(let[t,r]of Object.entries(sM)){for(let[t,i]of Object.entries(r))sM[t]={open:`\u001B[${i[0]}m`,close:`\u001B[${i[1]}m`},r[t]=sM[t],e.set(i[0],i[1]);Object.defineProperty(sM,t,{value:r,enumerable:!1})}return Object.defineProperty(sM,"codes",{value:e,enumerable:!1}),sM.color.close="\x1b[39m",sM.bgColor.close="\x1b[49m",sM.color.ansi=sL(),sM.color.ansi256=sU(),sM.color.ansi16m=sz(),sM.bgColor.ansi=sL(10),sM.bgColor.ansi256=sU(10),sM.bgColor.ansi16m=sz(10),Object.defineProperties(sM,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value(e){let t=/[a-f\d]{6}|[a-f\d]{3}/i.exec(e.toString(16));if(!t)return[0,0,0];let[r]=t;3===r.length&&(r=[...r].map(e=>e+e).join(""));let i=Number.parseInt(r,16);return[i>>16&255,i>>8&255,255&i]},enumerable:!1},hexToAnsi256:{value:e=>sM.rgbToAnsi256(...sM.hexToRgb(e)),enumerable:!1},ansi256ToAnsi:{value(e){let t,r,i;if(e<8)return 30+e;if(e<16)return 90+(e-8);if(e>=232)r=t=((e-232)*10+8)/255,i=t;else{let n=(e-=16)%36;t=Math.floor(e/36)/5,r=Math.floor(n/6)/5,i=n%6/5}let n=2*Math.max(t,r,i);if(0===n)return 30;let a=30+(Math.round(i)<<2|Math.round(r)<<1|Math.round(t));return 2===n&&(a+=60),a},enumerable:!1},rgbToAnsi:{value:(e,t,r)=>sM.ansi256ToAnsi(sM.rgbToAnsi256(e,t,r)),enumerable:!1},hexToAnsi:{value:e=>sM.ansi256ToAnsi(sM.hexToAnsi256(e)),enumerable:!1}}),sM}();function sZ(e,t){return`${e.open}${t}${e.close}`}function sF(e,t){try{return JSON.stringify(e,null,2)}catch{return t}}function sB(e){return"string"==typeof e?e.trim():null==e?e:sF(e,e.toString())}function sq(e){if(!e.end_time)return"";let t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}iP({},{ConsoleCallbackHandler:()=>sJ});let{color:sW}=sD;var sJ=class extends sR{name="console_callback_handler";persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let e=this.runMap.get(r.parent_run_id);if(e)t.push(e),r=e;else break}return t}getBreadcrumbs(e){let t=[...this.getParents(e).reverse(),e].map((e,t,r)=>{let i=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?sZ(sD.bold,i):i}).join(" > ");return sZ(sW.grey,t)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${sZ(sW.green,"[chain/start]")} [${t}] Entering Chain run with input: ${sF(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${sZ(sW.cyan,"[chain/end]")} [${t}] [${sq(e)}] Exiting Chain run with output: ${sF(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${sZ(sW.red,"[chain/error]")} [${t}] [${sq(e)}] Chain run errored with error: ${sF(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(e=>e.trim())}:e.inputs;console.log(`${sZ(sW.green,"[llm/start]")} [${t}] Entering LLM run with input: ${sF(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${sZ(sW.cyan,"[llm/end]")} [${t}] [${sq(e)}] Exiting LLM run with output: ${sF(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${sZ(sW.red,"[llm/error]")} [${t}] [${sq(e)}] LLM run errored with error: ${sF(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${sZ(sW.green,"[tool/start]")} [${t}] Entering Tool run with input: "${sB(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${sZ(sW.cyan,"[tool/end]")} [${t}] [${sq(e)}] Exiting Tool run with output: "${sB(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${sZ(sW.red,"[tool/error]")} [${t}] [${sq(e)}] Tool run errored with error: ${sF(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${sZ(sW.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${sF(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${sZ(sW.cyan,"[retriever/end]")} [${t}] [${sq(e)}] Exiting Retriever run with output: ${sF(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${sZ(sW.red,"[retriever/error]")} [${t}] [${sq(e)}] Retriever run errored with error: ${sF(e.error,"[error]")}`)}onAgentAction(e){let t=this.getBreadcrumbs(e);console.log(`${sZ(sW.blue,"[agent/action]")} [${t}] Agent selected action: ${sF(e.actions[e.actions.length-1],"[action]")}`)}};e.i(49753);let sG=()=>(void 0===u&&(u=new sv("false"===ag("LANGCHAIN_CALLBACKS_BACKGROUND")?{blockOnRootRunFinalization:!0}:{})),u),sH=Symbol.for("ls:tracing_async_local_storage"),sV=new class{getStore(){}run(e,t){return t()}},sK=new class{getInstance(){return globalThis[sH]??sV}initializeGlobalInstance(e){void 0===globalThis[sH]&&(globalThis[sH]=e)}};function sX(e){return"function"==typeof e&&"langsmith:traceable"in e}Symbol.for("langsmith:traceable:root"),iP({},{LangChainTracer:()=>sY});var sY=class e extends sR{name="langchain_tracer";projectName;exampleId;client;replicas;usesRunTreeMap=!0;constructor(t={}){super(t);const{exampleId:r,projectName:i,client:n,replicas:a}=t;this.projectName=i??aE(),this.replicas=a,this.exampleId=r,this.client=n??sG();const s=e.getTraceableRunTree();s&&this.updateFromRunTree(s)}async persistRun(e){}async onRunCreate(e){let t=this.getRunTreeWithTracingConfig(e.id);await t?.postRun()}async onRunUpdate(e){let t=this.getRunTreeWithTracingConfig(e.id);await t?.patchRun()}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){this.runTreeMap.set(e.id,e);let t=e,r=new Set;for(;t.parent_run&&!r.has(t.id)&&(r.add(t.id),t.parent_run);){;t=t.parent_run}r.clear();let i=[t];for(;i.length>0;){let e=i.shift();!(!e||r.has(e.id))&&(r.add(e.id),this.runTreeMap.set(e.id,e),e.child_runs&&i.push(...e.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){let t=this.runTreeMap.get(e);if(t)return new sA({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return function(e=!1){let t=sK.getInstance().getStore();if(!e&&void 0===t)throw Error("Could not get the current run tree.\n\nPlease make sure you are calling this method within a traceable function and that tracing is enabled.");return t}(!0)}catch{return}}},sQ=e.i(48271);sQ.default;var s0=sQ;class s1 extends Error{name="TimeoutError";constructor(e,t){super(e,t),Error.captureStackTrace?.(this,s1)}}let s4=e=>e.reason??new DOMException("This operation was aborted.","AbortError");class s2{#e=[];enqueue(e,t){let{priority:r=0,id:i}=t??{},n={priority:r,id:i,run:e};if(0===this.size||this.#e[this.size-1].priority>=r)return void this.#e.push(n);let a=function(e,t,r){let i=0,n=e.length;for(;n>0;){let a=Math.trunc(n/2),s=i+a;0>=r(e[s],t)?(i=++s,n-=a+1):n=a}return i}(this.#e,n,(e,t)=>t.priority-e.priority);this.#e.splice(a,0,n)}setPriority(e,t){let r=this.#e.findIndex(t=>t.id===e);if(-1===r)throw ReferenceError(`No promise function with the id "${e}" exists in the queue.`);let[i]=this.#e.splice(r,1);this.enqueue(i.run,{priority:t,id:e})}dequeue(){let e=this.#e.shift();return e?.run}filter(e){return this.#e.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this.#e.length}}class s6 extends s0.default{#t;#r;#i=0;#n;#a=!1;#s=!1;#o;#l=0;#u=0;#c;#d;#e;#p;#h=0;#m;#f;#g=1n;#y=new Map;timeout;constructor(e){if(super(),!("number"==typeof(e={carryoverIntervalCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:s2,...e}).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);if(this.#t=e.carryoverIntervalCount??e.carryoverConcurrencyCount??!1,this.#r=e.intervalCap===1/0||0===e.interval,this.#n=e.intervalCap,this.#o=e.interval,this.#e=new e.queueClass,this.#p=e.queueClass,this.concurrency=e.concurrency,void 0!==e.timeout&&!(Number.isFinite(e.timeout)&&e.timeout>0))throw TypeError(`Expected \`timeout\` to be a positive finite number, got \`${e.timeout}\` (${typeof e.timeout})`);this.timeout=e.timeout,this.#f=!1===e.autoStart,this.#_()}get #v(){return this.#r||this.#i<this.#n}get #b(){return this.#h<this.#m}#w(){this.#h--,0===this.#h&&this.emit("pendingZero"),this.#$(),this.emit("next")}#x(){this.#k(),this.#I(),this.#d=void 0}get #O(){let e=Date.now();if(void 0===this.#c){let t=this.#l-e;if(!(t<0))return this.#S(t),!0;if(this.#u>0){let t=e-this.#u;if(t<this.#o)return this.#S(this.#o-t),!0}this.#i=this.#t?this.#h:0}return!1}#S(e){void 0===this.#d&&(this.#d=setTimeout(()=>{this.#x()},e))}#E(){this.#c&&(clearInterval(this.#c),this.#c=void 0)}#T(){this.#d&&(clearTimeout(this.#d),this.#d=void 0)}#$(){if(0===this.#e.size)return this.#E(),this.emit("empty"),0===this.#h&&(this.#T(),this.emit("idle")),!1;let e=!1;if(!this.#f){let t=!this.#O;if(this.#v&&this.#b){let r=this.#e.dequeue();this.#r||(this.#i++,this.#A()),this.emit("active"),this.#u=Date.now(),r(),t&&this.#I(),e=!0}}return e}#I(){this.#r||void 0!==this.#c||(this.#c=setInterval(()=>{this.#k()},this.#o),this.#l=Date.now()+this.#o)}#k(){0===this.#i&&0===this.#h&&this.#c&&this.#E(),this.#i=this.#t?this.#h:0,this.#N(),this.#A()}#N(){for(;this.#$(););}get concurrency(){return this.#m}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#m=e,this.#N()}setPriority(e,t){if("number"!=typeof t||!Number.isFinite(t))throw TypeError(`Expected \`priority\` to be a finite number, got \`${t}\` (${typeof t})`);this.#e.setPriority(e,t)}async add(e,t={}){return t.id??=(this.#g++).toString(),t={timeout:this.timeout,...t},new Promise((r,i)=>{let n=Symbol(`task-${t.id}`);this.#e.enqueue(async()=>{let a;this.#h++,this.#y.set(n,{id:t.id,priority:t.priority??0,startTime:Date.now(),timeout:t.timeout});try{try{t.signal?.throwIfAborted()}catch(e){throw!this.#r&&this.#i--,this.#y.delete(n),e}let i=e({signal:t.signal});if(t.timeout&&(i=function(e,t){let r,i,{milliseconds:n,fallback:a,message:s,customTimers:o={setTimeout,clearTimeout},signal:l}=t,u=new Promise((t,u)=>{if("number"!=typeof n||1!==Math.sign(n))throw TypeError(`Expected \`milliseconds\` to be a positive number, got \`${n}\``);if(l?.aborted)return void u(s4(l));if(l&&(i=()=>{u(s4(l))},l.addEventListener("abort",i,{once:!0})),e.then(t,u),n===1/0)return;let c=new s1;r=o.setTimeout.call(void 0,()=>{if(a){try{t(a())}catch(e){u(e)}return}"function"==typeof e.cancel&&e.cancel(),!1===s?t():s instanceof Error?u(s):(c.message=s??`Promise timed out after ${n} milliseconds`,u(c))},n)}).finally(()=>{u.clear(),i&&l&&l.removeEventListener("abort",i)});return u.clear=()=>{o.clearTimeout.call(void 0,r),r=void 0},u}(Promise.resolve(i),{milliseconds:t.timeout,message:`Task timed out after ${t.timeout}ms (queue has ${this.#h} running, ${this.#e.size} waiting)`})),t.signal){let{signal:e}=t;i=Promise.race([i,new Promise((t,r)=>{a=()=>{r(e.reason)},e.addEventListener("abort",a,{once:!0})})])}let s=await i;r(s),this.emit("completed",s)}catch(e){i(e),this.emit("error",e)}finally{a&&t.signal?.removeEventListener("abort",a),this.#y.delete(n),queueMicrotask(()=>{this.#w()})}},t),this.emit("add"),this.#$()})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this.#f&&(this.#f=!1,this.#N()),this}pause(){this.#f=!0}clear(){this.#e=new this.#p,this.#C()}async onEmpty(){0!==this.#e.size&&await this.#P("empty")}async onSizeLessThan(e){this.#e.size<e||await this.#P("next",()=>this.#e.size<e)}async onIdle(){(0!==this.#h||0!==this.#e.size)&&await this.#P("idle")}async onPendingZero(){0!==this.#h&&await this.#P("pendingZero")}async onRateLimit(){this.isRateLimited||await this.#P("rateLimit")}async onRateLimitCleared(){this.isRateLimited&&await this.#P("rateLimitCleared")}async onError(){return new Promise((e,t)=>{let r=e=>{this.off("error",r),t(e)};this.on("error",r)})}async #P(e,t){return new Promise(r=>{let i=()=>{(!t||t())&&(this.off(e,i),r())};this.on(e,i)})}get size(){return this.#e.size}sizeBy(e){return this.#e.filter(e).length}get pending(){return this.#h}get isPaused(){return this.#f}#_(){this.#r||(this.on("add",()=>{this.#e.size>0&&this.#A()}),this.on("next",()=>{this.#A()}))}#A(){this.#r||this.#s||(this.#s=!0,queueMicrotask(()=>{this.#s=!1,this.#C()}))}#C(){let e=this.#a,t=!this.#r&&this.#i>=this.#n&&this.#e.size>0;t!==e&&(this.#a=t,this.emit(t?"rateLimit":"rateLimitCleared"))}get isRateLimited(){return this.#a}get isSaturated(){return this.#h===this.#m&&this.#e.size>0||this.isRateLimited&&this.#e.size>0}get runningTasks(){return[...this.#y.values()].map(e=>({...e}))}}async function s9(e,t){if(!0===t){let t=al();void 0!==t?await t.run(void 0,async()=>e()):await e()}else void 0===c&&(c=new("default"in s6?s6.default:s6)({autoStart:!0,concurrency:1})),c.add(async()=>{let t=al();void 0!==t?await t.run(void 0,async()=>e()):await e()})}async function s5(){let e=sG();await Promise.allSettled([void 0!==c?c.onIdle():Promise.resolve(),e.awaitPendingTraceBatches()])}function s3(e){let t=al();if(void 0===t)return;let r=t.getStore();return r?.[ao]?.[e]}iP({},{awaitAllCallbacks:()=>s5,consumeCallback:()=>s9});let s8=Symbol("lc:configure_hooks");var ay=ay;function s7(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}iP({},{BaseCallbackManager:()=>oe,BaseRunManager:()=>ot,CallbackManager:()=>os,CallbackManagerForChainRun:()=>on,CallbackManagerForLLMRun:()=>oi,CallbackManagerForRetrieverRun:()=>or,CallbackManagerForToolRun:()=>oa,ensureHandler:()=>oo,parseCallbackConfigArg:()=>s7});var oe=class{setHandler(e){return this.setHandlers([e])}},ot=class{constructor(e,t,r,i,n,a,s,o){this.runId=e,this.handlers=t,this.inheritableHandlers=r,this.tags=i,this.inheritableTags=n,this.metadata=a,this.inheritableMetadata=s,this._parentRunId=o}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>s9(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,i,n){await Promise.all(this.handlers.map(r=>s9(async()=>{try{await r.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleCustomEvent: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}},or=class extends ot{getChild(e){let t=new os(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>s9(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw e}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>s9(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}},t.awaitHandlers)))}},oi=class extends ot{async handleLLMNewToken(e,t,r,i,n,a){await Promise.all(this.handlers.map(r=>s9(async()=>{if(!r.ignoreLLM)try{await r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}async handleLLMError(e,t,r,i,n){await Promise.all(this.handlers.map(t=>s9(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleLLMEnd(e,t,r,i,n){await Promise.all(this.handlers.map(t=>s9(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}},on=class extends ot{getChild(e){let t=new os(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,i,n){await Promise.all(this.handlers.map(t=>s9(async()=>{if(!t.ignoreChain)try{await t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleChainEnd(e,t,r,i,n){await Promise.all(this.handlers.map(t=>s9(async()=>{if(!t.ignoreChain)try{await t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>s9(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>s9(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}},oa=class extends ot{getChild(e){let t=new os(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>s9(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>s9(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}},os=class e extends oe{handlers=[];inheritableHandlers=[];tags=[];inheritableTags=[];metadata={};inheritableMetadata={};name="callback_manager";_parentRunId;constructor(e,t){super(),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r,i,n,a,s,o){return Promise.all(t.map(async(t,i)=>{let a=0===i&&r?r:(0,ay.default)();return await Promise.all(this.handlers.map(r=>{if(!r.ignoreLLM)return sj(r)&&r._createRunForLLMStart(e,[t],a,this._parentRunId,n,this.tags,this.metadata,o),s9(async()=>{try{await r.handleLLMStart?.(e,[t],a,this._parentRunId,n,this.tags,this.metadata,o)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new oi(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r,i,n,a,s,o){return Promise.all(t.map(async(t,i)=>{let a=0===i&&r?r:(0,ay.default)();return await Promise.all(this.handlers.map(r=>{if(!r.ignoreLLM)return sj(r)&&r._createRunForChatModelStart(e,[t],a,this._parentRunId,n,this.tags,this.metadata,o),s9(async()=>{try{if(r.handleChatModelStart)await r.handleChatModelStart?.(e,[t],a,this._parentRunId,n,this.tags,this.metadata,o);else if(r.handleLLMStart){let i=n2(t);await r.handleLLMStart?.(e,[i],a,this._parentRunId,n,this.tags,this.metadata,o)}}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new oi(a,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=(0,ay.default)(),i,n,a,s){return await Promise.all(this.handlers.map(n=>{if(!n.ignoreChain)return sj(n)&&n._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,i,s),s9(async()=>{try{await n.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,i,s)}catch(e){if((n.raiseError?console.error:console.warn)(`Error in handler ${n.constructor.name}, handleChainStart: ${e}`),n.raiseError)throw e}},n.awaitHandlers)})),new on(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=(0,ay.default)(),i,n,a,s){return await Promise.all(this.handlers.map(i=>{if(!i.ignoreAgent)return sj(i)&&i._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,s),s9(async()=>{try{await i.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s)}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleToolStart: ${e}`),i.raiseError)throw e}},i.awaitHandlers)})),new oa(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=(0,ay.default)(),i,n,a,s){return await Promise.all(this.handlers.map(i=>{if(!i.ignoreRetriever)return sj(i)&&i._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,s),s9(async()=>{try{await i.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s)}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleRetrieverStart: ${e}`),i.raiseError)throw e}},i.awaitHandlers)})),new or(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,i,n){await Promise.all(this.handlers.map(i=>s9(async()=>{if(!i.ignoreCustomEvent)try{await i.handleCustomEvent?.(e,t,r,this.tags,this.metadata)}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${e}`),i.raiseError)throw e}},i.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){for(let r of(this.handlers=[],this.inheritableHandlers=[],e))this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(t=[],r=!0){let i=new e(this._parentRunId);for(let e of this.handlers){let t=this.inheritableHandlers.includes(e);i.addHandler(e,t)}for(let e of this.tags){let t=this.inheritableTags.includes(e);i.addTags([e],t)}for(let e of Object.keys(this.metadata)){let t=Object.keys(this.inheritableMetadata).includes(e);i.addMetadata({[e]:this.metadata[e]},t)}for(let e of t)i.handlers.filter(e=>"console_callback_handler"===e.name).some(t=>t.name===e.name)||i.addHandler(e,r);return i}static fromHandlers(e){class t extends ab{name=(0,ay.default)();constructor(){super(),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static configure(e,t,r,i,n,a,s){return this._configureSync(e,t,r,i,n,a,s)}static _configureSync(t,r,i,n,a,s,o){var l;let u;(t||r)&&(Array.isArray(t)||!t?(u=new e).setHandlers(t?.map(oo)??[],!0):u=t,u=u.copy(Array.isArray(r)?r.map(oo):r?.handlers,!1));let c="true"===ag("LANGCHAIN_VERBOSE")||o?.verbose,d=sY.getTraceableRunTree()?.tracingEnabled||(void 0!==l?l:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(e=>"true"===ag(e))),p=d||(ag("LANGCHAIN_TRACING")??!1);if(c||p){if(u||(u=new e),c&&!u.handlers.some(e=>e.name===sJ.prototype.name)){let e=new sJ;u.addHandler(e,!0)}if(p&&!u.handlers.some(e=>"langchain_tracer"===e.name)&&d){let e=new sY;u.addHandler(e,!0)}if(d){let e=sY.getTraceableRunTree();if(e&&void 0===u._parentRunId){u._parentRunId=e.id;let t=u.handlers.find(e=>"langchain_tracer"===e.name);t?.updateFromRunTree(e)}}}for(let{contextVar:t,inheritable:r=!0,handlerClass:i,envVar:n}of s3(s8)||[]){let a,s=n&&"true"===ag(n)&&i,o=void 0!==t?s3(t):void 0;o&&aw(o)?a=o:s&&(a=new i({})),void 0!==a&&(u||(u=new e),u.handlers.some(e=>e.name===a.name)||u.addHandler(a,r))}return(i||n)&&u&&(u.addTags(i??[]),u.addTags(n??[],!1)),(a||s)&&u&&(u.addMetadata(a??{}),u.addMetadata(s??{},!1)),u}};function oo(e){return"name"in e?e:ab.fromMethods(e)}var ol=class{getStore(){}run(e,t){return t()}enterWith(e){}};let ou=new ol,oc=Symbol.for("lc:child_config"),od=new class{getInstance(){return al()??ou}getRunnableConfig(){let e=this.getInstance();return e.getStore()?.extra?.[oc]}runWithConfig(e,t,r){let i,n=os._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),a=this.getInstance(),s=a.getStore(),o=n?.getParentRunId(),l=n?.handlers?.find(e=>e?.name==="langchain_tracer");return l&&o?i=l.getRunTreeWithTracingConfig(o):r||(i=new sA({name:"<runnable_lambda>",tracingEnabled:!1})),i&&(i.extra={...i.extra,[oc]:e}),void 0!==s&&void 0!==s[ao]&&(void 0===i&&(i={}),i[ao]=s[ao]),a.run(i,t)}initializeGlobalInstance(e){void 0===al()&&(globalThis[as]=e)}};async function op(e){return os._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function oh(...e){let t={};for(let r of e.filter(e=>!!e))for(let e of Object.keys(r))if("metadata"===e)t[e]={...t[e],...r[e]};else if("tags"===e){let i=t[e]??[];t[e]=[...new Set(i.concat(r[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...r[e]};else if("timeout"===e)void 0===t.timeout?t.timeout=r.timeout:void 0!==r.timeout&&(t.timeout=Math.min(t.timeout,r.timeout));else if("signal"===e)void 0===t.signal?t.signal=r.signal:void 0!==r.signal&&("any"in AbortSignal?t.signal=AbortSignal.any([t.signal,r.signal]):t.signal=r.signal);else if("callbacks"===e){let e=t.callbacks,i=r.callbacks;if(Array.isArray(i))if(e)if(Array.isArray(e))t.callbacks=e.concat(i);else{let r=e.copy();for(let e of i)r.addHandler(oo(e),!0);t.callbacks=r}else t.callbacks=i;else if(i)if(e)if(Array.isArray(e)){let r=i.copy();for(let t of e)r.addHandler(oo(t),!0);t.callbacks=r}else t.callbacks=new os(i._parentRunId,{handlers:e.handlers.concat(i.handlers),inheritableHandlers:e.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(i.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(i.inheritableTags))),metadata:{...e.metadata,...i.metadata}});else t.callbacks=i}else t[e]=r[e]??t[e];return t}iP({},{AsyncLocalStorageProviderSingleton:()=>od,MockAsyncLocalStorage:()=>ol,_CONTEXT_VARIABLES_KEY:()=>ao});let om=new Set(["string","number","boolean"]);function of(e){let t=od.getRunnableConfig(),r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(t){let{runId:e,runName:i,...n}=t;r=Object.entries(n).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),r)}if(e&&(r=Object.entries(e).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),r)),r?.configurable)for(let e of Object.keys(r.configurable))om.has(typeof r.configurable[e])&&!r.metadata?.[e]&&(r.metadata||(r.metadata={}),r.metadata[e]=r.configurable[e]);if(void 0!==r.timeout){if(r.timeout<=0)throw Error("Timeout must be a positive number");let e=AbortSignal.timeout(r.timeout);void 0!==r.signal?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,e])):r.signal=e,delete r.timeout}return r}function og(e={},{callbacks:t,maxConcurrency:r,recursionLimit:i,runName:n,configurable:a,runId:s}={}){let o=of(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==i&&(o.recursionLimit=i),void 0!==r&&(o.maxConcurrency=r),void 0!==n&&(o.runName=n),void 0!==a&&(o.configurable={...o.configurable,...a}),void 0!==s&&delete o.runId,o}function oy(e){if(e)return{configurable:e.configurable,recursionLimit:e.recursionLimit,callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,maxConcurrency:e.maxConcurrency,timeout:e.timeout,signal:e.signal,store:e.store}}async function o_(e,t){let r;return void 0===t?e:Promise.race([e.catch(e=>{if(!t?.aborted)throw e}),new Promise((e,i)=>{r=()=>{i(ov(t))},t.addEventListener("abort",r),t.aborted&&i(ov(t))})]).finally(()=>t.removeEventListener("abort",r))}function ov(e){return e?.reason instanceof Error?e.reason:"string"==typeof e?.reason?Error(e.reason):Error("Aborted")}iP({},{AsyncGeneratorWithSetup:()=>ox,IterableReadableStream:()=>ob,atee:()=>ow,concat:()=>o$,pipeGeneratorWithSetup:()=>ok});var ob=class e extends ReadableStream{reader;ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();if(e.done)return this.reader.releaseLock(),{done:!0,value:void 0};return{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}static fromReadableStream(t){let r=t.getReader();return new e({start:e=>(function t(){return r.read().then(({done:r,value:i})=>r?void e.close():(e.enqueue(i),t()))})(),cancel(){r.releaseLock()}})}static fromAsyncGenerator(t){return new e({async pull(e){let{value:r,done:i}=await t.next();i&&e.close(),e.enqueue(r)},async cancel(e){await t.return(e)}})}};function ow(e,t=2){let r=Array.from({length:t},()=>[]);return r.map(async function*(t){for(;;)if(0===t.length){let t=await e.next();for(let e of r)e.push(t)}else{if(t[0].done)return;yield t.shift().value}})}function o$(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if("string"==typeof e&&"string"==typeof t)return e+t;if("number"==typeof e&&"number"==typeof t)return e+t;if("concat"in e&&"function"==typeof e.concat)return e.concat(t);if("object"==typeof e&&"object"==typeof t){let r={...e};for(let[e,i]of Object.entries(t))e in r&&!Array.isArray(r[e])?r[e]=o$(r[e],i):r[e]=i;return r}else throw Error(`Cannot concat ${typeof e} and ${typeof t}`)}var ox=class{generator;setup;config;signal;firstResult;firstResultUsed=!1;constructor(e){this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,r)=>{od.runWithConfig(oy(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then(e=>t(void 0),r)},!0)})}async next(...e){return(this.signal?.throwIfAborted(),this.firstResultUsed)?od.runWithConfig(oy(this.config),this.signal?async()=>o_(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}};async function ok(e,t,r,i,...n){let a=new ox({generator:t,startSetup:r,signal:i}),s=await a.setup;return{output:e(a,s,...n),setup:s}}let oI=Object.prototype.hasOwnProperty;function oO(e,t){return oI.call(e,t)}function oS(e){if(Array.isArray(e)){let t=Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)oO(e,r)&&t.push(r);return t}function oE(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function oT(e){let t,r=0,i=e.length;for(;r<i;){if((t=e.charCodeAt(r))>=48&&t<=57){r++;continue}return!1}return!0}function oA(e){return -1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function oN(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function oC(e,t){let r=[e];for(let e in t){let i="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==i&&r.push(`${e}: ${i}`)}return r.join("\n")}var oP=class extends Error{constructor(e,t,r,i,n){super(oC(e,{name:t,index:r,operation:i,tree:n})),this.name=t,this.index=r,this.operation=i,this.tree=n,Object.setPrototypeOf(this,new.target.prototype),this.message=oC(e,{name:t,index:r,operation:i,tree:n})}},oj={};iP(oj,{JsonPatchError:()=>oR,_areEquals:()=>oW,applyOperation:()=>oD,applyPatch:()=>oZ,applyReducer:()=>oF,deepClone:()=>oL,getValueByPointer:()=>oM,validate:()=>oq,validator:()=>oB});let oR=oP,oL=oE,oU={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var i=e[t];return delete e[t],{newDocument:r,removed:i}},replace:function(e,t,r){var i=e[t];return e[t]=this.value,{newDocument:r,removed:i}},move:function(e,t,r){let i=oM(r,this.path);i&&(i=oE(i));let n=oD(r,{op:"remove",path:this.from}).removed;return oD(r,{op:"add",path:this.path,value:n}),{newDocument:r,removed:i}},copy:function(e,t,r){let i=oM(r,this.from);return oD(r,{op:"add",path:this.path,value:oE(i)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:oW(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var oz={add:function(e,t,r){return oT(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var i=e[t];return e[t]=this.value,{newDocument:r,removed:i}},move:oU.move,copy:oU.copy,test:oU.test,_get:oU._get};function oM(e,t){if(""==t)return e;var r={op:"_get",path:t};return oD(e,r),r.value}function oD(e,t,r=!1,i=!0,n=!0,a=0){if(r&&("function"==typeof r?r(t,0,e,t.path):oB(t,0)),""===t.path){let i={newDocument:e};if("add"===t.op)return i.newDocument=t.value,i;if("replace"===t.op)return i.newDocument=t.value,i.removed=e,i;if("move"===t.op||"copy"===t.op)return i.newDocument=oM(e,t.from),"move"===t.op&&(i.removed=e),i;else if("test"===t.op){if(i.test=oW(e,t.value),!1===i.test)throw new oR("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return i.newDocument=e,i}else if("remove"===t.op)return i.removed=e,i.newDocument=null,i;else if("_get"===t.op)return t.value=e,i;else if(!r)return i;else throw new oR("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e)}{let s,o,l;i||(e=oE(e));let u=(t.path||"").split("/"),c=e,d=1,p=u.length;for(o="function"==typeof r?r:oB;;){if((s=u[d])&&-1!=s.indexOf("~")&&(s=oN(s)),n&&("__proto__"==s||"prototype"==s&&d>0&&"constructor"==u[d-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===l&&(void 0===c[s]?l=u.slice(0,d).join("/"):d==p-1&&(l=t.path),void 0!==l&&o(t,0,e,l)),d++,Array.isArray(c)){if("-"===s)s=c.length;else if(r&&!oT(s))throw new oR("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);else oT(s)&&(s=~~s);if(d>=p){if(r&&"add"===t.op&&s>c.length)throw new oR("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);let i=oz[t.op].call(t,c,s,e);if(!1===i.test)throw new oR("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return i}}else if(d>=p){let r=oU[t.op].call(t,c,s,e);if(!1===r.test)throw new oR("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return r}if(c=c[s],r&&d<p&&(!c||"object"!=typeof c))throw new oR("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}}function oZ(e,t,r,i=!0,n=!0){if(r&&!Array.isArray(t))throw new oR("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=oE(e));let a=Array(t.length);for(let i=0,s=t.length;i<s;i++)a[i]=oD(e,t[i],r,!0,n,i),e=a[i].newDocument;return a.newDocument=e,a}function oF(e,t,r){let i=oD(e,t);if(!1===i.test)throw new oR("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return i.newDocument}function oB(e,t,r,i){if("object"!=typeof e||null===e||Array.isArray(e))throw new oR("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(oU[e.op]){if("string"!=typeof e.path)throw new oR("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);else if(0!==e.path.indexOf("/")&&e.path.length>0)throw new oR('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);else if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new oR("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new oR("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&function e(t){if(void 0===t)return!0;if(t){if(Array.isArray(t)){for(let r=0,i=t.length;r<i;r++)if(e(t[r]))return!0}else if("object"==typeof t){let i=oS(t),n=i.length;for(var r=0;r<n;r++)if(e(t[i[r]]))return!0}}return!1}(e.value))throw new oR("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);else if(r){if("add"==e.op){var n=e.path.split("/").length,a=i.split("/").length;if(n!==a+1&&n!==a)throw new oR("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==i)throw new oR("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var s=oq([{op:"_get",path:e.from,value:void 0}],r);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new oR("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new oR("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function oq(e,t,r){try{if(!Array.isArray(e))throw new oR("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)oZ(oE(t),oE(e),r||!0);else{r=r||oB;for(var i=0;i<e.length;i++)r(e[i],i,t,void 0)}}catch(e){if(e instanceof oR)return e;throw e}}function oW(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,i,n,a=Array.isArray(e),s=Array.isArray(t);if(a&&s){if((i=e.length)!=t.length)return!1;for(r=i;0!=r--;)if(!oW(e[r],t[r]))return!1;return!0}if(a!=s)return!1;var o=Object.keys(e);if((i=o.length)!==Object.keys(t).length)return!1;for(r=i;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=i;0!=r--;)if(!oW(e[n=o[r]],t[n]))return!1;return!0}return e!=e&&t!=t}function oJ(e,t,r=!1){var i=[];return!function e(t,r,i,n,a){if(r!==t){"function"==typeof r.toJSON&&(r=r.toJSON());for(var s=oS(r),o=oS(t),l=!1,u=o.length-1;u>=0;u--){var c=o[u],d=t[c];if(oO(r,c)&&(void 0!==r[c]||void 0===d||!1!==Array.isArray(r))){var p=r[c];"object"==typeof d&&null!=d&&"object"==typeof p&&null!=p&&Array.isArray(d)===Array.isArray(p)?e(d,p,i,n+"/"+oA(c),a):d!==p&&(a&&i.push({op:"test",path:n+"/"+oA(c),value:oE(d)}),i.push({op:"replace",path:n+"/"+oA(c),value:oE(p)}))}else Array.isArray(t)===Array.isArray(r)?(a&&i.push({op:"test",path:n+"/"+oA(c),value:oE(d)}),i.push({op:"remove",path:n+"/"+oA(c)}),l=!0):(a&&i.push({op:"test",path:n,value:t}),i.push({op:"replace",path:n,value:r}))}if(l||s.length!=o.length)for(var u=0;u<s.length;u++){var c=s[u];oO(t,c)||void 0===r[c]||i.push({op:"add",path:n+"/"+oA(c),value:oE(r[c])})}}}(e,t,i,"",r),i}({...oj,JsonPatchError:oP,deepClone:oE,escapePathComponent:oA,unescapePathComponent:oN}),iP({},{LogStreamCallbackHandler:()=>oY,RunLog:()=>oH,RunLogPatch:()=>oG,isLogStreamHandler:()=>oV});var oG=class{ops;constructor(e){this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),r=oZ({},t);return new oH({ops:t,state:r[r.length-1].newDocument})}},oH=class e extends oG{state;constructor(e){super(e),this.state=e.state}concat(t){let r=this.ops.concat(t.ops),i=oZ(this.state,t.ops);return new e({ops:r,state:i[i.length-1].newDocument})}static fromRunLogPatch(t){let r=oZ({},t.ops);return new e({ops:t.ops,state:r[r.length-1].newDocument})}};let oV=e=>"log_stream_tracer"===e.name;async function oK(e,t){if("original"===t)throw Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:r}=e;return["retriever","llm","prompt"].includes(e.run_type)?r:1!==Object.keys(r).length||r?.input!==""?r.input:void 0}async function oX(e,t){let{outputs:r}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?r:void 0!==r&&1===Object.keys(r).length&&r?.output!==void 0?r.output:r}var oY=class extends sR{autoClose=!0;includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;_schemaFormat="original";rootId;keyMapByRunId={};counterMapByRunName={};transformStream;writer;receiveStream;name="log_stream_tracer";lc_prefer_streaming=!0;constructor(e){super({_awaitHandler:!0,...e}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ob.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){for await(let r of t){if(e!==this.rootId){let t=this.keyMapByRunId[e];t&&await this.writer.write(new oG({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new oG({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(r.inputs=await oK(e,this._schemaFormat)),await this.writer.write(new oG({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(void 0===t)return;let r=[];"streaming_events"===this._schemaFormat&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await oK(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await oX(e,this._schemaFormat)}),void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let i=new oG({ops:r});await this.writer.write(i)}finally{if(e.id===this.rootId){let t=new oG({ops:[{op:"replace",path:"/final_output",value:await oX(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){let i,n=this.keyMapByRunId[e.id];if(void 0===n)return;if(void 0!==e.inputs.messages){var a;i=void 0!==(a=r?.chunk)&&void 0!==a.message?r?.chunk:new nY({id:`run-${e.id}`,content:t})}else i=t;let s=new oG({ops:[{op:"add",path:`/logs/${n}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${n}/streamed_output/-`,value:i}]});await this.writer.write(s)}};iP({},{ChatGenerationChunk:()=>o1,GenerationChunk:()=>o0,RUN_KEY:()=>oQ});let oQ="__run";var o0=class e{text;generationInfo;constructor(e){this.text=e.text,this.generationInfo=e.generationInfo}concat(t){return new e({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo}})}},o1=class e extends o0{message;constructor(e){super(e),this.message=e.message}concat(t){return new e({text:this.text+t.text,generationInfo:{...this.generationInfo,...t.generationInfo},message:this.message.concat(t.message)})}};function o4({name:e,serialized:t}){return void 0!==e?e:t?.name!==void 0?t.name:t?.id!==void 0&&Array.isArray(t?.id)?t.id[t.id.length-1]:"Unnamed"}let o2=e=>"event_stream_tracer"===e.name;var o6=class extends sR{autoClose=!0;includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;runInfoMap=new Map;tappedPromises=new Map;transformStream;writer;receiveStream;name="event_stream_tracer";lc_prefer_streaming=!0;constructor(e){super({_awaitHandler:!0,...e}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ob.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.runType)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.runType)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){let r=await t.next();if(r.done)return;let i=this.runInfoMap.get(e);if(void 0===i)return void(yield r.value);function n(e,t){return"llm"===e&&"string"==typeof t?new o0({text:t}):t}let a=this.tappedPromises.get(e);if(void 0===a){let s;a=new Promise(e=>{s=e}),this.tappedPromises.set(e,a);try{let a={event:`on_${i.runType}_stream`,run_id:e,name:i.name,tags:i.tags,metadata:i.metadata,data:{}};for await(let e of(await this.send({...a,data:{chunk:n(i.runType,r.value)}},i),yield r.value,t))"tool"!==i.runType&&"retriever"!==i.runType&&await this.send({...a,data:{chunk:n(i.runType,e)}},i),yield e}finally{s?.()}}else for await(let e of(yield r.value,t))yield e}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){let r=this.tappedPromises.get(e.run_id);void 0!==r?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){let t=o4(e),r=void 0!==e.inputs.messages?"chat_model":"llm",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,i);let n=`on_${r}_start`;await this.send({event:n,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)}async onLLMNewToken(e,t,r){let i,n,a=this.runInfoMap.get(e.id);if(void 0===a)throw Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(1!==this.runInfoMap.size){if("chat_model"===a.runType)n="on_chat_model_stream",i=r?.chunk===void 0?new nY({content:t,id:`run-${e.id}`}):r.chunk.message;else if("llm"===a.runType)n="on_llm_stream",i=r?.chunk===void 0?new o0({text:t}):r.chunk;else throw Error(`Unexpected run type ${a.runType}`);await this.send({event:n,data:{chunk:i},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}}async onLLMEnd(e){let t,r,i=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===i)throw Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let n=e.outputs?.generations;if("chat_model"===i.runType){for(let e of n??[]){if(void 0!==r)break;r=e[0]?.message}t="on_chat_model_end"}else if("llm"===i.runType)r={generations:n?.map(e=>e.map(e=>({text:e.text,generationInfo:e.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},t="on_llm_end";else throw Error(`onLLMEnd: Unexpected run type: ${i.runType}`);await this.sendEndEvent({event:t,data:{output:r,input:i.inputs},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}async onChainStart(e){let t=o4(e),r=e.run_type??"chain",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},n={};""===e.inputs.input&&1===Object.keys(e.inputs).length?(n={},i.inputs={}):void 0!==e.inputs.input?(n.input=e.inputs.input,i.inputs=e.inputs.input):(n.input=e.inputs,i.inputs=e.inputs),this.runInfoMap.set(e.id,i),await this.send({event:`on_${r}_start`,data:n,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)}async onChainEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let r=`on_${e.run_type}_end`,i=e.inputs??t.inputs??{},n={output:e.outputs?.output??e.outputs,input:i};i.input&&1===Object.keys(i).length&&(n.input=i.input,t.inputs=i.input),await this.sendEndEvent({event:r,data:n,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){let t=o4(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)}async onToolEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(void 0===t.inputs)throw Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let r=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){let t=o4(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,r),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onRetrieverEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){let i=this.runInfoMap.get(r);if(void 0===i)throw Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:i.tags,metadata:i.metadata,data:t},i)}async finish(){Promise.all([...this.tappedPromises.values()]).finally(()=>{this.writer.close()})}};iP({},{AsyncCaller:()=>o3});let o9=[400,401,402,403,404,405,406,407,409],o5=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status??e?.status;if(t&&o9.includes(+t))throw e;if(e?.error?.code==="insufficient_quota"){let t=Error(e?.message);throw t.name="InsufficientQuotaError",t}};var o3=class{maxConcurrency;maxRetries;onFailedAttempt;queue;constructor(e){this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??o5;const t="default"in s6?s6.default:s6;this.queue=new t({concurrency:this.maxConcurrency})}async call(e,...t){return this.queue.add(()=>aa(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt:({error:e})=>this.onFailedAttempt?.(e),retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){if(e.signal){let i;return Promise.race([this.call(t,...r),new Promise((t,r)=>{i=()=>{r(ov(e.signal))},e.signal?.addEventListener("abort",i)})]).finally(()=>{e.signal&&i&&e.signal.removeEventListener("abort",i)})}return this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}},o8=class extends sR{name="RootListenersTracer";rootId;config;argOnStart;argOnEnd;argOnError;constructor({config:e,onStart:t,onEnd:r,onError:i}){super({_awaitHandler:!0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=i}persistRun(e){return Promise.resolve()}async onRunCreate(e){!this.rootId&&(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}};function o7(e){return!!e&&e.lc_runnable}var le=class{includeNames;includeTypes;includeTags;excludeNames;excludeTypes;excludeTags;constructor(e){this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags,i=e.tags??[];return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(t)),void 0!==this.includeTags&&(r=r||i.some(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(r=r&&i.every(e=>!this.excludeTags?.includes(e))),r}};let lt=Object.freeze({status:"aborted"});function lr(e,t,r){function i(r,i){var n;for(let a in Object.defineProperty(r,"_zod",{value:r._zod??{},enumerable:!1}),(n=r._zod).traits??(n.traits=new Set),r._zod.traits.add(e),t(r,i),s.prototype)a in r||Object.defineProperty(r,a,{value:s.prototype[a].bind(r)});r._zod.constr=s,r._zod.def=i}let n=r?.Parent??Object;class a extends n{}function s(e){var t;let n=r?.Parent?new a:this;for(let r of(i(n,e),(t=n._zod).deferred??(t.deferred=[]),n._zod.deferred))r();return n}return Object.defineProperty(a,"name",{value:e}),Object.defineProperty(s,"init",{value:i}),Object.defineProperty(s,Symbol.hasInstance,{value:t=>!!r?.Parent&&t instanceof r.Parent||t?._zod?.traits?.has(e)}),Object.defineProperty(s,"name",{value:e}),s}let li=Symbol("zod_brand");class ln extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}let la={};function ls(e){return e&&Object.assign(la,e),la}e.s(["$ZodAsyncError",()=>ln,"$brand",0,li,"$constructor",()=>lr,"NEVER",0,lt,"config",()=>ls,"globalConfig",0,la],27438);let lo=/^[cC][^\s-]{8,}$/,ll=/^[0-9a-z]+$/,lu=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,lc=/^[0-9a-vA-V]{20}$/,ld=/^[A-Za-z0-9]{27}$/,lp=/^[a-zA-Z0-9_-]{21}$/,lh=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,lm=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,lf=e=>e?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,lg=lf(4),ly=lf(6),l_=lf(7),lv=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,lb="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function lw(){return RegExp(lb,"u")}let l$=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,lx=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,lk=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,lI=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,lO=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,lS=/^[A-Za-z0-9_-]*$/,lE=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,lT=/^\+(?:[0-9]){6,14}[0-9]$/,lA="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",lN=RegExp(`^${lA}$`);function lC(e){let t="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof e.precision?-1===e.precision?`${t}`:0===e.precision?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function lP(e){return RegExp(`^${lC(e)}$`)}function lj(e){let t=lC({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-]\\d{2}:\\d{2})");let i=`${t}(?:${r.join("|")})`;return RegExp(`^${lA}T(?:${i})$`)}let lR=e=>{let t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return RegExp(`^${t}$`)},lL=/^\d+n?$/,lU=/^\d+$/,lz=/^-?\d+(?:\.\d+)?/i,lM=/true|false/i,lD=/null/i,lZ=/undefined/i,lF=/^[^A-Z]*$/,lB=/^[^a-z]*$/;function lq(e){return e}function lW(e){return e}function lJ(e){}function lG(e){throw Error()}function lH(e){}function lV(e){let t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,r])=>-1===t.indexOf(+e)).map(([e,t])=>t)}function lK(e,t="|"){return e.map(e=>uu(e)).join(t)}function lX(e,t){return"bigint"==typeof t?t.toString():t}function lY(e){return{get value(){{let t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function lQ(e){return null==e}function l0(e){let t=+!!e.startsWith("^"),r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function l1(e,t){let r=(e.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,n=r>i?r:i;return Number.parseInt(e.toFixed(n).replace(".",""))%Number.parseInt(t.toFixed(n).replace(".",""))/10**n}function l4(e,t,r){Object.defineProperty(e,t,{get(){{let i=r();return e[t]=i,i}},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function l2(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function l6(e,t){return t?t.reduce((e,t)=>e?.[t],e):e}function l9(e){let t=Object.keys(e);return Promise.all(t.map(t=>e[t])).then(e=>{let r={};for(let i=0;i<t.length;i++)r[t[i]]=e[i];return r})}function l5(e=10){let t="abcdefghijklmnopqrstuvwxyz",r="";for(let i=0;i<e;i++)r+=t[Math.floor(Math.random()*t.length)];return r}function l3(e){return JSON.stringify(e)}e.s(["_emoji",0,lb,"base64",0,lO,"base64url",0,lS,"bigint",0,lL,"boolean",0,lM,"browserEmail",0,/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,"cidrv4",0,lk,"cidrv6",0,lI,"cuid",0,lo,"cuid2",0,ll,"date",0,lN,"datetime",()=>lj,"domain",0,/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,"duration",0,lh,"e164",0,lT,"email",0,lv,"emoji",()=>lw,"extendedDuration",0,/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,"guid",0,lm,"hostname",0,lE,"html5Email",0,/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,"integer",0,lU,"ipv4",0,l$,"ipv6",0,lx,"ksuid",0,ld,"lowercase",0,lF,"nanoid",0,lp,"null",()=>lD,"number",0,lz,"rfc5322Email",0,/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,"string",0,lR,"time",()=>lP,"ulid",0,lu,"undefined",()=>lZ,"unicodeEmail",0,/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,"uppercase",0,lB,"uuid",0,lf,"uuid4",0,lg,"uuid6",0,ly,"uuid7",0,l_,"xid",0,lc],21131);let l8=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function l7(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}let ue=lY(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(e){return!1}});function ut(e){if(!1===l7(e))return!1;let t=e.constructor;if(void 0===t)return!0;let r=t.prototype;return!1!==l7(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}function ur(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}let ui=new Set(["string","number","symbol"]),un=new Set(["string","number","bigint","boolean","symbol","undefined"]);function ua(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function us(e,t,r){let i=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(i._zod.parent=e),i}function uo(e){if(!e)return{};if("string"==typeof e)return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");e.error=e.message}return(delete e.message,"string"==typeof e.error)?{...e,error:()=>e.error}:e}function ul(e){let t;return new Proxy({},{get:(r,i,n)=>(t??(t=e()),Reflect.get(t,i,n)),set:(r,i,n,a)=>(t??(t=e()),Reflect.set(t,i,n,a)),has:(r,i)=>(t??(t=e()),Reflect.has(t,i)),deleteProperty:(r,i)=>(t??(t=e()),Reflect.deleteProperty(t,i)),ownKeys:r=>(t??(t=e()),Reflect.ownKeys(t)),getOwnPropertyDescriptor:(r,i)=>(t??(t=e()),Reflect.getOwnPropertyDescriptor(t,i)),defineProperty:(r,i,n)=>(t??(t=e()),Reflect.defineProperty(t,i,n))})}function uu(e){return"bigint"==typeof e?e.toString()+"n":"string"==typeof e?`"${e}"`:`${e}`}function uc(e){return Object.keys(e).filter(t=>"optional"===e[t]._zod.optin&&"optional"===e[t]._zod.optout)}let ud={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},up={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function uh(e,t){let r={},i=e._zod.def;for(let e in t){if(!(e in i.shape))throw Error(`Unrecognized key: "${e}"`);t[e]&&(r[e]=i.shape[e])}return us(e,{...e._zod.def,shape:r,checks:[]})}function um(e,t){let r={...e._zod.def.shape},i=e._zod.def;for(let e in t){if(!(e in i.shape))throw Error(`Unrecognized key: "${e}"`);t[e]&&delete r[e]}return us(e,{...e._zod.def,shape:r,checks:[]})}function uf(e,t){if(!ut(t))throw Error("Invalid input to extend: expected a plain object");let r={...e._zod.def,get shape(){let r={...e._zod.def.shape,...t};return l2(this,"shape",r),r},checks:[]};return us(e,r)}function ug(e,t){return us(e,{...e._zod.def,get shape(){let r={...e._zod.def.shape,...t._zod.def.shape};return l2(this,"shape",r),r},catchall:t._zod.def.catchall,checks:[]})}function uy(e,t,r){let i=t._zod.def.shape,n={...i};if(r)for(let t in r){if(!(t in i))throw Error(`Unrecognized key: "${t}"`);r[t]&&(n[t]=e?new e({type:"optional",innerType:i[t]}):i[t])}else for(let t in i)n[t]=e?new e({type:"optional",innerType:i[t]}):i[t];return us(t,{...t._zod.def,shape:n,checks:[]})}function u_(e,t,r){let i=t._zod.def.shape,n={...i};if(r)for(let t in r){if(!(t in n))throw Error(`Unrecognized key: "${t}"`);r[t]&&(n[t]=new e({type:"nonoptional",innerType:i[t]}))}else for(let t in i)n[t]=new e({type:"nonoptional",innerType:i[t]});return us(t,{...t._zod.def,shape:n,checks:[]})}function uv(e,t=0){for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function ub(e,t){return t.map(t=>(t.path??(t.path=[]),t.path.unshift(e),t))}function uw(e){return"string"==typeof e?e:e?.message}function u$(e,t,r){let i={...e,path:e.path??[]};return e.message||(i.message=uw(e.inst?._zod.def?.error?.(e))??uw(t?.error?.(e))??uw(r.customError?.(e))??uw(r.localeError?.(e))??"Invalid input"),delete i.inst,delete i.continue,t?.reportInput||delete i.input,i}function ux(e){return e instanceof Set?"set":e instanceof Map?"map":e instanceof File?"file":"unknown"}function uk(e){return Array.isArray(e)?"array":"string"==typeof e?"string":"unknown"}function uI(...e){let[t,r,i]=e;return"string"==typeof t?{message:t,code:"custom",input:r,inst:i}:{...t}}function uO(e){return Object.entries(e).filter(([e,t])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}class uS{constructor(...e){}}e.s(["BIGINT_FORMAT_RANGES",0,up,"Class",()=>uS,"NUMBER_FORMAT_RANGES",0,ud,"aborted",()=>uv,"allowsEval",0,ue,"assert",()=>lH,"assertEqual",()=>lq,"assertIs",()=>lJ,"assertNever",()=>lG,"assertNotEqual",()=>lW,"assignProp",()=>l2,"cached",()=>lY,"captureStackTrace",0,l8,"cleanEnum",()=>uO,"cleanRegex",()=>l0,"clone",()=>us,"createTransparentProxy",()=>ul,"defineLazy",()=>l4,"esc",()=>l3,"escapeRegex",()=>ua,"extend",()=>uf,"finalizeIssue",()=>u$,"floatSafeRemainder",()=>l1,"getElementAtPath",()=>l6,"getEnumValues",()=>lV,"getLengthableOrigin",()=>uk,"getParsedType",0,e=>{let t=typeof e;switch(t){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(e)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return"promise";if("undefined"!=typeof Map&&e instanceof Map)return"map";if("undefined"!=typeof Set&&e instanceof Set)return"set";if("undefined"!=typeof Date&&e instanceof Date)return"date";if("undefined"!=typeof File&&e instanceof File)return"file";return"object";default:throw Error(`Unknown data type: ${t}`)}},"getSizableOrigin",()=>ux,"isObject",()=>l7,"isPlainObject",()=>ut,"issue",()=>uI,"joinValues",()=>lK,"jsonStringifyReplacer",()=>lX,"merge",()=>ug,"normalizeParams",()=>uo,"nullish",()=>lQ,"numKeys",()=>ur,"omit",()=>um,"optionalKeys",()=>uc,"partial",()=>uy,"pick",()=>uh,"prefixIssues",()=>ub,"primitiveTypes",0,un,"promiseAllObject",()=>l9,"propertyKeyTypes",0,ui,"randomString",()=>l5,"required",()=>u_,"stringifyPrimitive",()=>uu,"unwrapMessage",()=>uw],86618);let uE=lr("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),uT={number:"number",bigint:"bigint",object:"date"},uA=lr("$ZodCheckLessThan",(e,t)=>{uE.init(e,t);let r=uT[typeof t.value];e._zod.onattach.push(e=>{let r=e._zod.bag,i=(t.inclusive?r.maximum:r.exclusiveMaximum)??1/0;t.value<i&&(t.inclusive?r.maximum=t.value:r.exclusiveMaximum=t.value)}),e._zod.check=i=>{(t.inclusive?i.value<=t.value:i.value<t.value)||i.issues.push({origin:r,code:"too_big",maximum:t.value,input:i.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),uN=lr("$ZodCheckGreaterThan",(e,t)=>{uE.init(e,t);let r=uT[typeof t.value];e._zod.onattach.push(e=>{let r=e._zod.bag,i=(t.inclusive?r.minimum:r.exclusiveMinimum)??-1/0;t.value>i&&(t.inclusive?r.minimum=t.value:r.exclusiveMinimum=t.value)}),e._zod.check=i=>{(t.inclusive?i.value>=t.value:i.value>t.value)||i.issues.push({origin:r,code:"too_small",minimum:t.value,input:i.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),uC=lr("$ZodCheckMultipleOf",(e,t)=>{uE.init(e,t),e._zod.onattach.push(e=>{var r;(r=e._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof r.value?r.value%t.value===BigInt(0):0===l1(r.value,t.value))||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),uP=lr("$ZodCheckNumberFormat",(e,t)=>{uE.init(e,t),t.format=t.format||"float64";let r=t.format?.includes("int"),i=r?"int":"number",[n,a]=ud[t.format];e._zod.onattach.push(e=>{let i=e._zod.bag;i.format=t.format,i.minimum=n,i.maximum=a,r&&(i.pattern=lU)}),e._zod.check=s=>{let o=s.value;if(r){if(!Number.isInteger(o))return void s.issues.push({expected:i,format:t.format,code:"invalid_type",input:o,inst:e});if(!Number.isSafeInteger(o))return void(o>0?s.issues.push({input:o,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:i,continue:!t.abort}):s.issues.push({input:o,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:i,continue:!t.abort}))}o<n&&s.issues.push({origin:"number",input:o,code:"too_small",minimum:n,inclusive:!0,inst:e,continue:!t.abort}),o>a&&s.issues.push({origin:"number",input:o,code:"too_big",maximum:a,inst:e})}}),uj=lr("$ZodCheckBigIntFormat",(e,t)=>{uE.init(e,t);let[r,i]=up[t.format];e._zod.onattach.push(e=>{let n=e._zod.bag;n.format=t.format,n.minimum=r,n.maximum=i}),e._zod.check=n=>{let a=n.value;a<r&&n.issues.push({origin:"bigint",input:a,code:"too_small",minimum:r,inclusive:!0,inst:e,continue:!t.abort}),a>i&&n.issues.push({origin:"bigint",input:a,code:"too_big",maximum:i,inst:e})}}),uR=lr("$ZodCheckMaxSize",(e,t)=>{var r;uE.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!lQ(t)&&void 0!==t.size}),e._zod.onattach.push(e=>{let r=e._zod.bag.maximum??1/0;t.maximum<r&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{let i=r.value;i.size<=t.maximum||r.issues.push({origin:ux(i),code:"too_big",maximum:t.maximum,input:i,inst:e,continue:!t.abort})}}),uL=lr("$ZodCheckMinSize",(e,t)=>{var r;uE.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!lQ(t)&&void 0!==t.size}),e._zod.onattach.push(e=>{let r=e._zod.bag.minimum??-1/0;t.minimum>r&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{let i=r.value;i.size>=t.minimum||r.issues.push({origin:ux(i),code:"too_small",minimum:t.minimum,input:i,inst:e,continue:!t.abort})}}),uU=lr("$ZodCheckSizeEquals",(e,t)=>{var r;uE.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!lQ(t)&&void 0!==t.size}),e._zod.onattach.push(e=>{let r=e._zod.bag;r.minimum=t.size,r.maximum=t.size,r.size=t.size}),e._zod.check=r=>{let i=r.value,n=i.size;if(n===t.size)return;let a=n>t.size;r.issues.push({origin:ux(i),...a?{code:"too_big",maximum:t.size}:{code:"too_small",minimum:t.size},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),uz=lr("$ZodCheckMaxLength",(e,t)=>{var r;uE.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!lQ(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag.maximum??1/0;t.maximum<r&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{let i=r.value;if(i.length<=t.maximum)return;let n=uk(i);r.issues.push({origin:n,code:"too_big",maximum:t.maximum,inclusive:!0,input:i,inst:e,continue:!t.abort})}}),uM=lr("$ZodCheckMinLength",(e,t)=>{var r;uE.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!lQ(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag.minimum??-1/0;t.minimum>r&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{let i=r.value;if(i.length>=t.minimum)return;let n=uk(i);r.issues.push({origin:n,code:"too_small",minimum:t.minimum,inclusive:!0,input:i,inst:e,continue:!t.abort})}}),uD=lr("$ZodCheckLengthEquals",(e,t)=>{var r;uE.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!lQ(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=r=>{let i=r.value,n=i.length;if(n===t.length)return;let a=uk(i),s=n>t.length;r.issues.push({origin:a,...s?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),uZ=lr("$ZodCheckStringFormat",(e,t)=>{var r,i;uE.init(e,t),e._zod.onattach.push(e=>{let r=e._zod.bag;r.format=t.format,t.pattern&&(r.patterns??(r.patterns=new Set),r.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=r=>{t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(i=e._zod).check??(i.check=()=>{})}),uF=lr("$ZodCheckRegex",(e,t)=>{uZ.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),uB=lr("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=lF),uZ.init(e,t)}),uq=lr("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=lB),uZ.init(e,t)}),uW=lr("$ZodCheckIncludes",(e,t)=>{uE.init(e,t);let r=ua(t.includes),i=new RegExp("number"==typeof t.position?`^.{${t.position}}${r}`:r);t.pattern=i,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(i)}),e._zod.check=r=>{r.value.includes(t.includes,t.position)||r.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:r.value,inst:e,continue:!t.abort})}}),uJ=lr("$ZodCheckStartsWith",(e,t)=>{uE.init(e,t);let r=RegExp(`^${ua(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),uG=lr("$ZodCheckEndsWith",(e,t)=>{uE.init(e,t);let r=RegExp(`.*${ua(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}});function uH(e,t,r){e.issues.length&&t.issues.push(...ub(r,e.issues))}let uV=lr("$ZodCheckProperty",(e,t)=>{uE.init(e,t),e._zod.check=e=>{let r=t.schema._zod.run({value:e.value[t.property],issues:[]},{});if(r instanceof Promise)return r.then(r=>uH(r,e,t.property));uH(r,e,t.property)}}),uK=lr("$ZodCheckMimeType",(e,t)=>{uE.init(e,t);let r=new Set(t.mime);e._zod.onattach.push(e=>{e._zod.bag.mime=t.mime}),e._zod.check=i=>{r.has(i.value.type)||i.issues.push({code:"invalid_value",values:t.mime,input:i.value.type,inst:e})}}),uX=lr("$ZodCheckOverwrite",(e,t)=>{uE.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}});e.s(["$ZodCheck",0,uE,"$ZodCheckBigIntFormat",0,uj,"$ZodCheckEndsWith",0,uG,"$ZodCheckGreaterThan",0,uN,"$ZodCheckIncludes",0,uW,"$ZodCheckLengthEquals",0,uD,"$ZodCheckLessThan",0,uA,"$ZodCheckLowerCase",0,uB,"$ZodCheckMaxLength",0,uz,"$ZodCheckMaxSize",0,uR,"$ZodCheckMimeType",0,uK,"$ZodCheckMinLength",0,uM,"$ZodCheckMinSize",0,uL,"$ZodCheckMultipleOf",0,uC,"$ZodCheckNumberFormat",0,uP,"$ZodCheckOverwrite",0,uX,"$ZodCheckProperty",0,uV,"$ZodCheckRegex",0,uF,"$ZodCheckSizeEquals",0,uU,"$ZodCheckStartsWith",0,uJ,"$ZodCheckStringFormat",0,uZ,"$ZodCheckUpperCase",0,uq],36608);class uY{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if("function"==typeof e){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let t=e.split("\n").filter(e=>e),r=Math.min(...t.map(e=>e.length-e.trimStart().length));for(let e of t.map(e=>e.slice(r)).map(e=>" ".repeat(2*this.indent)+e))this.content.push(e)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(e=>`  ${e}`)].join("\n"))}}e.s(["Doc",()=>uY],73911);let uQ=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,lX,2),enumerable:!0}),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},u0=lr("$ZodError",uQ),u1=lr("$ZodError",uQ,{Parent:Error});function u4(e,t=e=>e.message){let r={},i=[];for(let n of e.issues)n.path.length>0?(r[n.path[0]]=r[n.path[0]]||[],r[n.path[0]].push(t(n))):i.push(t(n));return{formErrors:i,fieldErrors:r}}function u2(e,t){let r=t||function(e){return e.message},i={_errors:[]},n=e=>{for(let t of e.issues)if("invalid_union"===t.code&&t.errors.length)t.errors.map(e=>n({issues:e}));else if("invalid_key"===t.code)n({issues:t.issues});else if("invalid_element"===t.code)n({issues:t.issues});else if(0===t.path.length)i._errors.push(r(t));else{let e=i,n=0;for(;n<t.path.length;){let i=t.path[n];n===t.path.length-1?(e[i]=e[i]||{_errors:[]},e[i]._errors.push(r(t))):e[i]=e[i]||{_errors:[]},e=e[i],n++}}};return n(e),i}function u6(e,t){let r=t||function(e){return e.message},i={errors:[]},n=(e,t=[])=>{var a,s;for(let o of e.issues)if("invalid_union"===o.code&&o.errors.length)o.errors.map(e=>n({issues:e},o.path));else if("invalid_key"===o.code)n({issues:o.issues},o.path);else if("invalid_element"===o.code)n({issues:o.issues},o.path);else{let e=[...t,...o.path];if(0===e.length){i.errors.push(r(o));continue}let n=i,l=0;for(;l<e.length;){let t=e[l],i=l===e.length-1;"string"==typeof t?(n.properties??(n.properties={}),(a=n.properties)[t]??(a[t]={errors:[]}),n=n.properties[t]):(n.items??(n.items=[]),(s=n.items)[t]??(s[t]={errors:[]}),n=n.items[t]),i&&n.errors.push(r(o)),l++}}};return n(e),i}function u9(e){let t=[];for(let r of e)"number"==typeof r?t.push(`[${r}]`):"symbol"==typeof r?t.push(`[${JSON.stringify(String(r))}]`):/[^\w$]/.test(r)?t.push(`[${JSON.stringify(r)}]`):(t.length&&t.push("."),t.push(r));return t.join("")}function u5(e){let t=[];for(let r of[...e.issues].sort((e,t)=>e.path.length-t.path.length))t.push(` ${r.message}`),r.path?.length&&t.push(`   at ${u9(r.path)}`);return t.join("\n")}e.s(["$ZodError",0,u0,"$ZodRealError",0,u1,"flattenError",()=>u4,"formatError",()=>u2,"prettifyError",()=>u5,"toDotPath",()=>u9,"treeifyError",()=>u6],67021);let u3=e=>(t,r,i,n)=>{let a=i?Object.assign(i,{async:!1}):{async:!1},s=t._zod.run({value:r,issues:[]},a);if(s instanceof Promise)throw new ln;if(s.issues.length){let t=new(n?.Err??e)(s.issues.map(e=>u$(e,a,ls())));throw l8(t,n?.callee),t}return s.value},u8=u3(u1),u7=e=>async(t,r,i,n)=>{let a=i?Object.assign(i,{async:!0}):{async:!0},s=t._zod.run({value:r,issues:[]},a);if(s instanceof Promise&&(s=await s),s.issues.length){let t=new(n?.Err??e)(s.issues.map(e=>u$(e,a,ls())));throw l8(t,n?.callee),t}return s.value},ce=u7(u1),ct=e=>(t,r,i)=>{let n=i?{...i,async:!1}:{async:!1},a=t._zod.run({value:r,issues:[]},n);if(a instanceof Promise)throw new ln;return a.issues.length?{success:!1,error:new(e??u0)(a.issues.map(e=>u$(e,n,ls())))}:{success:!0,data:a.value}},cr=ct(u1),ci=e=>async(t,r,i)=>{let n=i?Object.assign(i,{async:!0}):{async:!0},a=t._zod.run({value:r,issues:[]},n);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new e(a.issues.map(e=>u$(e,n,ls())))}:{success:!0,data:a.value}},cn=ci(u1);e.s(["_parse",0,u3,"_parseAsync",0,u7,"_safeParse",0,ct,"_safeParseAsync",0,ci,"parse",0,u8,"parseAsync",0,ce,"safeParse",0,cr,"safeParseAsync",0,cn],15143);let ca={major:4,minor:0,patch:0};e.s(["version",0,ca],22824);let cs=lr("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=ca;let i=[...e._zod.def.checks??[]];for(let t of(e._zod.traits.has("$ZodCheck")&&i.unshift(e),i))for(let r of t._zod.onattach)r(e);if(0===i.length)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{let t=(e,t,r)=>{let i,n=uv(e);for(let a of t){if(a._zod.def.when){if(!a._zod.def.when(e))continue}else if(n)continue;let t=e.issues.length,s=a._zod.check(e);if(s instanceof Promise&&r?.async===!1)throw new ln;if(i||s instanceof Promise)i=(i??Promise.resolve()).then(async()=>{await s,e.issues.length!==t&&(n||(n=uv(e,t)))});else{if(e.issues.length===t)continue;n||(n=uv(e,t))}}return i?i.then(()=>e):e};e._zod.run=(r,n)=>{let a=e._zod.parse(r,n);if(a instanceof Promise){if(!1===n.async)throw new ln;return a.then(e=>t(e,i,n))}return t(a,i,n)}}e["~standard"]={validate:t=>{try{let r=cr(e,t);return r.success?{value:r.data}:{issues:r.error?.issues}}catch(r){return cn(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}}),co=lr("$ZodString",(e,t)=>{cs.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??lR(e._zod.bag),e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=String(r.value)}catch(e){}return"string"==typeof r.value||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),cl=lr("$ZodStringFormat",(e,t)=>{uZ.init(e,t),co.init(e,t)}),cu=lr("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=lm),cl.init(e,t)}),cc=lr("$ZodUUID",(e,t)=>{if(t.version){let e={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(void 0===e)throw Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=lf(e))}else t.pattern??(t.pattern=lf());cl.init(e,t)}),cd=lr("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=lv),cl.init(e,t)}),cp=lr("$ZodURL",(e,t)=>{cl.init(e,t),e._zod.check=r=>{try{let i=r.value,n=new URL(i),a=n.href;t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(n.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:lE.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(n.protocol.endsWith(":")?n.protocol.slice(0,-1):n.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),!i.endsWith("/")&&a.endsWith("/")?r.value=a.slice(0,-1):r.value=a;return}catch(i){r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),ch=lr("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=lw()),cl.init(e,t)}),cm=lr("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=lp),cl.init(e,t)}),cf=lr("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=lo),cl.init(e,t)}),cg=lr("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=ll),cl.init(e,t)}),cy=lr("$ZodULID",(e,t)=>{t.pattern??(t.pattern=lu),cl.init(e,t)}),c_=lr("$ZodXID",(e,t)=>{t.pattern??(t.pattern=lc),cl.init(e,t)}),cv=lr("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=ld),cl.init(e,t)}),cb=lr("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=lj(t)),cl.init(e,t)}),cw=lr("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=lN),cl.init(e,t)}),c$=lr("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=lP(t)),cl.init(e,t)}),cx=lr("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=lh),cl.init(e,t)}),ck=lr("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=l$),cl.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.format="ipv4"})}),cI=lr("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=lx),cl.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.format="ipv6"}),e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),cO=lr("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=lk),cl.init(e,t)}),cS=lr("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=lI),cl.init(e,t),e._zod.check=r=>{let[i,n]=r.value.split("/");try{if(!n)throw Error();let e=Number(n);if(`${e}`!==n||e<0||e>128)throw Error();new URL(`http://[${i}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function cE(e){if(""===e)return!0;if(e.length%4!=0)return!1;try{return atob(e),!0}catch{return!1}}let cT=lr("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=lO),cl.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64"}),e._zod.check=r=>{cE(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function cA(e){if(!lS.test(e))return!1;let t=e.replace(/[-_]/g,e=>"-"===e?"+":"/");return cE(t.padEnd(4*Math.ceil(t.length/4),"="))}let cN=lr("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=lS),cl.init(e,t),e._zod.onattach.push(e=>{e._zod.bag.contentEncoding="base64url"}),e._zod.check=r=>{cA(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),cC=lr("$ZodE164",(e,t)=>{t.pattern??(t.pattern=lT),cl.init(e,t)});function cP(e,t=null){try{let r=e.split(".");if(3!==r.length)return!1;let[i]=r;if(!i)return!1;let n=JSON.parse(atob(i));if("typ"in n&&n?.typ!=="JWT"||!n.alg||t&&(!("alg"in n)||n.alg!==t))return!1;return!0}catch{return!1}}let cj=lr("$ZodJWT",(e,t)=>{cl.init(e,t),e._zod.check=r=>{cP(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),cR=lr("$ZodCustomStringFormat",(e,t)=>{cl.init(e,t),e._zod.check=r=>{t.fn(r.value)||r.issues.push({code:"invalid_format",format:t.format,input:r.value,inst:e,continue:!t.abort})}}),cL=lr("$ZodNumber",(e,t)=>{cs.init(e,t),e._zod.pattern=e._zod.bag.pattern??lz,e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=Number(r.value)}catch(e){}let n=r.value;if("number"==typeof n&&!Number.isNaN(n)&&Number.isFinite(n))return r;let a="number"==typeof n?Number.isNaN(n)?"NaN":Number.isFinite(n)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:n,inst:e,...a?{received:a}:{}}),r}}),cU=lr("$ZodNumber",(e,t)=>{uP.init(e,t),cL.init(e,t)}),cz=lr("$ZodBoolean",(e,t)=>{cs.init(e,t),e._zod.pattern=lM,e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=!!r.value}catch(e){}let n=r.value;return"boolean"==typeof n||r.issues.push({expected:"boolean",code:"invalid_type",input:n,inst:e}),r}}),cM=lr("$ZodBigInt",(e,t)=>{cs.init(e,t),e._zod.pattern=lL,e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=BigInt(r.value)}catch(e){}return"bigint"==typeof r.value||r.issues.push({expected:"bigint",code:"invalid_type",input:r.value,inst:e}),r}}),cD=lr("$ZodBigInt",(e,t)=>{uj.init(e,t),cM.init(e,t)}),cZ=lr("$ZodSymbol",(e,t)=>{cs.init(e,t),e._zod.parse=(t,r)=>{let i=t.value;return"symbol"==typeof i||t.issues.push({expected:"symbol",code:"invalid_type",input:i,inst:e}),t}}),cF=lr("$ZodUndefined",(e,t)=>{cs.init(e,t),e._zod.pattern=lZ,e._zod.values=new Set([void 0]),e._zod.optin="optional",e._zod.optout="optional",e._zod.parse=(t,r)=>{let i=t.value;return void 0===i||t.issues.push({expected:"undefined",code:"invalid_type",input:i,inst:e}),t}}),cB=lr("$ZodNull",(e,t)=>{cs.init(e,t),e._zod.pattern=lD,e._zod.values=new Set([null]),e._zod.parse=(t,r)=>{let i=t.value;return null===i||t.issues.push({expected:"null",code:"invalid_type",input:i,inst:e}),t}}),cq=lr("$ZodAny",(e,t)=>{cs.init(e,t),e._zod.parse=e=>e}),cW=lr("$ZodUnknown",(e,t)=>{cs.init(e,t),e._zod.parse=e=>e}),cJ=lr("$ZodNever",(e,t)=>{cs.init(e,t),e._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)}),cG=lr("$ZodVoid",(e,t)=>{cs.init(e,t),e._zod.parse=(t,r)=>{let i=t.value;return void 0===i||t.issues.push({expected:"void",code:"invalid_type",input:i,inst:e}),t}}),cH=lr("$ZodDate",(e,t)=>{cs.init(e,t),e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=new Date(r.value)}catch(e){}let n=r.value,a=n instanceof Date;return a&&!Number.isNaN(n.getTime())||r.issues.push({expected:"date",code:"invalid_type",input:n,...a?{received:"Invalid Date"}:{},inst:e}),r}});function cV(e,t,r){e.issues.length&&t.issues.push(...ub(r,e.issues)),t.value[r]=e.value}let cK=lr("$ZodArray",(e,t)=>{cs.init(e,t),e._zod.parse=(r,i)=>{let n=r.value;if(!Array.isArray(n))return r.issues.push({expected:"array",code:"invalid_type",input:n,inst:e}),r;r.value=Array(n.length);let a=[];for(let e=0;e<n.length;e++){let s=n[e],o=t.element._zod.run({value:s,issues:[]},i);o instanceof Promise?a.push(o.then(t=>cV(t,r,e))):cV(o,r,e)}return a.length?Promise.all(a).then(()=>r):r}});function cX(e,t,r){e.issues.length&&t.issues.push(...ub(r,e.issues)),t.value[r]=e.value}function cY(e,t,r,i){e.issues.length?void 0===i[r]?r in i?t.value[r]=void 0:t.value[r]=e.value:t.issues.push(...ub(r,e.issues)):void 0===e.value?r in i&&(t.value[r]=void 0):t.value[r]=e.value}let cQ=lr("$ZodObject",(e,t)=>{let r,i;cs.init(e,t);let n=lY(()=>{let e=Object.keys(t.shape);for(let r of e)if(!(t.shape[r]instanceof cs))throw Error(`Invalid element at key "${r}": expected a Zod schema`);let r=uc(t.shape);return{shape:t.shape,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(r)}});l4(e._zod,"propValues",()=>{let e=t.shape,r={};for(let t in e){let i=e[t]._zod;if(i.values)for(let e of(r[t]??(r[t]=new Set),i.values))r[t].add(e)}return r});let a=!la.jitless,s=a&&ue.value,o=t.catchall;e._zod.parse=(l,u)=>{i??(i=n.value);let c=l.value;if(!l7(c))return l.issues.push({expected:"object",code:"invalid_type",input:c,inst:e}),l;let d=[];if(a&&s&&u?.async===!1&&!0!==u.jitless)r||(r=(e=>{let t=new uY(["shape","payload","ctx"]),r=n.value,i=e=>{let t=l3(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write("const input = payload.value;");let a=Object.create(null),s=0;for(let e of r.keys)a[e]=`key_${s++}`;for(let e of(t.write("const newResult = {}"),r.keys))if(r.optionalKeys.has(e)){let r=a[e];t.write(`const ${r} = ${i(e)};`);let n=l3(e);t.write(`
        if (${r}.issues.length) {
          if (input[${n}] === undefined) {
            if (${n} in input) {
              newResult[${n}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${r}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${n}, ...iss.path] : [${n}],
              }))
            );
          }
        } else if (${r}.value === undefined) {
          if (${n} in input) newResult[${n}] = undefined;
        } else {
          newResult[${n}] = ${r}.value;
        }
        `)}else{let r=a[e];t.write(`const ${r} = ${i(e)};`),t.write(`
          if (${r}.issues.length) payload.issues = payload.issues.concat(${r}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${l3(e)}, ...iss.path] : [${l3(e)}]
          })));`),t.write(`newResult[${l3(e)}] = ${r}.value`)}t.write("payload.value = newResult;"),t.write("return payload;");let o=t.compile();return(t,r)=>o(e,t,r)})(t.shape)),l=r(l,u);else{l.value={};let e=i.shape;for(let t of i.keys){let r=e[t],i=r._zod.run({value:c[t],issues:[]},u),n="optional"===r._zod.optin&&"optional"===r._zod.optout;i instanceof Promise?d.push(i.then(e=>n?cY(e,l,t,c):cX(e,l,t))):n?cY(i,l,t,c):cX(i,l,t)}}if(!o)return d.length?Promise.all(d).then(()=>l):l;let p=[],h=i.keySet,m=o._zod,f=m.def.type;for(let e of Object.keys(c)){if(h.has(e))continue;if("never"===f){p.push(e);continue}let t=m.run({value:c[e],issues:[]},u);t instanceof Promise?d.push(t.then(t=>cX(t,l,e))):cX(t,l,e)}return(p.length&&l.issues.push({code:"unrecognized_keys",keys:p,input:c,inst:e}),d.length)?Promise.all(d).then(()=>l):l}});function c0(e,t,r,i){for(let r of e)if(0===r.issues.length)return t.value=r.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(e=>e.issues.map(e=>u$(e,i,ls())))}),t}let c1=lr("$ZodUnion",(e,t)=>{cs.init(e,t),l4(e._zod,"optin",()=>t.options.some(e=>"optional"===e._zod.optin)?"optional":void 0),l4(e._zod,"optout",()=>t.options.some(e=>"optional"===e._zod.optout)?"optional":void 0),l4(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),l4(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){let e=t.options.map(e=>e._zod.pattern);return RegExp(`^(${e.map(e=>l0(e.source)).join("|")})$`)}}),e._zod.parse=(r,i)=>{let n=!1,a=[];for(let e of t.options){let t=e._zod.run({value:r.value,issues:[]},i);if(t instanceof Promise)a.push(t),n=!0;else{if(0===t.issues.length)return t;a.push(t)}}return n?Promise.all(a).then(t=>c0(t,r,e,i)):c0(a,r,e,i)}}),c4=lr("$ZodDiscriminatedUnion",(e,t)=>{c1.init(e,t);let r=e._zod.parse;l4(e._zod,"propValues",()=>{let e={};for(let r of t.options){let i=r._zod.propValues;if(!i||0===Object.keys(i).length)throw Error(`Invalid discriminated union option at index "${t.options.indexOf(r)}"`);for(let[t,r]of Object.entries(i))for(let i of(e[t]||(e[t]=new Set),r))e[t].add(i)}return e});let i=lY(()=>{let e=t.options,r=new Map;for(let i of e){let e=i._zod.propValues[t.discriminator];if(!e||0===e.size)throw Error(`Invalid discriminated union option at index "${t.options.indexOf(i)}"`);for(let t of e){if(r.has(t))throw Error(`Duplicate discriminator value "${String(t)}"`);r.set(t,i)}}return r});e._zod.parse=(n,a)=>{let s=n.value;if(!l7(s))return n.issues.push({code:"invalid_type",expected:"object",input:s,inst:e}),n;let o=i.value.get(s?.[t.discriminator]);return o?o._zod.run(n,a):t.unionFallback?r(n,a):(n.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:s,path:[t.discriminator],inst:e}),n)}}),c2=lr("$ZodIntersection",(e,t)=>{cs.init(e,t),e._zod.parse=(e,r)=>{let i=e.value,n=t.left._zod.run({value:i,issues:[]},r),a=t.right._zod.run({value:i,issues:[]},r);return n instanceof Promise||a instanceof Promise?Promise.all([n,a]).then(([t,r])=>c6(e,t,r)):c6(e,n,a)}});function c6(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),uv(e))return e;let i=function e(t,r){if(t===r||t instanceof Date&&r instanceof Date&&+t==+r)return{valid:!0,data:t};if(ut(t)&&ut(r)){let i=Object.keys(r),n=Object.keys(t).filter(e=>-1!==i.indexOf(e)),a={...t,...r};for(let i of n){let n=e(t[i],r[i]);if(!n.valid)return{valid:!1,mergeErrorPath:[i,...n.mergeErrorPath]};a[i]=n.data}return{valid:!0,data:a}}if(Array.isArray(t)&&Array.isArray(r)){if(t.length!==r.length)return{valid:!1,mergeErrorPath:[]};let i=[];for(let n=0;n<t.length;n++){let a=e(t[n],r[n]);if(!a.valid)return{valid:!1,mergeErrorPath:[n,...a.mergeErrorPath]};i.push(a.data)}return{valid:!0,data:i}}return{valid:!1,mergeErrorPath:[]}}(t.value,r.value);if(!i.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(i.mergeErrorPath)}`);return e.value=i.data,e}let c9=lr("$ZodTuple",(e,t)=>{cs.init(e,t);let r=t.items,i=r.length-[...r].reverse().findIndex(e=>"optional"!==e._zod.optin);e._zod.parse=(n,a)=>{let s=n.value;if(!Array.isArray(s))return n.issues.push({input:s,inst:e,expected:"tuple",code:"invalid_type"}),n;n.value=[];let o=[];if(!t.rest){let t=s.length>r.length,a=s.length<i-1;if(t||a)return n.issues.push({input:s,inst:e,origin:"array",...t?{code:"too_big",maximum:r.length}:{code:"too_small",minimum:r.length}}),n}let l=-1;for(let e of r){if(++l>=s.length&&l>=i)continue;let t=e._zod.run({value:s[l],issues:[]},a);t instanceof Promise?o.push(t.then(e=>c5(e,n,l))):c5(t,n,l)}if(t.rest)for(let e of s.slice(r.length)){l++;let r=t.rest._zod.run({value:e,issues:[]},a);r instanceof Promise?o.push(r.then(e=>c5(e,n,l))):c5(r,n,l)}return o.length?Promise.all(o).then(()=>n):n}});function c5(e,t,r){e.issues.length&&t.issues.push(...ub(r,e.issues)),t.value[r]=e.value}let c3=lr("$ZodRecord",(e,t)=>{cs.init(e,t),e._zod.parse=(r,i)=>{let n=r.value;if(!ut(n))return r.issues.push({expected:"record",code:"invalid_type",input:n,inst:e}),r;let a=[];if(t.keyType._zod.values){let s,o=t.keyType._zod.values;for(let e of(r.value={},o))if("string"==typeof e||"number"==typeof e||"symbol"==typeof e){let s=t.valueType._zod.run({value:n[e],issues:[]},i);s instanceof Promise?a.push(s.then(t=>{t.issues.length&&r.issues.push(...ub(e,t.issues)),r.value[e]=t.value})):(s.issues.length&&r.issues.push(...ub(e,s.issues)),r.value[e]=s.value)}for(let e in n)o.has(e)||(s=s??[]).push(e);s&&s.length>0&&r.issues.push({code:"unrecognized_keys",input:n,inst:e,keys:s})}else for(let s of(r.value={},Reflect.ownKeys(n))){if("__proto__"===s)continue;let o=t.keyType._zod.run({value:s,issues:[]},i);if(o instanceof Promise)throw Error("Async schemas not supported in object keys currently");if(o.issues.length){r.issues.push({origin:"record",code:"invalid_key",issues:o.issues.map(e=>u$(e,i,ls())),input:s,path:[s],inst:e}),r.value[o.value]=o.value;continue}let l=t.valueType._zod.run({value:n[s],issues:[]},i);l instanceof Promise?a.push(l.then(e=>{e.issues.length&&r.issues.push(...ub(s,e.issues)),r.value[o.value]=e.value})):(l.issues.length&&r.issues.push(...ub(s,l.issues)),r.value[o.value]=l.value)}return a.length?Promise.all(a).then(()=>r):r}}),c8=lr("$ZodMap",(e,t)=>{cs.init(e,t),e._zod.parse=(r,i)=>{let n=r.value;if(!(n instanceof Map))return r.issues.push({expected:"map",code:"invalid_type",input:n,inst:e}),r;let a=[];for(let[s,o]of(r.value=new Map,n)){let l=t.keyType._zod.run({value:s,issues:[]},i),u=t.valueType._zod.run({value:o,issues:[]},i);l instanceof Promise||u instanceof Promise?a.push(Promise.all([l,u]).then(([t,a])=>{c7(t,a,r,s,n,e,i)})):c7(l,u,r,s,n,e,i)}return a.length?Promise.all(a).then(()=>r):r}});function c7(e,t,r,i,n,a,s){e.issues.length&&(ui.has(typeof i)?r.issues.push(...ub(i,e.issues)):r.issues.push({origin:"map",code:"invalid_key",input:n,inst:a,issues:e.issues.map(e=>u$(e,s,ls()))})),t.issues.length&&(ui.has(typeof i)?r.issues.push(...ub(i,t.issues)):r.issues.push({origin:"map",code:"invalid_element",input:n,inst:a,key:i,issues:t.issues.map(e=>u$(e,s,ls()))})),r.value.set(e.value,t.value)}let de=lr("$ZodSet",(e,t)=>{cs.init(e,t),e._zod.parse=(r,i)=>{let n=r.value;if(!(n instanceof Set))return r.issues.push({input:n,inst:e,expected:"set",code:"invalid_type"}),r;let a=[];for(let e of(r.value=new Set,n)){let n=t.valueType._zod.run({value:e,issues:[]},i);n instanceof Promise?a.push(n.then(e=>dt(e,r))):dt(n,r)}return a.length?Promise.all(a).then(()=>r):r}});function dt(e,t){e.issues.length&&t.issues.push(...e.issues),t.value.add(e.value)}let dr=lr("$ZodEnum",(e,t)=>{cs.init(e,t);let r=lV(t.entries);e._zod.values=new Set(r),e._zod.pattern=RegExp(`^(${r.filter(e=>ui.has(typeof e)).map(e=>"string"==typeof e?ua(e):e.toString()).join("|")})$`),e._zod.parse=(t,i)=>{let n=t.value;return e._zod.values.has(n)||t.issues.push({code:"invalid_value",values:r,input:n,inst:e}),t}}),di=lr("$ZodLiteral",(e,t)=>{cs.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=RegExp(`^(${t.values.map(e=>"string"==typeof e?ua(e):e?e.toString():String(e)).join("|")})$`),e._zod.parse=(r,i)=>{let n=r.value;return e._zod.values.has(n)||r.issues.push({code:"invalid_value",values:t.values,input:n,inst:e}),r}}),dn=lr("$ZodFile",(e,t)=>{cs.init(e,t),e._zod.parse=(t,r)=>{let i=t.value;return i instanceof File||t.issues.push({expected:"file",code:"invalid_type",input:i,inst:e}),t}}),da=lr("$ZodTransform",(e,t)=>{cs.init(e,t),e._zod.parse=(e,r)=>{let i=t.transform(e.value,e);if(r.async)return(i instanceof Promise?i:Promise.resolve(i)).then(t=>(e.value=t,e));if(i instanceof Promise)throw new ln;return e.value=i,e}}),ds=lr("$ZodOptional",(e,t)=>{cs.init(e,t),e._zod.optin="optional",e._zod.optout="optional",l4(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),l4(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${l0(e.source)})?$`):void 0}),e._zod.parse=(e,r)=>"optional"===t.innerType._zod.optin?t.innerType._zod.run(e,r):void 0===e.value?e:t.innerType._zod.run(e,r)}),dl=lr("$ZodNullable",(e,t)=>{cs.init(e,t),l4(e._zod,"optin",()=>t.innerType._zod.optin),l4(e._zod,"optout",()=>t.innerType._zod.optout),l4(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${l0(e.source)}|null)$`):void 0}),l4(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,r)=>null===e.value?e:t.innerType._zod.run(e,r)}),du=lr("$ZodDefault",(e,t)=>{cs.init(e,t),e._zod.optin="optional",l4(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{if(void 0===e.value)return e.value=t.defaultValue,e;let i=t.innerType._zod.run(e,r);return i instanceof Promise?i.then(e=>dc(e,t)):dc(i,t)}});function dc(e,t){return void 0===e.value&&(e.value=t.defaultValue),e}let dd=lr("$ZodPrefault",(e,t)=>{cs.init(e,t),e._zod.optin="optional",l4(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>(void 0===e.value&&(e.value=t.defaultValue),t.innerType._zod.run(e,r))}),dp=lr("$ZodNonOptional",(e,t)=>{cs.init(e,t),l4(e._zod,"values",()=>{let e=t.innerType._zod.values;return e?new Set([...e].filter(e=>void 0!==e)):void 0}),e._zod.parse=(r,i)=>{let n=t.innerType._zod.run(r,i);return n instanceof Promise?n.then(t=>dh(t,e)):dh(n,e)}});function dh(e,t){return e.issues.length||void 0!==e.value||e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}let dm=lr("$ZodSuccess",(e,t)=>{cs.init(e,t),e._zod.parse=(e,r)=>{let i=t.innerType._zod.run(e,r);return i instanceof Promise?i.then(t=>(e.value=0===t.issues.length,e)):(e.value=0===i.issues.length,e)}}),df=lr("$ZodCatch",(e,t)=>{cs.init(e,t),e._zod.optin="optional",l4(e._zod,"optout",()=>t.innerType._zod.optout),l4(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{let i=t.innerType._zod.run(e,r);return i instanceof Promise?i.then(i=>(e.value=i.value,i.issues.length&&(e.value=t.catchValue({...e,error:{issues:i.issues.map(e=>u$(e,r,ls()))},input:e.value}),e.issues=[]),e)):(e.value=i.value,i.issues.length&&(e.value=t.catchValue({...e,error:{issues:i.issues.map(e=>u$(e,r,ls()))},input:e.value}),e.issues=[]),e)}}),dg=lr("$ZodNaN",(e,t)=>{cs.init(e,t),e._zod.parse=(t,r)=>("number"==typeof t.value&&Number.isNaN(t.value)||t.issues.push({input:t.value,inst:e,expected:"nan",code:"invalid_type"}),t)}),dy=lr("$ZodPipe",(e,t)=>{cs.init(e,t),l4(e._zod,"values",()=>t.in._zod.values),l4(e._zod,"optin",()=>t.in._zod.optin),l4(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(e,r)=>{let i=t.in._zod.run(e,r);return i instanceof Promise?i.then(e=>d_(e,t,r)):d_(i,t,r)}});function d_(e,t,r){return uv(e)?e:t.out._zod.run({value:e.value,issues:e.issues},r)}let dv=lr("$ZodReadonly",(e,t)=>{cs.init(e,t),l4(e._zod,"propValues",()=>t.innerType._zod.propValues),l4(e._zod,"values",()=>t.innerType._zod.values),l4(e._zod,"optin",()=>t.innerType._zod.optin),l4(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(e,r)=>{let i=t.innerType._zod.run(e,r);return i instanceof Promise?i.then(db):db(i)}});function db(e){return e.value=Object.freeze(e.value),e}let dw=lr("$ZodTemplateLiteral",(e,t)=>{cs.init(e,t);let r=[];for(let e of t.parts)if(e instanceof cs){if(!e._zod.pattern)throw Error(`Invalid template literal part, no pattern found: ${[...e._zod.traits].shift()}`);let t=e._zod.pattern instanceof RegExp?e._zod.pattern.source:e._zod.pattern;if(!t)throw Error(`Invalid template literal part: ${e._zod.traits}`);let i=+!!t.startsWith("^"),n=t.endsWith("$")?t.length-1:t.length;r.push(t.slice(i,n))}else if(null===e||un.has(typeof e))r.push(ua(`${e}`));else throw Error(`Invalid template literal part: ${e}`);e._zod.pattern=RegExp(`^${r.join("")}$`),e._zod.parse=(t,r)=>("string"!=typeof t.value?t.issues.push({input:t.value,inst:e,expected:"template_literal",code:"invalid_type"}):(e._zod.pattern.lastIndex=0,e._zod.pattern.test(t.value)||t.issues.push({input:t.value,inst:e,code:"invalid_format",format:"template_literal",pattern:e._zod.pattern.source})),t)}),d$=lr("$ZodPromise",(e,t)=>{cs.init(e,t),e._zod.parse=(e,r)=>Promise.resolve(e.value).then(e=>t.innerType._zod.run({value:e,issues:[]},r))}),dx=lr("$ZodLazy",(e,t)=>{cs.init(e,t),l4(e._zod,"innerType",()=>t.getter()),l4(e._zod,"pattern",()=>e._zod.innerType._zod.pattern),l4(e._zod,"propValues",()=>e._zod.innerType._zod.propValues),l4(e._zod,"optin",()=>e._zod.innerType._zod.optin),l4(e._zod,"optout",()=>e._zod.innerType._zod.optout),e._zod.parse=(t,r)=>e._zod.innerType._zod.run(t,r)}),dk=lr("$ZodCustom",(e,t)=>{uE.init(e,t),cs.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=r=>{let i=r.value,n=t.fn(i);if(n instanceof Promise)return n.then(t=>dI(t,r,i,e));dI(n,r,i,e)}});function dI(e,t,r,i){if(!e){let e={code:"custom",input:r,inst:i,path:[...i._zod.def.path??[]],continue:!i._zod.def.abort};i._zod.def.params&&(e.params=i._zod.def.params),t.issues.push(uI(e))}}function dO(e,t){return new e({type:"string",...uo(t)})}function dS(e,t){return new e({type:"string",coerce:!0,...uo(t)})}function dE(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...uo(t)})}function dT(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...uo(t)})}function dA(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...uo(t)})}function dN(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...uo(t)})}function dC(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...uo(t)})}function dP(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...uo(t)})}function dj(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...uo(t)})}function dR(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...uo(t)})}function dL(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...uo(t)})}function dU(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...uo(t)})}function dz(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...uo(t)})}function dM(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...uo(t)})}function dD(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...uo(t)})}function dZ(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...uo(t)})}function dF(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...uo(t)})}function dB(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...uo(t)})}function dq(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...uo(t)})}function dW(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...uo(t)})}function dJ(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...uo(t)})}function dG(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...uo(t)})}function dH(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...uo(t)})}function dV(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...uo(t)})}e.s(["$ZodAny",0,cq,"$ZodArray",0,cK,"$ZodBase64",0,cT,"$ZodBase64URL",0,cN,"$ZodBigInt",0,cM,"$ZodBigIntFormat",0,cD,"$ZodBoolean",0,cz,"$ZodCIDRv4",0,cO,"$ZodCIDRv6",0,cS,"$ZodCUID",0,cf,"$ZodCUID2",0,cg,"$ZodCatch",0,df,"$ZodCustom",0,dk,"$ZodCustomStringFormat",0,cR,"$ZodDate",0,cH,"$ZodDefault",0,du,"$ZodDiscriminatedUnion",0,c4,"$ZodE164",0,cC,"$ZodEmail",0,cd,"$ZodEmoji",0,ch,"$ZodEnum",0,dr,"$ZodFile",0,dn,"$ZodGUID",0,cu,"$ZodIPv4",0,ck,"$ZodIPv6",0,cI,"$ZodISODate",0,cw,"$ZodISODateTime",0,cb,"$ZodISODuration",0,cx,"$ZodISOTime",0,c$,"$ZodIntersection",0,c2,"$ZodJWT",0,cj,"$ZodKSUID",0,cv,"$ZodLazy",0,dx,"$ZodLiteral",0,di,"$ZodMap",0,c8,"$ZodNaN",0,dg,"$ZodNanoID",0,cm,"$ZodNever",0,cJ,"$ZodNonOptional",0,dp,"$ZodNull",0,cB,"$ZodNullable",0,dl,"$ZodNumber",0,cL,"$ZodNumberFormat",0,cU,"$ZodObject",0,cQ,"$ZodOptional",0,ds,"$ZodPipe",0,dy,"$ZodPrefault",0,dd,"$ZodPromise",0,d$,"$ZodReadonly",0,dv,"$ZodRecord",0,c3,"$ZodSet",0,de,"$ZodString",0,co,"$ZodStringFormat",0,cl,"$ZodSuccess",0,dm,"$ZodSymbol",0,cZ,"$ZodTemplateLiteral",0,dw,"$ZodTransform",0,da,"$ZodTuple",0,c9,"$ZodType",0,cs,"$ZodULID",0,cy,"$ZodURL",0,cp,"$ZodUUID",0,cc,"$ZodUndefined",0,cF,"$ZodUnion",0,c1,"$ZodUnknown",0,cW,"$ZodVoid",0,cG,"$ZodXID",0,c_,"isValidBase64",()=>cE,"isValidBase64URL",()=>cA,"isValidJWT",()=>cP],39510);let dK={Any:null,Minute:-1,Second:0,Millisecond:3,Microsecond:6};function dX(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...uo(t)})}function dY(e,t){return new e({type:"string",format:"date",check:"string_format",...uo(t)})}function dQ(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...uo(t)})}function d0(e,t){return new e({type:"string",format:"duration",check:"string_format",...uo(t)})}function d1(e,t){return new e({type:"number",checks:[],...uo(t)})}function d4(e,t){return new e({type:"number",coerce:!0,checks:[],...uo(t)})}function d2(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...uo(t)})}function d6(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"float32",...uo(t)})}function d9(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"float64",...uo(t)})}function d5(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"int32",...uo(t)})}function d3(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"uint32",...uo(t)})}function d8(e,t){return new e({type:"boolean",...uo(t)})}function d7(e,t){return new e({type:"boolean",coerce:!0,...uo(t)})}function pe(e,t){return new e({type:"bigint",...uo(t)})}function pt(e,t){return new e({type:"bigint",coerce:!0,...uo(t)})}function pr(e,t){return new e({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...uo(t)})}function pi(e,t){return new e({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...uo(t)})}function pn(e,t){return new e({type:"symbol",...uo(t)})}function pa(e,t){return new e({type:"undefined",...uo(t)})}function ps(e,t){return new e({type:"null",...uo(t)})}function po(e){return new e({type:"any"})}function pl(e){return new e({type:"unknown"})}function pu(e,t){return new e({type:"never",...uo(t)})}function pc(e,t){return new e({type:"void",...uo(t)})}function pd(e,t){return new e({type:"date",...uo(t)})}function pp(e,t){return new e({type:"date",coerce:!0,...uo(t)})}function ph(e,t){return new e({type:"nan",...uo(t)})}function pm(e,t){return new uA({check:"less_than",...uo(t),value:e,inclusive:!1})}function pf(e,t){return new uA({check:"less_than",...uo(t),value:e,inclusive:!0})}function pg(e,t){return new uN({check:"greater_than",...uo(t),value:e,inclusive:!1})}function py(e,t){return new uN({check:"greater_than",...uo(t),value:e,inclusive:!0})}function p_(e){return pg(0,e)}function pv(e){return pm(0,e)}function pb(e){return pf(0,e)}function pw(e){return py(0,e)}function p$(e,t){return new uC({check:"multiple_of",...uo(t),value:e})}function px(e,t){return new uR({check:"max_size",...uo(t),maximum:e})}function pk(e,t){return new uL({check:"min_size",...uo(t),minimum:e})}function pI(e,t){return new uU({check:"size_equals",...uo(t),size:e})}function pO(e,t){return new uz({check:"max_length",...uo(t),maximum:e})}function pS(e,t){return new uM({check:"min_length",...uo(t),minimum:e})}function pE(e,t){return new uD({check:"length_equals",...uo(t),length:e})}function pT(e,t){return new uF({check:"string_format",format:"regex",...uo(t),pattern:e})}function pA(e){return new uB({check:"string_format",format:"lowercase",...uo(e)})}function pN(e){return new uq({check:"string_format",format:"uppercase",...uo(e)})}function pC(e,t){return new uW({check:"string_format",format:"includes",...uo(t),includes:e})}function pP(e,t){return new uJ({check:"string_format",format:"starts_with",...uo(t),prefix:e})}function pj(e,t){return new uG({check:"string_format",format:"ends_with",...uo(t),suffix:e})}function pR(e,t,r){return new uV({check:"property",property:e,schema:t,...uo(r)})}function pL(e,t){return new uK({check:"mime_type",mime:e,...uo(t)})}function pU(e){return new uX({check:"overwrite",tx:e})}function pz(e){return pU(t=>t.normalize(e))}function pM(){return pU(e=>e.trim())}function pD(){return pU(e=>e.toLowerCase())}function pZ(){return pU(e=>e.toUpperCase())}function pF(e,t,r){return new e({type:"array",element:t,...uo(r)})}function pB(e,t,r){return new e({type:"union",options:t,...uo(r)})}function pq(e,t,r,i){return new e({type:"union",options:r,discriminator:t,...uo(i)})}function pW(e,t,r){return new e({type:"intersection",left:t,right:r})}function pJ(e,t,r,i){let n=r instanceof cs,a=n?i:r;return new e({type:"tuple",items:t,rest:n?r:null,...uo(a)})}function pG(e,t,r,i){return new e({type:"record",keyType:t,valueType:r,...uo(i)})}function pH(e,t,r,i){return new e({type:"map",keyType:t,valueType:r,...uo(i)})}function pV(e,t,r){return new e({type:"set",valueType:t,...uo(r)})}function pK(e,t,r){return new e({type:"enum",entries:Array.isArray(t)?Object.fromEntries(t.map(e=>[e,e])):t,...uo(r)})}function pX(e,t,r){return new e({type:"enum",entries:t,...uo(r)})}function pY(e,t,r){return new e({type:"literal",values:Array.isArray(t)?t:[t],...uo(r)})}function pQ(e,t){return new e({type:"file",...uo(t)})}function p0(e,t){return new e({type:"transform",transform:t})}function p1(e,t){return new e({type:"optional",innerType:t})}function p4(e,t){return new e({type:"nullable",innerType:t})}function p2(e,t,r){return new e({type:"default",innerType:t,get defaultValue(){return"function"==typeof r?r():r}})}function p6(e,t,r){return new e({type:"nonoptional",innerType:t,...uo(r)})}function p9(e,t){return new e({type:"success",innerType:t})}function p5(e,t,r){return new e({type:"catch",innerType:t,catchValue:"function"==typeof r?r:()=>r})}function p3(e,t,r){return new e({type:"pipe",in:t,out:r})}function p8(e,t){return new e({type:"readonly",innerType:t})}function p7(e,t,r){return new e({type:"template_literal",parts:t,...uo(r)})}function he(e,t){return new e({type:"lazy",getter:t})}function ht(e,t){return new e({type:"promise",innerType:t})}function hr(e,t,r){let i=uo(r);return i.abort??(i.abort=!0),new e({type:"custom",check:"custom",fn:t,...i})}function hi(e,t,r){return new e({type:"custom",check:"custom",fn:t,...uo(r)})}function hn(e,t){let r=uo(t),i=r.truthy??["true","1","yes","on","y","enabled"],n=r.falsy??["false","0","no","off","n","disabled"];"sensitive"!==r.case&&(i=i.map(e=>"string"==typeof e?e.toLowerCase():e),n=n.map(e=>"string"==typeof e?e.toLowerCase():e));let a=new Set(i),s=new Set(n),o=e.Pipe??dy,l=e.Boolean??cz,u=e.String??co,c=new(e.Transform??da)({type:"transform",transform:(e,t)=>{let i=e;return"sensitive"!==r.case&&(i=i.toLowerCase()),!!a.has(i)||!s.has(i)&&(t.issues.push({code:"invalid_value",expected:"stringbool",values:[...a,...s],input:t.value,inst:c}),{})},error:r.error}),d=new o({type:"pipe",in:new u({type:"string",error:r.error}),out:c,error:r.error});return new o({type:"pipe",in:d,out:new l({type:"boolean",error:r.error}),error:r.error})}function ha(e,t,r,i={}){let n=uo(i),a={...uo(i),check:"string_format",type:"string",format:t,fn:"function"==typeof r?r:e=>r.test(e),...n};return r instanceof RegExp&&(a.pattern=r),new e(a)}e.s(["TimePrecision",0,dK,"_any",()=>po,"_array",()=>pF,"_base64",()=>dJ,"_base64url",()=>dG,"_bigint",()=>pe,"_boolean",()=>d8,"_catch",()=>p5,"_cidrv4",()=>dq,"_cidrv6",()=>dW,"_coercedBigint",()=>pt,"_coercedBoolean",()=>d7,"_coercedDate",()=>pp,"_coercedNumber",()=>d4,"_coercedString",()=>dS,"_cuid",()=>dU,"_cuid2",()=>dz,"_custom",()=>hr,"_date",()=>pd,"_default",()=>p2,"_discriminatedUnion",()=>pq,"_e164",()=>dH,"_email",()=>dE,"_emoji",()=>dR,"_endsWith",()=>pj,"_enum",()=>pK,"_file",()=>pQ,"_float32",()=>d6,"_float64",()=>d9,"_gt",()=>pg,"_gte",()=>py,"_guid",()=>dT,"_includes",()=>pC,"_int",()=>d2,"_int32",()=>d5,"_int64",()=>pr,"_intersection",()=>pW,"_ipv4",()=>dF,"_ipv6",()=>dB,"_isoDate",()=>dY,"_isoDateTime",()=>dX,"_isoDuration",()=>d0,"_isoTime",()=>dQ,"_jwt",()=>dV,"_ksuid",()=>dZ,"_lazy",()=>he,"_length",()=>pE,"_literal",()=>pY,"_lowercase",()=>pA,"_lt",()=>pm,"_lte",()=>pf,"_map",()=>pH,"_max",()=>pf,"_maxLength",()=>pO,"_maxSize",()=>px,"_mime",()=>pL,"_min",()=>py,"_minLength",()=>pS,"_minSize",()=>pk,"_multipleOf",()=>p$,"_nan",()=>ph,"_nanoid",()=>dL,"_nativeEnum",()=>pX,"_negative",()=>pv,"_never",()=>pu,"_nonnegative",()=>pw,"_nonoptional",()=>p6,"_nonpositive",()=>pb,"_normalize",()=>pz,"_null",()=>ps,"_nullable",()=>p4,"_number",()=>d1,"_optional",()=>p1,"_overwrite",()=>pU,"_pipe",()=>p3,"_positive",()=>p_,"_promise",()=>ht,"_property",()=>pR,"_readonly",()=>p8,"_record",()=>pG,"_refine",()=>hi,"_regex",()=>pT,"_set",()=>pV,"_size",()=>pI,"_startsWith",()=>pP,"_string",()=>dO,"_stringFormat",()=>ha,"_stringbool",()=>hn,"_success",()=>p9,"_symbol",()=>pn,"_templateLiteral",()=>p7,"_toLowerCase",()=>pD,"_toUpperCase",()=>pZ,"_transform",()=>p0,"_trim",()=>pM,"_tuple",()=>pJ,"_uint32",()=>d3,"_uint64",()=>pi,"_ulid",()=>dM,"_undefined",()=>pa,"_union",()=>pB,"_unknown",()=>pl,"_uppercase",()=>pN,"_url",()=>dj,"_uuid",()=>dA,"_uuidv4",()=>dN,"_uuidv6",()=>dC,"_uuidv7",()=>dP,"_void",()=>pc,"_xid",()=>dD],62061);let hs=Symbol("ZodOutput"),ho=Symbol("ZodInput");class hl{constructor(){this._map=new Map,this._idmap=new Map}add(e,...t){let r=t[0];if(this._map.set(e,r),r&&"object"==typeof r&&"id"in r){if(this._idmap.has(r.id))throw Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&"object"==typeof t&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let r={...this.get(t)??{}};return delete r.id,{...r,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function hu(){return new hl}let hc=hu();e.s(["$ZodRegistry",()=>hl,"$input",0,ho,"$output",0,hs,"globalRegistry",0,hc,"registry",()=>hu],52637);var hd=e.i(86618),hd=hd;function hp(e){if("object"!=typeof e||null===e||!("_zod"in e))return!1;let t=e._zod;return"object"==typeof t&&null!==t&&"def"in t}function hh(e){if("object"!=typeof e||null===e||!("_def"in e)||"_zod"in e)return!1;let t=e._def;return"object"==typeof t&&null!=t&&"typeName"in t}function hm(e){return hp(e)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),hh(e)}function hf(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&!!(hp(e)||hh(e))}function hg(e){return"object"==typeof e&&null!==e&&"_def"in e&&"object"==typeof e._def&&null!==e._def&&"typeName"in e._def&&"ZodLiteral"===e._def.typeName||!1}function hy(e){return!!hp(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"literal"===e._zod.def.type||!1)}function h_(e){return!!(hg(e)||hy(e))}async function hv(e,t){if(hp(e))try{let r=await ce(e,t);return{success:!0,data:r}}catch(e){return{success:!1,error:e}}if(hh(e))return await e.safeParseAsync(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function hb(e,t){if(hp(e))return await ce(e,t);if(hh(e))return await e.parseAsync(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function hw(e,t){if(hp(e))try{let r=u8(e,t);return{success:!0,data:r}}catch(e){return{success:!1,error:e}}if(hh(e))return e.safeParse(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function h$(e,t){if(hp(e))return u8(e,t);if(hh(e))return e.parse(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function hx(e){return hp(e)?hc.get(e)?.description:hh(e)||"description"in e&&"string"==typeof e.description?e.description:void 0}function hk(e){if(!hf(e))return!1;if(hh(e)){let t=e._def;if("ZodObject"===t.typeName)return!e.shape||0===Object.keys(e.shape).length;if("ZodRecord"===t.typeName)return!0}if(hp(e)){let t=e._zod.def;if("object"===t.type)return!e.shape||0===Object.keys(e.shape).length;if("record"===t.type)return!0}return"object"==typeof e&&null!==e&&!("shape"in e)}function hI(e){return!!hf(e)&&(hh(e)?"ZodString"===e._def.typeName:!!hp(e)&&"string"===e._zod.def.type)}function hO(e){return"object"==typeof e&&null!==e&&"_def"in e&&"object"==typeof e._def&&null!==e._def&&"typeName"in e._def&&"ZodObject"===e._def.typeName||!1}function hS(e){return!!hp(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"object"===e._zod.def.type||!1)}function hE(e){return!!hp(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"array"===e._zod.def.type||!1)}function hT(e){return!!hp(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"optional"===e._zod.def.type||!1)}function hA(e){return!!hp(e)&&("object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"nullable"===e._zod.def.type||!1)}function hN(e){return!!(hO(e)||hS(e))}function hC(e){if(hh(e))return e.shape;if(hp(e))return e._zod.def.shape;throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function hP(e,t){if(hh(e))return e.extend(t);if(hp(e))return hd.extend(e,t);throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function hj(e){if(hh(e))return e.partial();if(hp(e))return hd.partial(ds,e,void 0);throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function hR(e,t=!1){if(hh(e))return e.strict();if(hS(e)){let r=e._zod.def.shape;if(t)for(let[i,n]of Object.entries(e._zod.def.shape)){if(hS(n)){let e=hR(n,t);r[i]=e}else if(hE(n)){let e=n._zod.def.element;hS(e)&&(e=hR(e,t)),r[i]=us(n,{...n._zod.def,element:e})}else r[i]=n;let e=hc.get(n);e&&hc.add(r[i],e)}let i=us(e,{...e._zod.def,shape:r,catchall:pu(cJ)}),n=hc.get(e);return n&&hc.add(i,n),i}throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function hL(e){if(hh(e))try{let t=e.parse(void 0);return()=>t}catch{return}if(hp(e))try{let t=u8(e,void 0);return()=>t}catch{}}function hU(e,t=!1){return function e(t,r,i){let n=i.get(t);if(void 0!==n)return n;if(hh(t))return hh(t)&&"typeName"in t._def&&"ZodEffects"===t._def.typeName?e(t._def.schema,r,i):t;if(hp(t)){let n=t;if(hp(t)&&"pipe"===t._zod.def.type&&(n=e(t._zod.def.in,r,i)),r){if(hS(n)){let t=n._zod.def.shape;for(let[a,s]of Object.entries(n._zod.def.shape))t[a]=e(s,r,i);n=us(n,{...n._zod.def,shape:t})}else if(hE(n)){let t=e(n._zod.def.element,r,i);n=us(n,{...n._zod.def,element:t})}else if(hT(n)){let t=e(n._zod.def.innerType,r,i);n=us(n,{...n._zod.def,innerType:t})}else if(hA(n)){let t=e(n._zod.def.innerType,r,i);n=us(n,{...n._zod.def,innerType:t})}}let a=hc.get(t);return a&&hc.add(n,a),i.set(t,n),n}throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}(e,t,new WeakMap)}function hz(e,t){if(hh(e)){let r=hC(e),i={};for(let[e,n]of Object.entries(r))t(e,n)?i[e]=n.optional():i[e]=n;return e.extend(i)}if(hp(e)){let r=hC(e),i={...e._zod.def.shape};for(let[e,n]of Object.entries(r))t(e,n)&&(i[e]=new ds({type:"optional",innerType:n}));let n=us(e,{...e._zod.def,shape:i}),a=hc.get(e);return a&&hc.add(n,a),n}throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function hM(e){return e instanceof Error&&("ZodError"===e.constructor.name||"$ZodError"===e.constructor.name)}function hD(e){return e.replace(/[^a-zA-Z-_0-9]/g,"_")}let hZ=["*","_","`"];async function hF(e,t){let r=t?.backgroundColor??"white",i=t?.imageType??"png",n=btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");void 0!==r&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`));let a=`https://mermaid.ink/img/${n}?bgColor=${r}&type=${i}`,s=await fetch(a);if(!s.ok)throw Error(`Failed to render the graph using the Mermaid.INK API.
Status code: ${s.status}
Status text: ${s.statusText}`);return await s.blob()}let hB=Symbol("Let zodToJsonSchema decide on which parser to use"),hq={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},hW=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};function hJ(e){if("openAi"!==e.target)return{};let t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===e.$refStrategy?hW(t,e.currentPath):t.join("/")}}function hG(e,t,r,i){i?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function hH(e,t,r,i,n){e[t]=r,hG(e,t,i,n)}(ro=iS||(iS={})).assertEqual=e=>{},ro.assertIs=function(e){},ro.assertNever=function(e){throw Error()},ro.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},ro.getValidEnumValues=e=>{let t=ro.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),r={};for(let i of t)r[i]=e[i];return ro.objectValues(r)},ro.objectValues=e=>ro.objectKeys(e).map(function(t){return e[t]}),ro.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},ro.find=(e,t)=>{for(let r of e)if(t(r))return r},ro.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,ro.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},ro.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(iE||(iE={})).mergeShapes=(e,t)=>({...e,...t});let hV=iS.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),hK=e=>{switch(typeof e){case"undefined":return hV.undefined;case"string":return hV.string;case"number":return Number.isNaN(e)?hV.nan:hV.number;case"boolean":return hV.boolean;case"function":return hV.function;case"bigint":return hV.bigint;case"symbol":return hV.symbol;case"object":if(Array.isArray(e))return hV.array;if(null===e)return hV.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return hV.promise;if("undefined"!=typeof Map&&e instanceof Map)return hV.map;if("undefined"!=typeof Set&&e instanceof Set)return hV.set;if("undefined"!=typeof Date&&e instanceof Date)return hV.date;return hV.object;default:return hV.unknown}};e.s(["ZodParsedType",0,hV,"getParsedType",0,hK,"objectUtil",()=>iE,"util",()=>iS],42944);let hX=iS.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),hY=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class hQ extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},i=e=>{for(let n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(i);else if("invalid_return_type"===n.code)i(n.returnTypeError);else if("invalid_arguments"===n.code)i(n.argumentsError);else if(0===n.path.length)r._errors.push(t(n));else{let e=r,i=0;for(;i<n.path.length;){let r=n.path[i];i===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],i++}}};return i(this),r}static assert(e){if(!(e instanceof hQ))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,iS.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let i of this.issues)if(i.path.length>0){let r=i.path[0];t[r]=t[r]||[],t[r].push(e(i))}else r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}hQ.create=e=>new hQ(e),e.s(["ZodError",()=>hQ,"ZodIssueCode",0,hX,"quotelessJson",0,hY],15235);let h0=(e,t)=>{let r;switch(e.code){case hX.invalid_type:r=e.received===hV.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case hX.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,iS.jsonStringifyReplacer)}`;break;case hX.unrecognized_keys:r=`Unrecognized key(s) in object: ${iS.joinValues(e.keys,", ")}`;break;case hX.invalid_union:r="Invalid input";break;case hX.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${iS.joinValues(e.options)}`;break;case hX.invalid_enum_value:r=`Invalid enum value. Expected ${iS.joinValues(e.options)}, received '${e.received}'`;break;case hX.invalid_arguments:r="Invalid function arguments";break;case hX.invalid_return_type:r="Invalid function return type";break;case hX.invalid_date:r="Invalid date";break;case hX.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:iS.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case hX.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case hX.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case hX.custom:r="Invalid input";break;case hX.invalid_intersection_types:r="Intersection results could not be merged";break;case hX.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case hX.not_finite:r="Number must be finite";break;default:r=t.defaultError,iS.assertNever(e)}return{message:r}},h1=h0;function h4(e){h1=e}function h2(){return h1}e.s(["getErrorMap",()=>h2,"setErrorMap",()=>h4],85676),(rl=iT||(iT={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},rl.toString=e=>"string"==typeof e?e:e?.message;let h6=e=>{let{data:t,path:r,errorMaps:i,issueData:n}=e,a=[...r,...n.path||[]],s={...n,path:a};if(void 0!==n.message)return{...n,path:a,message:n.message};let o="";for(let e of i.filter(e=>!!e).slice().reverse())o=e(s,{data:t,defaultError:o}).message;return{...n,path:a,message:o}},h9=[];function h5(e,t){let r=h1,i=h6({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===h0?void 0:h0].filter(e=>!!e)});e.common.issues.push(i)}class h3{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let i of t){if("aborted"===i.status)return h8;"dirty"===i.status&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,i=await e.value;r.push({key:t,value:i})}return h3.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let i of t){let{key:t,value:n}=i;if("aborted"===t.status||"aborted"===n.status)return h8;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==n.value||i.alwaysSet)&&(r[t.value]=n.value)}return{status:e.value,value:r}}}let h8=Object.freeze({status:"aborted"}),h7=e=>({status:"dirty",value:e}),me=e=>({status:"valid",value:e}),mt=e=>"aborted"===e.status,mr=e=>"dirty"===e.status,mi=e=>"valid"===e.status,mn=e=>"undefined"!=typeof Promise&&e instanceof Promise;e.s(["DIRTY",0,h7,"EMPTY_PATH",0,h9,"INVALID",0,h8,"OK",0,me,"ParseStatus",()=>h3,"addIssueToContext",()=>h5,"isAborted",0,mt,"isAsync",0,mn,"isDirty",0,mr,"isValid",0,mi,"makeIssue",0,h6],84488);class ma{constructor(e,t,r,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let ms=(e,t)=>{if(mi(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new hQ(e.common.issues);return this._error=t,this._error}}};function mo(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:i,description:n}=e;if(t&&(r||i))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(t,n)=>{let{message:a}=e;return"invalid_enum_value"===t.code?{message:a??n.defaultError}:void 0===n.data?{message:a??i??n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:a??r??n.defaultError}},description:n}}class ml{get description(){return this._def.description}_getType(e){return hK(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:hK(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new h3,ctx:{common:e.parent.common,data:e.data,parsedType:hK(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(mn(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:hK(e)},i=this._parseSync({data:e,path:r.path,parent:r});return ms(r,i)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:hK(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return mi(r)?{value:r.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>mi(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:hK(e)},i=this._parse({data:e,path:r.path,parent:r});return ms(r,await (mn(i)?i:Promise.resolve(i)))}refine(e,t){return this._refinement((r,i)=>{let n=e(r),a=()=>i.addIssue({code:hX.custom,..."string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(r):t});return"undefined"!=typeof Promise&&n instanceof Promise?n.then(e=>!!e||(a(),!1)):!!n||(a(),!1)})}refinement(e,t){return this._refinement((r,i)=>!!e(r)||(i.addIssue("function"==typeof t?t(r,i):t),!1))}_refinement(e){return new m4({schema:this,typeName:iA.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return m2.create(this,this._def)}nullable(){return m6.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return mM.create(this)}promise(){return m1.create(this,this._def)}or(e){return mZ.create([this,e],this._def)}and(e){return mq.create(this,e,this._def)}transform(e){return new m4({...mo(this._def),schema:this,typeName:iA.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new m9({...mo(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:iA.ZodDefault})}brand(){return new m7({typeName:iA.ZodBranded,type:this,...mo(this._def)})}catch(e){return new m5({...mo(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:iA.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return fe.create(this,e)}readonly(){return ft.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let mu=/^c[^\s-]{8,}$/i,mc=/^[0-9a-z]+$/,md=/^[0-9A-HJKMNP-TV-Z]{26}$/i,mp=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,mh=/^[a-z0-9_-]{21}$/i,mm=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,mf=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,mg=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,my=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,m_=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,mv=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,mb=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,mw=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,m$=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,mx="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",mk=RegExp(`^${mx}$`);function mI(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function mO(e){let t=`${mx}T${mI(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class mS extends ml{_parse(e){var t,r,i,n;let a;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==hV.string){let t=this._getOrReturnCtx(e);return h5(t,{code:hX.invalid_type,expected:hV.string,received:t.parsedType}),h8}let s=new h3;for(let o of this._def.checks)if("min"===o.kind)e.data.length<o.value&&(h5(a=this._getOrReturnCtx(e,a),{code:hX.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),s.dirty());else if("max"===o.kind)e.data.length>o.value&&(h5(a=this._getOrReturnCtx(e,a),{code:hX.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),s.dirty());else if("length"===o.kind){let t=e.data.length>o.value,r=e.data.length<o.value;(t||r)&&(a=this._getOrReturnCtx(e,a),t?h5(a,{code:hX.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):r&&h5(a,{code:hX.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),s.dirty())}else if("email"===o.kind)mg.test(e.data)||(h5(a=this._getOrReturnCtx(e,a),{validation:"email",code:hX.invalid_string,message:o.message}),s.dirty());else if("emoji"===o.kind)d||(d=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),d.test(e.data)||(h5(a=this._getOrReturnCtx(e,a),{validation:"emoji",code:hX.invalid_string,message:o.message}),s.dirty());else if("uuid"===o.kind)mp.test(e.data)||(h5(a=this._getOrReturnCtx(e,a),{validation:"uuid",code:hX.invalid_string,message:o.message}),s.dirty());else if("nanoid"===o.kind)mh.test(e.data)||(h5(a=this._getOrReturnCtx(e,a),{validation:"nanoid",code:hX.invalid_string,message:o.message}),s.dirty());else if("cuid"===o.kind)mu.test(e.data)||(h5(a=this._getOrReturnCtx(e,a),{validation:"cuid",code:hX.invalid_string,message:o.message}),s.dirty());else if("cuid2"===o.kind)mc.test(e.data)||(h5(a=this._getOrReturnCtx(e,a),{validation:"cuid2",code:hX.invalid_string,message:o.message}),s.dirty());else if("ulid"===o.kind)md.test(e.data)||(h5(a=this._getOrReturnCtx(e,a),{validation:"ulid",code:hX.invalid_string,message:o.message}),s.dirty());else if("url"===o.kind)try{new URL(e.data)}catch{h5(a=this._getOrReturnCtx(e,a),{validation:"url",code:hX.invalid_string,message:o.message}),s.dirty()}else"regex"===o.kind?(o.regex.lastIndex=0,o.regex.test(e.data)||(h5(a=this._getOrReturnCtx(e,a),{validation:"regex",code:hX.invalid_string,message:o.message}),s.dirty())):"trim"===o.kind?e.data=e.data.trim():"includes"===o.kind?e.data.includes(o.value,o.position)||(h5(a=this._getOrReturnCtx(e,a),{code:hX.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),s.dirty()):"toLowerCase"===o.kind?e.data=e.data.toLowerCase():"toUpperCase"===o.kind?e.data=e.data.toUpperCase():"startsWith"===o.kind?e.data.startsWith(o.value)||(h5(a=this._getOrReturnCtx(e,a),{code:hX.invalid_string,validation:{startsWith:o.value},message:o.message}),s.dirty()):"endsWith"===o.kind?e.data.endsWith(o.value)||(h5(a=this._getOrReturnCtx(e,a),{code:hX.invalid_string,validation:{endsWith:o.value},message:o.message}),s.dirty()):"datetime"===o.kind?mO(o).test(e.data)||(h5(a=this._getOrReturnCtx(e,a),{code:hX.invalid_string,validation:"datetime",message:o.message}),s.dirty()):"date"===o.kind?mk.test(e.data)||(h5(a=this._getOrReturnCtx(e,a),{code:hX.invalid_string,validation:"date",message:o.message}),s.dirty()):"time"===o.kind?RegExp(`^${mI(o)}$`).test(e.data)||(h5(a=this._getOrReturnCtx(e,a),{code:hX.invalid_string,validation:"time",message:o.message}),s.dirty()):"duration"===o.kind?mf.test(e.data)||(h5(a=this._getOrReturnCtx(e,a),{validation:"duration",code:hX.invalid_string,message:o.message}),s.dirty()):"ip"===o.kind?(t=e.data,!(("v4"===(r=o.version)||!r)&&my.test(t)||("v6"===r||!r)&&mv.test(t))&&1&&(h5(a=this._getOrReturnCtx(e,a),{validation:"ip",code:hX.invalid_string,message:o.message}),s.dirty())):"jwt"===o.kind?!function(e,t){if(!mm.test(e))return!1;try{let[r]=e.split(".");if(!r)return!1;let i=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(i));if("object"!=typeof n||null===n||"typ"in n&&n?.typ!=="JWT"||!n.alg||t&&n.alg!==t)return!1;return!0}catch{return!1}}(e.data,o.alg)&&(h5(a=this._getOrReturnCtx(e,a),{validation:"jwt",code:hX.invalid_string,message:o.message}),s.dirty()):"cidr"===o.kind?(i=e.data,!(("v4"===(n=o.version)||!n)&&m_.test(i)||("v6"===n||!n)&&mb.test(i))&&1&&(h5(a=this._getOrReturnCtx(e,a),{validation:"cidr",code:hX.invalid_string,message:o.message}),s.dirty())):"base64"===o.kind?mw.test(e.data)||(h5(a=this._getOrReturnCtx(e,a),{validation:"base64",code:hX.invalid_string,message:o.message}),s.dirty()):"base64url"===o.kind?m$.test(e.data)||(h5(a=this._getOrReturnCtx(e,a),{validation:"base64url",code:hX.invalid_string,message:o.message}),s.dirty()):iS.assertNever(o);return{status:s.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:hX.invalid_string,...iT.errToObj(r)})}_addCheck(e){return new mS({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...iT.errToObj(e)})}url(e){return this._addCheck({kind:"url",...iT.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...iT.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...iT.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...iT.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...iT.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...iT.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...iT.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...iT.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...iT.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...iT.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...iT.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...iT.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...iT.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...iT.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...iT.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...iT.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...iT.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...iT.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...iT.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...iT.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...iT.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...iT.errToObj(t)})}nonempty(e){return this.min(1,iT.errToObj(e))}trim(){return new mS({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new mS({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new mS({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}mS.create=e=>new mS({checks:[],typeName:iA.ZodString,coerce:e?.coerce??!1,...mo(e)});class mE extends ml{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==hV.number){let t=this._getOrReturnCtx(e);return h5(t,{code:hX.invalid_type,expected:hV.number,received:t.parsedType}),h8}let r=new h3;for(let i of this._def.checks)"int"===i.kind?iS.isInteger(e.data)||(h5(t=this._getOrReturnCtx(e,t),{code:hX.invalid_type,expected:"integer",received:"float",message:i.message}),r.dirty()):"min"===i.kind?(i.inclusive?e.data<i.value:e.data<=i.value)&&(h5(t=this._getOrReturnCtx(e,t),{code:hX.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):"max"===i.kind?(i.inclusive?e.data>i.value:e.data>=i.value)&&(h5(t=this._getOrReturnCtx(e,t),{code:hX.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):"multipleOf"===i.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,n=r>i?r:i;return Number.parseInt(e.toFixed(n).replace(".",""))%Number.parseInt(t.toFixed(n).replace(".",""))/10**n}(e.data,i.value)&&(h5(t=this._getOrReturnCtx(e,t),{code:hX.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):"finite"===i.kind?Number.isFinite(e.data)||(h5(t=this._getOrReturnCtx(e,t),{code:hX.not_finite,message:i.message}),r.dirty()):iS.assertNever(i);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,iT.toString(t))}gt(e,t){return this.setLimit("min",e,!1,iT.toString(t))}lte(e,t){return this.setLimit("max",e,!0,iT.toString(t))}lt(e,t){return this.setLimit("max",e,!1,iT.toString(t))}setLimit(e,t,r,i){return new mE({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:iT.toString(i)}]})}_addCheck(e){return new mE({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:iT.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:iT.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:iT.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:iT.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:iT.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:iT.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:iT.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:iT.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:iT.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&iS.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks)if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;else"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value);return Number.isFinite(t)&&Number.isFinite(e)}}mE.create=e=>new mE({checks:[],typeName:iA.ZodNumber,coerce:e?.coerce||!1,...mo(e)});class mT extends ml{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==hV.bigint)return this._getInvalidInput(e);let r=new h3;for(let i of this._def.checks)"min"===i.kind?(i.inclusive?e.data<i.value:e.data<=i.value)&&(h5(t=this._getOrReturnCtx(e,t),{code:hX.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):"max"===i.kind?(i.inclusive?e.data>i.value:e.data>=i.value)&&(h5(t=this._getOrReturnCtx(e,t),{code:hX.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):"multipleOf"===i.kind?e.data%i.value!==BigInt(0)&&(h5(t=this._getOrReturnCtx(e,t),{code:hX.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):iS.assertNever(i);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return h5(t,{code:hX.invalid_type,expected:hV.bigint,received:t.parsedType}),h8}gte(e,t){return this.setLimit("min",e,!0,iT.toString(t))}gt(e,t){return this.setLimit("min",e,!1,iT.toString(t))}lte(e,t){return this.setLimit("max",e,!0,iT.toString(t))}lt(e,t){return this.setLimit("max",e,!1,iT.toString(t))}setLimit(e,t,r,i){return new mT({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:iT.toString(i)}]})}_addCheck(e){return new mT({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:iT.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:iT.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:iT.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:iT.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:iT.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}mT.create=e=>new mT({checks:[],typeName:iA.ZodBigInt,coerce:e?.coerce??!1,...mo(e)});class mA extends ml{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==hV.boolean){let t=this._getOrReturnCtx(e);return h5(t,{code:hX.invalid_type,expected:hV.boolean,received:t.parsedType}),h8}return me(e.data)}}mA.create=e=>new mA({typeName:iA.ZodBoolean,coerce:e?.coerce||!1,...mo(e)});class mN extends ml{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==hV.date){let t=this._getOrReturnCtx(e);return h5(t,{code:hX.invalid_type,expected:hV.date,received:t.parsedType}),h8}if(Number.isNaN(e.data.getTime()))return h5(this._getOrReturnCtx(e),{code:hX.invalid_date}),h8;let r=new h3;for(let i of this._def.checks)"min"===i.kind?e.data.getTime()<i.value&&(h5(t=this._getOrReturnCtx(e,t),{code:hX.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):"max"===i.kind?e.data.getTime()>i.value&&(h5(t=this._getOrReturnCtx(e,t),{code:hX.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):iS.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new mN({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:iT.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:iT.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}mN.create=e=>new mN({checks:[],coerce:e?.coerce||!1,typeName:iA.ZodDate,...mo(e)});class mC extends ml{_parse(e){if(this._getType(e)!==hV.symbol){let t=this._getOrReturnCtx(e);return h5(t,{code:hX.invalid_type,expected:hV.symbol,received:t.parsedType}),h8}return me(e.data)}}mC.create=e=>new mC({typeName:iA.ZodSymbol,...mo(e)});class mP extends ml{_parse(e){if(this._getType(e)!==hV.undefined){let t=this._getOrReturnCtx(e);return h5(t,{code:hX.invalid_type,expected:hV.undefined,received:t.parsedType}),h8}return me(e.data)}}mP.create=e=>new mP({typeName:iA.ZodUndefined,...mo(e)});class mj extends ml{_parse(e){if(this._getType(e)!==hV.null){let t=this._getOrReturnCtx(e);return h5(t,{code:hX.invalid_type,expected:hV.null,received:t.parsedType}),h8}return me(e.data)}}mj.create=e=>new mj({typeName:iA.ZodNull,...mo(e)});class mR extends ml{constructor(){super(...arguments),this._any=!0}_parse(e){return me(e.data)}}mR.create=e=>new mR({typeName:iA.ZodAny,...mo(e)});class mL extends ml{constructor(){super(...arguments),this._unknown=!0}_parse(e){return me(e.data)}}mL.create=e=>new mL({typeName:iA.ZodUnknown,...mo(e)});class mU extends ml{_parse(e){let t=this._getOrReturnCtx(e);return h5(t,{code:hX.invalid_type,expected:hV.never,received:t.parsedType}),h8}}mU.create=e=>new mU({typeName:iA.ZodNever,...mo(e)});class mz extends ml{_parse(e){if(this._getType(e)!==hV.undefined){let t=this._getOrReturnCtx(e);return h5(t,{code:hX.invalid_type,expected:hV.void,received:t.parsedType}),h8}return me(e.data)}}mz.create=e=>new mz({typeName:iA.ZodVoid,...mo(e)});class mM extends ml{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),i=this._def;if(t.parsedType!==hV.array)return h5(t,{code:hX.invalid_type,expected:hV.array,received:t.parsedType}),h8;if(null!==i.exactLength){let e=t.data.length>i.exactLength.value,n=t.data.length<i.exactLength.value;(e||n)&&(h5(t,{code:e?hX.too_big:hX.too_small,minimum:n?i.exactLength.value:void 0,maximum:e?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(null!==i.minLength&&t.data.length<i.minLength.value&&(h5(t,{code:hX.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),null!==i.maxLength&&t.data.length>i.maxLength.value&&(h5(t,{code:hX.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>i.type._parseAsync(new ma(t,e,t.path,r)))).then(e=>h3.mergeArray(r,e));let n=[...t.data].map((e,r)=>i.type._parseSync(new ma(t,e,t.path,r)));return h3.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new mM({...this._def,minLength:{value:e,message:iT.toString(t)}})}max(e,t){return new mM({...this._def,maxLength:{value:e,message:iT.toString(t)}})}length(e,t){return new mM({...this._def,exactLength:{value:e,message:iT.toString(t)}})}nonempty(e){return this.min(1,e)}}mM.create=(e,t)=>new mM({type:e,minLength:null,maxLength:null,exactLength:null,typeName:iA.ZodArray,...mo(t)});class mD extends ml{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=iS.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==hV.object){let t=this._getOrReturnCtx(e);return h5(t,{code:hX.invalid_type,expected:hV.object,received:t.parsedType}),h8}let{status:t,ctx:r}=this._processInputParams(e),{shape:i,keys:n}=this._getCached(),a=[];if(!(this._def.catchall instanceof mU&&"strip"===this._def.unknownKeys))for(let e in r.data)n.includes(e)||a.push(e);let s=[];for(let e of n){let t=i[e],n=r.data[e];s.push({key:{status:"valid",value:e},value:t._parse(new ma(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof mU){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of a)s.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)a.length>0&&(h5(r,{code:hX.unrecognized_keys,keys:a}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of a){let i=r.data[t];s.push({key:{status:"valid",value:t},value:e._parse(new ma(r,i,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of s){let r=await t.key,i=await t.value;e.push({key:r,value:i,alwaysSet:t.alwaysSet})}return e}).then(e=>h3.mergeObjectSync(t,e)):h3.mergeObjectSync(t,s)}get shape(){return this._def.shape()}strict(e){return iT.errToObj,new mD({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{let i=this._def.errorMap?.(t,r).message??r.defaultError;return"unrecognized_keys"===t.code?{message:iT.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new mD({...this._def,unknownKeys:"strip"})}passthrough(){return new mD({...this._def,unknownKeys:"passthrough"})}extend(e){return new mD({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new mD({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:iA.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new mD({...this._def,catchall:e})}pick(e){let t={};for(let r of iS.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new mD({...this._def,shape:()=>t})}omit(e){let t={};for(let r of iS.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new mD({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof mD){let r={};for(let i in t.shape){let n=t.shape[i];r[i]=m2.create(e(n))}return new mD({...t._def,shape:()=>r})}if(t instanceof mM)return new mM({...t._def,type:e(t.element)});if(t instanceof m2)return m2.create(e(t.unwrap()));if(t instanceof m6)return m6.create(e(t.unwrap()));if(t instanceof mW)return mW.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};for(let r of iS.objectKeys(this.shape)){let i=this.shape[r];e&&!e[r]?t[r]=i:t[r]=i.optional()}return new mD({...this._def,shape:()=>t})}required(e){let t={};for(let r of iS.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof m2;)e=e._def.innerType;t[r]=e}return new mD({...this._def,shape:()=>t})}keyof(){return mY(iS.objectKeys(this.shape))}}mD.create=(e,t)=>new mD({shape:()=>e,unknownKeys:"strip",catchall:mU.create(),typeName:iA.ZodObject,...mo(t)}),mD.strictCreate=(e,t)=>new mD({shape:()=>e,unknownKeys:"strict",catchall:mU.create(),typeName:iA.ZodObject,...mo(t)}),mD.lazycreate=(e,t)=>new mD({shape:e,unknownKeys:"strip",catchall:mU.create(),typeName:iA.ZodObject,...mo(t)});class mZ extends ml{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new hQ(e.ctx.common.issues));return h5(t,{code:hX.invalid_union,unionErrors:r}),h8});{let e,i=[];for(let n of r){let r={...t,common:{...t.common,issues:[]},parent:null},a=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:r}),r.common.issues.length&&i.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let n=i.map(e=>new hQ(e));return h5(t,{code:hX.invalid_union,unionErrors:n}),h8}}get options(){return this._def.options}}mZ.create=(e,t)=>new mZ({options:e,typeName:iA.ZodUnion,...mo(t)});let mF=e=>{if(e instanceof mK)return mF(e.schema);if(e instanceof m4)return mF(e.innerType());if(e instanceof mX)return[e.value];if(e instanceof mQ)return e.options;if(e instanceof m0)return iS.objectValues(e.enum);else if(e instanceof m9)return mF(e._def.innerType);else if(e instanceof mP)return[void 0];else if(e instanceof mj)return[null];else if(e instanceof m2)return[void 0,...mF(e.unwrap())];else if(e instanceof m6)return[null,...mF(e.unwrap())];else if(e instanceof m7)return mF(e.unwrap());else if(e instanceof ft)return mF(e.unwrap());else if(e instanceof m5)return mF(e._def.innerType);else return[]};class mB extends ml{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==hV.object)return h5(t,{code:hX.invalid_type,expected:hV.object,received:t.parsedType}),h8;let r=this.discriminator,i=t.data[r],n=this.optionsMap.get(i);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(h5(t,{code:hX.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),h8)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let i=new Map;for(let r of t){let t=mF(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let n of t){if(i.has(n))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);i.set(n,r)}}return new mB({typeName:iA.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...mo(r)})}}class mq extends ml{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),i=(e,i)=>{if(mt(e)||mt(i))return h8;let n=function e(t,r){let i=hK(t),n=hK(r);if(t===r)return{valid:!0,data:t};if(i===hV.object&&n===hV.object){let i=iS.objectKeys(r),n=iS.objectKeys(t).filter(e=>-1!==i.indexOf(e)),a={...t,...r};for(let i of n){let n=e(t[i],r[i]);if(!n.valid)return{valid:!1};a[i]=n.data}return{valid:!0,data:a}}if(i===hV.array&&n===hV.array){if(t.length!==r.length)return{valid:!1};let i=[];for(let n=0;n<t.length;n++){let a=e(t[n],r[n]);if(!a.valid)return{valid:!1};i.push(a.data)}return{valid:!0,data:i}}if(i===hV.date&&n===hV.date&&+t==+r)return{valid:!0,data:t};return{valid:!1}}(e.value,i.value);return n.valid?((mr(e)||mr(i))&&t.dirty(),{status:t.value,value:n.data}):(h5(r,{code:hX.invalid_intersection_types}),h8)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>i(e,t)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}mq.create=(e,t,r)=>new mq({left:e,right:t,typeName:iA.ZodIntersection,...mo(r)});class mW extends ml{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==hV.array)return h5(r,{code:hX.invalid_type,expected:hV.array,received:r.parsedType}),h8;if(r.data.length<this._def.items.length)return h5(r,{code:hX.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),h8;!this._def.rest&&r.data.length>this._def.items.length&&(h5(r,{code:hX.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...r.data].map((e,t)=>{let i=this._def.items[t]||this._def.rest;return i?i._parse(new ma(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(i).then(e=>h3.mergeArray(t,e)):h3.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new mW({...this._def,rest:e})}}mW.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new mW({items:e,typeName:iA.ZodTuple,rest:null,...mo(t)})};class mJ extends ml{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==hV.object)return h5(r,{code:hX.invalid_type,expected:hV.object,received:r.parsedType}),h8;let i=[],n=this._def.keyType,a=this._def.valueType;for(let e in r.data)i.push({key:n._parse(new ma(r,e,r.path,e)),value:a._parse(new ma(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?h3.mergeObjectAsync(t,i):h3.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return new mJ(t instanceof ml?{keyType:e,valueType:t,typeName:iA.ZodRecord,...mo(r)}:{keyType:mS.create(),valueType:e,typeName:iA.ZodRecord,...mo(t)})}}class mG extends ml{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==hV.map)return h5(r,{code:hX.invalid_type,expected:hV.map,received:r.parsedType}),h8;let i=this._def.keyType,n=this._def.valueType,a=[...r.data.entries()].map(([e,t],a)=>({key:i._parse(new ma(r,e,r.path,[a,"key"])),value:n._parse(new ma(r,t,r.path,[a,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of a){let i=await r.key,n=await r.value;if("aborted"===i.status||"aborted"===n.status)return h8;("dirty"===i.status||"dirty"===n.status)&&t.dirty(),e.set(i.value,n.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of a){let i=r.key,n=r.value;if("aborted"===i.status||"aborted"===n.status)return h8;("dirty"===i.status||"dirty"===n.status)&&t.dirty(),e.set(i.value,n.value)}return{status:t.value,value:e}}}}mG.create=(e,t,r)=>new mG({valueType:t,keyType:e,typeName:iA.ZodMap,...mo(r)});class mH extends ml{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==hV.set)return h5(r,{code:hX.invalid_type,expected:hV.set,received:r.parsedType}),h8;let i=this._def;null!==i.minSize&&r.data.size<i.minSize.value&&(h5(r,{code:hX.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),null!==i.maxSize&&r.data.size>i.maxSize.value&&(h5(r,{code:hX.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());let n=this._def.valueType;function a(e){let r=new Set;for(let i of e){if("aborted"===i.status)return h8;"dirty"===i.status&&t.dirty(),r.add(i.value)}return{status:t.value,value:r}}let s=[...r.data.values()].map((e,t)=>n._parse(new ma(r,e,r.path,t)));return r.common.async?Promise.all(s).then(e=>a(e)):a(s)}min(e,t){return new mH({...this._def,minSize:{value:e,message:iT.toString(t)}})}max(e,t){return new mH({...this._def,maxSize:{value:e,message:iT.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}mH.create=(e,t)=>new mH({valueType:e,minSize:null,maxSize:null,typeName:iA.ZodSet,...mo(t)});class mV extends ml{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==hV.function)return h5(t,{code:hX.invalid_type,expected:hV.function,received:t.parsedType}),h8;function r(e,r){return h6({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,h1,h0].filter(e=>!!e),issueData:{code:hX.invalid_arguments,argumentsError:r}})}function i(e,r){return h6({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,h1,h0].filter(e=>!!e),issueData:{code:hX.invalid_return_type,returnTypeError:r}})}let n={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof m1){let e=this;return me(async function(...t){let s=new hQ([]),o=await e._def.args.parseAsync(t,n).catch(e=>{throw s.addIssue(r(t,e)),s}),l=await Reflect.apply(a,this,o);return await e._def.returns._def.type.parseAsync(l,n).catch(e=>{throw s.addIssue(i(l,e)),s})})}{let e=this;return me(function(...t){let s=e._def.args.safeParse(t,n);if(!s.success)throw new hQ([r(t,s.error)]);let o=Reflect.apply(a,this,s.data),l=e._def.returns.safeParse(o,n);if(!l.success)throw new hQ([i(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new mV({...this._def,args:mW.create(e).rest(mL.create())})}returns(e){return new mV({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new mV({args:e||mW.create([]).rest(mL.create()),returns:t||mL.create(),typeName:iA.ZodFunction,...mo(r)})}}class mK extends ml{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}mK.create=(e,t)=>new mK({getter:e,typeName:iA.ZodLazy,...mo(t)});class mX extends ml{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return h5(t,{received:t.data,code:hX.invalid_literal,expected:this._def.value}),h8}return{status:"valid",value:e.data}}get value(){return this._def.value}}function mY(e,t){return new mQ({values:e,typeName:iA.ZodEnum,...mo(t)})}mX.create=(e,t)=>new mX({value:e,typeName:iA.ZodLiteral,...mo(t)});class mQ extends ml{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return h5(t,{expected:iS.joinValues(r),received:t.parsedType,code:hX.invalid_type}),h8}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return h5(t,{received:t.data,code:hX.invalid_enum_value,options:r}),h8}return me(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return mQ.create(e,{...this._def,...t})}exclude(e,t=this._def){return mQ.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}mQ.create=mY;class m0 extends ml{_parse(e){let t=iS.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==hV.string&&r.parsedType!==hV.number){let e=iS.objectValues(t);return h5(r,{expected:iS.joinValues(e),received:r.parsedType,code:hX.invalid_type}),h8}if(this._cache||(this._cache=new Set(iS.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=iS.objectValues(t);return h5(r,{received:r.data,code:hX.invalid_enum_value,options:e}),h8}return me(e.data)}get enum(){return this._def.values}}m0.create=(e,t)=>new m0({values:e,typeName:iA.ZodNativeEnum,...mo(t)});class m1 extends ml{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==hV.promise&&!1===t.common.async?(h5(t,{code:hX.invalid_type,expected:hV.promise,received:t.parsedType}),h8):me((t.parsedType===hV.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}m1.create=(e,t)=>new m1({type:e,typeName:iA.ZodPromise,...mo(t)});class m4 extends ml{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===iA.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),i=this._def.effect||null,n={addIssue:e=>{h5(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===i.type){let e=i.transform(r.data,n);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return h8;let i=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===i.status?h8:"dirty"===i.status||"dirty"===t.value?h7(i.value):i});{if("aborted"===t.value)return h8;let i=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===i.status?h8:"dirty"===i.status||"dirty"===t.value?h7(i.value):i}}if("refinement"===i.type){let e=e=>{let t=i.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?h8:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===i.status?h8:("dirty"===i.status&&t.dirty(),e(i.value),{status:t.value,value:i.value})}}if("transform"===i.type)if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>mi(e)?Promise.resolve(i.transform(e.value,n)).then(e=>({status:t.value,value:e})):h8);else{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!mi(e))return h8;let a=i.transform(e.value,n);if(a instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}iS.assertNever(i)}}m4.create=(e,t,r)=>new m4({schema:e,typeName:iA.ZodEffects,effect:t,...mo(r)}),m4.createWithPreprocess=(e,t,r)=>new m4({schema:t,effect:{type:"preprocess",transform:e},typeName:iA.ZodEffects,...mo(r)});class m2 extends ml{_parse(e){return this._getType(e)===hV.undefined?me(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}m2.create=(e,t)=>new m2({innerType:e,typeName:iA.ZodOptional,...mo(t)});class m6 extends ml{_parse(e){return this._getType(e)===hV.null?me(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}m6.create=(e,t)=>new m6({innerType:e,typeName:iA.ZodNullable,...mo(t)});class m9 extends ml{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===hV.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}m9.create=(e,t)=>new m9({innerType:e,typeName:iA.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...mo(t)});class m5 extends ml{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return mn(i)?i.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new hQ(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===i.status?i.value:this._def.catchValue({get error(){return new hQ(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}m5.create=(e,t)=>new m5({innerType:e,typeName:iA.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...mo(t)});class m3 extends ml{_parse(e){if(this._getType(e)!==hV.nan){let t=this._getOrReturnCtx(e);return h5(t,{code:hX.invalid_type,expected:hV.nan,received:t.parsedType}),h8}return{status:"valid",value:e.data}}}m3.create=e=>new m3({typeName:iA.ZodNaN,...mo(e)});let m8=Symbol("zod_brand");class m7 extends ml{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class fe extends ml{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?h8:"dirty"===e.status?(t.dirty(),h7(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?h8:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new fe({in:e,out:t,typeName:iA.ZodPipeline})}}class ft extends ml{_parse(e){let t=this._def.innerType._parse(e),r=e=>(mi(e)&&(e.value=Object.freeze(e.value)),e);return mn(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function fr(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function fi(e,t={},r){return e?mR.create().superRefine((i,n)=>{let a=e(i);if(a instanceof Promise)return a.then(e=>{if(!e){let e=fr(t,i),a=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:a})}});if(!a){let e=fr(t,i),a=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:a})}}):mR.create()}ft.create=(e,t)=>new ft({innerType:e,typeName:iA.ZodReadonly,...mo(t)});let fn={object:mD.lazycreate};(ru=iA||(iA={})).ZodString="ZodString",ru.ZodNumber="ZodNumber",ru.ZodNaN="ZodNaN",ru.ZodBigInt="ZodBigInt",ru.ZodBoolean="ZodBoolean",ru.ZodDate="ZodDate",ru.ZodSymbol="ZodSymbol",ru.ZodUndefined="ZodUndefined",ru.ZodNull="ZodNull",ru.ZodAny="ZodAny",ru.ZodUnknown="ZodUnknown",ru.ZodNever="ZodNever",ru.ZodVoid="ZodVoid",ru.ZodArray="ZodArray",ru.ZodObject="ZodObject",ru.ZodUnion="ZodUnion",ru.ZodDiscriminatedUnion="ZodDiscriminatedUnion",ru.ZodIntersection="ZodIntersection",ru.ZodTuple="ZodTuple",ru.ZodRecord="ZodRecord",ru.ZodMap="ZodMap",ru.ZodSet="ZodSet",ru.ZodFunction="ZodFunction",ru.ZodLazy="ZodLazy",ru.ZodLiteral="ZodLiteral",ru.ZodEnum="ZodEnum",ru.ZodEffects="ZodEffects",ru.ZodNativeEnum="ZodNativeEnum",ru.ZodOptional="ZodOptional",ru.ZodNullable="ZodNullable",ru.ZodDefault="ZodDefault",ru.ZodCatch="ZodCatch",ru.ZodPromise="ZodPromise",ru.ZodBranded="ZodBranded",ru.ZodPipeline="ZodPipeline",ru.ZodReadonly="ZodReadonly";let fa=(e,t={message:`Input not instance of ${e.name}`})=>fi(t=>t instanceof e,t),fs=mS.create,fo=mE.create,fl=m3.create,fu=mT.create,fc=mA.create,fd=mN.create,fp=mC.create,fh=mP.create,fm=mj.create,ff=mR.create,fg=mL.create,fy=mU.create,f_=mz.create,fv=mM.create,fb=mD.create,fw=mD.strictCreate,f$=mZ.create,fx=mB.create,fk=mq.create,fI=mW.create,fO=mJ.create,fS=mG.create,fE=mH.create,fT=mV.create,fA=mK.create,fN=mX.create,fC=mQ.create,fP=m0.create,fj=m1.create,fR=m4.create,fL=m2.create,fU=m6.create,fz=m4.createWithPreprocess,fM=fe.create,fD=()=>fs().optional(),fZ=()=>fo().optional(),fF=()=>fc().optional(),fB={string:e=>mS.create({...e,coerce:!0}),number:e=>mE.create({...e,coerce:!0}),boolean:e=>mA.create({...e,coerce:!0}),bigint:e=>mT.create({...e,coerce:!0}),date:e=>mN.create({...e,coerce:!0})};function fq(e,t){return gt(e.type._def,t)}e.s(["BRAND",0,m8,"NEVER",0,h8,"Schema",()=>ml,"ZodAny",()=>mR,"ZodArray",()=>mM,"ZodBigInt",()=>mT,"ZodBoolean",()=>mA,"ZodBranded",()=>m7,"ZodCatch",()=>m5,"ZodDate",()=>mN,"ZodDefault",()=>m9,"ZodDiscriminatedUnion",()=>mB,"ZodEffects",()=>m4,"ZodEnum",()=>mQ,"ZodFirstPartyTypeKind",()=>iA,"ZodFunction",()=>mV,"ZodIntersection",()=>mq,"ZodLazy",()=>mK,"ZodLiteral",()=>mX,"ZodMap",()=>mG,"ZodNaN",()=>m3,"ZodNativeEnum",()=>m0,"ZodNever",()=>mU,"ZodNull",()=>mj,"ZodNullable",()=>m6,"ZodNumber",()=>mE,"ZodObject",()=>mD,"ZodOptional",()=>m2,"ZodPipeline",()=>fe,"ZodPromise",()=>m1,"ZodReadonly",()=>ft,"ZodRecord",()=>mJ,"ZodSchema",()=>ml,"ZodSet",()=>mH,"ZodString",()=>mS,"ZodSymbol",()=>mC,"ZodTransformer",()=>m4,"ZodTuple",()=>mW,"ZodType",()=>ml,"ZodUndefined",()=>mP,"ZodUnion",()=>mZ,"ZodUnknown",()=>mL,"ZodVoid",()=>mz,"any",()=>ff,"array",()=>fv,"bigint",()=>fu,"boolean",()=>fc,"coerce",0,fB,"custom",()=>fi,"date",()=>fd,"datetimeRegex",()=>mO,"discriminatedUnion",()=>fx,"effect",()=>fR,"enum",()=>fC,"function",()=>fT,"instanceof",()=>fa,"intersection",()=>fk,"late",0,fn,"lazy",()=>fA,"literal",()=>fN,"map",()=>fS,"nan",()=>fl,"nativeEnum",()=>fP,"never",()=>fy,"null",()=>fm,"nullable",()=>fU,"number",()=>fo,"object",()=>fb,"oboolean",()=>fF,"onumber",()=>fZ,"optional",()=>fL,"ostring",()=>fD,"pipeline",()=>fM,"preprocess",()=>fz,"promise",()=>fj,"record",()=>fO,"set",()=>fE,"strictObject",()=>fw,"string",()=>fs,"symbol",()=>fp,"transformer",()=>fR,"tuple",()=>fI,"undefined",()=>fh,"union",()=>f$,"unknown",()=>fg,"void",()=>f_],17958);let fW=/^[cC][^\s-]{8,}$/,fJ=/^[0-9a-z]+$/,fG=/^[0-9A-HJKMNP-TV-Z]{26}$/,fH=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,fV=()=>(void 0===h&&(h=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),h),fK=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,fX=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,fY=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,fQ=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,f0=/^[a-zA-Z0-9_-]{21}$/,f1=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function f4(e,t){let r={type:"string"};if(e.checks)for(let i of e.checks)switch(i.kind){case"min":hH(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t);break;case"max":hH(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"email":switch(t.emailStrategy){case"format:email":f9(r,"email",i.message,t);break;case"format:idn-email":f9(r,"idn-email",i.message,t);break;case"pattern:zod":f5(r,fH,i.message,t)}break;case"url":f9(r,"uri",i.message,t);break;case"uuid":f9(r,"uuid",i.message,t);break;case"regex":f5(r,i.regex,i.message,t);break;case"cuid":f5(r,fW,i.message,t);break;case"cuid2":f5(r,fJ,i.message,t);break;case"startsWith":f5(r,RegExp(`^${f2(i.value,t)}`),i.message,t);break;case"endsWith":f5(r,RegExp(`${f2(i.value,t)}$`),i.message,t);break;case"datetime":f9(r,"date-time",i.message,t);break;case"date":f9(r,"date",i.message,t);break;case"time":f9(r,"time",i.message,t);break;case"duration":f9(r,"duration",i.message,t);break;case"length":hH(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t),hH(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"includes":f5(r,RegExp(f2(i.value,t)),i.message,t);break;case"ip":"v6"!==i.version&&f9(r,"ipv4",i.message,t),"v4"!==i.version&&f9(r,"ipv6",i.message,t);break;case"base64url":f5(r,fQ,i.message,t);break;case"jwt":f5(r,f1,i.message,t);break;case"cidr":"v6"!==i.version&&f5(r,fK,i.message,t),"v4"!==i.version&&f5(r,fX,i.message,t);break;case"emoji":f5(r,fV(),i.message,t);break;case"ulid":f5(r,fG,i.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":f9(r,"binary",i.message,t);break;case"contentEncoding:base64":hH(r,"contentEncoding","base64",i.message,t);break;case"pattern:zod":f5(r,fY,i.message,t)}break;case"nanoid":f5(r,f0,i.message,t)}return r}function f2(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)f6.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let f6=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function f9(e,t,r,i){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&i.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&i.errorMessages&&{errorMessage:{format:r}}})):hH(e,"format",t,r,i)}function f5(e,t,r,i){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&i.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:f3(t,i),...r&&i.errorMessages&&{errorMessage:{pattern:r}}})):hH(e,"pattern",f3(t,i),r,i)}function f3(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},i=r.i?e.source.toLowerCase():e.source,n="",a=!1,s=!1,o=!1;for(let e=0;e<i.length;e++){if(a){n+=i[e],a=!1;continue}if(r.i){if(s){if(i[e].match(/[a-z]/)){o?(n+=i[e],n+=`${i[e-2]}-${i[e]}`.toUpperCase(),o=!1):"-"===i[e+1]&&i[e+2]?.match(/[a-z]/)?(n+=i[e],o=!0):n+=`${i[e]}${i[e].toUpperCase()}`;continue}}else if(i[e].match(/[a-z]/)){n+=`[${i[e]}${i[e].toUpperCase()}]`;continue}}if(r.m){if("^"===i[e]){n+=`(^|(?<=[\r
]))`;continue}else if("$"===i[e]){n+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===i[e]){n+=s?`${i[e]}\r
`:`[${i[e]}\r
]`;continue}n+=i[e],"\\"===i[e]?a=!0:s&&"]"===i[e]?s=!1:s||"["!==i[e]||(s=!0)}try{new RegExp(n)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return n}function f8(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===iA.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,i)=>({...r,[i]:gt(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",i]})??hJ(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};let r={type:"object",additionalProperties:gt(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===iA.ZodString&&e.keyType._def.checks?.length){let{type:i,...n}=f4(e.keyType._def,t);return{...r,propertyNames:n}}if(e.keyType?._def.typeName===iA.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===iA.ZodBranded&&e.keyType._def.type._def.typeName===iA.ZodString&&e.keyType._def.type._def.checks?.length){let{type:i,...n}=fq(e.keyType._def,t);return{...r,propertyNames:n}}return r}let f7={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},ge=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>gt(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0};function gt(e,t,r=!1){let i=t.seen.get(e);if(t.override){let n=t.override?.(e,t,i,r);if(n!==hB)return n}if(i&&!r){let e=gr(i,t);if(void 0!==e)return e}let n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);let a=((e,t,r)=>{switch(t){case iA.ZodString:return f4(e,r);case iA.ZodNumber:let i={type:"number"};if(!e.checks)return i;for(let t of e.checks)switch(t.kind){case"int":i.type="integer",hG(i,"type",t.message,r);break;case"min":"jsonSchema7"===r.target?t.inclusive?hH(i,"minimum",t.value,t.message,r):hH(i,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(i.exclusiveMinimum=!0),hH(i,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?hH(i,"maximum",t.value,t.message,r):hH(i,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(i.exclusiveMaximum=!0),hH(i,"maximum",t.value,t.message,r));break;case"multipleOf":hH(i,"multipleOf",t.value,t.message,r)}return i;case iA.ZodObject:return function(e,t){let r="openAi"===t.target,i={type:"object",properties:{}},n=[],a=e.shape();for(let e in a){let s=a[e];if(void 0===s||void 0===s._def)continue;let o=function(e){try{return e.isOptional()}catch{return!0}}(s);o&&r&&("ZodOptional"===s._def.typeName&&(s=s._def.innerType),s.isNullable()||(s=s.nullable()),o=!1);let l=gt(s._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==l&&(i.properties[e]=l,o||n.push(e))}n.length&&(i.required=n);let s=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return gt(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==s&&(i.additionalProperties=s),i}(e,r);case iA.ZodBigInt:let n={type:"integer",format:"int64"};if(!e.checks)return n;for(let t of e.checks)switch(t.kind){case"min":"jsonSchema7"===r.target?t.inclusive?hH(n,"minimum",t.value,t.message,r):hH(n,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(n.exclusiveMinimum=!0),hH(n,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?hH(n,"maximum",t.value,t.message,r):hH(n,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(n.exclusiveMaximum=!0),hH(n,"maximum",t.value,t.message,r));break;case"multipleOf":hH(n,"multipleOf",t.value,t.message,r)}return n;case iA.ZodBoolean:return{type:"boolean"};case iA.ZodDate:return function e(t,r,i){let n=i??r.dateStrategy;if(Array.isArray(n))return{anyOf:n.map(i=>e(t,r,i))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var a=t,s=r;let o={type:"integer",format:"unix-time"};if("openApi3"===s.target)return o;for(let e of a.checks)switch(e.kind){case"min":hH(o,"minimum",e.value,e.message,s);break;case"max":hH(o,"maximum",e.value,e.message,s)}return o}}(e,r);case iA.ZodUndefined:return{not:hJ(r)};case iA.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case iA.ZodArray:let a;return a={type:"array"},e.type?._def&&e.type?._def?.typeName!==iA.ZodAny&&(a.items=gt(e.type._def,{...r,currentPath:[...r.currentPath,"items"]})),e.minLength&&hH(a,"minItems",e.minLength.value,e.minLength.message,r),e.maxLength&&hH(a,"maxItems",e.maxLength.value,e.maxLength.message,r),e.exactLength&&(hH(a,"minItems",e.exactLength.value,e.exactLength.message,r),hH(a,"maxItems",e.exactLength.value,e.exactLength.message,r)),a;case iA.ZodUnion:case iA.ZodDiscriminatedUnion:if("openApi3"===r.target)return ge(e,r);let s=e.options instanceof Map?Array.from(e.options.values()):e.options;if(s.every(e=>e._def.typeName in f7&&(!e._def.checks||!e._def.checks.length))){let e=s.reduce((e,t)=>{let r=f7[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(s.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=s.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];return e;default:return e}},[]);if(e.length===s.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:s.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(s.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:s.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return ge(e,r);case iA.ZodIntersection:let o,l,u;return o=[gt(e.left._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),gt(e.right._def,{...r,currentPath:[...r.currentPath,"allOf","1"]})].filter(e=>!!e),l="jsonSchema2019-09"===r.target?{unevaluatedProperties:!1}:void 0,u=[],o.forEach(e=>{if((!("type"in e)||"string"!==e.type)&&"allOf"in e)u.push(...e.allOf),void 0===e.unevaluatedProperties&&(l=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...i}=e;t=i}else l=void 0;u.push(t)}}),u.length?{allOf:u,...l}:void 0;case iA.ZodTuple:return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,t)=>gt(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:gt(e.rest._def,{...r,currentPath:[...r.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,t)=>gt(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])};case iA.ZodRecord:return f8(e,r);case iA.ZodLiteral:let c;return"bigint"!=(c=typeof e.value)&&"number"!==c&&"boolean"!==c&&"string"!==c?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===r.target?{type:"bigint"===c?"integer":c,enum:[e.value]}:{type:"bigint"===c?"integer":c,const:e.value};case iA.ZodEnum:return{type:"string",enum:Array.from(e.values)};case iA.ZodNativeEnum:let d,p,h;return d=e.values,{type:1===(h=Array.from(new Set((p=Object.keys(e.values).filter(e=>"number"!=typeof d[d[e]]).map(e=>d[e])).map(e=>typeof e)))).length?"string"===h[0]?"string":"number":["string","number"],enum:p};case iA.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===r.target?{type:f7[e.innerType._def.typeName],nullable:!0}:{type:[f7[e.innerType._def.typeName],"null"]};if("openApi3"===r.target){let t=gt(e.innerType._def,{...r,currentPath:[...r.currentPath]});return t&&"$ref"in t?{allOf:[t],nullable:!0}:t&&{...t,nullable:!0}}let m=gt(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","0"]});return m&&{anyOf:[m,{type:"null"}]};case iA.ZodOptional:if(r.currentPath.toString()===r.propertyPath?.toString())return gt(e.innerType._def,r);let f=gt(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","1"]});return f?{anyOf:[{not:hJ(r)},f]}:hJ(r);case iA.ZodMap:if("record"===r.mapStrategy)return f8(e,r);return{type:"array",maxItems:125,items:{type:"array",items:[gt(e.keyType._def,{...r,currentPath:[...r.currentPath,"items","items","0"]})||hJ(r),gt(e.valueType._def,{...r,currentPath:[...r.currentPath,"items","items","1"]})||hJ(r)],minItems:2,maxItems:2}};case iA.ZodSet:let g;return g={type:"array",uniqueItems:!0,items:gt(e.valueType._def,{...r,currentPath:[...r.currentPath,"items"]})},e.minSize&&hH(g,"minItems",e.minSize.value,e.minSize.message,r),e.maxSize&&hH(g,"maxItems",e.maxSize.value,e.maxSize.message,r),g;case iA.ZodLazy:return()=>e.getter()._def;case iA.ZodPromise:return gt(e.type._def,r);case iA.ZodNaN:case iA.ZodNever:return"openAi"===r.target?void 0:{not:hJ({...r,currentPath:[...r.currentPath,"not"]})};case iA.ZodEffects:return"input"===r.effectStrategy?gt(e.schema._def,r):hJ(r);case iA.ZodAny:case iA.ZodUnknown:return hJ(r);case iA.ZodDefault:return{...gt(e.innerType._def,r),default:e.defaultValue()};case iA.ZodBranded:return fq(e,r);case iA.ZodReadonly:case iA.ZodCatch:return gt(e.innerType._def,r);case iA.ZodPipeline:if("input"===r.pipeStrategy)return gt(e.in._def,r);if("output"===r.pipeStrategy)return gt(e.out._def,r);let y=gt(e.in._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),_=gt(e.out._def,{...r,currentPath:[...r.currentPath,"allOf",y?"1":"0"]});return{allOf:[y,_].filter(e=>void 0!==e)};case iA.ZodFunction:case iA.ZodVoid:case iA.ZodSymbol:default:return}})(e,e.typeName,t),s="function"==typeof a?gt(a(),t):a;if(s&&gi(e,t,s),t.postProcess){let r=t.postProcess(s,e,t);return n.jsonSchema=s,r}return n.jsonSchema=s,s}let gr=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:hW(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),hJ(t);return"seen"===t.$refStrategy?hJ(t):void 0}},gi=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r);class gn{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??hc,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var r;let i=e._zod.def,n=this.seen.get(e);if(n)return n.count++,t.schemaPath.includes(e)&&(n.cycle=t.path),n.schema;let a={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,a);let s=e._zod.toJSONSchema?.();if(s)a.schema=s;else{let r={...t,schemaPath:[...t.schemaPath,e],path:t.path},n=e._zod.parent;if(n)a.ref=n,this.process(n,r),this.seen.get(n).isParent=!0;else{let t=a.schema;switch(i.type){case"string":{t.type="string";let{minimum:r,maximum:i,format:n,patterns:s,contentEncoding:o}=e._zod.bag;if("number"==typeof r&&(t.minLength=r),"number"==typeof i&&(t.maxLength=i),n&&(t.format=({guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""})[n]??n,""===t.format&&delete t.format),o&&(t.contentEncoding=o),s&&s.size>0){let e=[...s];1===e.length?t.pattern=e[0].source:e.length>1&&(a.schema.allOf=[...e.map(e=>({..."draft-7"===this.target?{type:"string"}:{},pattern:e.source}))])}break}case"number":{let{minimum:r,maximum:i,format:n,multipleOf:a,exclusiveMaximum:s,exclusiveMinimum:o}=e._zod.bag;"string"==typeof n&&n.includes("int")?t.type="integer":t.type="number","number"==typeof o&&(t.exclusiveMinimum=o),"number"==typeof r&&(t.minimum=r,"number"==typeof o&&(o>=r?delete t.minimum:delete t.exclusiveMinimum)),"number"==typeof s&&(t.exclusiveMaximum=s),"number"==typeof i&&(t.maximum=i,"number"==typeof s&&(s<=i?delete t.maximum:delete t.exclusiveMaximum)),"number"==typeof a&&(t.multipleOf=a);break}case"boolean":case"success":t.type="boolean";break;case"bigint":if("throw"===this.unrepresentable)throw Error("BigInt cannot be represented in JSON Schema");break;case"symbol":if("throw"===this.unrepresentable)throw Error("Symbols cannot be represented in JSON Schema");break;case"null":t.type="null";break;case"any":case"unknown":break;case"undefined":if("throw"===this.unrepresentable)throw Error("Undefined cannot be represented in JSON Schema");break;case"void":if("throw"===this.unrepresentable)throw Error("Void cannot be represented in JSON Schema");break;case"never":t.not={};break;case"date":if("throw"===this.unrepresentable)throw Error("Date cannot be represented in JSON Schema");break;case"array":{let{minimum:n,maximum:a}=e._zod.bag;"number"==typeof n&&(t.minItems=n),"number"==typeof a&&(t.maxItems=a),t.type="array",t.items=this.process(i.element,{...r,path:[...r.path,"items"]});break}case"object":{t.type="object",t.properties={};let e=i.shape;for(let i in e)t.properties[i]=this.process(e[i],{...r,path:[...r.path,"properties",i]});let n=new Set([...new Set(Object.keys(e))].filter(e=>{let t=i.shape[e]._zod;return"input"===this.io?void 0===t.optin:void 0===t.optout}));n.size>0&&(t.required=Array.from(n)),i.catchall?._zod.def.type==="never"?t.additionalProperties=!1:i.catchall?i.catchall&&(t.additionalProperties=this.process(i.catchall,{...r,path:[...r.path,"additionalProperties"]})):"output"===this.io&&(t.additionalProperties=!1);break}case"union":t.anyOf=i.options.map((e,t)=>this.process(e,{...r,path:[...r.path,"anyOf",t]}));break;case"intersection":{let e=this.process(i.left,{...r,path:[...r.path,"allOf",0]}),n=this.process(i.right,{...r,path:[...r.path,"allOf",1]}),a=e=>"allOf"in e&&1===Object.keys(e).length;t.allOf=[...a(e)?e.allOf:[e],...a(n)?n.allOf:[n]];break}case"tuple":{t.type="array";let n=i.items.map((e,t)=>this.process(e,{...r,path:[...r.path,"prefixItems",t]}));if("draft-2020-12"===this.target?t.prefixItems=n:t.items=n,i.rest){let e=this.process(i.rest,{...r,path:[...r.path,"items"]});"draft-2020-12"===this.target?t.items=e:t.additionalItems=e}i.rest&&(t.items=this.process(i.rest,{...r,path:[...r.path,"items"]}));let{minimum:a,maximum:s}=e._zod.bag;"number"==typeof a&&(t.minItems=a),"number"==typeof s&&(t.maxItems=s);break}case"record":t.type="object",t.propertyNames=this.process(i.keyType,{...r,path:[...r.path,"propertyNames"]}),t.additionalProperties=this.process(i.valueType,{...r,path:[...r.path,"additionalProperties"]});break;case"map":if("throw"===this.unrepresentable)throw Error("Map cannot be represented in JSON Schema");break;case"set":if("throw"===this.unrepresentable)throw Error("Set cannot be represented in JSON Schema");break;case"enum":{let e=lV(i.entries);e.every(e=>"number"==typeof e)&&(t.type="number"),e.every(e=>"string"==typeof e)&&(t.type="string"),t.enum=e;break}case"literal":{let e=[];for(let t of i.values)if(void 0===t){if("throw"===this.unrepresentable)throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if("bigint"==typeof t)if("throw"===this.unrepresentable)throw Error("BigInt literals cannot be represented in JSON Schema");else e.push(Number(t));else e.push(t);if(0===e.length);else if(1===e.length){let r=e[0];t.type=null===r?"null":typeof r,t.const=r}else e.every(e=>"number"==typeof e)&&(t.type="number"),e.every(e=>"string"==typeof e)&&(t.type="string"),e.every(e=>"boolean"==typeof e)&&(t.type="string"),e.every(e=>null===e)&&(t.type="null"),t.enum=e;break}case"file":{let r={type:"string",format:"binary",contentEncoding:"binary"},{minimum:i,maximum:n,mime:a}=e._zod.bag;void 0!==i&&(r.minLength=i),void 0!==n&&(r.maxLength=n),a?1===a.length?(r.contentMediaType=a[0],Object.assign(t,r)):t.anyOf=a.map(e=>({...r,contentMediaType:e})):Object.assign(t,r);break}case"transform":if("throw"===this.unrepresentable)throw Error("Transforms cannot be represented in JSON Schema");break;case"nullable":t.anyOf=[this.process(i.innerType,r),{type:"null"}];break;case"nonoptional":case"promise":case"optional":this.process(i.innerType,r),a.ref=i.innerType;break;case"default":this.process(i.innerType,r),a.ref=i.innerType,t.default=JSON.parse(JSON.stringify(i.defaultValue));break;case"prefault":this.process(i.innerType,r),a.ref=i.innerType,"input"===this.io&&(t._prefault=JSON.parse(JSON.stringify(i.defaultValue)));break;case"catch":{let e;this.process(i.innerType,r),a.ref=i.innerType;try{e=i.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}t.default=e;break}case"nan":if("throw"===this.unrepresentable)throw Error("NaN cannot be represented in JSON Schema");break;case"template_literal":{let r=e._zod.pattern;if(!r)throw Error("Pattern not found in template literal");t.type="string",t.pattern=r.source;break}case"pipe":{let e="input"===this.io?"transform"===i.in._zod.def.type?i.out:i.in:i.out;this.process(e,r),a.ref=e;break}case"readonly":this.process(i.innerType,r),a.ref=i.innerType,t.readOnly=!0;break;case"lazy":{let t=e._zod.innerType;this.process(t,r),a.ref=t;break}case"custom":if("throw"===this.unrepresentable)throw Error("Custom types cannot be represented in JSON Schema")}}}let o=this.metadataRegistry.get(e);return o&&Object.assign(a.schema,o),"input"===this.io&&function e(t,r){let i=r??{seen:new Set};if(i.seen.has(t))return!1;i.seen.add(t);let n=t._zod.def;switch(n.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":case"custom":case"success":case"catch":return!1;case"array":return e(n.element,i);case"object":for(let t in n.shape)if(e(n.shape[t],i))return!0;return!1;case"union":for(let t of n.options)if(e(t,i))return!0;return!1;case"intersection":return e(n.left,i)||e(n.right,i);case"tuple":for(let t of n.items)if(e(t,i))return!0;if(n.rest&&e(n.rest,i))return!0;return!1;case"record":case"map":return e(n.keyType,i)||e(n.valueType,i);case"set":return e(n.valueType,i);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":case"default":case"prefault":return e(n.innerType,i);case"lazy":return e(n.getter(),i);case"transform":return!0;case"pipe":return e(n.in,i)||e(n.out,i)}throw Error(`Unknown schema type: ${n.type}`)}(e)&&(delete a.schema.examples,delete a.schema.default),"input"===this.io&&a.schema._prefault&&((r=a.schema).default??(r.default=a.schema._prefault)),delete a.schema._prefault,this.seen.get(e).schema}emit(e,t){let r={cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0},i=this.seen.get(e);if(!i)throw Error("Unprocessed schema. This is a bug in Zod.");let n=e=>{let t="draft-2020-12"===this.target?"$defs":"definitions";if(r.external){let i=r.external.registry.get(e[0])?.id,n=r.external.uri??(e=>e);if(i)return{ref:n(i)};let a=e[1].defId??e[1].schema.id??`schema${this.counter++}`;return e[1].defId=a,{defId:a,ref:`${n("__shared")}#/${t}/${a}`}}if(e[1]===i)return{ref:"#"};let n=`#/${t}/`,a=e[1].schema.id??`__schema${this.counter++}`;return{defId:a,ref:n+a}},a=e=>{if(e[1].schema.$ref)return;let t=e[1],{ref:r,defId:i}=n(e);t.def={...t.schema},i&&(t.defId=i);let a=t.schema;for(let e in a)delete a[e];a.$ref=r};if("throw"===r.cycles)for(let e of this.seen.entries()){let t=e[1];if(t.cycle)throw Error(`Cycle detected: #/${t.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let t of this.seen.entries()){let i=t[1];if(e===t[0]){a(t);continue}if(r.external){let i=r.external.registry.get(t[0])?.id;if(e!==t[0]&&i){a(t);continue}}if(this.metadataRegistry.get(t[0])?.id||i.cycle||i.count>1&&"ref"===r.reused){a(t);continue}}let s=(e,t)=>{let r=this.seen.get(e),i=r.def??r.schema,n={...i};if(null===r.ref)return;let a=r.ref;if(r.ref=null,a){s(a,t);let e=this.seen.get(a).schema;e.$ref&&"draft-7"===t.target?(i.allOf=i.allOf??[],i.allOf.push(e)):(Object.assign(i,e),Object.assign(i,n))}r.isParent||this.override({zodSchema:e,jsonSchema:i,path:r.path??[]})};for(let e of[...this.seen.entries()].reverse())s(e[0],{target:this.target});let o={};if("draft-2020-12"===this.target?o.$schema="https://json-schema.org/draft/2020-12/schema":"draft-7"===this.target?o.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),r.external?.uri){let t=r.external.registry.get(e)?.id;if(!t)throw Error("Schema is missing an `id` property");o.$id=r.external.uri(t)}Object.assign(o,i.def);let l=r.external?.defs??{};for(let e of this.seen.entries()){let t=e[1];t.def&&t.defId&&(l[t.defId]=t.def)}r.external||Object.keys(l).length>0&&("draft-2020-12"===this.target?o.$defs=l:o.definitions=l);try{return JSON.parse(JSON.stringify(o))}catch(e){throw Error("Error converting schema to JSON.")}}}function ga(e,t){if(e instanceof hl){let r=new gn(t),i={};for(let t of e._idmap.entries()){let[e,i]=t;r.process(i)}let n={},a={registry:e,uri:t?.uri,defs:i};for(let i of e._idmap.entries()){let[e,s]=i;n[e]=r.emit(s,{...t,external:a})}return Object.keys(i).length>0&&(n.__shared={["draft-2020-12"===r.target?"$defs":"definitions"]:i}),{schemas:n}}let r=new gn(t);return r.process(e),r.emit(e,t)}function gs(e,t){let r=typeof e;if(r!==typeof t)return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;let r=e.length;if(r!==t.length)return!1;for(let i=0;i<r;i++)if(!gs(e[i],t[i]))return!1;return!0}if("object"===r){if(!e||!t)return e===t;let r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(let i of r)if(!gs(e[i],t[i]))return!1;return!0}return e===t}function go(e){return encodeURI(e.replace(/~/g,"~0").replace(/\//g,"~1"))}e.s(["JSONSchemaGenerator",()=>gn,"toJSONSchema",()=>ga],7159);let gl={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},gu={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},gc={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},gd="undefined"!=typeof self&&self.location&&"null"!==self.location.origin?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function gp(e,t=Object.create(null),r=gd,i=""){if(e&&"object"==typeof e&&!Array.isArray(e)){let n=e.$id||e.id;if(n){let a=new URL(n,r.href);a.hash.length>1?t[a.href]=e:(a.hash="",""===i?r=a:gp(e,t,r))}}else if(!0!==e&&!1!==e)return t;let n=r.href+(i?"#"+i:"");if(void 0!==t[n])throw Error(`Duplicate schema URI "${n}".`);if(t[n]=e,!0===e||!1===e)return t;if(void 0===e.__absolute_uri__&&Object.defineProperty(e,"__absolute_uri__",{enumerable:!1,value:n}),e.$ref&&void 0===e.__absolute_ref__){let t=new URL(e.$ref,r.href);t.hash=t.hash,Object.defineProperty(e,"__absolute_ref__",{enumerable:!1,value:t.href})}if(e.$recursiveRef&&void 0===e.__absolute_recursive_ref__){let t=new URL(e.$recursiveRef,r.href);t.hash=t.hash,Object.defineProperty(e,"__absolute_recursive_ref__",{enumerable:!1,value:t.href})}for(let n in e.$anchor&&(t[new URL("#"+e.$anchor,r.href).href]=e),e){if(gc[n])continue;let a=`${i}/${go(n)}`,s=e[n];if(Array.isArray(s)){if(gl[n]){let e=s.length;for(let i=0;i<e;i++)gp(s[i],t,r,`${a}/${i}`)}}else if(gu[n])for(let e in s)gp(s[e],t,r,`${a}/${go(e)}`);else gp(s,t,r,a)}return t}let gh=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,gm=[0,31,28,31,30,31,30,31,31,30,31,30,31],gf=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function gg(e){return e.test.bind(e)}let gy={date:g_,time:gv.bind(void 0,!1),"date-time":function(e){let t=e.split(gb);return 2==t.length&&g_(t[0])&&gv(!0,t[1])},duration:e=>e.length>1&&e.length<80&&(/^P\d+([.,]\d+)?W$/.test(e)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(e)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(e)),uri:function(e){return gw.test(e)&&g$.test(e)},"uri-reference":gg(/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i),"uri-template":gg(/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i),url:gg(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu),email:e=>{if('"'===e[0])return!1;let[t,r,...i]=e.split("@");return!(!t||!r||0!==i.length||t.length>64||r.length>253||"."===t[0]||t.endsWith(".")||t.includes(".."))&&!!/^[a-z0-9.-]+$/i.test(r)&&!!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(t)&&r.split(".").every(e=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(e))},hostname:gg(/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i),ipv4:gg(/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/),ipv6:gg(/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i),regex:function(e){if(gx.test(e))return!1;try{return RegExp(e,"u"),!0}catch(e){return!1}},uuid:gg(/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i),"json-pointer":gg(/^(?:\/(?:[^~/]|~0|~1)*)*$/),"json-pointer-uri-fragment":gg(/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i),"relative-json-pointer":gg(/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/)};function g_(e){var t;let r=e.match(gh);if(!r)return!1;let i=+r[1],n=+r[2],a=+r[3];return n>=1&&n<=12&&a>=1&&a<=(2==n&&(t=i)%4==0&&(t%100!=0||t%400==0)?29:gm[n])}function gv(e,t){let r=t.match(gf);if(!r)return!1;let i=+r[1],n=+r[2],a=+r[3],s=!!r[5];return(i<=23&&n<=59&&a<=59||23==i&&59==n&&60==a)&&(!e||s)}let gb=/t|\s/i,gw=/\/|:/,g$=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,gx=/[^\\]\\Z/;function gk(e,t,r="2019-09",i=gp(t),n=!0,a=null,s="#",o="#",l=Object.create(null)){let u;if(!0===t)return{valid:!0,errors:[]};if(!1===t)return{valid:!1,errors:[{instanceLocation:s,keyword:"false",keywordLocation:s,error:"False boolean schema."}]};let c=typeof e;switch(c){case"boolean":case"number":case"string":u=c;break;case"object":u=null===e?"null":Array.isArray(e)?"array":"object";break;default:throw Error(`Instances of "${c}" type are not supported.`)}let{$ref:d,$recursiveRef:p,$recursiveAnchor:h,type:m,const:f,enum:g,required:y,not:_,anyOf:v,allOf:b,oneOf:w,if:$,then:x,else:k,format:I,properties:O,patternProperties:S,additionalProperties:E,unevaluatedProperties:T,minProperties:A,maxProperties:N,propertyNames:C,dependentRequired:P,dependentSchemas:j,dependencies:R,prefixItems:L,items:U,additionalItems:z,unevaluatedItems:M,contains:D,minContains:Z,maxContains:F,minItems:B,maxItems:q,uniqueItems:W,minimum:J,maximum:G,exclusiveMinimum:H,exclusiveMaximum:V,multipleOf:K,minLength:X,maxLength:Y,pattern:Q,__absolute_ref__:ee,__absolute_recursive_ref__:et}=t,er=[];if(!0===h&&null===a&&(a=t),"#"===p){let u=null===a?i[et]:a,c=`${o}/$recursiveRef`,d=gk(e,null===a?t:a,r,i,n,u,s,c,l);d.valid||er.push({instanceLocation:s,keyword:"$recursiveRef",keywordLocation:c,error:"A subschema had errors."},...d.errors)}if(void 0!==d){let t=i[ee||d];if(void 0===t){let e=`Unresolved $ref "${d}".`;throw ee&&ee!==d&&(e+=`  Absolute URI "${ee}".`),Error(e+=`
Known schemas:
- ${Object.keys(i).join("\n- ")}`)}let u=`${o}/$ref`,c=gk(e,t,r,i,n,a,s,u,l);if(c.valid||er.push({instanceLocation:s,keyword:"$ref",keywordLocation:u,error:"A subschema had errors."},...c.errors),"4"===r||"7"===r)return{valid:0===er.length,errors:er}}if(Array.isArray(m)){let t=m.length,r=!1;for(let i=0;i<t;i++)if(u===m[i]||"integer"===m[i]&&"number"===u&&e%1==0&&e==e){r=!0;break}r||er.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${m.join('", "')}".`})}else"integer"===m?("number"!==u||e%1||e!=e)&&er.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${m}".`}):void 0!==m&&u!==m&&er.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${u}" is invalid. Expected "${m}".`});if(void 0!==f&&("object"===u||"array"===u?gs(e,f)||er.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(f)}.`}):e!==f&&er.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(f)}.`})),void 0!==g&&("object"===u||"array"===u?g.some(t=>gs(e,t))||er.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`}):g.some(t=>e===t)||er.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`})),void 0!==_){let t=`${o}/not`;gk(e,_,r,i,n,a,s,t).valid&&er.push({instanceLocation:s,keyword:"not",keywordLocation:t,error:'Instance matched "not" schema.'})}let ei=[];if(void 0!==v){let t=`${o}/anyOf`,u=er.length,c=!1;for(let o=0;o<v.length;o++){let u=v[o],d=Object.create(l),p=gk(e,u,r,i,n,!0===h?a:null,s,`${t}/${o}`,d);er.push(...p.errors),c=c||p.valid,p.valid&&ei.push(d)}c?er.length=u:er.splice(u,0,{instanceLocation:s,keyword:"anyOf",keywordLocation:t,error:"Instance does not match any subschemas."})}if(void 0!==b){let t=`${o}/allOf`,u=er.length,c=!0;for(let o=0;o<b.length;o++){let u=b[o],d=Object.create(l),p=gk(e,u,r,i,n,!0===h?a:null,s,`${t}/${o}`,d);er.push(...p.errors),c=c&&p.valid,p.valid&&ei.push(d)}c?er.length=u:er.splice(u,0,{instanceLocation:s,keyword:"allOf",keywordLocation:t,error:"Instance does not match every subschema."})}if(void 0!==w){let t=`${o}/oneOf`,u=er.length,c=w.filter((o,u)=>{let c=Object.create(l),d=gk(e,o,r,i,n,!0===h?a:null,s,`${t}/${u}`,c);return er.push(...d.errors),d.valid&&ei.push(c),d.valid}).length;1===c?er.length=u:er.splice(u,0,{instanceLocation:s,keyword:"oneOf",keywordLocation:t,error:`Instance does not match exactly one subschema (${c} matches).`})}if(("object"===u||"array"===u)&&Object.assign(l,...ei),void 0!==$){let t=`${o}/if`;if(gk(e,$,r,i,n,a,s,t,l).valid){if(void 0!==x){let u=gk(e,x,r,i,n,a,s,`${o}/then`,l);u.valid||er.push({instanceLocation:s,keyword:"if",keywordLocation:t,error:'Instance does not match "then" schema.'},...u.errors)}}else if(void 0!==k){let u=gk(e,k,r,i,n,a,s,`${o}/else`,l);u.valid||er.push({instanceLocation:s,keyword:"if",keywordLocation:t,error:'Instance does not match "else" schema.'},...u.errors)}}if("object"===u){if(void 0!==y)for(let t of y)t in e||er.push({instanceLocation:s,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${t}".`});let t=Object.keys(e);if(void 0!==A&&t.length<A&&er.push({instanceLocation:s,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${A} properties.`}),void 0!==N&&t.length>N&&er.push({instanceLocation:s,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${N} properties.`}),void 0!==C){let t=`${o}/propertyNames`;for(let o in e){let e=`${s}/${go(o)}`,l=gk(o,C,r,i,n,a,e,t);l.valid||er.push({instanceLocation:s,keyword:"propertyNames",keywordLocation:t,error:`Property name "${o}" does not match schema.`},...l.errors)}}if(void 0!==P){let t=`${o}/dependantRequired`;for(let r in P)if(r in e)for(let i of P[r])i in e||er.push({instanceLocation:s,keyword:"dependentRequired",keywordLocation:t,error:`Instance has "${r}" but does not have "${i}".`})}if(void 0!==j)for(let t in j){let u=`${o}/dependentSchemas`;if(t in e){let o=gk(e,j[t],r,i,n,a,s,`${u}/${go(t)}`,l);o.valid||er.push({instanceLocation:s,keyword:"dependentSchemas",keywordLocation:u,error:`Instance has "${t}" but does not match dependant schema.`},...o.errors)}}if(void 0!==R){let t=`${o}/dependencies`;for(let o in R)if(o in e){let l=R[o];if(Array.isArray(l))for(let r of l)r in e||er.push({instanceLocation:s,keyword:"dependencies",keywordLocation:t,error:`Instance has "${o}" but does not have "${r}".`});else{let u=gk(e,l,r,i,n,a,s,`${t}/${go(o)}`);u.valid||er.push({instanceLocation:s,keyword:"dependencies",keywordLocation:t,error:`Instance has "${o}" but does not match dependant schema.`},...u.errors)}}}let u=Object.create(null),c=!1;if(void 0!==O){let t=`${o}/properties`;for(let o in O){if(!(o in e))continue;let d=`${s}/${go(o)}`,p=gk(e[o],O[o],r,i,n,a,d,`${t}/${go(o)}`);if(p.valid)l[o]=u[o]=!0;else if(c=n,er.push({instanceLocation:s,keyword:"properties",keywordLocation:t,error:`Property "${o}" does not match schema.`},...p.errors),c)break}}if(!c&&void 0!==S){let t=`${o}/patternProperties`;for(let o in S){let d=RegExp(o,"u"),p=S[o];for(let h in e){if(!d.test(h))continue;let m=`${s}/${go(h)}`,f=gk(e[h],p,r,i,n,a,m,`${t}/${go(o)}`);f.valid?l[h]=u[h]=!0:(c=n,er.push({instanceLocation:s,keyword:"patternProperties",keywordLocation:t,error:`Property "${h}" matches pattern "${o}" but does not match associated schema.`},...f.errors))}}}if(c||void 0===E){if(!c&&void 0!==T){let t=`${o}/unevaluatedProperties`;for(let o in e)if(!l[o]){let u=`${s}/${go(o)}`,c=gk(e[o],T,r,i,n,a,u,t);c.valid?l[o]=!0:er.push({instanceLocation:s,keyword:"unevaluatedProperties",keywordLocation:t,error:`Property "${o}" does not match unevaluated properties schema.`},...c.errors)}}}else{let t=`${o}/additionalProperties`;for(let o in e){if(u[o])continue;let d=`${s}/${go(o)}`,p=gk(e[o],E,r,i,n,a,d,t);p.valid?l[o]=!0:(c=n,er.push({instanceLocation:s,keyword:"additionalProperties",keywordLocation:t,error:`Property "${o}" does not match additional properties schema.`},...p.errors))}}}else if("array"===u){void 0!==q&&e.length>q&&er.push({instanceLocation:s,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${e.length} > ${q}).`}),void 0!==B&&e.length<B&&er.push({instanceLocation:s,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${e.length} < ${B}).`});let t=e.length,u=0,c=!1;if(void 0!==L){let d=`${o}/prefixItems`,p=Math.min(L.length,t);for(;u<p;u++){let t=gk(e[u],L[u],r,i,n,a,`${s}/${u}`,`${d}/${u}`);if(l[u]=!0,!t.valid&&(c=n,er.push({instanceLocation:s,keyword:"prefixItems",keywordLocation:d,error:"Items did not match schema."},...t.errors),c))break}}if(void 0!==U){let d=`${o}/items`;if(Array.isArray(U)){let o=Math.min(U.length,t);for(;u<o;u++){let t=gk(e[u],U[u],r,i,n,a,`${s}/${u}`,`${d}/${u}`);if(l[u]=!0,!t.valid&&(c=n,er.push({instanceLocation:s,keyword:"items",keywordLocation:d,error:"Items did not match schema."},...t.errors),c))break}}else for(;u<t;u++){let t=gk(e[u],U,r,i,n,a,`${s}/${u}`,d);if(l[u]=!0,!t.valid&&(c=n,er.push({instanceLocation:s,keyword:"items",keywordLocation:d,error:"Items did not match schema."},...t.errors),c))break}if(!c&&void 0!==z){let d=`${o}/additionalItems`;for(;u<t;u++){let t=gk(e[u],z,r,i,n,a,`${s}/${u}`,d);l[u]=!0,t.valid||(c=n,er.push({instanceLocation:s,keyword:"additionalItems",keywordLocation:d,error:"Items did not match additional items schema."},...t.errors))}}}if(void 0!==D)if(0===t&&void 0===Z)er.push({instanceLocation:s,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(void 0!==Z&&t<Z)er.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${t}) than minContains (${Z}).`});else{let u=`${o}/contains`,c=er.length,d=0;for(let o=0;o<t;o++){let t=gk(e[o],D,r,i,n,a,`${s}/${o}`,u);t.valid?(l[o]=!0,d++):er.push(...t.errors)}d>=(Z||0)&&(er.length=c),void 0===Z&&void 0===F&&0===d?er.splice(c,0,{instanceLocation:s,keyword:"contains",keywordLocation:u,error:"Array does not contain item matching schema."}):void 0!==Z&&d<Z?er.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${Z} items matching schema. Only ${d} items were found.`}):void 0!==F&&d>F&&er.push({instanceLocation:s,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${F} items matching schema. ${d} items were found.`})}if(!c&&void 0!==M){let c=`${o}/unevaluatedItems`;for(;u<t;u++){if(l[u])continue;let t=gk(e[u],M,r,i,n,a,`${s}/${u}`,c);l[u]=!0,t.valid||er.push({instanceLocation:s,keyword:"unevaluatedItems",keywordLocation:c,error:"Items did not match unevaluated items schema."},...t.errors)}}if(W)for(let r=0;r<t;r++){let i=e[r],n="object"==typeof i&&null!==i;for(let a=0;a<t;a++){if(r===a)continue;let t=e[a],l="object"==typeof t&&null!==t;(i===t||n&&l&&gs(i,t))&&(er.push({instanceLocation:s,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${r} and ${a}.`}),r=Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER)}}}else if("number"===u){if("4"===r?(void 0!==J&&(!0===H&&e<=J||e<J)&&er.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${H?"or equal to ":""} ${J}.`}),void 0!==G&&(!0===V&&e>=G||e>G)&&er.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${V?"or equal to ":""} ${G}.`})):(void 0!==J&&e<J&&er.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${e} is less than ${J}.`}),void 0!==G&&e>G&&er.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${e} is greater than ${G}.`}),void 0!==H&&e<=H&&er.push({instanceLocation:s,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${e} is less than ${H}.`}),void 0!==V&&e>=V&&er.push({instanceLocation:s,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${e} is greater than or equal to ${V}.`})),void 0!==K){let t=e%K;Math.abs(0-t)>=11920929e-14&&Math.abs(K-t)>=11920929e-14&&er.push({instanceLocation:s,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${e} is not a multiple of ${K}.`})}}else if("string"===u){let t=void 0===X&&void 0===Y?0:function(e){let t,r=0,i=e.length,n=0;for(;n<i;)r++,(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<i&&(64512&(t=e.charCodeAt(n)))==56320&&n++;return r}(e);void 0!==X&&t<X&&er.push({instanceLocation:s,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${t} < ${X}).`}),void 0!==Y&&t>Y&&er.push({instanceLocation:s,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${t} > ${Y}).`}),void 0===Q||RegExp(Q,"u").test(e)||er.push({instanceLocation:s,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),void 0!==I&&gy[I]&&!gy[I](e)&&er.push({instanceLocation:s,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${I}".`})}return{valid:0===er.length,errors:er}}(rc=iN||(iN={}))[rc.Flag=1]="Flag",rc[rc.Basic=2]="Basic",rc[rc.Detailed=4]="Detailed";class gI{schema;draft;shortCircuit;lookup;constructor(e,t="2019-09",r=!0){this.schema=e,this.draft=t,this.shortCircuit=r,this.lookup=gp(e)}validate(e){return gk(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,t){t&&(e={...e,$id:t}),gp(e,this.lookup)}}function gO(e){if(hp(e)){let t=hU(e,!0);return hS(t)?ga(hR(t,!0)):ga(e)}return hh(e)?((e,t)=>{let r,i,n=(i=void 0!==(r="string"==typeof t?{...hq,name:t}:{...hq,...t}).name?[...r.basePath,r.definitionPath,r.name]:r.basePath,{...r,flags:{hasReferencedOpenAiAnyType:!1},currentPath:i,propertyPath:void 0,seen:new Map(Object.entries(r.definitions).map(([e,t])=>[t._def,{def:t._def,path:[...r.basePath,r.definitionPath,e],jsonSchema:void 0}]))}),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,r])=>({...e,[t]:gt(r._def,{...n,currentPath:[...n.basePath,n.definitionPath,t]},!0)??hJ(n)}),{}):void 0,s="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,o=gt(e._def,void 0===s?n:{...n,currentPath:[...n.basePath,n.definitionPath,s]},!1)??hJ(n),l="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==l&&(o.title=l),n.flags.hasReferencedOpenAiAnyType&&(a||(a={}),a[n.openAiAnyTypeName]||(a[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===n.$refStrategy?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));let u=void 0===s?a?{...o,[n.definitionPath]:a}:o:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,s].join("/"),[n.definitionPath]:{...a,[s]:o}};return"jsonSchema7"===n.target?u.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===n.target||"openAi"===n.target)&&(u.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===n.target&&("anyOf"in u||"oneOf"in u||"allOf"in u||"type"in u&&Array.isArray(u.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),u})(e):e}function gS(e){if(!e||"object"!=typeof e||0===Object.keys(e).length||Array.isArray(e))return!1;if("type"in e)return"string"==typeof e.type?"string"===e.type:!!Array.isArray(e.type)&&e.type.every(e=>"string"===e);if("enum"in e)return Array.isArray(e.enum)&&e.enum.length>0&&e.enum.every(e=>"string"==typeof e);if("const"in e)return"string"==typeof e.const;if("allOf"in e&&Array.isArray(e.allOf))return e.allOf.some(e=>gS(e));if("anyOf"in e&&Array.isArray(e.anyOf)||"oneOf"in e&&Array.isArray(e.oneOf)){let t="anyOf"in e?e.anyOf:e.oneOf;return t.length>0&&t.every(e=>gS(e))}if("not"in e)return!1;if("$ref"in e&&"string"==typeof e.$ref){let t=e.$ref,r=gp(e);if(r[t])return gS(r[t])}return!1}iP({},{Validator:()=>gI,deepCompareStrict:()=>gs,toJsonSchema:()=>gO,validatesOnlyStrings:()=>gS});var ay=ay,gE=e.i(9807),gE=gE;iP({},{Graph:()=>gT});var gT=class e{nodes={};edges=[];constructor(e){this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){let e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=(0,gE.default)(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...o7(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...gO(t.data.schema),title:t.data.name}}})),edges:this.edges.map(t=>{let r={source:e[t.source],target:e[t.target]};return void 0!==t.data&&(r.data=t.data),void 0!==t.conditional&&(r.conditional=t.conditional),r})}}addNode(e,t,r){if(void 0!==t&&void 0!==this.nodes[t])throw Error(`Node with id ${t} already exists`);let i=t??(0,ay.default)(),n={id:i,data:e,name:function(e,t){if(void 0!==e&&!(0,gE.default)(e))return e;if(!o7(t))return t.name??"UnknownSchema";try{let e=t.getName();return e=e.startsWith("Runnable")?e.slice(8):e}catch{return t.getName()}}(t,e),metadata:r};return this.nodes[i]=n,n}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,i){if(void 0===this.nodes[e.id])throw Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw Error(`Target node ${t.id} not in graph`);let n={source:e.id,target:t.id,data:r,conditional:i};return this.edges.push(n),n}firstNode(){return gA(this)}lastNode(){return gN(this)}extend(e,t=""){let r=t;Object.values(e.nodes).map(e=>e.id).every(gE.default)&&(r="");let i=e=>r?`${r}:${e}`:e;Object.entries(e.nodes).forEach(([e,t])=>{this.nodes[i(e)]={...t,id:i(e)}});let n=e.edges.map(e=>({...e,source:i(e.source),target:i(e.target)}));this.edges=[...this.edges,...n];let a=e.firstNode(),s=e.lastNode();return[a?{id:i(a.id),data:a.data}:void 0,s?{id:i(s.id),data:s.data}:void 0]}trimFirstNode(){let e=this.firstNode();e&&gA(this,[e.id])&&this.removeNode(e)}trimLastNode(){let e=this.lastNode();e&&gN(this,[e.id])&&this.removeNode(e)}reid(){let t=Object.fromEntries(Object.values(this.nodes).map(e=>[e.id,e.name])),r=new Map;Object.values(t).forEach(e=>{r.set(e,(r.get(e)||0)+1)});let i=e=>{let i=t[e];return(0,gE.default)(e)&&1===r.get(i)?i:e};return new e({nodes:Object.fromEntries(Object.entries(this.nodes).map(([e,t])=>[i(e),{...t,id:i(e)}])),edges:this.edges.map(e=>({...e,source:i(e.source),target:i(e.target)}))})}drawMermaid(e){let{withStyles:t,curveStyle:r,nodeColors:i={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:n}=e??{},a=this.reid(),s=a.firstNode(),o=a.lastNode();return function(e,t,r){let{firstNode:i,lastNode:n,nodeColors:a,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=r??{},u=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:"graph TD;\n";if(s){let t="default",r={[t]:"{0}({1})"};for(let[a,s]of(void 0!==i&&(r[i]="{0}([{1}]):::first"),void 0!==n&&(r[n]="{0}([{1}]):::last"),Object.entries(e))){let e=s.name.split(":").pop()??"",i=hZ.some(t=>e.startsWith(t)&&e.endsWith(t))?`<p>${e}</p>`:e;Object.keys(s.metadata??{}).length&&(i+=`<hr/><small><em>${Object.entries(s.metadata??{}).map(([e,t])=>`${e} = ${t}`).join("\n")}</em></small>`);let n=(r[a]??r[t]).replace("{0}",hD(a)).replace("{1}",i);u+=`	${n}
`}}let c={};for(let e of t){let t=e.source.split(":"),r=e.target.split(":"),i=t.filter((e,t)=>e===r[t]).join(":");c[i]||(c[i]=[]),c[i].push(e)}let d=new Set;function p(e,t){let r=1===e.length&&e[0].source===e[0].target;if(t&&!r){let e=t.split(":").pop();if(d.has(e))throw Error(`Found duplicate subgraph '${e}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(e),u+=`	subgraph ${e}
`}for(let t of e){let{source:e,target:r,data:i,conditional:n}=t,a="";if(void 0!==i){let e=i,t=e.split(" ");t.length>l&&(e=Array.from({length:Math.ceil(t.length/l)},(e,r)=>t.slice(r*l,(r+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),a=n?` -. &nbsp;${e}&nbsp; .-> `:` -- &nbsp;${e}&nbsp; --> `}else a=n?" -.-> ":" --> ";u+=`	${hD(e)}${a}${hD(r)};
`}for(let e in c)e.startsWith(`${t}:`)&&e!==t&&p(c[e],e);t&&!r&&(u+="	end\n")}for(let e in p(c[""]??[],""),c)e.includes(":")||""===e||p(c[e],e);return s&&(u+=function(e){let t="";for(let[r,i]of Object.entries(e))t+=`	classDef ${r} ${i};
`;return t}(a??{})),u}(a.nodes,a.edges,{firstNode:s?.id,lastNode:o?.id,withStyles:t,curveStyle:r,nodeColors:i,wrapLabelNWords:n})}async drawMermaidPng(e){return hF(this.drawMermaid(e),{backgroundColor:e?.backgroundColor})}};function gA(e,t=[]){let r=new Set(e.edges.filter(e=>!t.includes(e.source)).map(e=>e.target)),i=[];for(let n of Object.values(e.nodes))t.includes(n.id)||r.has(n.id)||i.push(n);return 1===i.length?i[0]:void 0}function gN(e,t=[]){let r=new Set(e.edges.filter(e=>!t.includes(e.target)).map(e=>e.source)),i=[];for(let n of Object.values(e.nodes))t.includes(n.id)||r.has(n.id)||i.push(n);return 1===i.length?i[0]:void 0}function gC(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.iterator]&&"function"==typeof e.next}function gP(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator]}function*gj(e,t){for(;;){let{value:r,done:i}=od.runWithConfig(oy(e),t.next.bind(t),!0);if(i)break;yield r}}async function*gR(e,t){let r=t[Symbol.asyncIterator]();for(;;){let{value:i,done:n}=await od.runWithConfig(oy(e),r.next.bind(t),!0);if(n)break;yield i}}e.s([],54033),e.i(54033),e.i(85676),e.s(["defaultErrorMap",0,h0,"getErrorMap",()=>h2,"setErrorMap",()=>h4],76733),e.i(76733),e.i(84488),e.s([],91316),e.i(91316),e.i(42944),e.i(17958),e.i(15235),e.s(["BRAND",0,m8,"DIRTY",0,h7,"EMPTY_PATH",0,h9,"INVALID",0,h8,"NEVER",0,h8,"OK",0,me,"ParseStatus",()=>h3,"Schema",()=>ml,"ZodAny",()=>mR,"ZodArray",()=>mM,"ZodBigInt",()=>mT,"ZodBoolean",()=>mA,"ZodBranded",()=>m7,"ZodCatch",()=>m5,"ZodDate",()=>mN,"ZodDefault",()=>m9,"ZodDiscriminatedUnion",()=>mB,"ZodEffects",()=>m4,"ZodEnum",()=>mQ,"ZodError",()=>hQ,"ZodFirstPartyTypeKind",()=>iA,"ZodFunction",()=>mV,"ZodIntersection",()=>mq,"ZodIssueCode",0,hX,"ZodLazy",()=>mK,"ZodLiteral",()=>mX,"ZodMap",()=>mG,"ZodNaN",()=>m3,"ZodNativeEnum",()=>m0,"ZodNever",()=>mU,"ZodNull",()=>mj,"ZodNullable",()=>m6,"ZodNumber",()=>mE,"ZodObject",()=>mD,"ZodOptional",()=>m2,"ZodParsedType",0,hV,"ZodPipeline",()=>fe,"ZodPromise",()=>m1,"ZodReadonly",()=>ft,"ZodRecord",()=>mJ,"ZodSchema",()=>ml,"ZodSet",()=>mH,"ZodString",()=>mS,"ZodSymbol",()=>mC,"ZodTransformer",()=>m4,"ZodTuple",()=>mW,"ZodType",()=>ml,"ZodUndefined",()=>mP,"ZodUnion",()=>mZ,"ZodUnknown",()=>mL,"ZodVoid",()=>mz,"addIssueToContext",()=>h5,"any",()=>ff,"array",()=>fv,"bigint",()=>fu,"boolean",()=>fc,"coerce",0,fB,"custom",()=>fi,"date",()=>fd,"datetimeRegex",()=>mO,"defaultErrorMap",0,h0,"discriminatedUnion",()=>fx,"effect",()=>fR,"enum",()=>fC,"function",()=>fT,"getErrorMap",()=>h2,"getParsedType",0,hK,"instanceof",()=>fa,"intersection",()=>fk,"isAborted",0,mt,"isAsync",0,mn,"isDirty",0,mr,"isValid",0,mi,"late",0,fn,"lazy",()=>fA,"literal",()=>fN,"makeIssue",0,h6,"map",()=>fS,"nan",()=>fl,"nativeEnum",()=>fP,"never",()=>fy,"null",()=>fm,"nullable",()=>fU,"number",()=>fo,"object",()=>fb,"objectUtil",()=>iE,"oboolean",()=>fF,"onumber",()=>fZ,"optional",()=>fL,"ostring",()=>fD,"pipeline",()=>fM,"preprocess",()=>fz,"promise",()=>fj,"quotelessJson",0,hY,"record",()=>fO,"set",()=>fE,"setErrorMap",()=>h4,"strictObject",()=>fw,"string",()=>fs,"symbol",()=>fp,"transformer",()=>fR,"tuple",()=>fI,"undefined",()=>fh,"union",()=>f$,"unknown",()=>fg,"util",()=>iS,"void",()=>f_],35907);var gL=e.i(35907);e.s(["z",0,gL],22632);var gL=gL,ay=ay;function gU(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}var gz=class extends iH{lc_runnable=!0;name;getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}withRetry(e){return new gZ({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new gM({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new gG({runnable:this,fallbacks:Array.isArray(e)?e:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(of);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([e])=>"runId"!==e));return Array.from({length:t},(t,i)=>of(0===i?e:r))}return Array.from({length:t},()=>of(e))}async batch(e,t,r){let i=this._getOptionsList(t??{},e.length),n=new o3({maxConcurrency:i[0]?.maxConcurrency??r?.maxConcurrency,onFailedAttempt:e=>{throw e}});return Promise.all(e.map((e,t)=>n.call(async()=>{try{return await this.invoke(e,i[t])}catch(e){if(r?.returnExceptions)return e;throw e}})))}async *_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let r=of(t),i=new ox({generator:this._streamIterator(e,r),config:r});return await i.setup,ob.fromAsyncGenerator(i)}_separateRunnableConfigFromCallOptions(e){let t;t=void 0===e?of(e):of({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){let i,n=of(r),a=await op(n),s=await a?.handleChainStart(this.toJSON(),gU(t,"input"),n.runId,n?.runType,void 0,void 0,n?.runName??this.getName());delete n.runId;try{let a=e.call(this,t,n,s);i=await o_(a,r?.signal)}catch(e){throw await s?.handleChainError(e),e}return await s?.handleChainEnd(gU(i,"output")),i}async _batchWithConfig(e,t,r,i){let n,a=this._getOptionsList(r??{},t.length),s=await Promise.all(a.map(op)),o=await Promise.all(s.map(async(e,r)=>{let i=await e?.handleChainStart(this.toJSON(),gU(t[r],"input"),a[r].runId,a[r].runType,void 0,void 0,a[r].runName??this.getName());return delete a[r].runId,i}));try{let r=e.call(this,t,a,o,i);n=await o_(r,a?.[0]?.signal)}catch(e){throw await Promise.all(o.map(t=>t?.handleChainError(e))),e}return await Promise.all(o.map(e=>e?.handleChainEnd(gU(n,"output")))),n}_concatOutputChunks(e,t){return o$(e,t)}async *_transformStreamWithConfig(e,t,r){let i,n,a,s=!0,o=!0,l=of(r),u=await op(l),c=this;async function*d(){for await(let t of e){if(s)if(void 0===i)i=t;else try{i=c._concatOutputChunks(i,t)}catch{i=void 0,s=!1}yield t}}try{let e=await ok(t.bind(this),d(),async()=>u?.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),r?.signal,l);delete l.runId,a=e.setup;let i=a?.handlers.find(o2),s=e.output;void 0!==i&&void 0!==a&&(s=i.tapOutputIterable(a.runId,s));let c=a?.handlers.find(oV);for await(let e of(void 0!==c&&void 0!==a&&(s=c.tapOutputIterable(a.runId,s)),s))if(yield e,o)if(void 0===n)n=e;else try{n=this._concatOutputChunks(n,e)}catch{n=void 0,o=!1}}catch(e){throw await a?.handleChainError(e,void 0,void 0,void 0,{inputs:gU(i,"input")}),e}await a?.handleChainEnd(n??{},void 0,void 0,void 0,{inputs:gU(i,"input")})}getGraph(e){let t=new gT,r=t.addNode({name:`${this.getName()}Input`,schema:gL.any()}),i=t.addNode(this),n=t.addNode({name:`${this.getName()}Output`,schema:gL.any()});return t.addEdge(r,i),t.addEdge(i,n),t}pipe(e){return new gF({first:this,last:gH(e)})}pick(e){return this.pipe(new gK(e))}assign(e){return this.pipe(new gV(new gB({steps:e})))}async *transform(e,t){let r;for await(let t of e)r=void 0===r?t:this._concatOutputChunks(r,t);yield*this._streamIterator(r,of(t))}async *streamLog(e,t,r){let i=new oY({...r,autoClose:!1,_schemaFormat:"original"}),n=of(t);yield*this._streamLog(e,i,n)}async *_streamLog(e,t,r){let{callbacks:i}=r;if(void 0===i)r.callbacks=[t];else if(Array.isArray(i))r.callbacks=i.concat([t]);else{let e=i.copy();e.addHandler(t,!0),r.callbacks=e}let n=this.stream(e,r),a=async function(){try{for await(let e of(await n)){let r=new oG({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await t.writer.write(r)}}finally{await t.writer.close()}}();try{for await(let e of t)yield e}finally{await a}}streamEvents(e,t,r){var i;let n,a,s;if("v1"===t.version)n=this._streamEventsV1(e,t,r);else if("v2"===t.version)n=this._streamEventsV2(e,t,r);else throw Error('Only versions "v1" and "v2" of the schema are currently supported.');if("text/event-stream"!==t.encoding)return ob.fromAsyncGenerator(n);return i=n,a=new TextEncoder,s=new ReadableStream({async start(e){for await(let t of i)e.enqueue(a.encode(`event: data
data: ${JSON.stringify(t)}

`));e.enqueue(a.encode("event: end\n\n")),e.close()}}),ob.fromReadableStream(s)}async *_streamEventsV2(e,t,r){let i,n=new o6({...r,autoClose:!1}),a=of(t),s=a.runId??(0,ay.default)();a.runId=s;let o=a.callbacks;if(void 0===o)a.callbacks=[n];else if(Array.isArray(o))a.callbacks=o.concat(n);else{let e=o.copy();e.addHandler(n,!0),a.callbacks=e}let l=new AbortController,u=this,c=async function(){let r,i=null;try{t?.signal?"any"in AbortSignal?r=AbortSignal.any([l.signal,t.signal]):(r=t.signal,i=()=>{l.abort()},t.signal.addEventListener("abort",i,{once:!0})):r=l.signal;let o=await u.stream(e,{...a,signal:r});for await(let e of n.tapOutputIterable(s,o))if(l.signal.aborted)break}finally{await n.finish(),r&&i&&r.removeEventListener("abort",i)}}(),d=!1;try{for await(let t of n){if(!d){t.data.input=e,d=!0,i=t.run_id,yield t;continue}t.run_id===i&&t.event.endsWith("_end")&&t.data?.input&&delete t.data.input,yield t}}finally{l.abort(),await c}}async *_streamEventsV1(e,t,r){let i,n=!1,a=of(t),s=a.tags??[],o=a.metadata??{},l=a.runName??this.getName(),u=new oY({...r,autoClose:!1,_schemaFormat:"streaming_events"}),c=new le({...r});for await(let t of this._streamLog(e,u,a)){if(void 0===(i=i?i.concat(t):oH.fromRunLogPatch(t)).state)throw Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!n){n=!0;let t={...i.state},r={run_id:t.id,event:`on_${t.type}_start`,name:l,tags:s,metadata:o,data:{input:e}};c.includeEvent(r,t.type)&&(yield r)}for(let e of[...new Set(t.ops.filter(e=>e.path.startsWith("/logs/")).map(e=>e.path.split("/")[2]))]){let t,r={},n=i.state.logs[e];if("start"==(t=void 0===n.end_time?n.streamed_output.length>0?"stream":"start":"end"))void 0!==n.inputs&&(r.input=n.inputs);else if("end"===t)void 0!==n.inputs&&(r.input=n.inputs),r.output=n.final_output;else if("stream"===t){let e=n.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${n.name}"`);r={chunk:n.streamed_output[0]},n.streamed_output=[]}yield{event:`on_${n.type}_${t}`,name:n.name,run_id:n.id,tags:n.tags,metadata:n.metadata,data:r}}let{state:r}=i;if(r.streamed_output.length>0){let e=r.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${r.name}"`);let t={chunk:r.streamed_output[0]};r.streamed_output=[];let i={event:`on_${r.type}_stream`,run_id:r.id,tags:s,metadata:o,name:l,data:t};c.includeEvent(i,r.type)&&(yield i)}}let d=i?.state;if(void 0!==d){let e={event:`on_${d.type}_end`,name:l,run_id:d.id,tags:s,metadata:o,data:{output:d.final_output}};c.includeEvent(e,d.type)&&(yield e)}}static isRunnable(e){return o7(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new gM({bound:this,config:{},configFactories:[i=>({callbacks:[new o8({config:i,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){var t,r;let i,n;return t=this,i=(r=e).name??t.getName(),n=r.description??hx(r.schema),new gX(hI(r.schema)?{name:i,description:n,schema:gL.object({input:gL.string()}).transform(e=>e.input),bound:t}:{name:i,description:n,schema:r.schema,bound:t})}},gM=class e extends gz{static lc_name(){return"RunnableBinding"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;bound;config;kwargs;configFactories;constructor(e){super(e),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=oh(this.config,...e);return oh(t,...this.configFactories?await Promise.all(this.configFactories.map(async e=>await e(t))):[])}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new gZ({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e?.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(t,this.kwargs))}async batch(e,t,r){let i=Array.isArray(t)?await Promise.all(t.map(async e=>this._mergeConfig(of(e),this.kwargs))):await this._mergeConfig(of(t),this.kwargs);return this.bound.batch(e,i,r)}_concatOutputChunks(e,t){return this.bound._concatOutputChunks(e,t)}async *_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(of(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(of(t),this.kwargs))}async *transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(of(t),this.kwargs))}streamEvents(e,t,r){let i=this,n=async function*(){yield*i.bound.streamEvents(e,{...await i._mergeConfig(of(t),i.kwargs),version:t.version},r)};return ob.fromAsyncGenerator(n())}static isRunnableBinding(e){return e.bound&&gz.isRunnable(e.bound)}withListeners({onStart:t,onEnd:r,onError:i}){return new e({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[e=>({callbacks:[new o8({config:e,onStart:t,onEnd:r,onError:i})]})]})}},gD=class e extends gz{static lc_name(){return"RunnableEach"}lc_serializable=!0;lc_namespace=["langchain_core","runnables"];bound;constructor(e){super(e),this.bound=e.bound}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,og(t,{callbacks:r?.getChild()}))}withListeners({onStart:t,onEnd:r,onError:i}){return new e({bound:this.bound.withListeners({onStart:t,onEnd:r,onError:i})})}},gZ=class extends gM{static lc_name(){return"RunnableRetry"}lc_namespace=["langchain_core","runnables"];maxAttemptNumber=3;onFailedAttempt=()=>{};constructor(e){super(e),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let i=e>1?`retry:attempt:${e}`:void 0;return og(t,{callbacks:r?.getChild(i)})}async _invoke(e,t,r){return aa(i=>super.invoke(e,this._patchConfigForRetry(i,t,r)),{onFailedAttempt:({error:t})=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,i){let n={};try{await aa(async a=>{let s,o=e.map((e,t)=>t).filter(e=>void 0===n[e.toString()]||n[e.toString()]instanceof Error),l=o.map(t=>e[t]),u=o.map(e=>this._patchConfigForRetry(a,t?.[e],r?.[e])),c=await super.batch(l,u,{...i,returnExceptions:!0});for(let e=0;e<c.length;e+=1){let t=c[e],r=o[e];t instanceof Error&&void 0===s&&((s=t).input=l[e]),n[r.toString()]=t}if(s)throw s;return c},{onFailedAttempt:({error:e})=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(i?.returnExceptions!==!0)throw e}return Object.keys(n).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>n[parseInt(e,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}},gF=class e extends gz{static lc_name(){return"RunnableSequence"}first;middle=[];last;omitSequenceTags=!1;lc_serializable=!0;lc_namespace=["langchain_core","runnables"];constructor(e){super(e),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r,i=of(t),n=await op(i),a=await n?.handleChainStart(this.toJSON(),gU(e,"input"),i.runId,void 0,void 0,void 0,i?.runName);delete i.runId;let s=e;try{let e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){let n=e[r].invoke(s,og(i,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${r+1}`)}));s=await o_(n,t?.signal)}if(t?.signal?.aborted)throw ov(t.signal);r=await this.last.invoke(s,og(i,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(e){throw await a?.handleChainError(e),e}return await a?.handleChainEnd(gU(r,"output")),r}async batch(e,t,r){let i=this._getOptionsList(t??{},e.length),n=await Promise.all(i.map(op)),a=await Promise.all(n.map(async(t,r)=>{let n=await t?.handleChainStart(this.toJSON(),gU(e[r],"input"),i[r].runId,void 0,void 0,void 0,i[r].runName);return delete i[r].runId,n})),s=e;try{for(let e=0;e<this.steps.length;e+=1){let t=this.steps[e].batch(s,a.map((t,r)=>{let n=t?.getChild(this.omitSequenceTags?void 0:`seq:step:${e+1}`);return og(i[r],{callbacks:n})}),r);s=await o_(t,i[0]?.signal)}}catch(e){throw await Promise.all(a.map(t=>t?.handleChainError(e))),e}return await Promise.all(a.map(e=>e?.handleChainEnd(gU(s,"output")))),s}_concatOutputChunks(e,t){return this.last._concatOutputChunks(e,t)}async *_streamIterator(e,t){let r,i=await op(t),{runId:n,...a}=t??{},s=await i?.handleChainStart(this.toJSON(),gU(e,"input"),n,void 0,void 0,void 0,a?.runName),o=[this.first,...this.middle,this.last],l=!0;async function*u(){yield e}try{let e=o[0].transform(u(),og(a,{callbacks:s?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let t=1;t<o.length;t+=1){let r=o[t];e=await r.transform(e,og(a,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${t+1}`)}))}for await(let i of e)if(t?.signal?.throwIfAborted(),yield i,l)if(void 0===r)r=i;else try{r=this._concatOutputChunks(r,i)}catch{r=void 0,l=!1}}catch(e){throw await s?.handleChainError(e),e}await s?.handleChainEnd(gU(r,"output"))}getGraph(e){let t=new gT,r=null;return this.steps.forEach((i,n)=>{let a=i.getGraph(e);0!==n&&a.trimFirstNode(),n!==this.steps.length-1&&a.trimLastNode(),t.extend(a);let s=a.firstNode();if(!s)throw Error(`Runnable ${i} has no first node`);r&&t.addEdge(r,s),r=a.lastNode()}),t}pipe(t){return new e(e.isRunnableSequence(t)?{first:this.first,middle:this.middle.concat([this.last,t.first,...t.middle]),last:t.last,name:this.name??t.name}:{first:this.first,middle:[...this.middle,this.last],last:gH(t),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&gz.isRunnable(e)}static from([t,...r],i){let n={};return"string"==typeof i?n.name=i:void 0!==i&&(n=i),new e({...n,first:gH(t),middle:r.slice(0,-1).map(gH),last:gH(r[r.length-1])})}},gB=class e extends gz{static lc_name(){return"RunnableMap"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;steps;getStepsKeys(){return Object.keys(this.steps)}constructor(e){for(const[t,r]of(super(e),this.steps={},Object.entries(e.steps)))this.steps[t]=gH(r)}static from(t){return new e({steps:t})}async invoke(e,t){let r=of(t),i=await op(r),n=await i?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let a={};try{let i=Object.entries(this.steps).map(async([t,i])=>{a[t]=await i.invoke(e,og(r,{callbacks:n?.getChild(`map:key:${t}`)}))});await o_(Promise.all(i),t?.signal)}catch(e){throw await n?.handleChainError(e),e}return await n?.handleChainEnd(a),a}async *_transform(e,t,r){let i={...this.steps},n=ow(e,Object.keys(i).length),a=new Map(Object.entries(i).map(([e,i],a)=>{let s=i.transform(n[a],og(r,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,s.next().then(t=>({key:e,gen:s,result:t}))]}));for(;a.size;){let e=Promise.race(a.values()),{key:t,result:i,gen:n}=await o_(e,r?.signal);a.delete(t),i.done||(yield{[t]:i.value},a.set(t,n.next().then(e=>({key:t,gen:n,result:e}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=of(t),n=new ox({generator:this.transform(r(),i),config:i});return await n.setup,ob.fromAsyncGenerator(n)}},gq=class e extends gz{lc_serializable=!1;lc_namespace=["langchain_core","runnables"];func;constructor(e){if(super(e),!sX(e.func))throw Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){let[r]=this._getOptionsList(t??{},1),i=await op(r);return o_(this.func(og(r,{callbacks:i}),e),r?.signal)}async *_streamIterator(e,t){let[r]=this._getOptionsList(t??{},1),i=await this.invoke(e,t);if(gP(i)){for await(let e of i)r?.signal?.throwIfAborted(),yield e;return}if(null!=i&&"object"==typeof i&&"next"in i&&"function"==typeof i.next){for(;;){r?.signal?.throwIfAborted();let e=i.next();if(e.done)break;yield e.value}return}yield i}static from(t){return new e({func:t})}},gW=class e extends gz{static lc_name(){return"RunnableLambda"}lc_namespace=["langchain_core","runnables"];func;constructor(e){if(sX(e.func))return gq.from(e.func);if(super(e),sX(e.func))throw Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.");this.func=e.func}static from(t){return new e({func:t})}async _invoke(e,t,r){return new Promise((i,n)=>{let a=og(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??25)-1});od.runWithConfig(oy(a),async()=>{try{let r=await this.func(e,{...a});if(r&&gz.isRunnable(r)){if(t?.recursionLimit===0)throw Error("Recursion limit reached.");r=await r.invoke(e,{...a,recursionLimit:(a.recursionLimit??25)-1})}else if(gP(r)){let e;for await(let i of gR(a,r))if(t?.signal?.throwIfAborted(),void 0===e)e=i;else try{e=this._concatOutputChunks(e,i)}catch{e=i}r=e}else if(gC(r)){let e;for(let i of gj(a,r))if(t?.signal?.throwIfAborted(),void 0===e)e=i;else try{e=this._concatOutputChunks(e,i)}catch{e=i}r=e}i(r)}catch(e){n(e)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async *_transform(e,t,r){let i;for await(let t of e)if(void 0===i)i=t;else try{i=this._concatOutputChunks(i,t)}catch{i=t}let n=og(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??25)-1}),a=await new Promise((e,t)=>{od.runWithConfig(oy(n),async()=>{try{let t=await this.func(i,{...n,config:n});e(t)}catch(e){t(e)}})});if(a&&gz.isRunnable(a)){if(r?.recursionLimit===0)throw Error("Recursion limit reached.");for await(let e of(await a.stream(i,n)))yield e}else if(gP(a))for await(let e of gR(n,a))r?.signal?.throwIfAborted(),yield e;else if(gC(a))for(let e of gj(n,a))r?.signal?.throwIfAborted(),yield e;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=of(t),n=new ox({generator:this.transform(r(),i),config:i});return await n.setup,ob.fromAsyncGenerator(n)}},gJ=class extends gB{},gG=class extends gz{static lc_name(){return"RunnableWithFallbacks"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;runnable;fallbacks;constructor(e){super(e),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){for(let e of(yield this.runnable,this.fallbacks))yield e}async invoke(e,t){let r=of(t),i=await op(r),{runId:n,...a}=r,s=await i?.handleChainStart(this.toJSON(),gU(e,"input"),n,void 0,void 0,void 0,a?.runName),o=og(a,{callbacks:s?.getChild()});return await od.runWithConfig(o,async()=>{let t;for(let i of this.runnables()){r?.signal?.throwIfAborted();try{let t=await i.invoke(e,o);return await s?.handleChainEnd(gU(t,"output")),t}catch(e){void 0===t&&(t=e)}}if(void 0===t)throw Error("No error stored at end of fallback.");throw await s?.handleChainError(t),t})}async *_streamIterator(e,t){let r,i,n,a=of(t),s=await op(a),{runId:o,...l}=a,u=await s?.handleChainStart(this.toJSON(),gU(e,"input"),o,void 0,void 0,void 0,l?.runName);for(let t of this.runnables()){a?.signal?.throwIfAborted();let n=og(l,{callbacks:u?.getChild()});try{let r=await t.stream(e,n);i=gR(n,r);break}catch(e){void 0===r&&(r=e)}}if(void 0===i){let e=r??Error("No error stored at end of fallback.");throw await u?.handleChainError(e),e}try{for await(let e of i){yield e;try{n=void 0===n?n:this._concatOutputChunks(n,e)}catch{n=void 0}}}catch(e){throw await u?.handleChainError(e),e}await u?.handleChainEnd(gU(n,"output"))}async batch(e,t,r){let i;if(r?.returnExceptions)throw Error("Not implemented.");let n=this._getOptionsList(t??{},e.length),a=await Promise.all(n.map(e=>op(e))),s=await Promise.all(a.map(async(t,r)=>{let i=await t?.handleChainStart(this.toJSON(),gU(e[r],"input"),n[r].runId,void 0,void 0,void 0,n[r].runName);return delete n[r].runId,i}));for(let t of this.runnables()){n[0].signal?.throwIfAborted();try{let i=await t.batch(e,s.map((e,t)=>og(n[t],{callbacks:e?.getChild()})),r);return await Promise.all(s.map((e,t)=>e?.handleChainEnd(gU(i[t],"output")))),i}catch(e){void 0===i&&(i=e)}}if(!i)throw Error("No error stored at end of fallbacks.");throw await Promise.all(s.map(e=>e?.handleChainError(i))),i}};function gH(e){if("function"==typeof e)return new gW({func:e});if(gz.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`);{let t={};for(let[r,i]of Object.entries(e))t[r]=gH(i);return new gB({steps:t})}}var gV=class extends gz{static lc_name(){return"RunnableAssign"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;mapper;constructor(e){e instanceof gB&&(e={mapper:e}),super(e),this.mapper=e.mapper}async invoke(e,t){let r=await this.mapper.invoke(e,t);return{...e,...r}}async *_transform(e,t,r){let i=this.mapper.getStepsKeys(),[n,a]=ow(e),s=this.mapper.transform(a,og(r,{callbacks:t?.getChild()})),o=s.next();for await(let e of n){if("object"!=typeof e||Array.isArray(e))throw Error(`RunnableAssign can only be used with objects as input, got ${typeof e}`);let t=Object.fromEntries(Object.entries(e).filter(([e])=>!i.includes(e)));Object.keys(t).length>0&&(yield t)}for await(let e of(yield(await o).value,s))yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=of(t),n=new ox({generator:this.transform(r(),i),config:i});return await n.setup,ob.fromAsyncGenerator(n)}},gK=class extends gz{static lc_name(){return"RunnablePick"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;keys;constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{let t=this.keys.map(t=>[t,e[t]]).filter(e=>void 0!==e[1]);return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async *_transform(e){for await(let t of e){let e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=of(t),n=new ox({generator:this.transform(r(),i),config:i});return await n.setup,ob.fromAsyncGenerator(n)}},gX=class extends gM{name;description;schema;constructor(e){super({bound:gF.from([gW.from(async e=>{let t;if(nD(e))try{t=await hb(this.schema,e.args)}catch{throw new nZ("Received tool input did not match expected schema",JSON.stringify(e.args))}else t=e;return t}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name}),config:e.config??{}}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};e.s(["Runnable",()=>gz,"RunnableAssign",()=>gV,"RunnableBinding",()=>gM,"RunnableEach",()=>gD,"RunnableLambda",()=>gW,"RunnableMap",()=>gB,"RunnableParallel",()=>gJ,"RunnablePick",()=>gK,"RunnableRetry",()=>gZ,"RunnableSequence",()=>gF,"RunnableToolLike",()=>gX,"RunnableWithFallbacks",()=>gG,"_coerceToDict",()=>gU,"_coerceToRunnable",()=>gH],20204);let gY=(e,t)=>{let r=[...new Set(t?.map(e=>{if("string"==typeof e)return e;let t=new e({});if(!("getType"in t)||"function"!=typeof t.getType)throw Error("Invalid type provided.");return t.getType()}))],i=e.getType();return r.some(e=>e===i)};function gQ(e,t){return Array.isArray(e)?g0(e,t):gW.from(t=>g0(t,e))}function g0(e,t={}){let{includeNames:r,excludeNames:i,includeTypes:n,excludeTypes:a,includeIds:s,excludeIds:o}=t,l=[];for(let t of e)if(!(i&&t.name&&i.includes(t.name))){if(a&&gY(t,a))continue;if(o&&t.id&&o.includes(t.id))continue;n||s||r?r&&t.name&&r.some(e=>e===t.name)||n&&gY(t,n)?l.push(t):s&&t.id&&s.some(e=>e===t.id)&&l.push(t):l.push(t)}return l}function g1(e){return Array.isArray(e)?g4(e):gW.from(g4)}function g4(e){if(!e.length)return[];let t=[];for(let r of e){let e=t.pop();if(e)if("tool"===r.getType()||r.getType()!==e.getType())t.push(e,r);else{let i=n3(e),n=n3(r),a=i.concat(n);"string"==typeof i.content&&"string"==typeof n.content&&(a.content=`${i.content}
${n.content}`),t.push(function(e){let t,r=e.getType(),i=Object.fromEntries(Object.entries(e).filter(([e])=>!["type","tool_call_chunks"].includes(e)&&!e.startsWith("lc_")));if(r in g3&&(t=g8(r,i)),!t)throw Error(`Unrecognized message chunk class ${r}. Supported classes are ${Object.keys(g3)}`);return t}(a))}else t.push(r)}return t}function g2(e,t){if(!Array.isArray(e))return gW.from(t=>g6(t,e)).withConfig({runName:"trim_messages"});if(!t)throw Error("Options parameter is required when providing messages.");return g6(e,t)}async function g6(e,t){let r,{maxTokens:i,tokenCounter:n,strategy:a="last",allowPartial:s=!1,endOn:o,startOn:l,includeSystem:u=!1,textSplitter:c}=t;if(l&&"first"===a)throw Error("`startOn` should only be specified if `strategy` is 'last'.");if(u&&"first"===a)throw Error("`includeSystem` should only be specified if `strategy` is 'last'.");r="getNumTokens"in n?async e=>(await Promise.all(e.map(e=>n.getNumTokens(e.content)))).reduce((e,t)=>e+t,0):async e=>n(e);let d=g7;if(c&&(d="splitText"in c?c.splitText:async e=>c(e)),"first"===a)return g9(e,{maxTokens:i,tokenCounter:r,textSplitter:d,partialStrategy:s?"first":void 0,endOn:o});if("last"===a)return g5(e,{maxTokens:i,tokenCounter:r,textSplitter:d,allowPartial:s,includeSystem:u,startOn:l,endOn:o});throw Error(`Unrecognized strategy: '${a}'. Must be one of 'first' or 'last'.`)}async function g9(e,t){let{maxTokens:r,tokenCounter:i,textSplitter:n,partialStrategy:a,endOn:s}=t,o=[...e],l=0;for(let e=0;e<o.length;e+=1){let t=e>0?o.slice(0,-e):o;if(await i(t)<=r){l=o.length-e;break}}if(l<o.length&&a){let e=!1;if(Array.isArray(o[l].content)){let t=o[l];if("string"==typeof t.content)throw Error("Expected content to be an array.");let n=t.content.length,s="last"===a?[...t.content].reverse():t.content;for(let u=1;u<=n;u+=1){let n="first"===a?s.slice(0,u):s.slice(-u),c=Object.fromEntries(Object.entries(t).filter(([e])=>"type"!==e&&!e.startsWith("lc_"))),d=g8(t.getType(),{...c,content:n}),p=[...o.slice(0,l),d];if(await i(p)<=r)o=p,l+=1,e=!0;else break}e&&"last"===a&&(t.content=[...s].reverse())}if(!e){let e,t=o[l];if(Array.isArray(t.content)&&t.content.some(e=>"string"==typeof e||"text"===e.type)){let r=t.content.find(e=>"text"===e.type&&e.text);e=r?.text}else"string"==typeof t.content&&(e=t.content);if(e){let s=await n(e),u=s.length;"last"===a&&s.reverse();for(let e=0;e<u-1;e+=1)if(s.pop(),t.content=s.join(""),await i([...o.slice(0,l),t])<=r){"last"===a&&(t.content=[...s].reverse().join("")),o=[...o.slice(0,l),t],l+=1;break}}}}if(s){let e=Array.isArray(s)?s:[s];for(;l>0&&!gY(o[l-1],e);)l-=1}return o.slice(0,l)}async function g5(e,t){let{allowPartial:r=!1,includeSystem:i=!1,endOn:n,startOn:a,...s}=t,o=e.map(e=>{let t=Object.fromEntries(Object.entries(e).filter(([e])=>"type"!==e&&!e.startsWith("lc_")));return g8(e.getType(),t,np(e))});if(n){let e=Array.isArray(n)?n:[n];for(;o.length>0&&!gY(o[o.length-1],e);)o=o.slice(0,-1)}let l=i&&o[0]?.getType()==="system",u=l?o.slice(0,1).concat(o.slice(1).reverse()):o.reverse();return(u=await g9(u,{...s,partialStrategy:r?"last":void 0,endOn:a}),l)?[u[0],...u.slice(1).reverse()]:u.reverse()}let g3={human:{message:nA,messageChunk:nN},ai:{message:nV,messageChunk:nY},system:{message:nR,messageChunk:nL},developer:{message:nR,messageChunk:nL},tool:{message:ny,messageChunk:n_},function:{message:nO,messageChunk:nS},generic:{message:n$,messageChunk:nx},remove:{message:nj,messageChunk:nj}};function g8(e,t,r){let i,n;switch(e){case"human":r?i=new nN(t):n=new nA(t);break;case"ai":if(r){let e={...t};"tool_calls"in e&&(e={...e,tool_call_chunks:e.tool_calls?.map(e=>({...e,type:"tool_call_chunk",index:void 0,args:JSON.stringify(e.args)}))}),i=new nY(e)}else n=new nV(t);break;case"system":r?i=new nL(t):n=new nR(t);break;case"developer":r?i=new nL({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}}):n=new nR({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});break;case"tool":if("tool_call_id"in t)r?i=new n_(t):n=new ny(t);else throw Error("Can not convert ToolMessage to ToolMessageChunk if 'tool_call_id' field is not defined.");break;case"function":if(r)i=new nS(t);else{if(!t.name)throw Error("FunctionMessage must have a 'name' field");n=new nO(t)}break;case"generic":if("role"in t)r?i=new nx(t):n=new n$(t);else throw Error("Can not convert ChatMessage to ChatMessageChunk if 'role' field is not defined.");break;default:throw Error(`Unrecognized message type ${e}`)}if(r&&i)return i;if(n)return n;throw Error(`Unrecognized message type ${e}`)}function g7(e){let t=e.split("\n");return Promise.resolve([...t.slice(0,-1).map(e=>`${e}
`),t[t.length-1]])}let ye=["text","reasoning","tool_call","tool_call_chunk","invalid_tool_call","server_tool_call","server_tool_call_chunk","server_tool_call_result","image","video","audio","text-plain","file"];function yt(e){return!!e&&!!(/^o\d/.test(e??"")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-chat"))}function yr(e){let t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!n$.isInstance(e))throw Error("Invalid generic chat message");return"system"!==e.role&&"developer"!==e.role&&"assistant"!==e.role&&"user"!==e.role&&"function"!==e.role&&"tool"!==e.role&&console.warn(`Unknown message role: ${e.role}`),e.role;default:throw Error(`Unknown message type: ${t}`)}}function yi(e){return"undefined"!=typeof Headers&&null!==e&&"object"==typeof e&&"[object Headers]"===Object.prototype.toString.call(e)}function yn(e){return void 0!==e&&Array.isArray(e.lc_namespace)}function ya(e){return void 0!==e&&gz.isRunnable(e)&&"lc_name"in e.constructor&&"function"==typeof e.constructor.lc_name&&"RunnableToolLike"===e.constructor.lc_name()}function ys(e){return!!e&&"object"==typeof e&&"name"in e&&"schema"in e&&(hf(e.schema)||null!=e.schema&&"object"==typeof e.schema&&"type"in e.schema&&"string"==typeof e.schema.type&&["null","boolean","object","array","number","string"].includes(e.schema.type))}function yo(e){return ys(e)||ya(e)||yn(e)}function yl(e,t){let r="number"==typeof t?void 0:t;return{name:e.name,description:e.description,parameters:gO(e.schema),...r?.strict!==void 0?{strict:r.strict}:{}}}function yu(e,t){let r,i="number"==typeof t?void 0:t;return r=yo(e)?{type:"function",function:yl(e)}:e,i?.strict!==void 0&&(r.function.strict=i.strict),r}function yc(e,t){let r=[];for(let[i,n]of Object.entries(e.properties??{}))n.description&&t<2&&r.push(`// ${n.description}`),e.required?.includes(i)?r.push(`${i}: ${yd(n,t)},`):r.push(`${i}?: ${yd(n,t)},`);return r.map(e=>" ".repeat(t)+e).join("\n")}function yd(e,t){if(void 0!==e.anyOf&&Array.isArray(e.anyOf))return e.anyOf.map(e=>yd(e,t)).join(" | ");switch(e.type){case"string":if(e.enum)return e.enum.map(e=>`"${e}"`).join(" | ");return"string";case"number":if(e.enum)return e.enum.map(e=>`${e}`).join(" | ");return"number";case"integer":if(e.enum)return e.enum.map(e=>`${e}`).join(" | ");return"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",yc(e,t+2),"}"].join("\n");case"array":if(e.items)return`${yd(e.items,t)}[]`;return"any[]";default:return""}}function yp(e){if(e){if("any"===e||"required"===e)return"required";if("auto"===e)return"auto";if("none"===e)return"none";else if("string"==typeof e)return{type:"function",function:{name:e}};else return e}}function yh(e){return"type"in e&&"function"!==e.type}function ym(e){return"object"==typeof e&&null!==e&&"metadata"in e&&"object"==typeof e.metadata&&null!==e.metadata&&"customTool"in e.metadata&&"object"==typeof e.metadata.customTool&&null!==e.metadata.customTool}function yf(e){return"type"in e&&"custom"===e.type&&"custom"in e&&"object"==typeof e.custom&&null!==e.custom}iP({},{AIMessage:()=>nV,AIMessageChunk:()=>nY,BaseMessage:()=>nn,BaseMessageChunk:()=>nu,ChatMessage:()=>n$,ChatMessageChunk:()=>nx,FunctionMessage:()=>nO,FunctionMessageChunk:()=>nS,HumanMessage:()=>nA,HumanMessageChunk:()=>nN,KNOWN_BLOCK_TYPES:()=>ye,RemoveMessage:()=>nj,SystemMessage:()=>nR,SystemMessageChunk:()=>nL,ToolMessage:()=>ny,ToolMessageChunk:()=>n_,_isMessageFieldWithRole:()=>nc,_mergeDicts:()=>ns,_mergeLists:()=>no,_mergeObj:()=>nl,_mergeStatus:()=>ni,coerceMessageLikeToMessage:()=>n4,collapseToolCallChunks:()=>n8,convertToChunk:()=>n3,convertToOpenAIImageBlock:()=>iM,convertToProviderContentBlock:()=>iF,defaultTextSplitter:()=>g7,defaultToolCallParser:()=>nv,filterMessages:()=>gQ,getBufferString:()=>n2,iife:()=>nQ,isAIMessage:()=>nK,isAIMessageChunk:()=>nX,isBase64ContentBlock:()=>iL,isBaseMessage:()=>nd,isBaseMessageChunk:()=>np,isChatMessage:()=>nk,isChatMessageChunk:()=>nI,isDataContentBlock:()=>ij,isDirectToolOutput:()=>ng,isFunctionMessage:()=>nE,isFunctionMessageChunk:()=>nT,isHumanMessage:()=>nC,isHumanMessageChunk:()=>nP,isIDContentBlock:()=>iz,isMessage:()=>iB,isOpenAIToolCallArray:()=>na,isPlainTextContentBlock:()=>iU,isSystemMessage:()=>nU,isSystemMessageChunk:()=>nz,isToolMessage:()=>nb,isToolMessageChunk:()=>nw,isURLContentBlock:()=>iR,mapChatMessagesToStoredMessages:()=>n5,mapStoredMessageToChatMessage:()=>n6,mapStoredMessagesToChatMessages:()=>n9,mergeContent:()=>nr,mergeMessageRuns:()=>g1,mergeResponseMetadata:()=>nh,mergeUsageMetadata:()=>nf,parseBase64DataUrl:()=>iZ,parseMimeType:()=>iD,trimMessages:()=>g2}),e.s([],37253),iP({},{convertToOpenAIFunction:()=>yl,convertToOpenAITool:()=>yu,isLangChainTool:()=>yo,isRunnableToolLike:()=>ya,isStructuredTool:()=>yn,isStructuredToolParams:()=>ys}),iP({},{extendInteropZodObject:()=>hP,getInteropZodDefaultGetter:()=>hL,getInteropZodObjectShape:()=>hC,getSchemaDescription:()=>hx,interopParse:()=>h$,interopParseAsync:()=>hb,interopSafeParse:()=>hw,interopSafeParseAsync:()=>hv,interopZodObjectMakeFieldsOptional:()=>hz,interopZodObjectPartial:()=>hj,interopZodObjectPassthrough:()=>function e(t,r=!1){if(hO(t))return t.passthrough();if(hS(t)){let i=t._zod.def.shape;if(r)for(let[n,a]of Object.entries(t._zod.def.shape)){if(hS(a)){let t=e(a,r);i[n]=t}else if(hE(a)){let t=a._zod.def.element;hS(t)&&(t=e(t,r)),i[n]=us(a,{...a._zod.def,element:t})}else i[n]=a;let t=hc.get(a);t&&hc.add(i[n],t)}let n=us(t,{...t._zod.def,shape:i,catchall:pl(cW)}),a=hc.get(t);return a&&hc.add(n,a),n}throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")},interopZodObjectStrict:()=>hR,interopZodTransformInputSchema:()=>hU,isInteropZodError:()=>hM,isInteropZodLiteral:()=>h_,isInteropZodObject:()=>hN,isInteropZodSchema:()=>hf,isShapelessZodSchema:()=>hk,isSimpleStringZodSchema:()=>hI,isZodArrayV4:()=>hE,isZodLiteralV3:()=>hg,isZodLiteralV4:()=>hy,isZodNullableV4:()=>hA,isZodObjectV3:()=>hO,isZodObjectV4:()=>hS,isZodOptionalV4:()=>hT,isZodSchema:()=>hm,isZodSchemaV3:()=>hh,isZodSchemaV4:()=>hp});let yg=Symbol("Let zodToJsonSchema decide on which parser to use"),yy={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},y_=e=>"_def"in e?e._def:e;function yv(e,t,r,i){i?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function yb(e,t,r,i,n){e[t]=r,yv(e,t,i,n)}let yw=/^[cC][^\s-]{8,}$/,y$=/^[0-9a-z]+$/,yx=/^[0-9A-HJKMNP-TV-Z]{26}$/,yk=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,yI=()=>(void 0===p&&(p=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),p),yO=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,yS=/^[a-zA-Z0-9_-]{21}$/;function yE(e,t){let r={type:"string"};function i(e){return"escape"===t.patternStrategy?yT(e):e}if(e.checks)for(let n of e.checks)switch(n.kind){case"min":yb(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,n.value):n.value,n.message,t);break;case"max":yb(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,n.value):n.value,n.message,t);break;case"email":switch(t.emailStrategy){case"format:email":yA(r,"email",n.message,t);break;case"format:idn-email":yA(r,"idn-email",n.message,t);break;case"pattern:zod":yN(r,yk,n.message,t)}break;case"url":yA(r,"uri",n.message,t);break;case"uuid":yA(r,"uuid",n.message,t);break;case"regex":yN(r,n.regex,n.message,t);break;case"cuid":yN(r,yw,n.message,t);break;case"cuid2":yN(r,y$,n.message,t);break;case"startsWith":yN(r,RegExp(`^${i(n.value)}`),n.message,t);break;case"endsWith":yN(r,RegExp(`${i(n.value)}$`),n.message,t);break;case"datetime":yA(r,"date-time",n.message,t);break;case"date":yA(r,"date",n.message,t);break;case"time":yA(r,"time",n.message,t);break;case"duration":yA(r,"duration",n.message,t);break;case"length":yb(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,n.value):n.value,n.message,t),yb(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,n.value):n.value,n.message,t);break;case"includes":yN(r,RegExp(i(n.value)),n.message,t);break;case"ip":"v6"!==n.version&&yA(r,"ipv4",n.message,t),"v4"!==n.version&&yA(r,"ipv6",n.message,t);break;case"emoji":yN(r,yI,n.message,t);break;case"ulid":yN(r,yx,n.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":yA(r,"binary",n.message,t);break;case"contentEncoding:base64":yb(r,"contentEncoding","base64",n.message,t);break;case"pattern:zod":yN(r,yO,n.message,t)}break;case"nanoid":yN(r,yS,n.message,t)}return r}let yT=e=>Array.from(e).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),yA=(e,t,r,i)=>{e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&i.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&i.errorMessages&&{errorMessage:{format:r}}})):yb(e,"format",t,r,i)},yN=(e,t,r,i)=>{e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&i.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:yC(t,i),...r&&i.errorMessages&&{errorMessage:{pattern:r}}})):yb(e,"pattern",yC(t,i),r,i)},yC=(e,t)=>{let r="function"==typeof e?e():e;if(!t.applyRegexFlags||!r.flags)return r.source;let i={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=i.i?r.source.toLowerCase():r.source,a="",s=!1,o=!1,l=!1;for(let e=0;e<n.length;e++){if(s){a+=n[e],s=!1;continue}if(i.i){if(o){if(n[e].match(/[a-z]/)){l?(a+=n[e],a+=`${n[e-2]}-${n[e]}`.toUpperCase(),l=!1):"-"===n[e+1]&&n[e+2]?.match(/[a-z]/)?(a+=n[e],l=!0):a+=`${n[e]}${n[e].toUpperCase()}`;continue}}else if(n[e].match(/[a-z]/)){a+=`[${n[e]}${n[e].toUpperCase()}]`;continue}}if(i.m){if("^"===n[e]){a+=`(^|(?<=[\r
]))`;continue}else if("$"===n[e]){a+=`($|(?=[\r
]))`;continue}}if(i.s&&"."===n[e]){a+=o?`${n[e]}\r
`:`[${n[e]}\r
]`;continue}a+=n[e],"\\"===n[e]?s=!0:o&&"]"===n[e]?o=!1:o||"["!==n[e]||(o=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return a};function yP(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===iA.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,i)=>({...r,[i]:yL(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",i]})??{}}),{}),additionalProperties:!1};let r={type:"object",additionalProperties:yL(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===iA.ZodString&&e.keyType._def.checks?.length){let i=Object.entries(yE(e.keyType._def,t)).reduce((e,[t,r])=>"type"===t?e:{...e,[t]:r},{});return{...r,propertyNames:i}}return e.keyType?._def.typeName===iA.ZodEnum?{...r,propertyNames:{enum:e.keyType._def.values}}:r}let yj={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},yR=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>yL(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0};function yL(e,t,r=!1){let i=t.seen.get(e);if(t.override){let n=t.override?.(e,t,i,r);if(n!==yg)return n}if(i&&!r){let e=yU(i,t);if(void 0!==e)return"$ref"in e&&t.seenRefs.add(e.$ref),e}let n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);let a=yM(e,e.typeName,t,r);return a&&yD(e,t,a),n.jsonSchema=a,a}let yU=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"extract-to-root":let r=e.path.slice(t.basePath.length+1).join("_");return r!==t.name&&"duplicate-ref"===t.nameStrategy&&(t.definitions[r]=e.def),{$ref:[...t.basePath,t.definitionPath,r].join("/")};case"relative":return{$ref:yz(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},yz=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},yM=(e,t,r,i)=>{switch(t){case iA.ZodString:return yE(e,r);case iA.ZodNumber:let n={type:"number"};if(!e.checks)return n;for(let t of e.checks)switch(t.kind){case"int":n.type="integer",yv(n,"type",t.message,r);break;case"min":"jsonSchema7"===r.target?t.inclusive?yb(n,"minimum",t.value,t.message,r):yb(n,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(n.exclusiveMinimum=!0),yb(n,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?yb(n,"maximum",t.value,t.message,r):yb(n,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(n.exclusiveMaximum=!0),yb(n,"maximum",t.value,t.message,r));break;case"multipleOf":yb(n,"multipleOf",t.value,t.message,r)}return n;case iA.ZodObject:let a;return(a={type:"object",...Object.entries(e.shape()).reduce((e,[t,i])=>{if(void 0===i||void 0===i._def)return e;let n=[...r.currentPath,"properties",t],a=yL(i._def,{...r,currentPath:n,propertyPath:n});if(void 0===a)return e;if(r.openaiStrictMode&&i.isOptional()&&!i.isNullable()&&void 0===i._def?.defaultValue)throw Error(`Zod field at \`${n.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...e.properties,[t]:a},required:i.isOptional()&&!r.openaiStrictMode?e.required:[...e.required,t]}},{properties:{},required:[]}),additionalProperties:"strict"===r.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:yL(e.catchall._def,{...r,currentPath:[...r.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:yL(e.catchall._def,{...r,currentPath:[...r.currentPath,"additionalProperties"]})??!0}).required.length||delete a.required,a;case iA.ZodBigInt:let s={type:"integer",format:"int64"};if(!e.checks)return s;for(let t of e.checks)switch(t.kind){case"min":"jsonSchema7"===r.target?t.inclusive?yb(s,"minimum",t.value,t.message,r):yb(s,"exclusiveMinimum",t.value,t.message,r):(t.inclusive||(s.exclusiveMinimum=!0),yb(s,"minimum",t.value,t.message,r));break;case"max":"jsonSchema7"===r.target?t.inclusive?yb(s,"maximum",t.value,t.message,r):yb(s,"exclusiveMaximum",t.value,t.message,r):(t.inclusive||(s.exclusiveMaximum=!0),yb(s,"maximum",t.value,t.message,r));break;case"multipleOf":yb(s,"multipleOf",t.value,t.message,r)}return s;case iA.ZodBoolean:return{type:"boolean"};case iA.ZodDate:return function e(t,r,i){let n=i??r.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((i,n)=>e(t,r,i))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var a=t,s=r;let o={type:"integer",format:"unix-time"};if("openApi3"===s.target)return o;for(let e of a.checks)switch(e.kind){case"min":yb(o,"minimum",e.value,e.message,s);break;case"max":yb(o,"maximum",e.value,e.message,s)}return o}}(e,r);case iA.ZodUndefined:return{not:{}};case iA.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case iA.ZodArray:let o;return o={type:"array"},e.type?._def?.typeName!==iA.ZodAny&&(o.items=yL(e.type._def,{...r,currentPath:[...r.currentPath,"items"]})),e.minLength&&yb(o,"minItems",e.minLength.value,e.minLength.message,r),e.maxLength&&yb(o,"maxItems",e.maxLength.value,e.maxLength.message,r),e.exactLength&&(yb(o,"minItems",e.exactLength.value,e.exactLength.message,r),yb(o,"maxItems",e.exactLength.value,e.exactLength.message,r)),o;case iA.ZodUnion:case iA.ZodDiscriminatedUnion:if("openApi3"===r.target)return yR(e,r);let l=e.options instanceof Map?Array.from(e.options.values()):e.options;if(l.every(e=>e._def.typeName in yj&&(!e._def.checks||!e._def.checks.length))){let e=l.reduce((e,t)=>{let r=yj[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(l.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=l.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===l.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:l.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(l.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:l.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return yR(e,r);case iA.ZodIntersection:let u,c,d;return u=[yL(e.left._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),yL(e.right._def,{...r,currentPath:[...r.currentPath,"allOf","1"]})].filter(e=>!!e),c="jsonSchema2019-09"===r.target?{unevaluatedProperties:!1}:void 0,d=[],u.forEach(e=>{if((!("type"in e)||"string"!==e.type)&&"allOf"in e)d.push(...e.allOf),void 0===e.unevaluatedProperties&&(c=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...i}=e;t=i}else c=void 0;d.push(t)}}),d.length?{allOf:d,...c}:void 0;case iA.ZodTuple:return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,t)=>yL(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:yL(e.rest._def,{...r,currentPath:[...r.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,t)=>yL(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])};case iA.ZodRecord:return yP(e,r);case iA.ZodLiteral:let p;return"bigint"!=(p=typeof e.value)&&"number"!==p&&"boolean"!==p&&"string"!==p?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===r.target?{type:"bigint"===p?"integer":p,enum:[e.value]}:{type:"bigint"===p?"integer":p,const:e.value};case iA.ZodEnum:return{type:"string",enum:[...e.values]};case iA.ZodNativeEnum:let h,m,f;return h=e.values,{type:1===(f=Array.from(new Set((m=Object.keys(e.values).filter(e=>"number"!=typeof h[h[e]]).map(e=>h[e])).map(e=>typeof e)))).length?"string"===f[0]?"string":"number":["string","number"],enum:m};case iA.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===r.target||"property"===r.nullableStrategy?{type:yj[e.innerType._def.typeName],nullable:!0}:{type:[yj[e.innerType._def.typeName],"null"]};if("openApi3"===r.target){let t=yL(e.innerType._def,{...r,currentPath:[...r.currentPath]});return t&&"$ref"in t?{allOf:[t],nullable:!0}:t&&{...t,nullable:!0}}let g=yL(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","0"]});return g&&{anyOf:[g,{type:"null"}]};case iA.ZodOptional:if(r.propertyPath&&r.currentPath.slice(0,r.propertyPath.length).toString()===r.propertyPath.toString())return yL(e.innerType._def,{...r,currentPath:r.currentPath});let y=yL(e.innerType._def,{...r,currentPath:[...r.currentPath,"anyOf","1"]});return y?{anyOf:[{not:{}},y]}:{};case iA.ZodMap:if("record"===r.mapStrategy)return yP(e,r);return{type:"array",maxItems:125,items:{type:"array",items:[yL(e.keyType._def,{...r,currentPath:[...r.currentPath,"items","items","0"]})||{},yL(e.valueType._def,{...r,currentPath:[...r.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}};case iA.ZodSet:let _;return _={type:"array",uniqueItems:!0,items:yL(e.valueType._def,{...r,currentPath:[...r.currentPath,"items"]})},e.minSize&&yb(_,"minItems",e.minSize.value,e.minSize.message,r),e.maxSize&&yb(_,"maxItems",e.maxSize.value,e.maxSize.message,r),_;case iA.ZodLazy:return yL(e.getter()._def,r);case iA.ZodPromise:return yL(e.type._def,r);case iA.ZodNaN:case iA.ZodNever:return{not:{}};case iA.ZodEffects:return"input"===r.effectStrategy?yL(e.schema._def,r,i):{};case iA.ZodAny:case iA.ZodUnknown:return{};case iA.ZodDefault:return{...yL(e.innerType._def,r),default:e.defaultValue()};case iA.ZodBranded:return yL(e.type._def,r);case iA.ZodReadonly:case iA.ZodCatch:return yL(e.innerType._def,r);case iA.ZodPipeline:if("input"===r.pipeStrategy)return yL(e.in._def,r);if("output"===r.pipeStrategy)return yL(e.out._def,r);let v=yL(e.in._def,{...r,currentPath:[...r.currentPath,"allOf","0"]}),b=yL(e.out._def,{...r,currentPath:[...r.currentPath,"allOf",v?"1":"0"]});return{allOf:[v,b].filter(e=>void 0!==e)};case iA.ZodFunction:case iA.ZodVoid:case iA.ZodSymbol:default:return}},yD=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r);function yZ(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}let yF=["jsonSchema","functionCalling","jsonMode"];var yB={"gpt-4.1-nano":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"text-embedding-3-small":{maxInputTokens:8191,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1536,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4":{maxInputTokens:8192,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:8192,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-pro":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-05-13":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-08-06":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4.1-mini":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-deep-research":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-3.5-turbo":{maxInputTokens:16385,imageInputs:!1,audioInputs:!1,pdfInputs:!1,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!1,imageUrlInputs:!1,pdfToolMessage:!1,imageToolMessage:!1,toolChoice:!0},"text-embedding-3-large":{maxInputTokens:8191,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:3072,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4-turbo":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-preview":{maxInputTokens:128e3,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-mini":{maxInputTokens:2e5,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"codex-mini-latest":{maxInputTokens:2e5,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-nano":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-codex":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4.1":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o4-mini":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},o1:{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-mini":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-mini":{maxInputTokens:128e3,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:65536,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"text-embedding-ada-002":{maxInputTokens:8192,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1536,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-pro":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-11-20":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},o3:{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o4-mini-deep-research":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-chat-latest":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-mini":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-pro":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:272e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0}};iP({},{BasePromptValue:()=>yq,ChatPromptValue:()=>yJ,ImagePromptValue:()=>yG,StringPromptValue:()=>yW});var yq=class extends iH{},yW=class extends yq{static lc_name(){return"StringPromptValue"}lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;value;constructor(e){super({value:e}),this.value=e}toString(){return this.value}toChatMessages(){return[new nA(this.value)]}},yJ=class extends yq{lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;static lc_name(){return"ChatPromptValue"}messages;constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),this.messages=e.messages}toString(){return n2(this.messages)}toChatMessages(){return this.messages}},yG=class extends yq{lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;static lc_name(){return"ImagePromptValue"}imageUrl;value;constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new nA({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}};e.s(["ChatPromptValue",()=>yJ,"ImagePromptValue",()=>yG,"StringPromptValue",()=>yW],63025);var yH="0123456789abcdef".split(""),yV=[-0x80000000,8388608,32768,128],yK=[24,16,8,0],yX=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2],yY=[];function yQ(e,t){t?(yY[0]=yY[16]=yY[1]=yY[2]=yY[3]=yY[4]=yY[5]=yY[6]=yY[7]=yY[8]=yY[9]=yY[10]=yY[11]=yY[12]=yY[13]=yY[14]=yY[15]=0,this.blocks=yY):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=0xc1059ed8,this.h1=0x367cd507,this.h2=0x3070dd17,this.h3=0xf70e5939,this.h4=0xffc00b31,this.h5=0x68581511,this.h6=0x64f98fa7,this.h7=0xbefa4fa4):(this.h0=0x6a09e667,this.h1=0xbb67ae85,this.h2=0x3c6ef372,this.h3=0xa54ff53a,this.h4=0x510e527f,this.h5=0x9b05688c,this.h6=0x1f83d9ab,this.h7=0x5be0cd19),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}yQ.prototype.update=function(e){if(!this.finalized){var t,r=typeof e;if("string"!==r){if("object"===r){if(null===e)throw Error(ERROR);else if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(e)))throw Error(ERROR)}else throw Error(ERROR);t=!0}for(var i,n,a=0,s=e.length,o=this.blocks;a<s;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,this.block=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),t)for(n=this.start;a<s&&n<64;++a)o[n>>>2]|=e[a]<<yK[3&n++];else for(n=this.start;a<s&&n<64;++a)(i=e.charCodeAt(a))<128?o[n>>>2]|=i<<yK[3&n++]:(i<2048?o[n>>>2]|=(192|i>>>6)<<yK[3&n++]:(i<55296||i>=57344?o[n>>>2]|=(224|i>>>12)<<yK[3&n++]:(i=65536+((1023&i)<<10|1023&e.charCodeAt(++a)),o[n>>>2]|=(240|i>>>18)<<yK[3&n++],o[n>>>2]|=(128|i>>>12&63)<<yK[3&n++]),o[n>>>2]|=(128|i>>>6&63)<<yK[3&n++]),o[n>>>2]|=(128|63&i)<<yK[3&n++]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.block=o[16],this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>0xffffffff&&(this.hBytes+=this.bytes/0x100000000|0,this.bytes=this.bytes%0x100000000),this}},yQ.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>>2]|=yV[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},yQ.prototype.hash=function(){var e,t,r,i,n,a,s,o,l,u,c=this.h0,d=this.h1,p=this.h2,h=this.h3,m=this.h4,f=this.h5,g=this.h6,y=this.h7,_=this.blocks;for(e=16;e<64;++e)t=((n=_[e-15])>>>7|n<<25)^(n>>>18|n<<14)^n>>>3,r=((n=_[e-2])>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,_[e]=_[e-16]+t+_[e-7]+r|0;for(e=0,u=d&p;e<64;e+=4)this.first?(this.is224?(s=300032,y=(n=_[0]-0x543c9a5b)-0x8f1a6c7|0,h=n+0x170e9b5|0):(s=0x2a01a605,y=(n=_[0]-0xc881298)-0x5ab00ac6|0,h=n+0x8909ae5|0),this.first=!1):(t=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),r=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7),i=(s=c&d)^c&p^u,n=y+r+(m&f^~m&g)+yX[e]+_[e],a=t+i,y=h+n|0,h=n+a|0),t=(h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),r=(y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7),i=(o=h&c)^h&d^s,n=f+r+(g&y^~g&m)+yX[e+1]+_[e+1],a=t+i,g=p+n|0,t=((p=n+a|0)>>>2|p<<30)^(p>>>13|p<<19)^(p>>>22|p<<10),r=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7),i=(l=p&h)^p&c^o,n=m+r+(f&g^~f&y)+yX[e+2]+_[e+2],a=t+i,f=d+n|0,t=((d=n+a|0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),r=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7),i=(u=d&p)^d&h^l,n=m+r+(f&g^~f&y)+yX[e+3]+_[e+3],a=t+i,m=c+n|0,c=n+a|0,this.chromeBugWorkAround=!0;this.h0=this.h0+c|0,this.h1=this.h1+d|0,this.h2=this.h2+p|0,this.h3=this.h3+h|0,this.h4=this.h4+m|0,this.h5=this.h5+f|0,this.h6=this.h6+g|0,this.h7=this.h7+y|0},yQ.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,i=this.h3,n=this.h4,a=this.h5,s=this.h6,o=this.h7,l=yH[e>>>28&15]+yH[e>>>24&15]+yH[e>>>20&15]+yH[e>>>16&15]+yH[e>>>12&15]+yH[e>>>8&15]+yH[e>>>4&15]+yH[15&e]+yH[t>>>28&15]+yH[t>>>24&15]+yH[t>>>20&15]+yH[t>>>16&15]+yH[t>>>12&15]+yH[t>>>8&15]+yH[t>>>4&15]+yH[15&t]+yH[r>>>28&15]+yH[r>>>24&15]+yH[r>>>20&15]+yH[r>>>16&15]+yH[r>>>12&15]+yH[r>>>8&15]+yH[r>>>4&15]+yH[15&r]+yH[i>>>28&15]+yH[i>>>24&15]+yH[i>>>20&15]+yH[i>>>16&15]+yH[i>>>12&15]+yH[i>>>8&15]+yH[i>>>4&15]+yH[15&i]+yH[n>>>28&15]+yH[n>>>24&15]+yH[n>>>20&15]+yH[n>>>16&15]+yH[n>>>12&15]+yH[n>>>8&15]+yH[n>>>4&15]+yH[15&n]+yH[a>>>28&15]+yH[a>>>24&15]+yH[a>>>20&15]+yH[a>>>16&15]+yH[a>>>12&15]+yH[a>>>8&15]+yH[a>>>4&15]+yH[15&a]+yH[s>>>28&15]+yH[s>>>24&15]+yH[s>>>20&15]+yH[s>>>16&15]+yH[s>>>12&15]+yH[s>>>8&15]+yH[s>>>4&15]+yH[15&s];return this.is224||(l+=yH[o>>>28&15]+yH[o>>>24&15]+yH[o>>>20&15]+yH[o>>>16&15]+yH[o>>>12&15]+yH[o>>>8&15]+yH[o>>>4&15]+yH[15&o]),l},yQ.prototype.toString=yQ.prototype.hex,yQ.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,i=this.h3,n=this.h4,a=this.h5,s=this.h6,o=this.h7,l=[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s];return this.is224||l.push(o>>>24&255,o>>>16&255,o>>>8&255,255&o),l},yQ.prototype.array=yQ.prototype.digest,yQ.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e};let y0=(...e)=>new yQ(!1,!0).update(e.join("")).hex();iP({},{sha256:()=>y0}),iP({},{BaseCache:()=>y6,InMemoryCache:()=>y5,defaultHashKeyEncoder:()=>y1,deserializeStoredGeneration:()=>y4,serializeGeneration:()=>y2});let y1=(...e)=>y0(e.join("_"));function y4(e){return void 0!==e.message?{text:e.text,message:n6(e.message)}:{text:e.text}}function y2(e){let t={text:e.text};return void 0!==e.message&&(t.message=e.message.toDict()),t}var y6=class{keyEncoder=y1;makeDefaultKeyEncoder(e){this.keyEncoder=e}};let y9=new Map;var y5=class e extends y6{cache;constructor(e){super(),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(this.keyEncoder(e,t))??null)}async update(e,t,r){this.cache.set(this.keyEncoder(e,t),r)}static global(){return new e(y9)}},y3=e.i(6920),y8=Object.defineProperty,y7=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){for(const[t,r]of(this.patStr=e.pat_str,Object.entries(e.bpe_ranks.split("\n").filter(Boolean).reduce((e,t)=>{let[r,i,...n]=t.split(" "),a=Number.parseInt(i,10);return n.forEach((t,r)=>e[t]=a+r),e},{})))){const e=y3.default.toByteArray(t);this.rankMap.set(e.join(","),r),this.textMap.set(r,e)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e),{})}encode(e,t=[],r="all"){let i=RegExp(this.patStr,"ug"),n=y7.specialTokenRegex(Object.keys(this.specialTokens)),a=[],s=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===r?Object.keys(this.specialTokens).filter(e=>!s.has(e)):r);if(o.size>0){let t=y7.specialTokenRegex([...o]),r=e.match(t);if(null!=r)throw Error(`The text contains a special token that is not allowed: ${r[0]}`)}let l=0;for(;;){let t=null,r=l;for(;n.lastIndex=r,!(null==(t=n.exec(e))||s.has(t[0]));)r=t.index+1;let o=t?.index??e.length;for(let t of e.substring(l,o).matchAll(i)){let e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));if(null!=r){a.push(r);continue}a.push(...function(e,t){return 1===e.length?[t.get(e.join(","))]:(function(e,t){let r=Array.from({length:e.length},(e,t)=>({start:t,end:t+1}));for(;r.length>1;){let i=null;for(let n=0;n<r.length-1;n++){let a=e.slice(r[n].start,r[n+1].end),s=t.get(a.join(","));null!=s&&(null==i||s<i[0])&&(i=[s,n])}if(null!=i){let e=i[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}else break}return r})(e,t).map(r=>t.get(e.slice(r.start,r.end).join(","))).filter(e=>null!=e)}(e,this.rankMap))}if(null==t)break;let u=this.specialTokens[t[0]];a.push(u),l=t.index+t[0].length}return a}decode(e){let t=[],r=0;for(let i=0;i<e.length;++i){let n=e[i],a=this.textMap.get(n)??this.inverseSpecialTokens[n];null!=a&&(t.push(a),r+=a.length)}let i=new Uint8Array(r),n=0;for(let e of t)i.set(e,n),n+=e.length;return this.textDecoder.decode(i)}};rd="specialTokenRegex",rp=e=>RegExp(e.map(e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")).join("|"),"g"),(m="symbol"!=typeof rd?rd+"":rd)in y7?y8(y7,m,{enumerable:!0,configurable:!0,writable:!0,value:rp}):y7[m]=rp,iP({},{encodingForModel:()=>_i,getEncoding:()=>_r});let _e={},_t=new o3({});async function _r(e){return e in _e||(_e[e]=_t.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then(e=>e.json()).then(e=>new y7(e)).catch(t=>{throw delete _e[e],t})),await _e[e]}async function _i(e){return _r(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw Error("Unknown model")}}(e))}iP({},{BaseLangChain:()=>_u,BaseLanguageModel:()=>_c,calculateMaxTokens:()=>_l,getEmbeddingContextSize:()=>_a,getModelContextSize:()=>_s,getModelNameForTiktoken:()=>_n,isOpenAITool:()=>_o});let _n=e=>e.startsWith("gpt-5")?"gpt-5":e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e.startsWith("gpt-4o")?"gpt-4o":e,_a=e=>"text-embedding-ada-002"===e?8191:2046,_s=e=>{switch(_n(e)){case"gpt-5":case"gpt-5-turbo":case"gpt-5-turbo-preview":return 4e5;case"gpt-4o":case"gpt-4o-mini":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4-turbo":case"gpt-4-turbo-preview":case"gpt-4-turbo-2024-04-09":case"gpt-4-0125-preview":case"gpt-4-1106-preview":return 128e3;case"gpt-4-32k":case"gpt-4-32k-0314":case"gpt-4-32k-0613":case"gemini-pro":case"gemini-pro-vision":return 32768;case"gpt-4":case"gpt-4-0314":case"gpt-4-0613":return 8192;case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-16k-0613":return 16384;case"gpt-3.5-turbo":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-1106":case"gpt-3.5-turbo-0125":return 4096;case"text-davinci-003":case"text-davinci-002":default:return 4097;case"text-davinci-001":return 2049;case"text-curie-001":case"text-babbage-001":case"text-ada-001":case"code-cushman-001":return 2048;case"code-davinci-002":case"code-davinci-001":return 8e3;case"claude-3-5-sonnet-20241022":case"claude-3-5-sonnet-20240620":case"claude-3-opus-20240229":case"claude-3-sonnet-20240229":case"claude-3-haiku-20240307":case"claude-2.1":return 2e5;case"claude-2.0":case"claude-instant-1.2":return 1e5;case"gemini-1.5-pro":case"gemini-1.5-pro-latest":case"gemini-1.5-flash":case"gemini-1.5-flash-latest":return 1e6}};function _o(e){return"object"==typeof e&&!!e&&("type"in e&&"function"===e.type&&"function"in e&&"object"==typeof e.function&&!!e.function&&"name"in e.function&&"parameters"in e.function||!1)}let _l=async({prompt:e,modelName:t})=>{let r;try{r=(await _i(_n(t))).encode(e).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),r=Math.ceil(e.length/4)}return _s(t)-r};var _u=class extends gz{verbose;callbacks;tags;metadata;get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),this.verbose=e.verbose??!1,this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}},_c=class extends _u{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}caller;cache;constructor({callbacks:e,callbackManager:t,...r}){const{cache:i,...n}=r;super({callbacks:e??t,...n}),"object"==typeof i?this.cache=i:i?this.cache=y5.global():this.cache=void 0,this.caller=new o3(r??{})}_encoding;async getNumTokens(e){let t,r=Math.ceil((t="string"==typeof e?e:e.map(e=>"string"==typeof e?e:"text"===e.type&&"text"in e?e.text:"").join("")).length/4);if(!this._encoding)try{this._encoding=await _i("modelName"in this?_n(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}if(this._encoding)try{r=this._encoding.encode(t).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return r}static _convertInputToPromptValue(e){return"string"==typeof e?new yW(e):Array.isArray(e)?new yJ(e.map(n4)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){return Object.entries({...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()}).filter(([e,t])=>void 0!==t).map(([e,t])=>`${e}:${JSON.stringify(t)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw Error("Use .toJSON() instead")}get profile(){return{}}},_d=class extends gz{static lc_name(){return"RunnablePassthrough"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;func;constructor(e){super(e),e&&(this.func=e.func)}async invoke(e,t){let r=of(t);return this.func&&await this.func(e,r),this._callWithConfig(e=>Promise.resolve(e),e,r)}async *transform(e,t){let r,i=of(t),n=!0;for await(let t of this._transformStreamWithConfig(e,e=>e,i))if(yield t,n)if(void 0===r)r=t;else try{r=o$(r,t)}catch{r=void 0,n=!1}this.func&&void 0!==r&&await this.func(r,i)}static assign(e){return new gV(new gB({steps:e}))}};function _p(e){return new e.constructor({...e,content:e.contentBlocks,response_metadata:{...e.response_metadata,output_version:"v1"}})}function _h(e){let t=[];for(let r of e){let e=r;if(Array.isArray(r.content))for(let t=0;t<r.content.length;t++){let i=r.content[t];(iR(i)||iL(i))&&e===r&&(e=new r.constructor({...e,content:[...r.content.slice(0,t),iM(i),...r.content.slice(t+1)]}))}t.push(e)}return t}iP({},{BaseChatModel:()=>_m,SimpleChatModel:()=>_f});var _m=class e extends _c{lc_namespace=["langchain","chat_models",this._llmType()];disableStreaming=!1;outputVersion;get callKeys(){return[...super.callKeys,"outputVersion"]}constructor(e){super(e),this.outputVersion=(()=>{let t=e.outputVersion??ag("LC_OUTPUT_VERSION");return t&&["v0","v1"].includes(t)?t:"v0"})()}_separateRunnableConfigFromCallOptionsCompat(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(t,r){let i=e._convertInputToPromptValue(t);return(await this.generatePrompt([i],r,r?.callbacks)).generations[0][0].message}async *_streamResponseChunks(e,t,r){throw Error("Not implemented.")}async *_streamIterator(t,r){if(this._streamResponseChunks===e.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(t,r);else{let i,n,a=e._convertInputToPromptValue(t).toChatMessages(),[s,o]=this._separateRunnableConfigFromCallOptionsCompat(r),l={...s.metadata,...this.getLsParams(o)},u=await os.configure(s.callbacks,this.callbacks,s.tags,this.tags,l,this.metadata,{verbose:this.verbose}),c={options:o,invocation_params:this?.invocationParams(o),batch_size:1},d=o.outputVersion??this.outputVersion,p=await u?.handleChatModelStart(this.toJSON(),[_h(a)],s.runId,void 0,c,void 0,void 0,s.runName);try{for await(let e of this._streamResponseChunks(a,o,p?.[0])){if(null==e.message.id){let t=p?.at(0)?.runId;null!=t&&e.message._updateId(`run-${t}`)}e.message.response_metadata={...e.generationInfo,...e.message.response_metadata},"v1"===d?yield _p(e.message):yield e.message,i=i?i.concat(e):e,nX(e.message)&&void 0!==e.message.usage_metadata&&(n={tokenUsage:{promptTokens:e.message.usage_metadata.input_tokens,completionTokens:e.message.usage_metadata.output_tokens,totalTokens:e.message.usage_metadata.total_tokens}})}}catch(e){throw await Promise.all((p??[]).map(t=>t?.handleLLMError(e))),e}await Promise.all((p??[]).map(e=>e?.handleLLMEnd({generations:[[i]],llmOutput:n})))}}getLsParams(e){let t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(t,r,i,n){let a,s=t.map(e=>e.map(n4));if(void 0!==n&&n.length===s.length)a=n;else{let e={...i.metadata,...this.getLsParams(r)},t=await os.configure(i.callbacks,this.callbacks,i.tags,this.tags,e,this.metadata,{verbose:this.verbose}),n={options:r,invocation_params:this?.invocationParams(r),batch_size:1};a=await t?.handleChatModelStart(this.toJSON(),s.map(_h),i.runId,void 0,n,void 0,void 0,i.runName)}let o=r.outputVersion??this.outputVersion,l=[],u=[];if(a?.[0].handlers.find(av)&&!this.disableStreaming&&1===s.length&&this._streamResponseChunks!==e.prototype._streamResponseChunks)try{let e,t;for await(let i of(await this._streamResponseChunks(s[0],r,a?.[0]))){if(null==i.message.id){let e=a?.at(0)?.runId;null!=e&&i.message._updateId(`run-${e}`)}e=void 0===e?i:o$(e,i),nX(i.message)&&void 0!==i.message.usage_metadata&&(t={tokenUsage:{promptTokens:i.message.usage_metadata.input_tokens,completionTokens:i.message.usage_metadata.output_tokens,totalTokens:i.message.usage_metadata.total_tokens}})}if(void 0===e)throw Error("Received empty response from chat model call.");l.push([e]),await a?.[0].handleLLMEnd({generations:l,llmOutput:t})}catch(e){throw await a?.[0].handleLLMError(e),e}else{let e=await Promise.allSettled(s.map(async(e,t)=>{let i=await this._generate(e,{...r,promptIndex:t},a?.[t]);if("v1"===o)for(let e of i.generations)e.message=_p(e.message);return i}));await Promise.all(e.map(async(e,t)=>{if("fulfilled"!==e.status)return await a?.[t]?.handleLLMError(e.reason),Promise.reject(e.reason);{let r=e.value;for(let e of r.generations){if(null==e.message.id){let t=a?.at(0)?.runId;null!=t&&e.message._updateId(`run-${t}`)}e.message.response_metadata={...e.generationInfo,...e.message.response_metadata}}return 1===r.generations.length&&(r.generations[0].message.response_metadata={...r.llmOutput,...r.generations[0].message.response_metadata}),l[t]=r.generations,u[t]=r.llmOutput,a?.[t]?.handleLLMEnd({generations:[r.generations],llmOutput:r.llmOutput})}}))}let c={generations:l,llmOutput:u.length?this._combineLLMOutput?.(...u):void 0};return Object.defineProperty(c,oQ,{value:a?{runIds:a?.map(e=>e.runId)}:void 0,configurable:!0}),c}async _generateCached({messages:t,cache:r,llmStringKey:i,parsedOptions:n,handledOptions:a}){let s=t.map(e=>e.map(n4)),o={...a.metadata,...this.getLsParams(n)},l=await os.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),u={options:n,invocation_params:this?.invocationParams(n),batch_size:1},c=await l?.handleChatModelStart(this.toJSON(),s.map(_h),a.runId,void 0,u,void 0,void 0,a.runName),d=[],p=(await Promise.allSettled(s.map(async(t,n)=>{let a=e._convertInputToPromptValue(t).toString(),s=await r.lookup(a,i);return null==s&&d.push(n),s}))).map((e,t)=>({result:e,runManager:c?.[t]})).filter(({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status),h=n.outputVersion??this.outputVersion,m=[];await Promise.all(p.map(async({result:e,runManager:t},r)=>{if("fulfilled"!==e.status)return await t?.handleLLMError(e.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(e.reason);{let i=e.value;return m[r]=i.map(e=>("message"in e&&nd(e.message)&&nK(e.message)&&(e.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0},"v1"===h&&(e.message=_p(e.message))),e.generationInfo={...e.generationInfo,tokenUsage:{}},e)),i.length&&await t?.handleLLMNewToken(i[0].text),t?.handleLLMEnd({generations:[i]},void 0,void 0,void 0,{cached:!0})}}));let f={generations:m,missingPromptIndices:d,startedRunManagers:c};return Object.defineProperty(f,oQ,{value:c?{runIds:c?.map(e=>e.runId)}:void 0,configurable:!0}),f}async generate(t,r,i){let n;n=Array.isArray(r)?{stop:r}:r;let a=t.map(e=>e.map(n4)),[s,o]=this._separateRunnableConfigFromCallOptionsCompat(n);if(s.callbacks=s.callbacks??i,!this.cache)return this._generateUncached(a,o,s);let{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d,startedRunManagers:p}=await this._generateCached({messages:a,cache:l,llmStringKey:u,parsedOptions:o,handledOptions:s}),h={};if(d.length>0){let t=await this._generateUncached(d.map(e=>a[e]),o,s,void 0!==p?d.map(e=>p?.[e]):void 0);await Promise.all(t.generations.map(async(t,r)=>{let i=d[r];c[i]=t;let n=e._convertInputToPromptValue(a[i]).toString();return l.update(n,u,t)})),h=t.llmOutput??{}}return{generations:c,llmOutput:h}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}async generatePrompt(e,t,r){let i=e.map(e=>e.toChatMessages());return this.generate(i,t,r)}withStructuredOutput(e,t){let r;if("function"!=typeof this.bindTools)throw Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t?.strict)throw Error('"strict" mode is not supported for this model by default.');let i=t?.name,n=hx(e)??"A function available to call.",a=t?.method,s=t?.includeRaw;if("jsonMode"===a)throw Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let o=i??"extract";hf(e)?r=[{type:"function",function:{name:o,description:n,parameters:gO(e)}}]:("name"in e&&(o=e.name),r=[{type:"function",function:{name:o,description:n,parameters:e}}]);let l=this.bindTools(r),u=gW.from(e=>{if(!nY.isInstance(e))throw Error("Input is not an AIMessageChunk.");if(!e.tool_calls||0===e.tool_calls.length)throw Error("No tool calls found in the response.");let t=e.tool_calls.find(e=>e.name===o);if(!t)throw Error(`No tool call found with name ${o}.`);return t.args});if(!s)return l.pipe(u).withConfig({runName:"StructuredOutput"});let c=_d.assign({parsed:(e,t)=>u.invoke(e.raw,t)}),d=_d.assign({parsed:()=>null}),p=c.withFallbacks({fallbacks:[d]});return gF.from([{raw:l},p]).withConfig({runName:"StructuredOutputRunnable"})}},_f=class extends _m{async _generate(e,t,r){let i=new nV(await this._call(e,t,r));if("string"!=typeof i.content)throw Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:i.content,message:i}]}}},_g=class extends gz{static lc_name(){return"RouterRunnable"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;runnables;constructor(e){super(e),this.runnables=e.runnables}async invoke(e,t){let{key:r,input:i}=e,n=this.runnables[r];if(void 0===n)throw Error(`No runnable associated with key "${r}".`);return n.invoke(i,of(t))}async batch(e,t,r){let i=e.map(e=>e.key),n=e.map(e=>e.input);if(void 0!==i.find(e=>void 0===this.runnables[e]))throw Error("One or more keys do not have a corresponding runnable.");let a=i.map(e=>this.runnables[e]),s=this._getOptionsList(t??{},e.length),o=s[0]?.maxConcurrency??r?.maxConcurrency,l=o&&o>0?o:e.length,u=[];for(let e=0;e<n.length;e+=l){let t=n.slice(e,e+l).map((e,t)=>a[t].invoke(e,s[t])),r=await Promise.all(t);u.push(r)}return u.flat()}async stream(e,t){let{key:r,input:i}=e,n=this.runnables[r];if(void 0===n)throw Error(`No runnable associated with key "${r}".`);return n.stream(i,t)}},_y=class extends gz{static lc_name(){return"RunnableBranch"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;default;branches;constructor(e){super(e),this.branches=e.branches,this.default=e.default}static from(e){if(e.length<1)throw Error("RunnableBranch requires at least one branch");return new this({branches:e.slice(0,-1).map(([e,t])=>[gH(e),gH(t)]),default:gH(e[e.length-1])})}async _invoke(e,t,r){let i;for(let n=0;n<this.branches.length;n+=1){let[a,s]=this.branches[n];if(await a.invoke(e,og(t,{callbacks:r?.getChild(`condition:${n+1}`)}))){i=await s.invoke(e,og(t,{callbacks:r?.getChild(`branch:${n+1}`)}));break}}return i||(i=await this.default.invoke(e,og(t,{callbacks:r?.getChild("branch:default")}))),i}async invoke(e,t={}){return this._callWithConfig(this._invoke,e,t)}async *_streamIterator(e,t){let r,i,n=await op(t),a=await n?.handleChainStart(this.toJSON(),gU(e,"input"),t?.runId,void 0,void 0,void 0,t?.runName),s=!0;try{for(let n=0;n<this.branches.length;n+=1){let[o,l]=this.branches[n];if(await o.invoke(e,og(t,{callbacks:a?.getChild(`condition:${n+1}`)}))){for await(let o of i=await l.stream(e,og(t,{callbacks:a?.getChild(`branch:${n+1}`)})))if(yield o,s)if(void 0===r)r=o;else try{r=o$(r,o)}catch{r=void 0,s=!1}break}}if(void 0===i){for await(let n of i=await this.default.stream(e,og(t,{callbacks:a?.getChild("branch:default")})))if(yield n,s)if(void 0===r)r=n;else try{r=o$(r,n)}catch{r=void 0,s=!1}}}catch(e){throw await a?.handleChainError(e),e}await a?.handleChainEnd(r??{})}},__=class extends gM{runnable;inputMessagesKey;outputMessagesKey;historyMessagesKey;getMessageHistory;constructor(e){let t=gW.from((e,t)=>this._enterHistory(e,t??{})).withConfig({runName:"loadHistory"});const r=e.historyMessagesKey??e.inputMessagesKey;r&&(t=_d.assign({[r]:t}).withConfig({runName:"insertHistory"})),super({...e,config:e.config??{},bound:t.pipe(e.runnable.withListeners({onEnd:(e,t)=>this._exitHistory(e,t??{})})).withConfig({runName:"RunnableWithMessageHistory"})}),this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let t;if("object"!=typeof e||Array.isArray(e)||nd(e))t=e;else{let r;r=this.inputMessagesKey?this.inputMessagesKey:1===Object.keys(e).length?Object.keys(e)[0]:"input",t=Array.isArray(e[r])&&Array.isArray(e[r][0])?e[r][0]:e[r]}if("string"==typeof t)return[new nA(t)];if(Array.isArray(t))return t;if(nd(t))return[t];throw Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(t,null,2)}`)}_getOutputMessages(e){let t;if(Array.isArray(e)||nd(e)||"string"==typeof e)t=e;else{let r;r=void 0!==this.outputMessagesKey?this.outputMessagesKey:1===Object.keys(e).length?Object.keys(e)[0]:"output",t=void 0!==e.generations?e.generations[0][0].message:e[r]}if("string"==typeof t)return[new nV(t)];if(Array.isArray(t))return t;if(nd(t))return[t];throw Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(t,null,2)}`)}async _enterHistory(e,t){let r=t?.configurable?.messageHistory,i=await r.getMessages();return void 0===this.historyMessagesKey?i.concat(this._getInputMessages(e)):i}async _exitHistory(e,t){let r,i=t.configurable?.messageHistory;r=Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?e.inputs[0]:e.inputs;let n=this._getInputMessages(r);if(void 0===this.historyMessagesKey){let e=await i.getMessages();n=n.slice(e.length)}let a=e.outputs;if(!a)throw Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);let s=this._getOutputMessages(a);await i.addMessages([...n,...s])}async _mergeConfig(...e){let t=await super._mergeConfig(...e);if(!t.configurable||!t.configurable.sessionId){let e={[this.inputMessagesKey??"input"]:"foo"};throw Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(e)}, ${JSON.stringify({configurable:{sessionId:"123"}})})`)}let{sessionId:r}=t.configurable;return t.configurable.messageHistory=await this.getMessageHistory(r),t}};iP({},{RouterRunnable:()=>_g,Runnable:()=>gz,RunnableAssign:()=>gV,RunnableBinding:()=>gM,RunnableBranch:()=>_y,RunnableEach:()=>gD,RunnableLambda:()=>gW,RunnableMap:()=>gB,RunnableParallel:()=>gJ,RunnablePassthrough:()=>_d,RunnablePick:()=>gK,RunnableRetry:()=>gZ,RunnableSequence:()=>gF,RunnableToolLike:()=>gX,RunnableWithFallbacks:()=>gG,RunnableWithMessageHistory:()=>__,_coerceToRunnable:()=>gH,ensureConfig:()=>of,getCallbackManagerForConfig:()=>op,mergeConfigs:()=>oh,patchConfig:()=>og,pickRunnableConfigKeys:()=>oy,raceWithSignal:()=>o_});var _v=class extends gz{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return"string"==typeof e.content?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return"string"==typeof e?this._callWithConfig(async(e,t)=>this.parseResult([{text:e}],t?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(e,t)=>this.parseResult([{message:e,text:this._baseMessageToString(e)}],t?.callbacks),e,{...t,runType:"parser"})}},_b=class extends _v{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw Error("_type not implemented")}},_w=class extends Error{llmOutput;observation;sendToLLM;constructor(e,t,r,i=!1){if(super(e),this.llmOutput=t,this.observation=r,this.sendToLLM=i,i&&(void 0===r||void 0===t))throw Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");nM(this,"OUTPUT_PARSING_FAILURE")}},_$=class extends _b{async *_transform(e){for await(let t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async *transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}},_x=class extends _${diff=!1;constructor(e){super(e),this.diff=e?.diff??this.diff}async *_transform(e){let t,r;for await(let i of e){let e;if("string"!=typeof i&&"string"!=typeof i.content)throw Error("Cannot handle non-string output.");if(np(i)){if("string"!=typeof i.content)throw Error("Cannot handle non-string message output.");e=new o1({message:i,text:i.content})}else if(nd(i)){if("string"!=typeof i.content)throw Error("Cannot handle non-string message output.");e=new o1({message:n3(i),text:i.content})}else e=new o0({text:i});r=void 0===r?e:r.concat(e);let n=await this.parsePartialResult([r]);null==n||gs(n,t)||(this.diff?yield this._diff(t,n):yield n,t=n)}}getFormatInstructions(){return""}};iP({},{applyPatch:()=>oZ,compare:()=>oJ});var _k=class extends _x{static lc_name(){return"JsonOutputParser"}lc_namespace=["langchain_core","output_parsers"];lc_serializable=!0;_concatOutputChunks(e,t){return this.diff?super._concatOutputChunks(e,t):t}_diff(e,t){if(t)return e?oJ(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return nF(e[0].text)}async parse(e){return nF(e,JSON.parse)}getFormatInstructions(){return""}},_I=class extends _${static lc_name(){return"BytesOutputParser"}lc_namespace=["langchain_core","output_parsers","bytes"];lc_serializable=!0;textEncoder=new TextEncoder;parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}},_O=class extends _${re;async *_transform(e){let t="";for await(let r of e)if("string"==typeof r?t+=r:t+=r.content,this.re){let e=[...t.matchAll(this.re)];if(e.length>1){let r=0;for(let t of e.slice(0,-1))yield[t[1]],r+=(t.index??0)+t[0].length;t=t.slice(r)}}else{let e=await this.parse(t);if(e.length>1){for(let t of e.slice(0,-1))yield[t];t=e[e.length-1]}}for(let e of(await this.parse(t)))yield[e]}},_S=class extends _O{static lc_name(){return"CommaSeparatedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;async parse(e){try{return e.trim().split(",").map(e=>e.trim())}catch{throw new _w(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}},_E=class extends _O{lc_namespace=["langchain_core","output_parsers","list"];length;separator;constructor({length:e,separator:t}){super(...arguments),this.length=e,this.separator=t||","}async parse(e){try{let t=e.trim().split(this.separator).map(e=>e.trim());if(void 0!==this.length&&t.length!==this.length)throw new _w(`Incorrect number of items. Expected ${this.length}, got ${t.length}.`);return t}catch(t){if(Object.getPrototypeOf(t)===_w.prototype)throw t;throw new _w(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${void 0===this.length?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}},_T=class extends _O{static lc_name(){return"NumberedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}re=/\d+\.\s([^\n]+)/g;async parse(e){return[...e.matchAll(this.re)??[]].map(e=>e[1])}},_A=class extends _O{static lc_name(){return"NumberedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}re=/^\s*[-*]\s([^\n]+)$/gm;async parse(e){return[...e.matchAll(this.re)??[]].map(e=>e[1])}},_N=class extends _${static lc_name(){return"StrOutputParser"}lc_namespace=["langchain_core","output_parsers","string"];lc_serializable=!0;parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw Error(`Cannot coerce "${e.type}" message part into a string.`)}throw Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((e,t)=>e+this._messageContentToString(t),"")}},gL=gL,_C=class extends _b{static lc_name(){return"StructuredOutputParser"}lc_namespace=["langchain","output_parsers","structured"];toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),this.schema=e}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(gL.object(Object.fromEntries(Object.entries(e).map(([e,t])=>[e,gL.string().describe(t)]))))}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(gO(this.schema))}
\`\`\`
`}async parse(e){try{let t=e.trim(),r=(t.match(/^```(?:json)?\s*([\s\S]*?)```/)?.[1]||t.match(/```json\s*([\s\S]*?)```/)?.[1]||t).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(e,t)=>{let r=t.replace(/\n/g,"\\n");return`"${r}"`}).replace(/\n/g,"");return await hb(this.schema,JSON.parse(r))}catch(t){throw new _w(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}},_P=class extends _C{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(e){let t=e?.interpolationDepth??1;if(t<1)throw Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(gO(this.schema)).replaceAll("{","{".repeat(t)).replaceAll("}","}".repeat(t))}
\`\`\``}_schemaToInstruction(e,t=2){if("type"in e){let r,i=!1;if(Array.isArray(e.type)){let t=e.type.findIndex(e=>"null"===e);-1!==t&&(i=!0,e.type.splice(t,1)),r=e.type.join(" | ")}else r=e.type;if("object"===e.type&&e.properties){let r=e.description?` // ${e.description}`:"",i=Object.entries(e.properties).map(([r,i])=>{let n=e.required?.includes(r)?"":" (optional)";return`${" ".repeat(t)}"${r}": ${this._schemaToInstruction(i,t+2)}${n}`}).join("\n");return`{
${i}
${" ".repeat(t-2)}}${r}`}if("array"===e.type&&e.items){let r=e.description?` // ${e.description}`:"";return`array[
${" ".repeat(t)}${this._schemaToInstruction(e.items,t+2)}
${" ".repeat(t-2)}] ${r}`}let n=i?" (nullable)":"",a=e.description?` // ${e.description}`:"";return`${r}${a}${n}`}if("anyOf"in e)return e.anyOf.map(e=>this._schemaToInstruction(e,t)).join(`
${" ".repeat(t-2)}`);throw Error("unsupported schema type")}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(gL.object(Object.fromEntries(Object.entries(e).map(([e,t])=>[e,gL.string().describe(t)]))))}},_j=class extends _b{structuredInputParser;constructor({inputSchema:e}){super(...arguments),this.structuredInputParser=new _P(e)}async parse(e){let t;try{t=await this.structuredInputParser.parse(e)}catch(t){throw new _w(`Failed to parse. Text: "${e}". Error: ${t}`,e)}return this.outputProcessor(t)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}};let _R=function(){let e={};e.parser=function(e,t){return new r(e,t)},e.SAXParser=r,e.SAXStream=l,e.createStream=function(e,t){return new l(e,t)},e.MAX_BUFFER_LENGTH=65536;let t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function r(i,n){if(!(this instanceof r))return new r(i,n);(function(e){for(var r=0,i=t.length;r<i;r++)e[t[r]]=""})(this),this.q=this.c="",this.bufferCheckPosition=e.MAX_BUFFER_LENGTH,this.opt=n||{},this.opt.lowercase=this.opt.lowercase||this.opt.lowercasetags,this.looseCase=this.opt.lowercase?"toLowerCase":"toUpperCase",this.tags=[],this.closed=this.closedRoot=this.sawRoot=!1,this.tag=this.error=null,this.strict=!!i,this.noscript=!!(i||this.opt.noscript),this.state=v.BEGIN,this.strictEntities=this.opt.strictEntities,this.ENTITIES=this.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),this.attribList=[],this.opt.xmlns&&(this.ns=Object.create(d)),this.trackPosition=!1!==this.opt.position,this.trackPosition&&(this.position=this.line=this.column=0),w(this,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}),r.prototype={end:function(){O(this)},write:function(r){if(this.error)throw this.error;if(this.closed)return I(this,"Cannot write after close. Assign an onready handler.");if(null===r)return O(this);"object"==typeof r&&(r=r.toString());for(var i=0,n="";n=j(r,i++),this.c=n,n;)switch(this.trackPosition&&(this.position++,"\n"===n?(this.line++,this.column=0):this.column++),this.state){case v.BEGIN:if(this.state=v.BEGIN_WHITESPACE,"\uFEFF"===n)continue;P(this,n);continue;case v.BEGIN_WHITESPACE:P(this,n);continue;case v.TEXT:if(this.sawRoot&&!this.closedRoot){for(var a=i-1;n&&"<"!==n&&"&"!==n;)(n=j(r,i++))&&this.trackPosition&&(this.position++,"\n"===n?(this.line++,this.column=0):this.column++);this.textNode+=r.substring(a,i-1)}"<"!==n||this.sawRoot&&this.closedRoot&&!this.strict?(g(n)||this.sawRoot&&!this.closedRoot||S(this,"Text data outside of root node."),"&"===n?this.state=v.TEXT_ENTITY:this.textNode+=n):(this.state=v.OPEN_WAKA,this.startTagPosition=this.position);continue;case v.SCRIPT:"<"===n?this.state=v.SCRIPT_ENDING:this.script+=n;continue;case v.SCRIPT_ENDING:"/"===n?this.state=v.CLOSE_TAG:(this.script+="<"+n,this.state=v.SCRIPT);continue;case v.OPEN_WAKA:"!"===n?(this.state=v.SGML_DECL,this.sgmlDecl=""):g(n)||(_(p,n)?(this.state=v.OPEN_TAG,this.tagName=n):"/"===n?(this.state=v.CLOSE_TAG,this.tagName=""):"?"===n?(this.state=v.PROC_INST,this.procInstName=this.procInstBody=""):(S(this,"Unencoded <"),this.startTagPosition+1<this.position&&(n=Array(this.position-this.startTagPosition).join(" ")+n),this.textNode+="<"+n,this.state=v.TEXT));continue;case v.SGML_DECL:"[CDATA["===(this.sgmlDecl+n).toUpperCase()?($(this,"onopencdata"),this.state=v.CDATA,this.sgmlDecl="",this.cdata=""):this.sgmlDecl+n==="--"?(this.state=v.COMMENT,this.comment="",this.sgmlDecl=""):"DOCTYPE"===(this.sgmlDecl+n).toUpperCase()?(this.state=v.DOCTYPE,(this.doctype||this.sawRoot)&&S(this,"Inappropriately located doctype declaration"),this.doctype="",this.sgmlDecl=""):">"===n?($(this,"onsgmldeclaration",this.sgmlDecl),this.sgmlDecl="",this.state=v.TEXT):(y(n)&&(this.state=v.SGML_DECL_QUOTED),this.sgmlDecl+=n);continue;case v.SGML_DECL_QUOTED:n===this.q&&(this.state=v.SGML_DECL,this.q=""),this.sgmlDecl+=n;continue;case v.DOCTYPE:">"===n?(this.state=v.TEXT,$(this,"ondoctype",this.doctype),this.doctype=!0):(this.doctype+=n,"["===n?this.state=v.DOCTYPE_DTD:y(n)&&(this.state=v.DOCTYPE_QUOTED,this.q=n));continue;case v.DOCTYPE_QUOTED:this.doctype+=n,n===this.q&&(this.q="",this.state=v.DOCTYPE);continue;case v.DOCTYPE_DTD:this.doctype+=n,"]"===n?this.state=v.DOCTYPE:y(n)&&(this.state=v.DOCTYPE_DTD_QUOTED,this.q=n);continue;case v.DOCTYPE_DTD_QUOTED:this.doctype+=n,n===this.q&&(this.state=v.DOCTYPE_DTD,this.q="");continue;case v.COMMENT:"-"===n?this.state=v.COMMENT_ENDING:this.comment+=n;continue;case v.COMMENT_ENDING:"-"===n?(this.state=v.COMMENT_ENDED,this.comment=k(this.opt,this.comment),this.comment&&$(this,"oncomment",this.comment),this.comment=""):(this.comment+="-"+n,this.state=v.COMMENT);continue;case v.COMMENT_ENDED:">"!==n?(S(this,"Malformed comment"),this.comment+="--"+n,this.state=v.COMMENT):this.state=v.TEXT;continue;case v.CDATA:"]"===n?this.state=v.CDATA_ENDING:this.cdata+=n;continue;case v.CDATA_ENDING:"]"===n?this.state=v.CDATA_ENDING_2:(this.cdata+="]"+n,this.state=v.CDATA);continue;case v.CDATA_ENDING_2:">"===n?(this.cdata&&$(this,"oncdata",this.cdata),$(this,"onclosecdata"),this.cdata="",this.state=v.TEXT):"]"===n?this.cdata+="]":(this.cdata+="]]"+n,this.state=v.CDATA);continue;case v.PROC_INST:"?"===n?this.state=v.PROC_INST_ENDING:g(n)?this.state=v.PROC_INST_BODY:this.procInstName+=n;continue;case v.PROC_INST_BODY:!this.procInstBody&&g(n)||("?"===n?this.state=v.PROC_INST_ENDING:this.procInstBody+=n);continue;case v.PROC_INST_ENDING:">"===n?($(this,"onprocessinginstruction",{name:this.procInstName,body:this.procInstBody}),this.procInstName=this.procInstBody="",this.state=v.TEXT):(this.procInstBody+="?"+n,this.state=v.PROC_INST_BODY);continue;case v.OPEN_TAG:_(h,n)?this.tagName+=n:(!function(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,r=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(r.ns=t.ns),e.attribList.length=0,$(e,"onopentagstart",r)}(this),">"===n?A(this):"/"===n?this.state=v.OPEN_TAG_SLASH:(g(n)||S(this,"Invalid character in tag name"),this.state=v.ATTRIB));continue;case v.OPEN_TAG_SLASH:">"===n?(A(this,!0),N(this)):(S(this,"Forward-slash in opening tag not followed by >"),this.state=v.ATTRIB);continue;case v.ATTRIB:g(n)||(">"===n?A(this):"/"===n?this.state=v.OPEN_TAG_SLASH:_(p,n)?(this.attribName=n,this.attribValue="",this.state=v.ATTRIB_NAME):S(this,"Invalid attribute name"));continue;case v.ATTRIB_NAME:"="===n?this.state=v.ATTRIB_VALUE:">"===n?(S(this,"Attribute without value"),this.attribValue=this.attribName,T(this),A(this)):g(n)?this.state=v.ATTRIB_NAME_SAW_WHITE:_(h,n)?this.attribName+=n:S(this,"Invalid attribute name");continue;case v.ATTRIB_NAME_SAW_WHITE:if("="===n)this.state=v.ATTRIB_VALUE;else{if(g(n))continue;S(this,"Attribute without value"),this.tag.attributes[this.attribName]="",this.attribValue="",$(this,"onattribute",{name:this.attribName,value:""}),this.attribName="",">"===n?A(this):_(p,n)?(this.attribName=n,this.state=v.ATTRIB_NAME):(S(this,"Invalid attribute name"),this.state=v.ATTRIB)}continue;case v.ATTRIB_VALUE:g(n)||(y(n)?(this.q=n,this.state=v.ATTRIB_VALUE_QUOTED):(S(this,"Unquoted attribute value"),this.state=v.ATTRIB_VALUE_UNQUOTED,this.attribValue=n));continue;case v.ATTRIB_VALUE_QUOTED:if(n!==this.q){"&"===n?this.state=v.ATTRIB_VALUE_ENTITY_Q:this.attribValue+=n;continue}T(this),this.q="",this.state=v.ATTRIB_VALUE_CLOSED;continue;case v.ATTRIB_VALUE_CLOSED:g(n)?this.state=v.ATTRIB:">"===n?A(this):"/"===n?this.state=v.OPEN_TAG_SLASH:_(p,n)?(S(this,"No whitespace between attributes"),this.attribName=n,this.attribValue="",this.state=v.ATTRIB_NAME):S(this,"Invalid attribute name");continue;case v.ATTRIB_VALUE_UNQUOTED:if(!(">"===(s=n)||g(s))){"&"===n?this.state=v.ATTRIB_VALUE_ENTITY_U:this.attribValue+=n;continue}T(this),">"===n?A(this):this.state=v.ATTRIB;continue;case v.CLOSE_TAG:this.tagName?">"===n?N(this):_(h,n)?this.tagName+=n:this.script?(this.script+="</"+this.tagName,this.tagName="",this.state=v.SCRIPT):(g(n)||S(this,"Invalid tagname in closing tag"),this.state=v.CLOSE_TAG_SAW_WHITE):g(n)||(_(p,n)?this.tagName=n:this.script?(this.script+="</"+n,this.state=v.SCRIPT):S(this,"Invalid tagname in closing tag."));continue;case v.CLOSE_TAG_SAW_WHITE:if(g(n))continue;">"===n?N(this):S(this,"Invalid characters in closing tag");continue;case v.TEXT_ENTITY:case v.ATTRIB_VALUE_ENTITY_Q:case v.ATTRIB_VALUE_ENTITY_U:switch(this.state){case v.TEXT_ENTITY:o=v.TEXT,l="textNode";break;case v.ATTRIB_VALUE_ENTITY_Q:o=v.ATTRIB_VALUE_QUOTED,l="attribValue";break;case v.ATTRIB_VALUE_ENTITY_U:o=v.ATTRIB_VALUE_UNQUOTED,l="attribValue"}if(";"===n)if(this.opt.unparsedEntities){var s,o,l,u=C(this);this.entity="",this.state=o,this.write(u)}else this[l]+=C(this),this.entity="",this.state=o;else _(this.entity.length?f:m,n)?this.entity+=n:(S(this,"Invalid character in entity name"),this[l]+="&"+this.entity+n,this.entity="",this.state=o);continue;default:throw Error(this,"Unknown state: "+this.state)}return this.position>=this.bufferCheckPosition&&function(r){for(var i=Math.max(e.MAX_BUFFER_LENGTH,10),n=0,a=0,s=t.length;a<s;a++){var o=r[t[a]].length;if(o>i)switch(t[a]){case"textNode":x(r);break;case"cdata":$(r,"oncdata",r.cdata),r.cdata="";break;case"script":$(r,"onscript",r.script),r.script="";break;default:I(r,"Max buffer length exceeded: "+t[a])}n=Math.max(n,o)}r.bufferCheckPosition=e.MAX_BUFFER_LENGTH-n+r.position}(this),this},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){x(this),""!==this.cdata&&($(this,"oncdata",this.cdata),this.cdata=""),""!==this.script&&($(this,"onscript",this.script),this.script="")}};var i,n,a,s=ReadableStream;s||(s=function(){});var o=e.EVENTS.filter(function(e){return"error"!==e&&"end"!==e});function l(e,t){if(!(this instanceof l))return new l(e,t);s.apply(this),this._parser=new r(e,t),this.writable=!0,this.readable=!0;var i=this;this._parser.onend=function(){i.emit("end")},this._parser.onerror=function(e){i.emit("error",e),i._parser.error=null},this._decoder=null,o.forEach(function(e){Object.defineProperty(i,"on"+e,{get:function(){return i._parser["on"+e]},set:function(t){if(!t)return i.removeAllListeners(e),i._parser["on"+e]=t,t;i.on(e,t)},enumerable:!0,configurable:!1})})}l.prototype=Object.create(s.prototype,{constructor:{value:l}}),l.prototype.write=function(e){return this._parser.write(e.toString()),this.emit("data",e),!0},l.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},l.prototype.on=function(e,t){var r=this;return r._parser["on"+e]||-1===o.indexOf(e)||(r._parser["on"+e]=function(){var t=1==arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),r.emit.apply(r,t)}),s.prototype.on.call(r,e,t)};var u="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/2000/xmlns/",d={xml:u,xmlns:c},p=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,h=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,m=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,f=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function g(e){return" "===e||"\n"===e||"\r"===e||"	"===e}function y(e){return'"'===e||"'"===e}function _(e,t){return e.test(t)}var v=0;for(var b in e.STATE={BEGIN:v++,BEGIN_WHITESPACE:v++,TEXT:v++,TEXT_ENTITY:v++,OPEN_WAKA:v++,SGML_DECL:v++,SGML_DECL_QUOTED:v++,DOCTYPE:v++,DOCTYPE_QUOTED:v++,DOCTYPE_DTD:v++,DOCTYPE_DTD_QUOTED:v++,COMMENT_STARTING:v++,COMMENT:v++,COMMENT_ENDING:v++,COMMENT_ENDED:v++,CDATA:v++,CDATA_ENDING:v++,CDATA_ENDING_2:v++,PROC_INST:v++,PROC_INST_BODY:v++,PROC_INST_ENDING:v++,OPEN_TAG:v++,OPEN_TAG_SLASH:v++,ATTRIB:v++,ATTRIB_NAME:v++,ATTRIB_NAME_SAW_WHITE:v++,ATTRIB_VALUE:v++,ATTRIB_VALUE_QUOTED:v++,ATTRIB_VALUE_CLOSED:v++,ATTRIB_VALUE_UNQUOTED:v++,ATTRIB_VALUE_ENTITY_Q:v++,ATTRIB_VALUE_ENTITY_U:v++,CLOSE_TAG:v++,CLOSE_TAG_SAW_WHITE:v++,SCRIPT:v++,SCRIPT_ENDING:v++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(t){var r=e.ENTITIES[t],i="number"==typeof r?String.fromCharCode(r):r;e.ENTITIES[t]=i}),e.STATE)e.STATE[e.STATE[b]]=b;function w(e,t,r){e[t]&&e[t](r)}function $(e,t,r){e.textNode&&x(e),w(e,t,r)}function x(e){e.textNode=k(e.opt,e.textNode),e.textNode&&w(e,"ontext",e.textNode),e.textNode=""}function k(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function I(e,t){return x(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),e.error=t=Error(t),w(e,"onerror",t),e}function O(e){return e.sawRoot&&!e.closedRoot&&S(e,"Unclosed root tag"),e.state!==v.BEGIN&&e.state!==v.BEGIN_WHITESPACE&&e.state!==v.TEXT&&I(e,"Unexpected end"),x(e),e.c="",e.closed=!0,w(e,"onend"),r.call(e,e.strict,e.opt),e}function S(e,t){if("object"!=typeof e||!(e instanceof r))throw Error("bad call to strictFail");e.strict&&I(e,t)}function E(e,t){var r=0>e.indexOf(":")?["",e]:e.split(":"),i=r[0],n=r[1];return t&&"xmlns"===e&&(i="xmlns",n=""),{prefix:i,local:n}}function T(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName)){e.attribName=e.attribValue="";return}if(e.opt.xmlns){var t=E(e.attribName,!0),r=t.prefix,i=t.local;if("xmlns"===r)if("xml"===i&&e.attribValue!==u)S(e,"xml: prefix must be bound to "+u+"\nActual: "+e.attribValue);else if("xmlns"===i&&e.attribValue!==c)S(e,"xmlns: prefix must be bound to "+c+"\nActual: "+e.attribValue);else{var n=e.tag,a=e.tags[e.tags.length-1]||e;n.ns===a.ns&&(n.ns=Object.create(a.ns)),n.ns[i]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,$(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}function A(e,t){if(e.opt.xmlns){var r=e.tag,i=E(e.tagName);r.prefix=i.prefix,r.local=i.local,r.uri=r.ns[i.prefix]||"",r.prefix&&!r.uri&&(S(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),r.uri=i.prefix);var n=e.tags[e.tags.length-1]||e;r.ns&&n.ns!==r.ns&&Object.keys(r.ns).forEach(function(t){$(e,"onopennamespace",{prefix:t,uri:r.ns[t]})});for(var a=0,s=e.attribList.length;a<s;a++){var o=e.attribList[a],l=o[0],u=o[1],c=E(l,!0),d=c.prefix,p=c.local,h=""===d?"":r.ns[d]||"",m={name:l,value:u,prefix:d,local:p,uri:h};d&&"xmlns"!==d&&!h&&(S(e,"Unbound namespace prefix: "+JSON.stringify(d)),m.uri=d),e.tag.attributes[l]=m,$(e,"onattribute",m)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),$(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=v.TEXT:e.state=v.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function N(e){if(!e.tagName){S(e,"Weird empty close tag."),e.textNode+="</>",e.state=v.TEXT;return}if(e.script){if("script"!==e.tagName){e.script+="</"+e.tagName+">",e.tagName="",e.state=v.SCRIPT;return}$(e,"onscript",e.script),e.script=""}var t=e.tags.length,r=e.tagName;e.strict||(r=r[e.looseCase]());for(var i=r;t--;)if(e.tags[t].name!==i)S(e,"Unexpected close tag");else break;if(t<0){S(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",e.state=v.TEXT;return}e.tagName=r;for(var n=e.tags.length;n-- >t;){var a=e.tag=e.tags.pop();e.tagName=e.tag.name,$(e,"onclosetag",e.tagName);var s={};for(var o in a.ns)s[o]=a.ns[o];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&a.ns!==l.ns&&Object.keys(a.ns).forEach(function(t){var r=a.ns[t];$(e,"onclosenamespace",{prefix:t,uri:r})})}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=v.TEXT}function C(e){var t,r=e.entity,i=r.toLowerCase(),n="";return e.ENTITIES[r]?e.ENTITIES[r]:e.ENTITIES[i]?e.ENTITIES[i]:("#"===(r=i).charAt(0)&&(n="x"===r.charAt(1)?(t=parseInt(r=r.slice(2),16)).toString(16):(t=parseInt(r=r.slice(1),10)).toString(10)),r=r.replace(/^0+/,""),isNaN(t)||n.toLowerCase()!==r)?(S(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t)}function P(e,t){"<"===t?(e.state=v.OPEN_WAKA,e.startTagPosition=e.position):g(t)||(S(e,"Non-whitespace before first tag."),e.textNode=t,e.state=v.TEXT)}function j(e,t){var r="";return t<e.length&&(r=e.charAt(t)),r}return v=e.STATE,String.fromCodePoint||(i=String.fromCharCode,n=Math.floor,a=function(){var e,t,r=[],a=-1,s=arguments.length;if(!s)return"";for(var o="";++a<s;){var l=Number(arguments[a]);if(!isFinite(l)||l<0||l>1114111||n(l)!==l)throw RangeError("Invalid code point: "+l);l<=65535?r.push(l):(l-=65536,e=(l>>10)+55296,t=l%1024+56320,r.push(e,t)),(a+1===s||r.length>16384)&&(o+=i.apply(null,r),r.length=0)}return o},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:a,configurable:!0,writable:!0}):String.fromCodePoint=a),e}(),_L=`The output should be formatted as a XML file.
1. Output should conform to the tags below. 
2. If tags are not given, make them on your own.
3. Remember to always open and close all the tags.

As an example, for the tags ["foo", "bar", "baz"]:
1. String "<foo>
   <bar>
      <baz></baz>
   </bar>
</foo>" is a well-formatted instance of the schema. 
2. String "<foo>
   <bar>
   </foo>" is a badly-formatted instance.
3. String "<foo>
   <tag>
   </tag>
</foo>" is a badly-formatted instance.

Here are the output tags:
\`\`\`
{tags}
\`\`\``;var _U=class extends _x{tags;constructor(e){super(e),this.tags=e?.tags}static lc_name(){return"XMLOutputParser"}lc_namespace=["langchain_core","output_parsers"];lc_serializable=!0;_diff(e,t){if(t)return e?oJ(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return _M(e[0].text)}async parse(e){return _M(e)}getFormatInstructions(){return this.tags&&this.tags.length>0?_L.replace("{tags}",this.tags?.join(", ")??""):_L}};let _z=e=>{if(0===Object.keys(e).length)return{};let t={};return e.children.length>0?t[e.name]=e.children.map(_z):t[e.name]=e.text??void 0,t};function _M(e){let t=e.split("\n").map(e=>e.replace(/^\s+/,"")).join("\n").trim(),r=_R.parser(!0),i={},n=[];r.onopentag=e=>{let t={name:e.name,attributes:e.attributes,children:[],text:"",isSelfClosing:e.isSelfClosing};n.length>0?n[n.length-1].children.push(t):i=t,e.isSelfClosing||n.push(t)},r.onclosetag=()=>{if(n.length>0){let e=n.pop();0===n.length&&e&&(i=e)}},r.ontext=e=>{if(n.length>0){let t=n[n.length-1];t.text+=e}},r.onattribute=e=>{n.length>0&&(n[n.length-1].attributes[e.name]=e.value)};let a=/```(xml)?(.*)```/s.exec(t),s=a?a[2]:t;return r.write(s).close(),i&&"?xml"===i.name&&(i=i.children[0]),_z(i)}function _D(e,t){let r;if(void 0===e.function)return;if(t?.partial)try{r=nB(e.function.arguments??"{}")}catch{return}else try{r=JSON.parse(e.function.arguments)}catch(t){throw new _w([`Function "${e.function.name}" arguments:`,"",e.function.arguments,"\nare not valid JSON.",`Error: ${t.message}`].join("\n"))}let i={name:e.function.name,args:r,type:"tool_call"};return t?.returnId&&(i.id=e.id),i}function _Z(e){if(void 0===e.id)throw Error('All OpenAI tool calls must have an "id" field.');return{id:e.id,type:"function",function:{name:e.name,arguments:JSON.stringify(e.args)}}}function _F(e,t){return{name:e.function?.name,args:e.function?.arguments,id:e.id,error:t,type:"invalid_tool_call"}}iP({},{AsymmetricStructuredOutputParser:()=>_j,BaseCumulativeTransformOutputParser:()=>_x,BaseLLMOutputParser:()=>_v,BaseOutputParser:()=>_b,BaseTransformOutputParser:()=>_$,BytesOutputParser:()=>_I,CommaSeparatedListOutputParser:()=>_S,CustomListOutputParser:()=>_E,JsonMarkdownStructuredOutputParser:()=>_P,JsonOutputParser:()=>_k,ListOutputParser:()=>_O,MarkdownListOutputParser:()=>_A,NumberedListOutputParser:()=>_T,OutputParserException:()=>_w,StringOutputParser:()=>_N,StructuredOutputParser:()=>_C,XMLOutputParser:()=>_U,XML_FORMAT_INSTRUCTIONS:()=>_L,parseJsonMarkdown:()=>nF,parsePartialJson:()=>nB,parseXMLMarkdown:()=>_M});var _B=class extends _x{static lc_name(){return"JsonOutputToolsParser"}returnId=!1;lc_namespace=["langchain","output_parsers","openai_tools"];lc_serializable=!0;constructor(e){super(e),this.returnId=e?.returnId??this.returnId}_diff(){throw Error("Not supported.")}async parse(){throw Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){let r,i=e[0].message;if(nK(i)&&i.tool_calls?.length?r=i.tool_calls.map(e=>{let{id:t,...r}=e;return this.returnId?{id:t,...r}:r}):void 0!==i.additional_kwargs.tool_calls&&(r=JSON.parse(JSON.stringify(i.additional_kwargs.tool_calls)).map(e=>_D(e,{returnId:this.returnId,partial:t}))),!r)return[];let n=[];for(let e of r)if(void 0!==e){let t={type:e.name,args:e.args,id:e.id};n.push(t)}return n}},_q=class extends _B{static lc_name(){return"JsonOutputKeyToolsParser"}lc_namespace=["langchain","output_parsers","openai_tools"];lc_serializable=!0;returnId=!1;keyName;returnSingle=!1;zodSchema;constructor(e){super(e),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(void 0===this.zodSchema)return e;let t=await hv(this.zodSchema,e);if(t.success)return t.data;throw new _w(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error?.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){let t=(await super.parsePartialResult(e)).filter(e=>e.type===this.keyName),r=t;if(t.length)return(this.returnId||(r=t.map(e=>e.args)),this.returnSingle)?r[0]:r}async parseResult(e){let t=(await super.parsePartialResult(e,!1)).filter(e=>e.type===this.keyName),r=t;return t.length?(this.returnId||(r=t.map(e=>e.args)),this.returnSingle)?this._validateResult(r[0]):await Promise.all(r.map(e=>this._validateResult(e))):void 0}};iP({},{JsonOutputKeyToolsParser:()=>_q,JsonOutputToolsParser:()=>_B,convertLangChainToolCallToOpenAI:()=>_Z,makeInvalidToolCall:()=>_F,parseToolCall:()=>_D});var _W=class extends _m{temperature;topP;frequencyPenalty;presencePenalty;n;logitBias;model="gpt-3.5-turbo";modelKwargs;stop;stopSequences;user;timeout;streaming=!1;streamUsage=!0;maxTokens;logprobs;topLogprobs;apiKey;organization;__includeRawResponse;client;clientConfig;supportsStrictToolCalling;audio;modalities;reasoning;zdrEnabled;service_tier;promptCacheKey;verbosity;defaultOptions;_llmType(){return"openai"}static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning","service_tier"]}lc_serializable=!0;get lc_secrets(){return{apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{apiKey:"openai_api_key",modelName:"model"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","model","modelName","modelKwargs","stop","stopSequences","timeout","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","zdrEnabled","reasoning","promptCacheKey","verbosity"]}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}constructor(e){super(e??{});const t="string"==typeof e?.configuration?.apiKey||"function"==typeof e?.configuration?.apiKey?e?.configuration?.apiKey:void 0;this.apiKey=e?.apiKey??t??ag("OPENAI_API_KEY"),this.organization=e?.configuration?.organization??ag("OPENAI_ORGANIZATION"),this.model=e?.model??e?.modelName??this.model,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this.stop,this.user=e?.user,this.__includeRawResponse=e?.__includeRawResponse,this.audio=e?.audio,this.modalities=e?.modalities,this.reasoning=e?.reasoning,this.maxTokens=e?.maxCompletionTokens??e?.maxTokens,this.promptCacheKey=e?.promptCacheKey??this.promptCacheKey,this.verbosity=e?.verbosity??this.verbosity,this.disableStreaming=e?.disableStreaming===!0,this.streaming=e?.streaming===!0,this.disableStreaming&&(this.streaming=!1),e?.streaming===!1&&(this.disableStreaming=!0),this.streamUsage=e?.streamUsage??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e?.configuration},e?.supportsStrictToolCalling!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),e?.service_tier!==void 0&&(this.service_tier=e.service_tier),this.zdrEnabled=e?.zdrEnabled??!1}_getReasoningParams(e){let t;if(yt(this.model))return void 0!==this.reasoning&&(t={...t,...this.reasoning}),e?.reasoning!==void 0&&(t={...t,...e.reasoning}),t}_getResponseFormat(e){return e&&"json_schema"===e.type&&e.json_schema.schema&&hf(e.json_schema.schema)?function(e,t,r){if(hh(e)){var i,n,a,s;let o;return a={type:"json_schema",json_schema:{...r,name:t,strict:!0,schema:"_zod"in e?function(e){var t=ga(e,{target:"draft-7"});if("object"!==t.type)throw Error(`Root schema must have type: 'object' but got type: ${t.type?`'${t.type}'`:"undefined"}`);let r=structuredClone(t);return function e(t,r,i){if("boolean"==typeof t)throw TypeError(`Expected object schema but got boolean; path=${r.join("/")}`);if(!yZ(t))throw TypeError(`Expected ${JSON.stringify(t)} to be an object; path=${r.join("/")}`);let n=t.$defs;if(yZ(n))for(let[t,a]of Object.entries(n))e(a,[...r,"$defs",t],i);let a=t.definitions;if(yZ(a))for(let[t,n]of Object.entries(a))e(n,[...r,"definitions",t],i);"object"!==t.type||"additionalProperties"in t||(t.additionalProperties=!1);let s=t.required??[],o=t.properties;if(yZ(o)){for(let[e,t]of Object.entries(o))if(!function e(t){if("boolean"==typeof t)return!1;if("null"===t.type)return!0;for(let r of t.oneOf??[])if(e(r))return!0;for(let r of t.anyOf??[])if(e(r))return!0;return!1}(t)&&!s.includes(e))throw Error(`Zod field at \`${[...r,"properties",e].join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);t.required=Object.keys(o),t.properties=Object.fromEntries(Object.entries(o).map(([t,n])=>[t,e(n,[...r,"properties",t],i)]))}let l=t.items;yZ(l)&&(t.items=e(l,[...r,"items"],i));let u=t.anyOf;Array.isArray(u)&&(t.anyOf=u.map((t,n)=>e(t,[...r,"anyOf",String(n)],i)));let c=t.allOf;Array.isArray(c)&&(1===c.length?(Object.assign(t,e(c[0],[...r,"allOf","0"],i)),delete t.allOf):t.allOf=c.map((t,n)=>e(t,[...r,"allOf",String(n)],i))),null===t.default&&delete t.default;let d=t.$ref;if(d&&function(e,t){let r=0;for(let t in e)if(++r>1)return!0;return!1}(t,1)){if("string"!=typeof d)throw TypeError(`Received non-string $ref - ${d}; path=${r.join("/")}`);let n=function(e,t){if(!t.startsWith("#/"))throw Error(`Unexpected $ref format ${JSON.stringify(t)}; Does not start with #/`);let r=t.slice(2).split("/"),i=e;for(let e of r){if(!yZ(i))throw Error(`encountered non-object entry while resolving ${t} - ${JSON.stringify(i)}`);let r=i[e];if(void 0===r)throw Error(`Key ${e} not found while resolving ${t}`);i=r}return i}(i,d);if("boolean"==typeof n)throw Error(`Expected \`$ref: ${d}\` to resolve to an object schema but got boolean`);if(!yZ(n))throw Error(`Expected \`$ref: ${d}\` to resolve to an object but got ${JSON.stringify(n)}`);return Object.assign(t,{...n,...t}),delete t.$ref,e(t,r,i)}return t}(r,[],r)}(e):((e,t)=>{let r,i,n=(i=void 0!==(r="string"==typeof t?{...yy,basePath:["#"],definitions:{},name:t}:{...yy,basePath:["#"],definitions:{},...t}).name?[...r.basePath,r.definitionPath,r.name]:r.basePath,{...r,currentPath:i,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(r.definitions).map(([e,t])=>[y_(t),{def:y_(t),path:[...r.basePath,r.definitionPath,e],jsonSchema:void 0}]))}),a="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,s=yL(e._def,void 0===a?n:{...n,currentPath:[...n.basePath,n.definitionPath,a]},!1)??{},o="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==o&&(s.title=o);let l=(()=>{if(function(e){if(!e)return!0;for(let t in e)return!1;return!0}(n.definitions))return;let e={},t=new Set;for(let r=0;r<500;r++){let r=Object.entries(n.definitions).filter(([e])=>!t.has(e));if(0===r.length)break;for(let[i,a]of r)e[i]=yL(y_(a),{...n,currentPath:[...n.basePath,n.definitionPath,i]},!0)??{},t.add(i)}return e})(),u=void 0===a?l?{...s,[n.definitionPath]:l}:s:"duplicate-ref"===n.nameStrategy?{...s,...l||n.seenRefs.size?{[n.definitionPath]:{...l,...n.seenRefs.size?{[a]:s}:void 0}}:void 0}:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,a].join("/"),[n.definitionPath]:{...l,[a]:s}};return"jsonSchema7"===n.target?u.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===n.target&&(u.$schema="https://json-schema.org/draft/2019-09/schema#"),u})(e,{openaiStrictMode:!0,name:{name:t}.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}},s=t=>e.parse(JSON.parse(t)),Object.defineProperties(o={...a},{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:s,enumerable:!1}}),o}if(hp(e)){let a;return i={type:"json_schema",json_schema:{...r,name:t,strict:!0,schema:ga(e,{cycles:"ref",reused:"ref",override(e){e.jsonSchema.title=t}})}},n=t=>u8(e,JSON.parse(t)),Object.defineProperties(a={...i},{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:n,enumerable:!1}}),a}throw Error("Unsupported schema response format")}(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}_combineCallOptions(e){return{...this.defaultOptions,...e??{}}}_getClientOptions(e){if(!this.client){let e=function(e){let{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:r,azureOpenAIApiKey:i,azureOpenAIBasePath:n,baseURL:a,azureADTokenProvider:s,azureOpenAIEndpoint:o}=e;if((i||s)&&n&&t)return`${n}/${t}`;if((i||s)&&o&&t)return`${o}/openai/deployments/${t}`;if(i||s){if(!r)throw Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${r}.openai.azure.com/openai/deployments/${t}`}return a}({baseURL:this.clientConfig.baseURL}),t={...this.clientConfig,baseURL:e,timeout:this.timeout,maxRetries:0};t.baseURL||delete t.baseURL,t.defaultHeaders=function(e,t=!1,r="1.0.0"){let i,n=Object.fromEntries((yi(e)?e:Array.isArray(e)?new Headers(e):"object"==typeof e&&null!==e&&"values"in e&&yi(e.values)?e.values:"object"==typeof e&&null!==e?new Headers(Object.entries(e).filter(([,e])=>"string"==typeof e).map(([e,t])=>[e,t])):new Headers).entries()),a=(("node"===(i=am())||"deno"===i)&&(i=`(${i}/${process.version}; ${process.platform}; ${process.arch})`),i),s=`langchainjs${t?"-azure":""}-openai`;return{...n,"User-Agent":n["User-Agent"]?`${s}/${r} (${a})${n["User-Agent"]}`:`${s}/${r} (${a})`}}(t.defaultHeaders),this.client=new ra(t)}return{...this.clientConfig,...e}}_convertChatOpenAIToolToCompletionsTool(e,t){var r;let i;return ym(e)?{type:"custom",custom:{name:(r=e.metadata.customTool).name,description:r.description,format:(()=>{if(r.format){if("grammar"===r.format.type)return{type:"grammar",grammar:{definition:r.format.definition,syntax:r.format.syntax}};if("text"===r.format.type)return{type:"text"}}})()}}:_o(e)?t?.strict!==void 0?{...e,function:{...e.function,strict:t.strict}}:e:(i=yo(e)?yu(e):e,t?.strict!==void 0&&(i.function.strict=t.strict),i)}bindTools(e,t){let r;return t?.strict!==void 0?r=t.strict:void 0!==this.supportsStrictToolCalling&&(r=this.supportsStrictToolCalling),this.withConfig({tools:e.map(e=>yh(e)||ym(e)?e:this._convertChatOpenAIToolToCompletionsTool(e,{strict:r})),...t})}async stream(e,t){return super.stream(e,this._combineCallOptions(t))}async invoke(e,t){return super.invoke(e,this._combineCallOptions(t))}_combineLLMOutput(...e){return e.reduce((e,t)=>(t&&t.tokenUsage&&(e.tokenUsage.completionTokens+=t.tokenUsage.completionTokens??0,e.tokenUsage.promptTokens+=t.tokenUsage.promptTokens??0,e.tokenUsage.totalTokens+=t.tokenUsage.totalTokens??0),e),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}async getNumTokensFromMessages(e){let t=0,r=0,i=0;"gpt-3.5-turbo-0301"===this.model?(r=4,i=-1):(r=3,i=1);let n=await Promise.all(e.map(async e=>{let n=await this.getNumTokens(e.content),a=await this.getNumTokens(yr(e)),s=void 0!==e.name?i+await this.getNumTokens(e.name):0,o=n+r+a+s;if("function"===e._getType()&&(o-=2),e.additional_kwargs?.function_call&&(o+=3),e?.additional_kwargs.function_call?.name&&(o+=await this.getNumTokens(e.additional_kwargs.function_call?.name)),e.additional_kwargs.function_call?.arguments)try{o+=await this.getNumTokens(JSON.stringify(JSON.parse(e.additional_kwargs.function_call?.arguments)))}catch(t){console.error("Error parsing function arguments",t,JSON.stringify(e.additional_kwargs.function_call)),o+=await this.getNumTokens(e.additional_kwargs.function_call?.arguments)}return t+=o,o}));return{totalCount:t+=3,countPerMessage:n}}async _getNumTokensFromGenerations(e){return(await Promise.all(e.map(async e=>e.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([e.message])).countPerMessage[0]:await this.getNumTokens(e.message.content)))).reduce((e,t)=>e+t,0)}async _getEstimatedTokenCountFromPrompt(e,t,r){let i=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&"auto"!==r){let e=function(e){let t=["namespace functions {",""];for(let r of e)r.description&&t.push(`// ${r.description}`),Object.keys(r.parameters.properties??{}).length>0?(t.push(`type ${r.name} = (_: {`),t.push(yc(r.parameters,0)),t.push("}) => any;")):t.push(`type ${r.name} = () => any;`),t.push("");return t.push("} // namespace functions"),t.join("\n")}(t);i+=await this.getNumTokens(e),i+=9}return t&&e.find(e=>"system"===e._getType())&&(i-=4),"none"===r?i+=1:"object"==typeof r&&(i+=await this.getNumTokens(r.name)+4),i}get profile(){return yB[this.model]??{}}_getStructuredOutputMethod(e){let t={...e};if(this.model.startsWith("gpt-3")||this.model.startsWith("gpt-4-")||"gpt-4"===this.model)"jsonSchema"===t.method&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`);else if(t?.method===void 0)return"jsonSchema";return t.method}withStructuredOutput(e,t){let r,i,{schema:n,name:a,includeRaw:s}={...t,schema:e};if(t?.strict!==void 0&&"jsonMode"===t.method)throw Error("Argument `strict` is only supported for `method` = 'function_calling'");let o=function(e,t){if(void 0!==t&&!yF.includes(t))throw Error(`Invalid method: ${t}. Supported methods are: ${yF.join(", ")}`);let r=!e.startsWith("gpt-3")&&!e.startsWith("gpt-4-")&&"gpt-4"!==e;if(r&&!t)return"jsonSchema";if(!r&&"jsonSchema"===t)throw Error(`JSON Schema is not supported for model "${e}". Please use a different method, e.g. "functionCalling" or "jsonMode".`);return t??"functionCalling"}(this.model,t?.method);if("jsonMode"===o){i=hf(n)?_C.fromZodSchema(n):new _k;let e=gO(n);r=this.withConfig({outputVersion:"v0",response_format:{type:"json_object"},ls_structured_output_format:{kwargs:{method:"json_mode"},schema:{title:a??"extract",...e}}})}else if("jsonSchema"===o){let e={name:a??"extract",description:hx(n),schema:n,strict:t?.strict},s=gO(e.schema);if(r=this.withConfig({outputVersion:"v0",response_format:{type:"json_schema",json_schema:e},ls_structured_output_format:{kwargs:{method:"json_schema"},schema:{title:e.name,description:e.description,...s}}}),hf(n)){let e=_C.fromZodSchema(n);i=gW.from(t=>"parsed"in t.additional_kwargs?t.additional_kwargs.parsed:e)}else i=new _k}else{let e=a??"extract";if(hf(n)){let a=gO(n);r=this.withConfig({outputVersion:"v0",tools:[{type:"function",function:{name:e,description:a.description,parameters:a}}],tool_choice:{type:"function",function:{name:e}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:e,...a}},...t?.strict!==void 0?{strict:t.strict}:{}}),i=new _q({returnSingle:!0,keyName:e,zodSchema:n})}else{let a;"string"==typeof n.name&&"object"==typeof n.parameters&&null!=n.parameters?(a=n,e=n.name):a={name:e=n.title??e,description:n.description??"",parameters:n};let s=gO(n);r=this.withConfig({outputVersion:"v0",tools:[{type:"function",function:a}],tool_choice:{type:"function",function:{name:e}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:e,...s}},...t?.strict!==void 0?{strict:t.strict}:{}}),i=new _q({returnSingle:!0,keyName:e})}}if(!s)return r.pipe(i);let l=_d.assign({parsed:(e,t)=>i.invoke(e.raw,t)}),u=_d.assign({parsed:()=>null}),c=l.withFallbacks({fallbacks:[u]});return gF.from([{raw:r},c])}};let _J={providerName:"ChatOpenAI",fromStandardTextBlock:e=>({type:"text",text:e.text}),fromStandardImageBlock(e){if("url"===e.source_type)return{type:"image_url",image_url:{url:e.url,...e.metadata?.detail?{detail:e.metadata.detail}:{}}};if("base64"===e.source_type)return{type:"image_url",image_url:{url:`data:${e.mime_type??""};base64,${e.data}`,...e.metadata?.detail?{detail:e.metadata.detail}:{}}};throw Error(`Image content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(e){if("url"===e.source_type){let t,r=iZ({dataUrl:e.url});if(!r)throw Error(`URL audio blocks with source_type ${e.source_type} must be formatted as a data URL for ChatOpenAI`);let i=r.mime_type||e.mime_type||"";try{t=iD(i)}catch{throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`)}if("audio"!==t.type||"wav"!==t.subtype&&"mp3"!==t.subtype)throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:t.subtype,data:r.data}}}if("base64"===e.source_type){let t;try{t=iD(e.mime_type??"")}catch{throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`)}if("audio"!==t.type||"wav"!==t.subtype&&"mp3"!==t.subtype)throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:t.subtype,data:e.data}}}throw Error(`Audio content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(e){if("url"===e.source_type){if(!iZ({dataUrl:e.url}))throw Error(`URL file blocks with source_type ${e.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:e.url,...e.metadata?.filename||e.metadata?.name?{filename:e.metadata?.filename||e.metadata?.name}:{}}}}if("base64"===e.source_type)return{type:"file",file:{file_data:`data:${e.mime_type??""};base64,${e.data}`,...e.metadata?.filename||e.metadata?.name||e.metadata?.title?{filename:e.metadata?.filename||e.metadata?.name||e.metadata?.title}:{}}};if("id"===e.source_type)return{type:"file",file:{file_id:e.id}};throw Error(`File content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)}},_G=e=>{if("image"===e.type){if(e.url)return{type:"image_url",image_url:{url:e.url}};else if(e.data)return{type:"image_url",image_url:{url:`data:${e.mimeType};base64,${e.data}`}}}if("audio"===e.type&&e.data){let t=nQ(()=>{let[,t]=e.mimeType.split("/");return"wav"===t||"mp3"===t?t:"wav"});return{type:"input_audio",input_audio:{data:e.data.toString(),format:t}}}if("file"===e.type){if(e.data)return{type:"file",file:{file_data:e.data.toString()}};if(e.fileId)return{type:"file",file:{file_id:e.fileId}}}},_H=({messages:e,model:t})=>e.flatMap(e=>{if("output_version"in e.response_metadata&&e.response_metadata?.output_version==="v1")return(({message:e,model:t})=>{let r=yr(e);if("system"===r&&yt(t)&&(r="developer"),"developer"===r)return{role:"developer",content:e.contentBlocks.filter(e=>"text"===e.type)};if("system"===r)return{role:"system",content:e.contentBlocks.filter(e=>"text"===e.type)};if("assistant"===r)return{role:"assistant",content:e.contentBlocks.filter(e=>"text"===e.type)};if("tool"===r&&ny.isInstance(e))return{role:"tool",tool_call_id:e.tool_call_id,content:e.contentBlocks.filter(e=>"text"===e.type)};if("function"===r)return{role:"function",name:e.name??"",content:e.contentBlocks.filter(e=>"text"===e.type).join("")};return{role:"user",content:Array.from(function*(e){for(let t of e){"text"===t.type&&(yield{type:"text",text:t.text});let e=_G(t);e&&(yield e)}}(e.contentBlocks))}})({message:e});let r=yr(e);"system"===r&&yt(t)&&(r="developer");let i={role:r,content:"string"==typeof e.content?e.content:e.content.map(e=>ij(e)?iF(e,_J):e)};return(null!=e.name&&(i.name=e.name),null!=e.additional_kwargs.function_call&&(i.function_call=e.additional_kwargs.function_call,i.content=""),nV.isInstance(e)&&e.tool_calls?.length?(i.tool_calls=e.tool_calls.map(_Z),i.content=""):(null!=e.additional_kwargs.tool_calls&&(i.tool_calls=e.additional_kwargs.tool_calls),ny.isInstance(e)&&null!=e.tool_call_id&&(i.tool_call_id=e.tool_call_id)),e.additional_kwargs.audio&&"object"==typeof e.additional_kwargs.audio&&"id"in e.additional_kwargs.audio)?[i,{role:"assistant",audio:{id:e.additional_kwargs.audio.id}}]:i});var _V=class extends _W{invocationParams(e,t){let r;e?.strict!==void 0?r=e.strict:void 0!==this.supportsStrictToolCalling&&(r=this.supportsStrictToolCalling);let i={};e?.stream_options!==void 0?i={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t?.streaming)&&(i={stream_options:{include_usage:!0}});let n={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:e?.tools?.length?e.tools.map(e=>this._convertChatOpenAIToolToCompletionsTool(e,{strict:r})):void 0,tool_choice:yp(e?.tool_choice),response_format:this._getResponseFormat(e?.response_format),seed:e?.seed,...i,parallel_tool_calls:e?.parallel_tool_calls,...this.audio||e?.audio?{audio:this.audio||e?.audio}:{},...this.modalities||e?.modalities?{modalities:this.modalities||e?.modalities}:{},...this.modelKwargs,prompt_cache_key:e?.promptCacheKey??this.promptCacheKey,verbosity:e?.verbosity??this.verbosity};e?.prediction!==void 0&&(n.prediction=e.prediction),void 0!==this.service_tier&&(n.service_tier=this.service_tier),e?.service_tier!==void 0&&(n.service_tier=e.service_tier);let a=this._getReasoningParams(e);return void 0!==a&&void 0!==a.effort&&(n.reasoning_effort=a.effort),yt(n.model)?n.max_completion_tokens=-1===this.maxTokens?void 0:this.maxTokens:n.max_tokens=-1===this.maxTokens?void 0:this.maxTokens,n}async _generate(e,t,r){let i={},n=this.invocationParams(t),a=_H({messages:e,model:this.model});if(n.stream){let n=this._streamResponseChunks(e,t,r),a={};for await(let e of n){e.message.response_metadata={...e.generationInfo,...e.message.response_metadata};let t=e.generationInfo?.completion??0;void 0===a[t]?a[t]=e:a[t]=a[t].concat(e)}let s=Object.entries(a).sort(([e],[t])=>parseInt(e,10)-parseInt(t,10)).map(([e,t])=>t),{functions:o,function_call:l}=this.invocationParams(t),u=await this._getEstimatedTokenCountFromPrompt(e,o,l),c=await this._getNumTokensFromGenerations(s);return i.input_tokens=u,i.output_tokens=c,i.total_tokens=u+c,{generations:s,llmOutput:{estimatedTokenUsage:{promptTokens:i.input_tokens,completionTokens:i.output_tokens,totalTokens:i.total_tokens}}}}{let e=await this.completionWithRetry({...n,stream:!1,messages:a},{signal:t?.signal,...t?.options}),{completion_tokens:r,prompt_tokens:s,total_tokens:o,prompt_tokens_details:l,completion_tokens_details:u}=e?.usage??{};r&&(i.output_tokens=(i.output_tokens??0)+r),s&&(i.input_tokens=(i.input_tokens??0)+s),o&&(i.total_tokens=(i.total_tokens??0)+o),(l?.audio_tokens!==null||l?.cached_tokens!==null)&&(i.input_token_details={...l?.audio_tokens!==null&&{audio:l?.audio_tokens},...l?.cached_tokens!==null&&{cache_read:l?.cached_tokens}}),(u?.audio_tokens!==null||u?.reasoning_tokens!==null)&&(i.output_token_details={...u?.audio_tokens!==null&&{audio:u?.audio_tokens},...u?.reasoning_tokens!==null&&{reasoning:u?.reasoning_tokens}});let c=[];for(let t of e?.choices??[]){let r={text:t.message?.content??"",message:this._convertCompletionsMessageToBaseMessage(t.message??{role:"assistant"},e)};r.generationInfo={...t.finish_reason?{finish_reason:t.finish_reason}:{},...t.logprobs?{logprobs:t.logprobs}:{}},nK(r.message)&&(r.message.usage_metadata=i),r.message=new nV(Object.fromEntries(Object.entries(r.message).filter(([e])=>!e.startsWith("lc_")))),c.push(r)}return{generations:c,llmOutput:{tokenUsage:{promptTokens:i.input_tokens,completionTokens:i.output_tokens,totalTokens:i.total_tokens}}}}}async *_streamResponseChunks(e,t,r){let i,n,a=_H({messages:e,model:this.model}),s={...this.invocationParams(t,{streaming:!0}),messages:a,stream:!0};for await(let e of(await this.completionWithRetry(s,t))){let a=e?.choices?.[0];if(e.usage&&(n=e.usage),!a)continue;let{delta:s}=a;if(!s)continue;let o=this._convertCompletionsDeltaToBaseMessageChunk(s,e,i);i=s.role??i;let l={prompt:t.promptIndex??0,completion:a.index??0};if("string"!=typeof o.content){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let u={...l};null!=a.finish_reason&&(u.finish_reason=a.finish_reason,u.system_fingerprint=e.system_fingerprint,u.model_name=e.model,u.service_tier=e.service_tier),this.logprobs&&(u.logprobs=a.logprobs);let c=new o1({message:o,text:o.content,generationInfo:u});yield c,await r?.handleLLMNewToken(c.text??"",l,void 0,void 0,void 0,{chunk:c})}if(n){let e={...n.prompt_tokens_details?.audio_tokens!==null&&{audio:n.prompt_tokens_details?.audio_tokens},...n.prompt_tokens_details?.cached_tokens!==null&&{cache_read:n.prompt_tokens_details?.cached_tokens}},t={...n.completion_tokens_details?.audio_tokens!==null&&{audio:n.completion_tokens_details?.audio_tokens},...n.completion_tokens_details?.reasoning_tokens!==null&&{reasoning:n.completion_tokens_details?.reasoning_tokens}},r=new o1({message:new nY({content:"",response_metadata:{usage:{...n}},usage_metadata:{input_tokens:n.prompt_tokens,output_tokens:n.completion_tokens,total_tokens:n.total_tokens,...Object.keys(e).length>0&&{input_token_details:e},...Object.keys(t).length>0&&{output_token_details:t}}}),text:""});yield r}if(t.signal?.aborted)throw Error("AbortError")}async completionWithRetry(e,t){let r=this._getClientOptions(t),i=e.response_format&&"json_schema"===e.response_format.type;return this.caller.call(async()=>{try{if(i&&!e.stream)return await this.client.chat.completions.parse(e,r);return await this.client.chat.completions.create(e,r)}catch(e){throw rs(e)}})}_convertCompletionsDeltaToBaseMessageChunk(e,t,r){return(({delta:e,rawResponse:t,includeRawResponse:r,defaultRole:i})=>{let n,a=e.role??i,s=e.content??"";n=e.function_call?{function_call:e.function_call}:e.tool_calls?{tool_calls:e.tool_calls}:{},r&&(n.__raw_response=t),e.audio&&(n.audio={...e.audio,index:t.choices[0].index});let o={model_provider:"openai",usage:{...t.usage}};if("user"===a)return new nN({content:s,response_metadata:o});if("assistant"===a){let r=[];if(Array.isArray(e.tool_calls))for(let t of e.tool_calls)r.push({name:t.function?.name,args:t.function?.arguments,id:t.id,index:t.index,type:"tool_call_chunk"});return new nY({content:s,tool_call_chunks:r,additional_kwargs:n,id:t.id,response_metadata:o})}if("system"===a)return new nL({content:s,response_metadata:o});if("developer"===a)return new nL({content:s,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}});if("function"===a)return new nS({content:s,additional_kwargs:n,name:e.name,response_metadata:o});else if("tool"===a)return new n_({content:s,additional_kwargs:n,tool_call_id:e.tool_call_id,response_metadata:o});else return new nx({content:s,role:a,response_metadata:o})})({delta:e,rawResponse:t,includeRawResponse:this.__includeRawResponse,defaultRole:r})}_convertCompletionsMessageToBaseMessage(e,t){return(({message:e,rawResponse:t,includeRawResponse:r})=>{let i=e.tool_calls;if("assistant"!==e.role)return new n$(e.content||"",e.role??"unknown");{var n,a;let s=[],o=[];for(let e of i??[])try{s.push(_D(e,{returnId:!0}))}catch(t){o.push(_F(e,t.message))}let l={function_call:e.function_call,tool_calls:i};void 0!==r&&(l.__raw_response=t);let u={model_provider:"openai",model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(l.audio=e.audio),new nV({content:(n=e.content||"",(a=t.choices?.[0]?.message)&&"object"==typeof a&&"images"in a&&Array.isArray(a.images)?[{type:"text",text:n},...a.images.filter(e=>"string"==typeof e?.image_url?.url).map(e=>({type:"image",url:e.image_url.url}))]:n),tool_calls:s,invalid_tool_calls:o,additional_kwargs:l,response_metadata:u,id:t.id})}})({message:e,rawResponse:t,includeRawResponse:this.__includeRawResponse})}};let _K="__openai_function_call_ids__",_X=e=>{let t={...e?.input_tokens_details?.cached_tokens!=null&&{cache_read:e?.input_tokens_details?.cached_tokens}},r={...e?.output_tokens_details?.reasoning_tokens!=null&&{reasoning:e?.output_tokens_details?.reasoning_tokens}};return{input_tokens:e?.input_tokens??0,output_tokens:e?.output_tokens??0,total_tokens:e?.total_tokens??0,input_token_details:t,output_token_details:r}},_Y=e=>{let t;if(e.error){let t=Error(e.error.message);throw t.name=e.error.code,t}let r=[],i=[],n=[],a={model_provider:"openai",model:e.model,created_at:e.created_at,id:e.id,incomplete_details:e.incomplete_details,metadata:e.metadata,object:e.object,status:e.status,user:e.user,service_tier:e.service_tier,model_name:e.model},s={};for(let a of e.output)if("message"===a.type)t=a.id,r.push(...a.content.flatMap(e=>"output_text"===e.type?("parsed"in e&&null!=e.parsed&&(s.parsed=e.parsed),{type:"text",text:e.text,annotations:e.annotations}):"refusal"===e.type?(s.refusal=e.refusal,[]):e));else if("function_call"===a.type){let e={function:{name:a.name,arguments:a.arguments},id:a.call_id};try{i.push(_D(e,{returnId:!0}))}catch(r){let t;"object"==typeof r&&null!=r&&"message"in r&&"string"==typeof r.message&&(t=r.message),n.push(_F(e,t))}s[_K]??={},a.id&&(s[_K][a.call_id]=a.id)}else if("reasoning"===a.type)s.reasoning=a;else if("custom_tool_call"===a.type){let e=function(e){if("custom_tool_call"===e.type)return{...e,type:"tool_call",call_id:e.id,id:e.call_id,name:e.name,isCustomTool:!0,args:{input:e.input}}}(a);e?i.push(e):n.push(_F(a,"Malformed custom tool call"))}else s.tool_outputs??=[],s.tool_outputs.push(a);return new nV({id:t,content:r,tool_calls:i,invalid_tool_calls:n,usage_metadata:_X(e.usage),additional_kwargs:s,response_metadata:a})},_Q=e=>{let t,r,i=[],n={},a=[],s={model_provider:"openai"},o={};if("response.output_text.delta"===e.type)i.push({type:"text",text:e.delta,index:e.content_index});else if("response.output_text.annotation.added"===e.type)i.push({type:"text",text:"",annotations:[e.annotation],index:e.content_index});else if("response.output_item.added"===e.type&&"message"===e.item.type)r=e.item.id;else if("response.output_item.added"===e.type&&"function_call"===e.item.type)a.push({type:"tool_call_chunk",name:e.item.name,args:e.item.arguments,id:e.item.call_id,index:e.output_index}),o[_K]={[e.item.call_id]:e.item.id};else if("response.output_item.done"===e.type&&["web_search_call","file_search_call","computer_call","code_interpreter_call","mcp_call","mcp_list_tools","mcp_approval_request","image_generation_call","custom_tool_call"].includes(e.item.type))o.tool_outputs=[e.item];else if("response.created"===e.type)s.id=e.response.id,s.model_name=e.response.model,s.model=e.response.model;else if("response.completed"===e.type){let r=_Y(e.response);for(let[i,n]of(t=_X(e.response.usage),e.response.text?.format?.type==="json_schema"&&(o.parsed??=JSON.parse(r.text)),Object.entries(e.response)))"id"!==i&&(s[i]=n)}else if("response.function_call_arguments.delta"===e.type||"response.custom_tool_call_input.delta"===e.type)a.push({type:"tool_call_chunk",args:e.delta,index:e.output_index});else if("response.web_search_call.completed"===e.type||"response.file_search_call.completed"===e.type)n={tool_outputs:{id:e.item_id,type:e.type.replace("response.","").replace(".completed",""),status:"completed"}};else if("response.refusal.done"===e.type)o.refusal=e.refusal;else if("response.output_item.added"===e.type&&"item"in e&&"reasoning"===e.item.type){let t=e.item.summary?e.item.summary.map((e,t)=>({...e,index:t})):void 0;o.reasoning={id:e.item.id,type:e.item.type,...t?{summary:t}:{}}}else if("response.reasoning_summary_part.added"===e.type)o.reasoning={type:"reasoning",summary:[{...e.part,index:e.summary_index}]};else if("response.reasoning_summary_text.delta"===e.type)o.reasoning={type:"reasoning",summary:[{text:e.delta,type:"summary_text",index:e.summary_index}]};else if("response.image_generation_call.partial_image"===e.type)return null;else return null;return new o1({text:i.map(e=>e.text).join(""),message:new nY({id:r,content:i,tool_call_chunks:a,usage_metadata:t,additional_kwargs:o,response_metadata:s}),generationInfo:n})},_0=({messages:e,zdrEnabled:t,model:r})=>e.flatMap(e=>{var i;let n=e.response_metadata;if(n?.output_version==="v1"){let t;return t=nV.isInstance(e)&&e.response_metadata?.model_provider==="openai",Array.from(function*(){let r,i=(()=>{try{let t=yr(e);if("system"===t||"developer"===t||"assistant"===t||"user"===t)return t;return"assistant"}catch{return"assistant"}})(),n=new Set,a=new Set,s=new Map,o=new Map;function*l(){if(!r)return;let e=r.content;("string"==typeof e&&e.length>0||Array.isArray(e)&&e.length>0)&&(yield r),r=void 0}let u=e=>{r||(r={type:"message",role:i,content:[]}),"string"==typeof r.content?r.content=r.content.length>0?[{type:"input_text",text:r.content},...e]:[...e]:r.content.push(...e)},c=e=>{if("string"==typeof e)return e;try{return JSON.stringify(e??{})}catch{return"{}"}},d=e=>{let t,r="low"===(t=e.metadata?.detail)||"high"===t||"auto"===t?t:"auto";if(e.fileId)return{type:"input_image",detail:r,file_id:e.fileId};if(e.url)return{type:"input_image",detail:r,image_url:e.url};if(e.data){let t="string"==typeof e.data?e.data:Buffer.from(e.data).toString("base64"),i=e.mimeType??"image/png";return{type:"input_image",detail:r,image_url:`data:${i};base64,${t}`}}},p=e=>{let t=e.metadata?.filename??e.metadata?.name??e.metadata?.title;if(e.fileId&&"string"==typeof t)return{type:"input_file",file_id:e.fileId,...t?{filename:t}:{}};if(e.url&&"string"==typeof t)return{type:"input_file",file_url:e.url,...t?{filename:t}:{}};if(e.data&&"string"==typeof t){let r="string"==typeof e.data?e.data:Buffer.from(e.data).toString("base64"),i=e.mimeType??"application/octet-stream";return{type:"input_file",file_data:`data:${i};base64,${r}`,...t?{filename:t}:{}}}},h=e=>{let t=(()=>{if(Array.isArray(e.summary)){let t=e.summary,r=t?.map(e=>e?.text).filter(e=>"string"==typeof e)??[];if(r.length>0)return r}return e.reasoning?[e.reasoning]:[]})(),r=t.length>0?t.map(e=>({type:"summary_text",text:e})):[{type:"summary_text",text:""}],i={type:"reasoning",id:e.id??"",summary:r};return e.reasoning&&(i.content=[{type:"reasoning_text",text:e.reasoning}]),i},m=e=>({type:"function_call",name:e.name??"",call_id:e.id??"",arguments:c(e.args)}),f=e=>{let t=c(e.output),r="success"===e.status?"completed":"error"===e.status?"incomplete":void 0;return{type:"function_call_output",call_id:e.toolCallId??"",output:t,...r?{status:r}:{}}};for(let r of e.contentBlocks)if("text"===r.type)u([{type:"input_text",text:r.text}]);else if("invalid_tool_call"===r.type);else if("reasoning"===r.type)yield*l(),yield h(r);else if("tool_call"===r.type){yield*l();let e=r.id??"";e&&(n.add(e),s.delete(e)),yield m(r)}else if("tool_call_chunk"===r.type){if(r.id){let e=s.get(r.id)??{name:r.name,args:[]};r.name&&(e.name=r.name),r.args&&e.args.push(r.args),s.set(r.id,e)}}else if("server_tool_call"===r.type){yield*l();let e=r.id??"";e&&(a.add(e),o.delete(e)),yield m(r)}else if("server_tool_call_chunk"===r.type){if(r.id){let e=o.get(r.id)??{name:r.name,args:[]};r.name&&(e.name=r.name),r.args&&e.args.push(r.args),o.set(r.id,e)}}else if("server_tool_call_result"===r.type)yield*l(),yield f(r);else if("audio"===r.type);else if("file"===r.type){let e=p(r);e&&u([e])}else if("image"===r.type){let e=d(r);e&&u([e])}else if("video"===r.type){let e=p(r);e&&u([e])}else"text-plain"===r.type?r.text&&u([{type:"input_text",text:r.text}]):"non_standard"===r.type&&t&&(yield*l(),yield r.value);for(let[e,t]of(yield*l(),s)){if(!e||n.has(e))continue;let r=t.args.join("");(t.name||r)&&(yield{type:"function_call",call_id:e,name:t.name??"",arguments:r})}for(let[e,t]of o){if(!e||a.has(e))continue;let r=t.args.join("");(t.name||r)&&(yield{type:"function_call",call_id:e,name:t.name??"",arguments:r})}}())}let a=e.additional_kwargs,s=yr(e);if("system"===s&&yt(r)&&(s="developer"),"function"===s)throw Error("Function messages are not supported in Responses API");if("tool"===s)return a?.type==="computer_call_output"?{type:"computer_call_output",output:(()=>{if("string"==typeof e.content)return{type:"computer_screenshot",image_url:e.content};if(Array.isArray(e.content)){let t=e.content.find(e=>"computer_screenshot"===e.type);if(t)return t;let r=e.content.find(e=>"image_url"===e.type);if(r)return{type:"computer_screenshot",image_url:"string"==typeof r.image_url?r.image_url:r.image_url.url}}throw Error("Invalid computer call output")})(),call_id:e.tool_call_id}:e.additional_kwargs?.customTool?{type:"custom_tool_call_output",call_id:e.tool_call_id,output:e.content}:{type:"function_call_output",call_id:e.tool_call_id,id:e.id?.startsWith("fc_")?e.id:void 0,output:"string"!=typeof e.content?JSON.stringify(e.content):e.content};if("assistant"===s){if(!t&&n?.output!=null&&Array.isArray(n?.output)&&n?.output.length>0&&n?.output.every(e=>"type"in e))return n?.output;let r=[];if(a?.reasoning&&!t){let e,t=(e=((i=a.reasoning).summary.length>1?i.summary.reduce((e,t)=>{let r=e[e.length-1];return r.index===t.index?r.text+=t.text:e.push(t),e},[{...i.summary[0]}]):i.summary).map(e=>Object.fromEntries(Object.entries(e).filter(([e])=>"index"!==e))),{...i,summary:e});r.push(t)}let{content:s}=e;a?.refusal&&("string"==typeof s&&(s=[{type:"output_text",text:s,annotations:[]}]),s=[...s,{type:"refusal",refusal:a.refusal}]),("string"==typeof s||s.length>0)&&r.push({type:"message",role:"assistant",...e.id&&!t&&e.id.startsWith("msg_")?{id:e.id}:{},content:"string"==typeof s?s:s.flatMap(e=>"text"===e.type?{type:"output_text",text:e.text,annotations:e.annotations??[]}:"output_text"===e.type||"refusal"===e.type?e:[])});let o=a?.[_K];nV.isInstance(e)&&e.tool_calls?.length?r.push(...e.tool_calls.map(e=>"tool_call"===e.type&&"isCustomTool"in e&&!0===e.isCustomTool?{type:"custom_tool_call",id:e.call_id,call_id:e.id??"",input:e.args.input,name:e.name}:{type:"function_call",name:e.name,arguments:JSON.stringify(e.args),call_id:e.id,...!t?{id:o?.[e.id]}:{}})):a?.tool_calls&&r.push(...a.tool_calls.map(e=>({type:"function_call",name:e.function.name,call_id:e.id,arguments:e.function.arguments,...!t?{id:o?.[e.id]}:{}})));let l=n?.output?.length?n?.output:a.tool_outputs,u=["computer_call","mcp_call","code_interpreter_call","image_generation_call"];if(null!=l){let e=l?.filter(e=>u.includes(e.type));e.length>0&&r.push(...e)}return r}if("user"===s||"system"===s||"developer"===s){if("string"==typeof e.content)return{type:"message",role:s,content:e.content};let t=[],r=e.content.flatMap(e=>{if("mcp_approval_response"===e.type&&t.push({type:"mcp_approval_response",approval_request_id:e.approval_request_id,approve:e.approve}),ij(e))return iF(e,_J);if("text"===e.type)return{type:"input_text",text:e.text};if("image_url"===e.type)return{type:"input_image",image_url:"string"==typeof e.image_url?e.image_url:"object"==typeof e.image_url&&null!==e.image_url&&"url"in e.image_url?e.image_url.url:void 0,detail:"string"==typeof e.image_url?"auto":"object"==typeof e.image_url&&null!==e.image_url&&"detail"in e.image_url?e.image_url.detail:void 0};return"input_text"===e.type||"input_image"===e.type||"input_file"===e.type?e:[]});return r.length>0&&t.push({type:"message",role:s,content:r}),t}return console.warn(`Unsupported role found when converting to OpenAI Responses API: ${s}`),[]});var _1=class extends _W{invocationParams(e){var t;let r;e?.strict!==void 0?r=e.strict:void 0!==this.supportsStrictToolCalling&&(r=this.supportsStrictToolCalling);let i={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e?.previous_response_id,truncation:e?.truncation,include:e?.include,tools:e?.tools?.length?this._reduceChatOpenAITools(e.tools,{stream:this.streaming,strict:r}):void 0,tool_choice:null!=(t=e?.tool_choice)&&"object"==typeof t&&"type"in t&&"function"!==t.type?e?.tool_choice:(()=>{let t=yp(e?.tool_choice);if("object"==typeof t&&"type"in t){if("function"===t.type)return{type:"function",name:t.function.name};else if("allowed_tools"===t.type)return{type:"allowed_tools",mode:t.allowed_tools.mode,tools:t.allowed_tools.tools};else if("custom"===t.type)return{type:"custom",name:t.custom.name}}})(),text:(()=>{if(e?.text)return e.text;let t=this._getResponseFormat(e?.response_format);return t?.type==="json_schema"?null!=t.json_schema.schema?{format:{type:"json_schema",schema:t.json_schema.schema,description:t.json_schema.description,name:t.json_schema.name,strict:t.json_schema.strict},verbosity:e?.verbosity}:void 0:{format:t,verbosity:e?.verbosity}})(),parallel_tool_calls:e?.parallel_tool_calls,max_output_tokens:-1===this.maxTokens?void 0:this.maxTokens,prompt_cache_key:e?.promptCacheKey??this.promptCacheKey,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},n=this._getReasoningParams(e);return void 0!==n&&(i.reasoning=n),i}async _generate(e,t){let r=this.invocationParams(t);if(r.stream){let r;for await(let i of this._streamResponseChunks(e,t))i.message.response_metadata={...i.generationInfo,...i.message.response_metadata},r=r?.concat(i)??i;return{generations:r?[r]:[],llmOutput:{estimatedTokenUsage:r?.message?.usage_metadata}}}{let i=await this.completionWithRetry({input:_0({messages:e,zdrEnabled:this.zdrEnabled??!1,model:this.model}),...r,stream:!1},{signal:t?.signal,...t?.options});return{generations:[{text:i.output_text,message:_Y(i)}],llmOutput:{id:i.id,estimatedTokenUsage:i.usage?{promptTokens:i.usage.input_tokens,completionTokens:i.usage.output_tokens,totalTokens:i.usage.total_tokens}:void 0}}}}async *_streamResponseChunks(e,t,r){for await(let i of(await this.completionWithRetry({...this.invocationParams(t),input:_0({messages:e,zdrEnabled:this.zdrEnabled??!1,model:this.model}),stream:!0},t))){let e=_Q(i);null!=e&&(yield e,await r?.handleLLMNewToken(e.text||"",{prompt:t.promptIndex??0,completion:0},void 0,void 0,void 0,{chunk:e}))}}async completionWithRetry(e,t){return this.caller.call(async()=>{let r=this._getClientOptions(t);try{if(e.text?.format?.type==="json_schema"&&!e.stream)return await this.client.responses.parse(e,r);return await this.client.responses.create(e,r)}catch(e){throw rs(e)}})}_reduceChatOpenAITools(e,t){let r=[];for(let i of e)if(yh(i))"image_generation"===i.type&&t?.stream&&(i.partial_images=1),r.push(i);else if(ym(i)){let e=i.metadata.customTool;r.push({type:"custom",name:e.name,description:e.description,format:e.format})}else _o(i)?r.push({type:"function",name:i.function.name,parameters:i.function.parameters,description:i.function.description,strict:t?.strict??null}):yf(i)&&r.push(function(e){return{type:"custom",name:e.custom.name,description:e.custom.description,format:(()=>{if(e.custom.format){if("grammar"===e.custom.format.type)return{type:"grammar",definition:e.custom.format.grammar.definition,syntax:e.custom.format.grammar.syntax};if("text"===e.custom.format.type)return{type:"text"}}})()}}(i));return r}},_4=class e extends _W{useResponsesApi=!1;responses;completions;get lc_serializable_keys(){return[...super.lc_serializable_keys,"useResponsesApi"]}get callKeys(){return[...super.callKeys,"useResponsesApi"]}constructor(e){super(e),this.fields=e,this.useResponsesApi=e?.useResponsesApi??!1,this.responses=e?.responses??new _1(e),this.completions=e?.completions??new _V(e)}_useResponsesApi(e){let t=e?.tools?.some(yh),r=e?.previous_response_id!=null||e?.text!=null||e?.truncation!=null||e?.include!=null||e?.reasoning?.summary!=null||this.reasoning?.summary!=null,i=e?.tools?.some(yf)||e?.tools?.some(ym);return this.useResponsesApi||t||r||i}getLsParams(e){let t=this._combineCallOptions(e);return this._useResponsesApi(e)?this.responses.getLsParams(t):this.completions.getLsParams(t)}invocationParams(e){let t=this._combineCallOptions(e);return this._useResponsesApi(e)?this.responses.invocationParams(t):this.completions.invocationParams(t)}async _generate(e,t,r){return this._useResponsesApi(t)?this.responses._generate(e,t):this.completions._generate(e,t,r)}async *_streamResponseChunks(e,t,r){this._useResponsesApi(t)?yield*this.responses._streamResponseChunks(e,this._combineCallOptions(t),r):yield*this.completions._streamResponseChunks(e,this._combineCallOptions(t),r)}withConfig(t){let r=new e(this.fields);return r.defaultOptions={...this.defaultOptions,...t},r}};e.s(["ChatOpenAI",()=>_4],40849),iP({},{BaseLLM:()=>_2,LLM:()=>_6});var _2=class e extends _c{lc_namespace=["langchain","llms",this._llmType()];async invoke(t,r){let i=e._convertInputToPromptValue(t);return(await this.generatePrompt([i],r,r?.callbacks)).generations[0][0].text}async *_streamResponseChunks(e,t,r){throw Error("Not implemented.")}_separateRunnableConfigFromCallOptionsCompat(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async *_streamIterator(t,r){if(this._streamResponseChunks===e.prototype._streamResponseChunks)yield this.invoke(t,r);else{let i=e._convertInputToPromptValue(t),[n,a]=this._separateRunnableConfigFromCallOptionsCompat(r),s=await os.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),o={options:a,invocation_params:this?.invocationParams(a),batch_size:1},l=await s?.handleLLMStart(this.toJSON(),[i.toString()],n.runId,void 0,o,void 0,void 0,n.runName),u=new o0({text:""});try{for await(let e of this._streamResponseChunks(i.toString(),a,l?.[0]))u=u?u.concat(e):e,"string"==typeof e.text&&(yield e.text)}catch(e){throw await Promise.all((l??[]).map(t=>t?.handleLLMError(e))),e}await Promise.all((l??[]).map(e=>e?.handleLLMEnd({generations:[[u]]})))}}async generatePrompt(e,t,r){let i=e.map(e=>e.toString());return this.generate(i,t,r)}invocationParams(e){return{}}_flattenLLMResult(e){let t=[];for(let r=0;r<e.generations.length;r+=1){let i=e.generations[r];if(0===r)t.push({generations:[i],llmOutput:e.llmOutput});else{let r=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;t.push({generations:[i],llmOutput:r})}}return t}async _generateUncached(t,r,i,n){let a,s;if(void 0!==n&&n.length===t.length)a=n;else{let e=await os.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),n={options:r,invocation_params:this?.invocationParams(r),batch_size:t.length};a=await e?.handleLLMStart(this.toJSON(),t,i.runId,void 0,n,void 0,void 0,i?.runName)}if(a?.[0].handlers.find(av)&&1===t.length&&this._streamResponseChunks!==e.prototype._streamResponseChunks)try{let e;for await(let i of(await this._streamResponseChunks(t[0],r,a?.[0])))e=void 0===e?i:o$(e,i);if(void 0===e)throw Error("Received empty response from chat model call.");s={generations:[[e]],llmOutput:{}},await a?.[0].handleLLMEnd(s)}catch(e){throw await a?.[0].handleLLMError(e),e}else{try{s=await this._generate(t,r,a?.[0])}catch(e){throw await Promise.all((a??[]).map(t=>t?.handleLLMError(e))),e}let e=this._flattenLLMResult(s);await Promise.all((a??[]).map((t,r)=>t?.handleLLMEnd(e[r])))}let o=a?.map(e=>e.runId)||void 0;return Object.defineProperty(s,oQ,{value:o?{runIds:o}:void 0,configurable:!0}),s}async _generateCached({prompts:e,cache:t,llmStringKey:r,parsedOptions:i,handledOptions:n,runId:a}){let s=await os.configure(n.callbacks,this.callbacks,n.tags,this.tags,n.metadata,this.metadata,{verbose:this.verbose}),o={options:i,invocation_params:this?.invocationParams(i),batch_size:e.length},l=await s?.handleLLMStart(this.toJSON(),e,a,void 0,o,void 0,void 0,n?.runName),u=[],c=(await Promise.allSettled(e.map(async(e,i)=>{let n=await t.lookup(e,r);return null==n&&u.push(i),n}))).map((e,t)=>({result:e,runManager:l?.[t]})).filter(({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status),d=[];await Promise.all(c.map(async({result:e,runManager:t},r)=>{if("fulfilled"!==e.status)return await t?.handleLLMError(e.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(e.reason);{let i=e.value;return d[r]=i.map(e=>(e.generationInfo={...e.generationInfo,tokenUsage:{}},e)),i.length&&await t?.handleLLMNewToken(i[0].text),t?.handleLLMEnd({generations:[i]},void 0,void 0,void 0,{cached:!0})}}));let p={generations:d,missingPromptIndices:u,startedRunManagers:l};return Object.defineProperty(p,oQ,{value:l?{runIds:l?.map(e=>e.runId)}:void 0,configurable:!0}),p}async generate(e,t,r){let i;if(!Array.isArray(e))throw Error("Argument 'prompts' is expected to be a string[]");i=Array.isArray(t)?{stop:t}:t;let[n,a]=this._separateRunnableConfigFromCallOptionsCompat(i);if(n.callbacks=n.callbacks??r,!this.cache)return this._generateUncached(e,a,n);let{cache:s}=this,o=this._getSerializedCacheKeyParametersForCall(a),{generations:l,missingPromptIndices:u,startedRunManagers:c}=await this._generateCached({prompts:e,cache:s,llmStringKey:o,parsedOptions:a,handledOptions:n,runId:n.runId}),d={};if(u.length>0){let t=await this._generateUncached(u.map(t=>e[t]),a,n,void 0!==c?u.map(e=>c?.[e]):void 0);await Promise.all(t.generations.map(async(t,r)=>{let i=u[r];return l[i]=t,s.update(e[i],o,t)})),d=t.llmOutput??{}}return{generations:l,llmOutput:d}}_identifyingParams(){return{}}_modelType(){return"base_llm"}},_6=class extends _2{async _generate(e,t,r){return{generations:await Promise.all(e.map((e,i)=>this._call(e,{...t,promptIndex:i},r).then(e=>[{text:e}])))}}};iP({},{chunkArray:()=>_9});let _9=(e,t)=>e.reduce((e,r,i)=>{let n=Math.floor(i/t),a=e[n]||[];return e[n]=a.concat([r]),e},[]);iP({},{Embeddings:()=>_5});var _5=class{caller;constructor(e){this.caller=new o3(e??{})}},gL=gL;function _3(){let e,t;return{localeError:(e={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}},t={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Invalid input: expected ${r.expected}, received ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Invalid input: expected ${uu(r.values[0])}`;return`Invalid option: expected one of ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Too big: expected ${r.origin??"value"} to have ${t}${r.maximum.toString()} ${i.unit??"elements"}`;return`Too big: expected ${r.origin??"value"} to be ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Too small: expected ${r.origin} to have ${t}${r.minimum.toString()} ${i.unit}`;return`Too small: expected ${r.origin} to be ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Invalid string: must start with "${r.prefix}"`;if("ends_with"===r.format)return`Invalid string: must end with "${r.suffix}"`;if("includes"===r.format)return`Invalid string: must include "${r.includes}"`;if("regex"===r.format)return`Invalid string: must match pattern ${r.pattern}`;return`Invalid ${t[r.format]??r.format}`;case"not_multiple_of":return`Invalid number: must be a multiple of ${r.divisor}`;case"unrecognized_keys":return`Unrecognized key${r.keys.length>1?"s":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`Invalid key in ${r.origin}`;case"invalid_union":default:return"Invalid input";case"invalid_element":return`Invalid value in ${r.origin}`}})}}ls(_3()),e.s([],54048),e.i(54048),e.s([],82811),e.i(82811),e.i(27438),e.i(15143),e.i(67021),e.i(39510),e.s(["$ZodAny",0,cq,"$ZodArray",0,cK,"$ZodBase64",0,cT,"$ZodBase64URL",0,cN,"$ZodBigInt",0,cM,"$ZodBigIntFormat",0,cD,"$ZodBoolean",0,cz,"$ZodCIDRv4",0,cO,"$ZodCIDRv6",0,cS,"$ZodCUID",0,cf,"$ZodCUID2",0,cg,"$ZodCatch",0,df,"$ZodCustom",0,dk,"$ZodCustomStringFormat",0,cR,"$ZodDate",0,cH,"$ZodDefault",0,du,"$ZodDiscriminatedUnion",0,c4,"$ZodE164",0,cC,"$ZodEmail",0,cd,"$ZodEmoji",0,ch,"$ZodEnum",0,dr,"$ZodFile",0,dn,"$ZodGUID",0,cu,"$ZodIPv4",0,ck,"$ZodIPv6",0,cI,"$ZodISODate",0,cw,"$ZodISODateTime",0,cb,"$ZodISODuration",0,cx,"$ZodISOTime",0,c$,"$ZodIntersection",0,c2,"$ZodJWT",0,cj,"$ZodKSUID",0,cv,"$ZodLazy",0,dx,"$ZodLiteral",0,di,"$ZodMap",0,c8,"$ZodNaN",0,dg,"$ZodNanoID",0,cm,"$ZodNever",0,cJ,"$ZodNonOptional",0,dp,"$ZodNull",0,cB,"$ZodNullable",0,dl,"$ZodNumber",0,cL,"$ZodNumberFormat",0,cU,"$ZodObject",0,cQ,"$ZodOptional",0,ds,"$ZodPipe",0,dy,"$ZodPrefault",0,dd,"$ZodPromise",0,d$,"$ZodReadonly",0,dv,"$ZodRecord",0,c3,"$ZodSet",0,de,"$ZodString",0,co,"$ZodStringFormat",0,cl,"$ZodSuccess",0,dm,"$ZodSymbol",0,cZ,"$ZodTemplateLiteral",0,dw,"$ZodTransform",0,da,"$ZodTuple",0,c9,"$ZodType",0,cs,"$ZodULID",0,cy,"$ZodURL",0,cp,"$ZodUUID",0,cc,"$ZodUndefined",0,cF,"$ZodUnion",0,c1,"$ZodUnknown",0,cW,"$ZodVoid",0,cG,"$ZodXID",0,c_,"clone",()=>us,"isValidBase64",()=>cE,"isValidBase64URL",()=>cA,"isValidJWT",()=>cP],62429),e.i(62429),e.i(36608),e.i(22824);var _8=hd,_7=e.i(21131);function ve(e,t,r,i){let n=Math.abs(e),a=n%10,s=n%100;return s>=11&&s<=19?i:1===a?t:a>=2&&a<=4?r:i}function vt(e,t,r,i){let n=Math.abs(e),a=n%10,s=n%100;return s>=11&&s<=19?i:1===a?t:a>=2&&a<=4?r:i}e.s([],79113),e.i(79113),e.s(["ar",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},t={regex:"",email:" ",url:"",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ISO",date:"  ISO",time:"  ISO",duration:"  ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:"   IPv4",cidrv6:"   IPv6",base64:"  base64-encoded",base64url:"  base64url-encoded",json_string:"   JSON",e164:"   E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return`  :   ${r.expected}    ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`  :   ${uu(r.values[0])}`;return`  :     : ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`   :    ${r.origin??""} ${t} ${r.maximum.toString()} ${i.unit??""}`;return`  :    ${r.origin??""} ${t} ${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`  :   ${r.origin}   ${t} ${r.minimum.toString()} ${i.unit}`;return`  :   ${r.origin}   ${t} ${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`  :     "${r.prefix}"`;if("ends_with"===r.format)return`  :     "${r.suffix}"`;if("includes"===r.format)return`  :    "${r.includes}"`;if("regex"===r.format)return`  :     ${r.pattern}`;return`${t[r.format]??r.format}  `;case"not_multiple_of":return`  :      ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"":""} ${r.keys.length>1?"":""}: ${lK(r.keys," ")}`;case"invalid_key":return`    ${r.origin}`;case"invalid_union":default:return"  ";case"invalid_element":return`    ${r.origin}`}})}},"az",0,function(){let e,t;return{localeError:(e={string:{unit:"simvol",verb:"olmaldr"},file:{unit:"bayt",verb:"olmaldr"},array:{unit:"element",verb:"olmaldr"},set:{unit:"element",verb:"olmaldr"}},t={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Yanl dyr: g\xf6zlniln ${r.expected}, daxil olan ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Yanl dyr: g\xf6zlniln ${uu(r.values[0])}`;return`Yanl se\xe7im: aadaklardan biri olmaldr: ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`\xc7ox b\xf6y\xfck: g\xf6zlniln ${r.origin??"dyr"} ${t}${r.maximum.toString()} ${i.unit??"element"}`;return`\xc7ox b\xf6y\xfck: g\xf6zlniln ${r.origin??"dyr"} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`\xc7ox ki\xe7ik: g\xf6zlniln ${r.origin} ${t}${r.minimum.toString()} ${i.unit}`;return`\xc7ox ki\xe7ik: g\xf6zlniln ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Yanl mtn: "${r.prefix}" il balamaldr`;if("ends_with"===r.format)return`Yanl mtn: "${r.suffix}" il bitmlidir`;if("includes"===r.format)return`Yanl mtn: "${r.includes}" daxil olmaldr`;if("regex"===r.format)return`Yanl mtn: ${r.pattern} ablonuna uyun olmaldr`;return`Yanl ${t[r.format]??r.format}`;case"not_multiple_of":return`Yanl dd: ${r.divisor} il b\xf6l\xfcn biln olmaldr`;case"unrecognized_keys":return`Tannmayan a\xe7ar${r.keys.length>1?"lar":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`${r.origin} daxilind yanl a\xe7ar`;case"invalid_union":return"Yanl dyr";case"invalid_element":return`${r.origin} daxilind yanl dyr`;default:return`Yanl dyr`}})}},"be",0,function(){let e,t;return{localeError:(e={string:{unit:{one:"",few:"",many:""},verb:""},array:{unit:{one:"",few:"",many:""},verb:""},set:{unit:{one:"",few:"",many:""},verb:""},file:{unit:{one:"",few:"",many:""},verb:""}},t={regex:"",email:"email ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"   base64",base64url:"   base64url",json_string:"JSON ",e164:" E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` :  ${uu(r.values[0])}`;return` :    ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i){let e=ve(Number(r.maximum),i.unit.one,i.unit.few,i.unit.many);return` : ,  ${r.origin??""}  ${i.verb} ${t}${r.maximum.toString()} ${e}`}return` : ,  ${r.origin??""}   ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i){let e=ve(Number(r.minimum),i.unit.one,i.unit.few,i.unit.many);return` : ,  ${r.origin}  ${i.verb} ${t}${r.minimum.toString()} ${e}`}return` : ,  ${r.origin}   ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` :    "${r.prefix}"`;if("ends_with"===r.format)return` :    "${r.suffix}"`;if("includes"===r.format)return` :   "${r.includes}"`;if("regex"===r.format)return` :    ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` :    ${r.divisor}`;case"unrecognized_keys":return` ${r.keys.length>1?"":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return" ";case"invalid_element":return`   ${r.origin}`;default:return` `}})}},"ca",0,function(){let e,t;return{localeError:(e={string:{unit:"carcters",verb:"contenir"},file:{unit:"bytes",verb:"contenir"},array:{unit:"elements",verb:"contenir"},set:{unit:"elements",verb:"contenir"}},t={regex:"entrada",email:"adrea electrnica",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i hora ISO",date:"data ISO",time:"hora ISO",duration:"durada ISO",ipv4:"adrea IPv4",ipv6:"adrea IPv6",cidrv4:"rang IPv4",cidrv6:"rang IPv6",base64:"cadena codificada en base64",base64url:"cadena codificada en base64url",json_string:"cadena JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"},r=>{switch(r.code){case"invalid_type":return`Tipus inv\xe0lid: s'esperava ${r.expected}, s'ha rebut ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Valor inv\xe0lid: s'esperava ${uu(r.values[0])}`;return`Opci\xf3 inv\xe0lida: s'esperava una de ${lK(r.values," o ")}`;case"too_big":{let t=r.inclusive?"com a mxim":"menys de",i=e[r.origin]??null;if(i)return`Massa gran: s'esperava que ${r.origin??"el valor"} contingu\xe9s ${t} ${r.maximum.toString()} ${i.unit??"elements"}`;return`Massa gran: s'esperava que ${r.origin??"el valor"} fos ${t} ${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?"com a mnim":"ms de",i=e[r.origin]??null;if(i)return`Massa petit: s'esperava que ${r.origin} contingu\xe9s ${t} ${r.minimum.toString()} ${i.unit}`;return`Massa petit: s'esperava que ${r.origin} fos ${t} ${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Format inv\xe0lid: ha de comen\xe7ar amb "${r.prefix}"`;if("ends_with"===r.format)return`Format inv\xe0lid: ha d'acabar amb "${r.suffix}"`;if("includes"===r.format)return`Format inv\xe0lid: ha d'incloure "${r.includes}"`;if("regex"===r.format)return`Format inv\xe0lid: ha de coincidir amb el patr\xf3 ${r.pattern}`;return`Format inv\xe0lid per a ${t[r.format]??r.format}`;case"not_multiple_of":return`N\xfamero inv\xe0lid: ha de ser m\xfaltiple de ${r.divisor}`;case"unrecognized_keys":return`Clau${r.keys.length>1?"s":""} no reconeguda${r.keys.length>1?"s":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`Clau inv\xe0lida a ${r.origin}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Element inv\xe0lid a ${r.origin}`;default:return`Entrada inv\xe0lida`}})}},"cs",0,function(){let e,t;return{localeError:(e={string:{unit:"znak",verb:"mt"},file:{unit:"bajt",verb:"mt"},array:{unit:"prvk",verb:"mt"},set:{unit:"prvk",verb:"mt"}},t={regex:"regulrn vraz",email:"e-mailov adresa",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"datum a as ve formtu ISO",date:"datum ve formtu ISO",time:"as ve formtu ISO",duration:"doba trvn ISO",ipv4:"IPv4 adresa",ipv6:"IPv6 adresa",cidrv4:"rozsah IPv4",cidrv6:"rozsah IPv6",base64:"etzec zakdovan ve formtu base64",base64url:"etzec zakdovan ve formtu base64url",json_string:"etzec ve formtu JSON",e164:"slo E.164",jwt:"JWT",template_literal:"vstup"},r=>{switch(r.code){case"invalid_type":return`Neplatn\xfd vstup: oek\xe1v\xe1no ${r.expected}, obdreno ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"slo";case"string":return"etzec";case"boolean":return"boolean";case"bigint":return"bigint";case"function":return"funkce";case"symbol":return"symbol";case"undefined":return"undefined";case"object":if(Array.isArray(e))return"pole";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Neplatn\xfd vstup: oek\xe1v\xe1no ${uu(r.values[0])}`;return`Neplatn\xe1 monost: oek\xe1v\xe1na jedna z hodnot ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Hodnota je p\xedli velk\xe1: ${r.origin??"hodnota"} mus\xed m\xedt ${t}${r.maximum.toString()} ${i.unit??"prvk"}`;return`Hodnota je p\xedli velk\xe1: ${r.origin??"hodnota"} mus\xed b\xfdt ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Hodnota je p\xedli mal\xe1: ${r.origin??"hodnota"} mus\xed m\xedt ${t}${r.minimum.toString()} ${i.unit??"prvk"}`;return`Hodnota je p\xedli mal\xe1: ${r.origin??"hodnota"} mus\xed b\xfdt ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Neplatn\xfd etzec: mus\xed za\xednat na "${r.prefix}"`;if("ends_with"===r.format)return`Neplatn\xfd etzec: mus\xed konit na "${r.suffix}"`;if("includes"===r.format)return`Neplatn\xfd etzec: mus\xed obsahovat "${r.includes}"`;if("regex"===r.format)return`Neplatn\xfd etzec: mus\xed odpov\xeddat vzoru ${r.pattern}`;return`Neplatn\xfd form\xe1t ${t[r.format]??r.format}`;case"not_multiple_of":return`Neplatn\xe9 \xedslo: mus\xed b\xfdt n\xe1sobkem ${r.divisor}`;case"unrecognized_keys":return`Nezn\xe1m\xe9 kl\xede: ${lK(r.keys,", ")}`;case"invalid_key":return`Neplatn\xfd kl\xed v ${r.origin}`;case"invalid_union":return"Neplatn vstup";case"invalid_element":return`Neplatn\xe1 hodnota v ${r.origin}`;default:return`Neplatn\xfd vstup`}})}},"de",0,function(){let e,t;return{localeError:(e={string:{unit:"Zeichen",verb:"zu haben"},file:{unit:"Bytes",verb:"zu haben"},array:{unit:"Elemente",verb:"zu haben"},set:{unit:"Elemente",verb:"zu haben"}},t={regex:"Eingabe",email:"E-Mail-Adresse",url:"URL",emoji:"Emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-Datum und -Uhrzeit",date:"ISO-Datum",time:"ISO-Uhrzeit",duration:"ISO-Dauer",ipv4:"IPv4-Adresse",ipv6:"IPv6-Adresse",cidrv4:"IPv4-Bereich",cidrv6:"IPv6-Bereich",base64:"Base64-codierter String",base64url:"Base64-URL-codierter String",json_string:"JSON-String",e164:"E.164-Nummer",jwt:"JWT",template_literal:"Eingabe"},r=>{switch(r.code){case"invalid_type":return`Ung\xfcltige Eingabe: erwartet ${r.expected}, erhalten ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"Zahl";case"object":if(Array.isArray(e))return"Array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ung\xfcltige Eingabe: erwartet ${uu(r.values[0])}`;return`Ung\xfcltige Option: erwartet eine von ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Zu gro\xdf: erwartet, dass ${r.origin??"Wert"} ${t}${r.maximum.toString()} ${i.unit??"Elemente"} hat`;return`Zu gro\xdf: erwartet, dass ${r.origin??"Wert"} ${t}${r.maximum.toString()} ist`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Zu klein: erwartet, dass ${r.origin} ${t}${r.minimum.toString()} ${i.unit} hat`;return`Zu klein: erwartet, dass ${r.origin} ${t}${r.minimum.toString()} ist`}case"invalid_format":if("starts_with"===r.format)return`Ung\xfcltiger String: muss mit "${r.prefix}" beginnen`;if("ends_with"===r.format)return`Ung\xfcltiger String: muss mit "${r.suffix}" enden`;if("includes"===r.format)return`Ung\xfcltiger String: muss "${r.includes}" enthalten`;if("regex"===r.format)return`Ung\xfcltiger String: muss dem Muster ${r.pattern} entsprechen`;return`Ung\xfcltig: ${t[r.format]??r.format}`;case"not_multiple_of":return`Ung\xfcltige Zahl: muss ein Vielfaches von ${r.divisor} sein`;case"unrecognized_keys":return`${r.keys.length>1?"Unbekannte Schlssel":"Unbekannter Schlssel"}: ${lK(r.keys,", ")}`;case"invalid_key":return`Ung\xfcltiger Schl\xfcssel in ${r.origin}`;case"invalid_union":return"Ungltige Eingabe";case"invalid_element":return`Ung\xfcltiger Wert in ${r.origin}`;default:return`Ung\xfcltige Eingabe`}})}},"en",0,_3,"eo",0,function(){let e,t;return{localeError:(e={string:{unit:"karaktrojn",verb:"havi"},file:{unit:"bajtojn",verb:"havi"},array:{unit:"elementojn",verb:"havi"},set:{unit:"elementojn",verb:"havi"}},t={regex:"enigo",email:"retadreso",url:"URL",emoji:"emoio",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datotempo",date:"ISO-dato",time:"ISO-tempo",duration:"ISO-daro",ipv4:"IPv4-adreso",ipv6:"IPv6-adreso",cidrv4:"IPv4-rango",cidrv6:"IPv6-rango",base64:"64-ume kodita karaktraro",base64url:"URL-64-ume kodita karaktraro",json_string:"JSON-karaktraro",e164:"E.164-nombro",jwt:"JWT",template_literal:"enigo"},r=>{switch(r.code){case"invalid_type":return`Nevalida enigo: atendiis ${r.expected}, riceviis ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nombro";case"object":if(Array.isArray(e))return"tabelo";if(null===e)return"senvalora";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Nevalida enigo: atendiis ${uu(r.values[0])}`;return`Nevalida opcio: atendiis unu el ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Tro granda: atendiis ke ${r.origin??"valoro"} havu ${t}${r.maximum.toString()} ${i.unit??"elementojn"}`;return`Tro granda: atendiis ke ${r.origin??"valoro"} havu ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Tro malgranda: atendiis ke ${r.origin} havu ${t}${r.minimum.toString()} ${i.unit}`;return`Tro malgranda: atendiis ke ${r.origin} estu ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Nevalida karaktraro: devas komencii per "${r.prefix}"`;if("ends_with"===r.format)return`Nevalida karaktraro: devas finii per "${r.suffix}"`;if("includes"===r.format)return`Nevalida karaktraro: devas inkluzivi "${r.includes}"`;if("regex"===r.format)return`Nevalida karaktraro: devas kongrui kun la modelo ${r.pattern}`;return`Nevalida ${t[r.format]??r.format}`;case"not_multiple_of":return`Nevalida nombro: devas esti oblo de ${r.divisor}`;case"unrecognized_keys":return`Nekonata${r.keys.length>1?"j":""} losilo${r.keys.length>1?"j":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`Nevalida losilo en ${r.origin}`;case"invalid_union":default:return"Nevalida enigo";case"invalid_element":return`Nevalida valoro en ${r.origin}`}})}},"es",0,function(){let e,t;return{localeError:(e={string:{unit:"caracteres",verb:"tener"},file:{unit:"bytes",verb:"tener"},array:{unit:"elementos",verb:"tener"},set:{unit:"elementos",verb:"tener"}},t={regex:"entrada",email:"direccin de correo electrnico",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"fecha y hora ISO",date:"fecha ISO",time:"hora ISO",duration:"duracin ISO",ipv4:"direccin IPv4",ipv6:"direccin IPv6",cidrv4:"rango IPv4",cidrv6:"rango IPv6",base64:"cadena codificada en base64",base64url:"URL codificada en base64",json_string:"cadena JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"},r=>{switch(r.code){case"invalid_type":return`Entrada inv\xe1lida: se esperaba ${r.expected}, recibido ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nmero";case"object":if(Array.isArray(e))return"arreglo";if(null===e)return"nulo";if(Object.getPrototypeOf(e)!==Object.prototype)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Entrada inv\xe1lida: se esperaba ${uu(r.values[0])}`;return`Opci\xf3n inv\xe1lida: se esperaba una de ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Demasiado grande: se esperaba que ${r.origin??"valor"} tuviera ${t}${r.maximum.toString()} ${i.unit??"elementos"}`;return`Demasiado grande: se esperaba que ${r.origin??"valor"} fuera ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Demasiado peque\xf1o: se esperaba que ${r.origin} tuviera ${t}${r.minimum.toString()} ${i.unit}`;return`Demasiado peque\xf1o: se esperaba que ${r.origin} fuera ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Cadena inv\xe1lida: debe comenzar con "${r.prefix}"`;if("ends_with"===r.format)return`Cadena inv\xe1lida: debe terminar en "${r.suffix}"`;if("includes"===r.format)return`Cadena inv\xe1lida: debe incluir "${r.includes}"`;if("regex"===r.format)return`Cadena inv\xe1lida: debe coincidir con el patr\xf3n ${r.pattern}`;return`Inv\xe1lido ${t[r.format]??r.format}`;case"not_multiple_of":return`N\xfamero inv\xe1lido: debe ser m\xfaltiplo de ${r.divisor}`;case"unrecognized_keys":return`Llave${r.keys.length>1?"s":""} desconocida${r.keys.length>1?"s":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`Llave inv\xe1lida en ${r.origin}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Valor inv\xe1lido en ${r.origin}`;default:return`Entrada inv\xe1lida`}})}},"fa",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},t={regex:"",email:" ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ",date:" ",time:" ",duration:"  ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected}  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}  `;case"invalid_value":if(1===r.values.length)return` :  ${uu(r.values[0])} `;return` :    ${lK(r.values,"|")} `;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` : ${r.origin??""}  ${t}${r.maximum.toString()} ${i.unit??""} `;return` : ${r.origin??""}  ${t}${r.maximum.toString()} `}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` : ${r.origin}  ${t}${r.minimum.toString()} ${i.unit} `;return` : ${r.origin}  ${t}${r.minimum.toString()} `}case"invalid_format":if("starts_with"===r.format)return` :   "${r.prefix}"  `;if("ends_with"===r.format)return` :   "${r.suffix}"  `;if("includes"===r.format)return` :   "${r.includes}" `;if("regex"===r.format)return` :    ${r.pattern}   `;return`${t[r.format]??r.format} `;case"not_multiple_of":return` :   ${r.divisor} `;case"unrecognized_keys":return`${r.keys.length>1?"":""} : ${lK(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":default:return` `;case"invalid_element":return`   ${r.origin}`}})}},"fi",0,function(){let e,t;return{localeError:(e={string:{unit:"merkki",subject:"merkkijonon"},file:{unit:"tavua",subject:"tiedoston"},array:{unit:"alkiota",subject:"listan"},set:{unit:"alkiota",subject:"joukon"},number:{unit:"",subject:"luvun"},bigint:{unit:"",subject:"suuren kokonaisluvun"},int:{unit:"",subject:"kokonaisluvun"},date:{unit:"",subject:"pivmrn"}},t={regex:"snnllinen lauseke",email:"shkpostiosoite",url:"URL-osoite",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-aikaleima",date:"ISO-pivmr",time:"ISO-aika",duration:"ISO-kesto",ipv4:"IPv4-osoite",ipv6:"IPv6-osoite",cidrv4:"IPv4-alue",cidrv6:"IPv6-alue",base64:"base64-koodattu merkkijono",base64url:"base64url-koodattu merkkijono",json_string:"JSON-merkkijono",e164:"E.164-luku",jwt:"JWT",template_literal:"templaattimerkkijono"},r=>{switch(r.code){case"invalid_type":return`Virheellinen tyyppi: odotettiin ${r.expected}, oli ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Virheellinen sy\xf6te: t\xe4ytyy olla ${uu(r.values[0])}`;return`Virheellinen valinta: t\xe4ytyy olla yksi seuraavista: ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Liian suuri: ${i.subject} t\xe4ytyy olla ${t}${r.maximum.toString()} ${i.unit}`.trim();return`Liian suuri: arvon t\xe4ytyy olla ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Liian pieni: ${i.subject} t\xe4ytyy olla ${t}${r.minimum.toString()} ${i.unit}`.trim();return`Liian pieni: arvon t\xe4ytyy olla ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Virheellinen sy\xf6te: t\xe4ytyy alkaa "${r.prefix}"`;if("ends_with"===r.format)return`Virheellinen sy\xf6te: t\xe4ytyy loppua "${r.suffix}"`;if("includes"===r.format)return`Virheellinen sy\xf6te: t\xe4ytyy sis\xe4lt\xe4\xe4 "${r.includes}"`;if("regex"===r.format)return`Virheellinen sy\xf6te: t\xe4ytyy vastata s\xe4\xe4nn\xf6llist\xe4 lauseketta ${r.pattern}`;return`Virheellinen ${t[r.format]??r.format}`;case"not_multiple_of":return`Virheellinen luku: t\xe4ytyy olla luvun ${r.divisor} monikerta`;case"unrecognized_keys":return`${r.keys.length>1?"Tuntemattomat avaimet":"Tuntematon avain"}: ${lK(r.keys,", ")}`;case"invalid_key":return"Virheellinen avain tietueessa";case"invalid_union":return"Virheellinen unioni";case"invalid_element":return"Virheellinen arvo joukossa";default:return`Virheellinen sy\xf6te`}})}},"fr",0,function(){let e,t;return{localeError:(e={string:{unit:"caractres",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"lments",verb:"avoir"},set:{unit:"lments",verb:"avoir"}},t={regex:"entre",email:"adresse e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date et heure ISO",date:"date ISO",time:"heure ISO",duration:"dure ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chane encode en base64",base64url:"chane encode en base64url",json_string:"chane JSON",e164:"numro E.164",jwt:"JWT",template_literal:"entre"},r=>{switch(r.code){case"invalid_type":return`Entr\xe9e invalide : ${r.expected} attendu, ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nombre";case"object":if(Array.isArray(e))return"tableau";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)} re\xe7u`;case"invalid_value":if(1===r.values.length)return`Entr\xe9e invalide : ${uu(r.values[0])} attendu`;return`Option invalide : une valeur parmi ${lK(r.values,"|")} attendue`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Trop grand : ${r.origin??"valeur"} doit ${i.verb} ${t}${r.maximum.toString()} ${i.unit??"lment(s)"}`;return`Trop grand : ${r.origin??"valeur"} doit \xeatre ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Trop petit : ${r.origin} doit ${i.verb} ${t}${r.minimum.toString()} ${i.unit}`;return`Trop petit : ${r.origin} doit \xeatre ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Cha\xeene invalide : doit commencer par "${r.prefix}"`;if("ends_with"===r.format)return`Cha\xeene invalide : doit se terminer par "${r.suffix}"`;if("includes"===r.format)return`Cha\xeene invalide : doit inclure "${r.includes}"`;if("regex"===r.format)return`Cha\xeene invalide : doit correspondre au mod\xe8le ${r.pattern}`;return`${t[r.format]??r.format} invalide`;case"not_multiple_of":return`Nombre invalide : doit \xeatre un multiple de ${r.divisor}`;case"unrecognized_keys":return`Cl\xe9${r.keys.length>1?"s":""} non reconnue${r.keys.length>1?"s":""} : ${lK(r.keys,", ")}`;case"invalid_key":return`Cl\xe9 invalide dans ${r.origin}`;case"invalid_union":return"Entre invalide";case"invalid_element":return`Valeur invalide dans ${r.origin}`;default:return`Entr\xe9e invalide`}})}},"frCA",0,function(){let e,t;return{localeError:(e={string:{unit:"caractres",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"lments",verb:"avoir"},set:{unit:"lments",verb:"avoir"}},t={regex:"entre",email:"adresse courriel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date-heure ISO",date:"date ISO",time:"heure ISO",duration:"dure ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chane encode en base64",base64url:"chane encode en base64url",json_string:"chane JSON",e164:"numro E.164",jwt:"JWT",template_literal:"entre"},r=>{switch(r.code){case"invalid_type":return`Entr\xe9e invalide : attendu ${r.expected}, re\xe7u ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Entr\xe9e invalide : attendu ${uu(r.values[0])}`;return`Option invalide : attendu l'une des valeurs suivantes ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"":"<",i=e[r.origin]??null;if(i)return`Trop grand : attendu que ${r.origin??"la valeur"} ait ${t}${r.maximum.toString()} ${i.unit}`;return`Trop grand : attendu que ${r.origin??"la valeur"} soit ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?"":">",i=e[r.origin]??null;if(i)return`Trop petit : attendu que ${r.origin} ait ${t}${r.minimum.toString()} ${i.unit}`;return`Trop petit : attendu que ${r.origin} soit ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Cha\xeene invalide : doit commencer par "${r.prefix}"`;if("ends_with"===r.format)return`Cha\xeene invalide : doit se terminer par "${r.suffix}"`;if("includes"===r.format)return`Cha\xeene invalide : doit inclure "${r.includes}"`;if("regex"===r.format)return`Cha\xeene invalide : doit correspondre au motif ${r.pattern}`;return`${t[r.format]??r.format} invalide`;case"not_multiple_of":return`Nombre invalide : doit \xeatre un multiple de ${r.divisor}`;case"unrecognized_keys":return`Cl\xe9${r.keys.length>1?"s":""} non reconnue${r.keys.length>1?"s":""} : ${lK(r.keys,", ")}`;case"invalid_key":return`Cl\xe9 invalide dans ${r.origin}`;case"invalid_union":return"Entre invalide";case"invalid_element":return`Valeur invalide dans ${r.origin}`;default:return`Entr\xe9e invalide`}})}},"he",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:" ",url:" ",emoji:"'",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"  ISO",date:" ISO",time:" ISO",duration:"  ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:"  64",base64url:"  64  ",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return`  :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`  :  ${uu(r.values[0])}`;return`  :     ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` : ${r.origin??"value"}   ${t}${r.maximum.toString()} ${i.unit??"elements"}`;return` : ${r.origin??"value"}   ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` : ${r.origin}   ${t}${r.minimum.toString()} ${i.unit}`;return` : ${r.origin}   ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`  :   "${r.prefix}"`;if("ends_with"===r.format)return`  :    "${r.suffix}"`;if("includes"===r.format)return`  :   "${r.includes}"`;if("regex"===r.format)return`  :    ${r.pattern}`;return`${t[r.format]??r.format}  `;case"not_multiple_of":return`  :     ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"":""}  ${r.keys.length>1?"":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return"  ";case"invalid_element":return`   ${r.origin}`;default:return`  `}})}},"hu",0,function(){let e,t;return{localeError:(e={string:{unit:"karakter",verb:"legyen"},file:{unit:"byte",verb:"legyen"},array:{unit:"elem",verb:"legyen"},set:{unit:"elem",verb:"legyen"}},t={regex:"bemenet",email:"email cm",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO idblyeg",date:"ISO dtum",time:"ISO id",duration:"ISO idintervallum",ipv4:"IPv4 cm",ipv6:"IPv6 cm",cidrv4:"IPv4 tartomny",cidrv6:"IPv6 tartomny",base64:"base64-kdolt string",base64url:"base64url-kdolt string",json_string:"JSON string",e164:"E.164 szm",jwt:"JWT",template_literal:"bemenet"},r=>{switch(r.code){case"invalid_type":return`\xc9rv\xe9nytelen bemenet: a v\xe1rt \xe9rt\xe9k ${r.expected}, a kapott \xe9rt\xe9k ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"szm";case"object":if(Array.isArray(e))return"tmb";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`\xc9rv\xe9nytelen bemenet: a v\xe1rt \xe9rt\xe9k ${uu(r.values[0])}`;return`\xc9rv\xe9nytelen opci\xf3: valamelyik \xe9rt\xe9k v\xe1rt ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`T\xfal nagy: ${r.origin??"rtk"} m\xe9rete t\xfal nagy ${t}${r.maximum.toString()} ${i.unit??"elem"}`;return`T\xfal nagy: a bemeneti \xe9rt\xe9k ${r.origin??"rtk"} t\xfal nagy: ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`T\xfal kicsi: a bemeneti \xe9rt\xe9k ${r.origin} m\xe9rete t\xfal kicsi ${t}${r.minimum.toString()} ${i.unit}`;return`T\xfal kicsi: a bemeneti \xe9rt\xe9k ${r.origin} t\xfal kicsi ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`\xc9rv\xe9nytelen string: "${r.prefix}" \xe9rt\xe9kkel kell kezddnie`;if("ends_with"===r.format)return`\xc9rv\xe9nytelen string: "${r.suffix}" \xe9rt\xe9kkel kell v\xe9gzdnie`;if("includes"===r.format)return`\xc9rv\xe9nytelen string: "${r.includes}" \xe9rt\xe9ket kell tartalmaznia`;if("regex"===r.format)return`\xc9rv\xe9nytelen string: ${r.pattern} mint\xe1nak kell megfelelnie`;return`\xc9rv\xe9nytelen ${t[r.format]??r.format}`;case"not_multiple_of":return`\xc9rv\xe9nytelen sz\xe1m: ${r.divisor} t\xf6bbsz\xf6r\xf6s\xe9nek kell lennie`;case"unrecognized_keys":return`Ismeretlen kulcs${r.keys.length>1?"s":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`\xc9rv\xe9nytelen kulcs ${r.origin}`;case"invalid_union":return"rvnytelen bemenet";case"invalid_element":return`\xc9rv\xe9nytelen \xe9rt\xe9k: ${r.origin}`;default:return`\xc9rv\xe9nytelen bemenet`}})}},"id",0,function(){let e,t;return{localeError:(e={string:{unit:"karakter",verb:"memiliki"},file:{unit:"byte",verb:"memiliki"},array:{unit:"item",verb:"memiliki"},set:{unit:"item",verb:"memiliki"}},t={regex:"input",email:"alamat email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tanggal dan waktu format ISO",date:"tanggal format ISO",time:"jam format ISO",duration:"durasi format ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"rentang alamat IPv4",cidrv6:"rentang alamat IPv6",base64:"string dengan enkode base64",base64url:"string dengan enkode base64url",json_string:"string JSON",e164:"angka E.164",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Input tidak valid: diharapkan ${r.expected}, diterima ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Input tidak valid: diharapkan ${uu(r.values[0])}`;return`Pilihan tidak valid: diharapkan salah satu dari ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Terlalu besar: diharapkan ${r.origin??"value"} memiliki ${t}${r.maximum.toString()} ${i.unit??"elemen"}`;return`Terlalu besar: diharapkan ${r.origin??"value"} menjadi ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Terlalu kecil: diharapkan ${r.origin} memiliki ${t}${r.minimum.toString()} ${i.unit}`;return`Terlalu kecil: diharapkan ${r.origin} menjadi ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`String tidak valid: harus dimulai dengan "${r.prefix}"`;if("ends_with"===r.format)return`String tidak valid: harus berakhir dengan "${r.suffix}"`;if("includes"===r.format)return`String tidak valid: harus menyertakan "${r.includes}"`;if("regex"===r.format)return`String tidak valid: harus sesuai pola ${r.pattern}`;return`${t[r.format]??r.format} tidak valid`;case"not_multiple_of":return`Angka tidak valid: harus kelipatan dari ${r.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali ${r.keys.length>1?"s":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`Kunci tidak valid di ${r.origin}`;case"invalid_union":default:return"Input tidak valid";case"invalid_element":return`Nilai tidak valid di ${r.origin}`}})}},"it",0,function(){let e,t;return{localeError:(e={string:{unit:"caratteri",verb:"avere"},file:{unit:"byte",verb:"avere"},array:{unit:"elementi",verb:"avere"},set:{unit:"elementi",verb:"avere"}},t={regex:"input",email:"indirizzo email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e ora ISO",date:"data ISO",time:"ora ISO",duration:"durata ISO",ipv4:"indirizzo IPv4",ipv6:"indirizzo IPv6",cidrv4:"intervallo IPv4",cidrv6:"intervallo IPv6",base64:"stringa codificata in base64",base64url:"URL codificata in base64",json_string:"stringa JSON",e164:"numero E.164",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Input non valido: atteso ${r.expected}, ricevuto ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"numero";case"object":if(Array.isArray(e))return"vettore";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Input non valido: atteso ${uu(r.values[0])}`;return`Opzione non valida: atteso uno tra ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Troppo grande: ${r.origin??"valore"} deve avere ${t}${r.maximum.toString()} ${i.unit??"elementi"}`;return`Troppo grande: ${r.origin??"valore"} deve essere ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Troppo piccolo: ${r.origin} deve avere ${t}${r.minimum.toString()} ${i.unit}`;return`Troppo piccolo: ${r.origin} deve essere ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Stringa non valida: deve iniziare con "${r.prefix}"`;if("ends_with"===r.format)return`Stringa non valida: deve terminare con "${r.suffix}"`;if("includes"===r.format)return`Stringa non valida: deve includere "${r.includes}"`;if("regex"===r.format)return`Stringa non valida: deve corrispondere al pattern ${r.pattern}`;return`Invalid ${t[r.format]??r.format}`;case"not_multiple_of":return`Numero non valido: deve essere un multiplo di ${r.divisor}`;case"unrecognized_keys":return`Chiav${r.keys.length>1?"i":"e"} non riconosciut${r.keys.length>1?"e":"a"}: ${lK(r.keys,", ")}`;case"invalid_key":return`Chiave non valida in ${r.origin}`;case"invalid_union":default:return"Input non valido";case"invalid_element":return`Valore non valido in ${r.origin}`}})}},"ja",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO",date:"ISO",time:"ISO",duration:"ISO",ipv4:"IPv4",ipv6:"IPv6",cidrv4:"IPv4",cidrv6:"IPv6",base64:"base64",base64url:"base64url",json_string:"JSON",e164:"E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return`: ${r.expected}${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`: ${uu(r.values[0])}`;return`: ${lK(r.values,"")}`;case"too_big":{let t=r.inclusive?"":"",i=e[r.origin]??null;if(i)return`: ${r.origin??""}${r.maximum.toString()}${i.unit??""}${t}`;return`: ${r.origin??""}${r.maximum.toString()}${t}`}case"too_small":{let t=r.inclusive?"":"",i=e[r.origin]??null;if(i)return`: ${r.origin}${r.minimum.toString()}${i.unit}${t}`;return`: ${r.origin}${r.minimum.toString()}${t}`}case"invalid_format":if("starts_with"===r.format)return`: "${r.prefix}"`;if("ends_with"===r.format)return`: "${r.suffix}"`;if("includes"===r.format)return`: "${r.includes}"`;if("regex"===r.format)return`: ${r.pattern}`;return`${t[r.format]??r.format}`;case"not_multiple_of":return`: ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"":""}: ${lK(r.keys,"")}`;case"invalid_key":return`${r.origin}`;case"invalid_union":return"";case"invalid_element":return`${r.origin}`;default:return``}})}},"kh",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"  ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:" base64",base64url:" base64url",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return`  ${r.expected}  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?" (NaN)":"";case"object":if(Array.isArray(e))return" (Array)";if(null===e)return" (null)";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`  ${uu(r.values[0])}`;return`  ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`  ${r.origin??""} ${t} ${r.maximum.toString()} ${i.unit??""}`;return`  ${r.origin??""} ${t} ${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`  ${r.origin} ${t} ${r.minimum.toString()} ${i.unit}`;return`  ${r.origin} ${t} ${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`  "${r.prefix}"`;if("ends_with"===r.format)return`  "${r.suffix}"`;if("includes"===r.format)return`  "${r.includes}"`;if("regex"===r.format)return`  ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return`  ${r.divisor}`;case"unrecognized_keys":return` ${lK(r.keys,", ")}`;case"invalid_key":return` ${r.origin}`;case"invalid_union":default:return``;case"invalid_element":return` ${r.origin}`}})}},"ko",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:"to have"},file:{unit:"",verb:"to have"},array:{unit:"",verb:"to have"},set:{unit:"",verb:"to have"}},t={regex:"",email:" ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64  ",base64url:"base64url  ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :   ${r.expected},   ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` :  ${uu(r.values[0])}  `;return` : ${lK(r.values," ")}   `;case"too_big":{let t=r.inclusive?"":"",i=""===t?" ":" ",n=e[r.origin]??null,a=n?.unit??"";if(n)return`${r.origin??""}  : ${r.maximum.toString()}${a} ${t}${i}`;return`${r.origin??""}  : ${r.maximum.toString()} ${t}${i}`}case"too_small":{let t=r.inclusive?"":"",i=""===t?" ":" ",n=e[r.origin]??null,a=n?.unit??"";if(n)return`${r.origin??""}  : ${r.minimum.toString()}${a} ${t}${i}`;return`${r.origin??""}  : ${r.minimum.toString()} ${t}${i}`}case"invalid_format":if("starts_with"===r.format)return` : "${r.prefix}"()  `;if("ends_with"===r.format)return` : "${r.suffix}"()  `;if("includes"===r.format)return` : "${r.includes}"()  `;if("regex"===r.format)return` :  ${r.pattern}   `;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` : ${r.divisor}  `;case"unrecognized_keys":return`   : ${lK(r.keys,", ")}`;case"invalid_key":return` : ${r.origin}`;case"invalid_union":default:return` `;case"invalid_element":return` : ${r.origin}`}})}},"mk",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},t={regex:"",email:"  -",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64- ",base64url:"base64url- ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :   ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Invalid input: expected ${uu(r.values[0])}`;return` :    ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` :   ${r.origin??""}   ${t}${r.maximum.toString()} ${i.unit??""}`;return` :   ${r.origin??""}   ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` :   ${r.origin}   ${t}${r.minimum.toString()} ${i.unit}`;return` :   ${r.origin}   ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` :     "${r.prefix}"`;if("ends_with"===r.format)return` :     "${r.suffix}"`;if("includes"===r.format)return` :    "${r.includes}"`;if("regex"===r.format)return` :      ${r.pattern}`;return`Invalid ${t[r.format]??r.format}`;case"not_multiple_of":return` :      ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?" ":" "}: ${lK(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return" ";case"invalid_element":return`   ${r.origin}`;default:return` `}})}},"ms",0,function(){let e,t;return{localeError:(e={string:{unit:"aksara",verb:"mempunyai"},file:{unit:"bait",verb:"mempunyai"},array:{unit:"elemen",verb:"mempunyai"},set:{unit:"elemen",verb:"mempunyai"}},t={regex:"input",email:"alamat e-mel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tarikh masa ISO",date:"tarikh ISO",time:"masa ISO",duration:"tempoh ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"julat IPv4",cidrv6:"julat IPv6",base64:"string dikodkan base64",base64url:"string dikodkan base64url",json_string:"string JSON",e164:"nombor E.164",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Input tidak sah: dijangka ${r.expected}, diterima ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nombor";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Input tidak sah: dijangka ${uu(r.values[0])}`;return`Pilihan tidak sah: dijangka salah satu daripada ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Terlalu besar: dijangka ${r.origin??"nilai"} ${i.verb} ${t}${r.maximum.toString()} ${i.unit??"elemen"}`;return`Terlalu besar: dijangka ${r.origin??"nilai"} adalah ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Terlalu kecil: dijangka ${r.origin} ${i.verb} ${t}${r.minimum.toString()} ${i.unit}`;return`Terlalu kecil: dijangka ${r.origin} adalah ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`String tidak sah: mesti bermula dengan "${r.prefix}"`;if("ends_with"===r.format)return`String tidak sah: mesti berakhir dengan "${r.suffix}"`;if("includes"===r.format)return`String tidak sah: mesti mengandungi "${r.includes}"`;if("regex"===r.format)return`String tidak sah: mesti sepadan dengan corak ${r.pattern}`;return`${t[r.format]??r.format} tidak sah`;case"not_multiple_of":return`Nombor tidak sah: perlu gandaan ${r.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali: ${lK(r.keys,", ")}`;case"invalid_key":return`Kunci tidak sah dalam ${r.origin}`;case"invalid_union":default:return"Input tidak sah";case"invalid_element":return`Nilai tidak sah dalam ${r.origin}`}})}},"nl",0,function(){let e,t;return{localeError:(e={string:{unit:"tekens"},file:{unit:"bytes"},array:{unit:"elementen"},set:{unit:"elementen"}},t={regex:"invoer",email:"emailadres",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum en tijd",date:"ISO datum",time:"ISO tijd",duration:"ISO duur",ipv4:"IPv4-adres",ipv6:"IPv6-adres",cidrv4:"IPv4-bereik",cidrv6:"IPv6-bereik",base64:"base64-gecodeerde tekst",base64url:"base64 URL-gecodeerde tekst",json_string:"JSON string",e164:"E.164-nummer",jwt:"JWT",template_literal:"invoer"},r=>{switch(r.code){case"invalid_type":return`Ongeldige invoer: verwacht ${r.expected}, ontving ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"getal";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ongeldige invoer: verwacht ${uu(r.values[0])}`;return`Ongeldige optie: verwacht \xe9\xe9n van ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Te lang: verwacht dat ${r.origin??"waarde"} ${t}${r.maximum.toString()} ${i.unit??"elementen"} bevat`;return`Te lang: verwacht dat ${r.origin??"waarde"} ${t}${r.maximum.toString()} is`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Te kort: verwacht dat ${r.origin} ${t}${r.minimum.toString()} ${i.unit} bevat`;return`Te kort: verwacht dat ${r.origin} ${t}${r.minimum.toString()} is`}case"invalid_format":if("starts_with"===r.format)return`Ongeldige tekst: moet met "${r.prefix}" beginnen`;if("ends_with"===r.format)return`Ongeldige tekst: moet op "${r.suffix}" eindigen`;if("includes"===r.format)return`Ongeldige tekst: moet "${r.includes}" bevatten`;if("regex"===r.format)return`Ongeldige tekst: moet overeenkomen met patroon ${r.pattern}`;return`Ongeldig: ${t[r.format]??r.format}`;case"not_multiple_of":return`Ongeldig getal: moet een veelvoud van ${r.divisor} zijn`;case"unrecognized_keys":return`Onbekende key${r.keys.length>1?"s":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`Ongeldige key in ${r.origin}`;case"invalid_union":default:return"Ongeldige invoer";case"invalid_element":return`Ongeldige waarde in ${r.origin}`}})}},"no",0,function(){let e,t;return{localeError:(e={string:{unit:"tegn",verb:" ha"},file:{unit:"bytes",verb:" ha"},array:{unit:"elementer",verb:" inneholde"},set:{unit:"elementer",verb:" inneholde"}},t={regex:"input",email:"e-postadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslett",date:"ISO-dato",time:"ISO-klokkeslett",duration:"ISO-varighet",ipv4:"IPv4-omrde",ipv6:"IPv6-omrde",cidrv4:"IPv4-spekter",cidrv6:"IPv6-spekter",base64:"base64-enkodet streng",base64url:"base64url-enkodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return`Ugyldig input: forventet ${r.expected}, fikk ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"tall";case"object":if(Array.isArray(e))return"liste";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ugyldig verdi: forventet ${uu(r.values[0])}`;return`Ugyldig valg: forventet en av ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`For stor(t): forventet ${r.origin??"value"} til \xe5 ha ${t}${r.maximum.toString()} ${i.unit??"elementer"}`;return`For stor(t): forventet ${r.origin??"value"} til \xe5 ha ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`For lite(n): forventet ${r.origin} til \xe5 ha ${t}${r.minimum.toString()} ${i.unit}`;return`For lite(n): forventet ${r.origin} til \xe5 ha ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Ugyldig streng: m\xe5 starte med "${r.prefix}"`;if("ends_with"===r.format)return`Ugyldig streng: m\xe5 ende med "${r.suffix}"`;if("includes"===r.format)return`Ugyldig streng: m\xe5 inneholde "${r.includes}"`;if("regex"===r.format)return`Ugyldig streng: m\xe5 matche m\xf8nsteret ${r.pattern}`;return`Ugyldig ${t[r.format]??r.format}`;case"not_multiple_of":return`Ugyldig tall: m\xe5 v\xe6re et multiplum av ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"Ukjente nkler":"Ukjent nkkel"}: ${lK(r.keys,", ")}`;case"invalid_key":return`Ugyldig n\xf8kkel i ${r.origin}`;case"invalid_union":default:return"Ugyldig input";case"invalid_element":return`Ugyldig verdi i ${r.origin}`}})}},"ota",0,function(){let e,t;return{localeError:(e={string:{unit:"harf",verb:"olmaldr"},file:{unit:"bayt",verb:"olmaldr"},array:{unit:"unsur",verb:"olmaldr"},set:{unit:"unsur",verb:"olmaldr"}},t={regex:"giren",email:"epostagh",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO hengm",date:"ISO tarihi",time:"ISO zaman",duration:"ISO mddeti",ipv4:"IPv4 nin",ipv6:"IPv6 nin",cidrv4:"IPv4 menzili",cidrv6:"IPv6 menzili",base64:"base64-ifreli metin",base64url:"base64url-ifreli metin",json_string:"JSON metin",e164:"E.164 says",jwt:"JWT",template_literal:"giren"},r=>{switch(r.code){case"invalid_type":return`F\xe2sit giren: umulan ${r.expected}, alnan ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"numara";case"object":if(Array.isArray(e))return"saf";if(null===e)return"gayb";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`F\xe2sit giren: umulan ${uu(r.values[0])}`;return`F\xe2sit tercih: m\xfbteberler ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Fazla b\xfcy\xfck: ${r.origin??"value"}, ${t}${r.maximum.toString()} ${i.unit??"elements"} sahip olmalyd.`;return`Fazla b\xfcy\xfck: ${r.origin??"value"}, ${t}${r.maximum.toString()} olmalyd.`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Fazla k\xfc\xe7\xfck: ${r.origin}, ${t}${r.minimum.toString()} ${i.unit} sahip olmalyd.`;return`Fazla k\xfc\xe7\xfck: ${r.origin}, ${t}${r.minimum.toString()} olmalyd.`}case"invalid_format":if("starts_with"===r.format)return`F\xe2sit metin: "${r.prefix}" ile balamal.`;if("ends_with"===r.format)return`F\xe2sit metin: "${r.suffix}" ile bitmeli.`;if("includes"===r.format)return`F\xe2sit metin: "${r.includes}" ihtiv\xe2 etmeli.`;if("regex"===r.format)return`F\xe2sit metin: ${r.pattern} nakna uymal.`;return`F\xe2sit ${t[r.format]??r.format}`;case"not_multiple_of":return`F\xe2sit say: ${r.divisor} kat olmalyd.`;case"unrecognized_keys":return`Tannmayan anahtar ${r.keys.length>1?"s":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`${r.origin} i\xe7in tannmayan anahtar var.`;case"invalid_union":return"Giren tannamad.";case"invalid_element":return`${r.origin} i\xe7in tannmayan kymet var.`;default:return`Kymet tannamad.`}})}},"pl",0,function(){let e,t;return{localeError:(e={string:{unit:"znakw",verb:"mie"},file:{unit:"bajtw",verb:"mie"},array:{unit:"elementw",verb:"mie"},set:{unit:"elementw",verb:"mie"}},t={regex:"wyraenie",email:"adres email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i godzina w formacie ISO",date:"data w formacie ISO",time:"godzina w formacie ISO",duration:"czas trwania ISO",ipv4:"adres IPv4",ipv6:"adres IPv6",cidrv4:"zakres IPv4",cidrv6:"zakres IPv6",base64:"cig znakw zakodowany w formacie base64",base64url:"cig znakw zakodowany w formacie base64url",json_string:"cig znakw w formacie JSON",e164:"liczba E.164",jwt:"JWT",template_literal:"wejcie"},r=>{switch(r.code){case"invalid_type":return`Nieprawidowe dane wejciowe: oczekiwano ${r.expected}, otrzymano ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"liczba";case"object":if(Array.isArray(e))return"tablica";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Nieprawidowe dane wejciowe: oczekiwano ${uu(r.values[0])}`;return`Nieprawidowa opcja: oczekiwano jednej z wartoci ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Za dua warto: oczekiwano, e ${r.origin??"warto"} bdzie mie ${t}${r.maximum.toString()} ${i.unit??"elementw"}`;return`Zbyt du(y/a/e): oczekiwano, e ${r.origin??"warto"} bdzie wynosi ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Za maa warto: oczekiwano, e ${r.origin??"warto"} bdzie mie ${t}${r.minimum.toString()} ${i.unit??"elementw"}`;return`Zbyt ma(y/a/e): oczekiwano, e ${r.origin??"warto"} bdzie wynosi ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Nieprawidowy cig znak\xf3w: musi zaczyna si od "${r.prefix}"`;if("ends_with"===r.format)return`Nieprawidowy cig znak\xf3w: musi koczy si na "${r.suffix}"`;if("includes"===r.format)return`Nieprawidowy cig znak\xf3w: musi zawiera "${r.includes}"`;if("regex"===r.format)return`Nieprawidowy cig znak\xf3w: musi odpowiada wzorcowi ${r.pattern}`;return`Nieprawidow(y/a/e) ${t[r.format]??r.format}`;case"not_multiple_of":return`Nieprawidowa liczba: musi by wielokrotnoci ${r.divisor}`;case"unrecognized_keys":return`Nierozpoznane klucze${r.keys.length>1?"s":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`Nieprawidowy klucz w ${r.origin}`;case"invalid_union":return"Nieprawidowe dane wejciowe";case"invalid_element":return`Nieprawidowa warto w ${r.origin}`;default:return`Nieprawidowe dane wejciowe`}})}},"ps",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"  ",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"  ",date:"",time:"",duration:"",ipv4:" IPv4 ",ipv6:" IPv6 ",cidrv4:" IPv4 ",cidrv6:" IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:" E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected} ,  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}  `;case"invalid_value":if(1===r.values.length)return` :  ${uu(r.values[0])} `;return` :    ${lK(r.values,"|")}  `;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` : ${r.origin??""}  ${t}${r.maximum.toString()} ${i.unit??""} `;return` : ${r.origin??""}  ${t}${r.maximum.toString()} `}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` : ${r.origin}  ${t}${r.minimum.toString()} ${i.unit} `;return` : ${r.origin}  ${t}${r.minimum.toString()} `}case"invalid_format":if("starts_with"===r.format)return` :   "${r.prefix}"   `;if("ends_with"===r.format)return` :   "${r.suffix}"    `;if("includes"===r.format)return` :  "${r.includes}" `;if("regex"===r.format)return` :   ${r.pattern}   `;return`${t[r.format]??r.format}  `;case"not_multiple_of":return` :   ${r.divisor}  `;case"unrecognized_keys":return` ${r.keys.length>1?"":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`   ${r.origin} `;case"invalid_union":default:return` `;case"invalid_element":return`   ${r.origin} `}})}},"pt",0,function(){let e,t;return{localeError:(e={string:{unit:"caracteres",verb:"ter"},file:{unit:"bytes",verb:"ter"},array:{unit:"itens",verb:"ter"},set:{unit:"itens",verb:"ter"}},t={regex:"padro",email:"endereo de e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e hora ISO",date:"data ISO",time:"hora ISO",duration:"durao ISO",ipv4:"endereo IPv4",ipv6:"endereo IPv6",cidrv4:"faixa de IPv4",cidrv6:"faixa de IPv6",base64:"texto codificado em base64",base64url:"URL codificada em base64",json_string:"texto JSON",e164:"nmero E.164",jwt:"JWT",template_literal:"entrada"},r=>{switch(r.code){case"invalid_type":return`Tipo inv\xe1lido: esperado ${r.expected}, recebido ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nmero";case"object":if(Array.isArray(e))return"array";if(null===e)return"nulo";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Entrada inv\xe1lida: esperado ${uu(r.values[0])}`;return`Op\xe7\xe3o inv\xe1lida: esperada uma das ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Muito grande: esperado que ${r.origin??"valor"} tivesse ${t}${r.maximum.toString()} ${i.unit??"elementos"}`;return`Muito grande: esperado que ${r.origin??"valor"} fosse ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Muito pequeno: esperado que ${r.origin} tivesse ${t}${r.minimum.toString()} ${i.unit}`;return`Muito pequeno: esperado que ${r.origin} fosse ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Texto inv\xe1lido: deve come\xe7ar com "${r.prefix}"`;if("ends_with"===r.format)return`Texto inv\xe1lido: deve terminar com "${r.suffix}"`;if("includes"===r.format)return`Texto inv\xe1lido: deve incluir "${r.includes}"`;if("regex"===r.format)return`Texto inv\xe1lido: deve corresponder ao padr\xe3o ${r.pattern}`;return`${t[r.format]??r.format} inv\xe1lido`;case"not_multiple_of":return`N\xfamero inv\xe1lido: deve ser m\xfaltiplo de ${r.divisor}`;case"unrecognized_keys":return`Chave${r.keys.length>1?"s":""} desconhecida${r.keys.length>1?"s":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`Chave inv\xe1lida em ${r.origin}`;case"invalid_union":return"Entrada invlida";case"invalid_element":return`Valor inv\xe1lido em ${r.origin}`;default:return`Campo inv\xe1lido`}})}},"ru",0,function(){let e,t;return{localeError:(e={string:{unit:{one:"",few:"",many:""},verb:""},file:{unit:{one:"",few:"",many:""},verb:""},array:{unit:{one:"",few:"",many:""},verb:""},set:{unit:{one:"",few:"",many:""},verb:""}},t={regex:"",email:"email ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"   base64",base64url:"   base64url",json_string:"JSON ",e164:" E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` :  ${uu(r.values[0])}`;return` :    ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i){let e=vt(Number(r.maximum),i.unit.one,i.unit.few,i.unit.many);return`  : ,  ${r.origin??""}   ${t}${r.maximum.toString()} ${e}`}return`  : ,  ${r.origin??""}  ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i){let e=vt(Number(r.minimum),i.unit.one,i.unit.few,i.unit.many);return`  : ,  ${r.origin}   ${t}${r.minimum.toString()} ${e}`}return`  : ,  ${r.origin}  ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` :    "${r.prefix}"`;if("ends_with"===r.format)return` :    "${r.suffix}"`;if("includes"===r.format)return` :   "${r.includes}"`;if("regex"===r.format)return` :    ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` :    ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"":""} ${r.keys.length>1?"":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return"  ";case"invalid_element":return`   ${r.origin}`;default:return`  `}})}},"sl",0,function(){let e,t;return{localeError:(e={string:{unit:"znakov",verb:"imeti"},file:{unit:"bajtov",verb:"imeti"},array:{unit:"elementov",verb:"imeti"},set:{unit:"elementov",verb:"imeti"}},t={regex:"vnos",email:"e-potni naslov",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum in as",date:"ISO datum",time:"ISO as",duration:"ISO trajanje",ipv4:"IPv4 naslov",ipv6:"IPv6 naslov",cidrv4:"obseg IPv4",cidrv6:"obseg IPv6",base64:"base64 kodiran niz",base64url:"base64url kodiran niz",json_string:"JSON niz",e164:"E.164 tevilka",jwt:"JWT",template_literal:"vnos"},r=>{switch(r.code){case"invalid_type":return`Neveljaven vnos: priakovano ${r.expected}, prejeto ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"tevilo";case"object":if(Array.isArray(e))return"tabela";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Neveljaven vnos: priakovano ${uu(r.values[0])}`;return`Neveljavna monost: priakovano eno izmed ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Preveliko: priakovano, da bo ${r.origin??"vrednost"} imelo ${t}${r.maximum.toString()} ${i.unit??"elementov"}`;return`Preveliko: priakovano, da bo ${r.origin??"vrednost"} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Premajhno: priakovano, da bo ${r.origin} imelo ${t}${r.minimum.toString()} ${i.unit}`;return`Premajhno: priakovano, da bo ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Neveljaven niz: mora se zaeti z "${r.prefix}"`;if("ends_with"===r.format)return`Neveljaven niz: mora se konati z "${r.suffix}"`;if("includes"===r.format)return`Neveljaven niz: mora vsebovati "${r.includes}"`;if("regex"===r.format)return`Neveljaven niz: mora ustrezati vzorcu ${r.pattern}`;return`Neveljaven ${t[r.format]??r.format}`;case"not_multiple_of":return`Neveljavno tevilo: mora biti vekratnik ${r.divisor}`;case"unrecognized_keys":return`Neprepoznan${r.keys.length>1?"i kljui":" klju"}: ${lK(r.keys,", ")}`;case"invalid_key":return`Neveljaven klju v ${r.origin}`;case"invalid_union":default:return"Neveljaven vnos";case"invalid_element":return`Neveljavna vrednost v ${r.origin}`}})}},"sv",0,function(){let e,t;return{localeError:(e={string:{unit:"tecken",verb:"att ha"},file:{unit:"bytes",verb:"att ha"},array:{unit:"objekt",verb:"att innehlla"},set:{unit:"objekt",verb:"att innehlla"}},t={regex:"reguljrt uttryck",email:"e-postadress",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datum och tid",date:"ISO-datum",time:"ISO-tid",duration:"ISO-varaktighet",ipv4:"IPv4-intervall",ipv6:"IPv6-intervall",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodad strng",base64url:"base64url-kodad strng",json_string:"JSON-strng",e164:"E.164-nummer",jwt:"JWT",template_literal:"mall-literal"},r=>{switch(r.code){case"invalid_type":return`Ogiltig inmatning: f\xf6rv\xe4ntat ${r.expected}, fick ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"antal";case"object":if(Array.isArray(e))return"lista";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ogiltig inmatning: f\xf6rv\xe4ntat ${uu(r.values[0])}`;return`Ogiltigt val: f\xf6rv\xe4ntade en av ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`F\xf6r stor(t): f\xf6rv\xe4ntade ${r.origin??"vrdet"} att ha ${t}${r.maximum.toString()} ${i.unit??"element"}`;return`F\xf6r stor(t): f\xf6rv\xe4ntat ${r.origin??"vrdet"} att ha ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`F\xf6r lite(t): f\xf6rv\xe4ntade ${r.origin??"vrdet"} att ha ${t}${r.minimum.toString()} ${i.unit}`;return`F\xf6r lite(t): f\xf6rv\xe4ntade ${r.origin??"vrdet"} att ha ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Ogiltig str\xe4ng: m\xe5ste b\xf6rja med "${r.prefix}"`;if("ends_with"===r.format)return`Ogiltig str\xe4ng: m\xe5ste sluta med "${r.suffix}"`;if("includes"===r.format)return`Ogiltig str\xe4ng: m\xe5ste inneh\xe5lla "${r.includes}"`;if("regex"===r.format)return`Ogiltig str\xe4ng: m\xe5ste matcha m\xf6nstret "${r.pattern}"`;return`Ogiltig(t) ${t[r.format]??r.format}`;case"not_multiple_of":return`Ogiltigt tal: m\xe5ste vara en multipel av ${r.divisor}`;case"unrecognized_keys":return`${r.keys.length>1?"Oknda nycklar":"Oknd nyckel"}: ${lK(r.keys,", ")}`;case"invalid_key":return`Ogiltig nyckel i ${r.origin??"vrdet"}`;case"invalid_union":default:return"Ogiltig input";case"invalid_element":return`Ogiltigt v\xe4rde i ${r.origin??"vrdet"}`}})}},"ta",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},t={regex:"",email:" ",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO  ",date:"ISO ",time:"ISO ",duration:"ISO  ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:"input"},r=>{switch(r.code){case"invalid_type":return` :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?" ":"";case"object":if(Array.isArray(e))return"";if(null===e)return"";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` :  ${uu(r.values[0])}`;return` :  ${lK(r.values,"|")}  `;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` :  ${r.origin??""} ${t}${r.maximum.toString()} ${i.unit??""}   `;return` :  ${r.origin??""} ${t}${r.maximum.toString()}   `}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` :  ${r.origin} ${t}${r.minimum.toString()} ${i.unit}   `;return` :  ${r.origin} ${t}${r.minimum.toString()}   `}case"invalid_format":if("starts_with"===r.format)return` : "${r.prefix}"   `;if("ends_with"===r.format)return` : "${r.suffix}"   `;if("includes"===r.format)return` : "${r.includes}"   `;if("regex"===r.format)return` : ${r.pattern}   `;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` : ${r.divisor}    `;case"unrecognized_keys":return`  ${r.keys.length>1?"":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`${r.origin}   `;case"invalid_union":return" ";case"invalid_element":return`${r.origin}   `;default:return` `}})}},"th",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:" ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IP  IPv4",cidrv6:" IP  IPv6",base64:" Base64",base64url:" Base64  URL",json_string:" JSON",e164:" (E.164)",jwt:" JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return`:  ${r.expected}  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?" (NaN)":"";case"object":if(Array.isArray(e))return" (Array)";if(null===e)return" (null)";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`:  ${uu(r.values[0])}`;return`:  ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"":"",i=e[r.origin]??null;if(i)return`: ${r.origin??""} ${t} ${r.maximum.toString()} ${i.unit??""}`;return`: ${r.origin??""} ${t} ${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?"":"",i=e[r.origin]??null;if(i)return`: ${r.origin} ${t} ${r.minimum.toString()} ${i.unit}`;return`: ${r.origin} ${t} ${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`:  "${r.prefix}"`;if("ends_with"===r.format)return`:  "${r.suffix}"`;if("includes"===r.format)return`:  "${r.includes}" `;if("regex"===r.format)return`:  ${r.pattern}`;return`: ${t[r.format]??r.format}`;case"not_multiple_of":return`:  ${r.divisor} `;case"unrecognized_keys":return`: ${lK(r.keys,", ")}`;case"invalid_key":return` ${r.origin}`;case"invalid_union":return": ";case"invalid_element":return` ${r.origin}`;default:return``}})}},"tr",0,function(){let e,t;return{localeError:(e={string:{unit:"karakter",verb:"olmal"},file:{unit:"bayt",verb:"olmal"},array:{unit:"e",verb:"olmal"},set:{unit:"e",verb:"olmal"}},t={regex:"girdi",email:"e-posta adresi",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO tarih ve saat",date:"ISO tarih",time:"ISO saat",duration:"ISO sre",ipv4:"IPv4 adresi",ipv6:"IPv6 adresi",cidrv4:"IPv4 aral",cidrv6:"IPv6 aral",base64:"base64 ile ifrelenmi metin",base64url:"base64url ile ifrelenmi metin",json_string:"JSON dizesi",e164:"E.164 says",jwt:"JWT",template_literal:"ablon dizesi"},r=>{switch(r.code){case"invalid_type":return`Ge\xe7ersiz deer: beklenen ${r.expected}, alnan ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`Ge\xe7ersiz deer: beklenen ${uu(r.values[0])}`;return`Ge\xe7ersiz se\xe7enek: aadakilerden biri olmal: ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`\xc7ok b\xfcy\xfck: beklenen ${r.origin??"deer"} ${t}${r.maximum.toString()} ${i.unit??"e"}`;return`\xc7ok b\xfcy\xfck: beklenen ${r.origin??"deer"} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`\xc7ok k\xfc\xe7\xfck: beklenen ${r.origin} ${t}${r.minimum.toString()} ${i.unit}`;return`\xc7ok k\xfc\xe7\xfck: beklenen ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Ge\xe7ersiz metin: "${r.prefix}" ile balamal`;if("ends_with"===r.format)return`Ge\xe7ersiz metin: "${r.suffix}" ile bitmeli`;if("includes"===r.format)return`Ge\xe7ersiz metin: "${r.includes}" i\xe7ermeli`;if("regex"===r.format)return`Ge\xe7ersiz metin: ${r.pattern} desenine uymal`;return`Ge\xe7ersiz ${t[r.format]??r.format}`;case"not_multiple_of":return`Ge\xe7ersiz say: ${r.divisor} ile tam b\xf6l\xfcnebilmeli`;case"unrecognized_keys":return`Tannmayan anahtar${r.keys.length>1?"lar":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`${r.origin} i\xe7inde ge\xe7ersiz anahtar`;case"invalid_union":return"Geersiz deer";case"invalid_element":return`${r.origin} i\xe7inde ge\xe7ersiz deer`;default:return`Ge\xe7ersiz deer`}})}},"ua",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:" ",email:"  ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:"   base64",base64url:"   base64url",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:" "},r=>{switch(r.code){case"invalid_type":return`  :  ${r.expected},  ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`  :  ${uu(r.values[0])}`;return` :    ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` : ,  ${r.origin??""} ${i.verb} ${t}${r.maximum.toString()} ${i.unit??""}`;return` : ,  ${r.origin??""}  ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` : ,  ${r.origin} ${i.verb} ${t}${r.minimum.toString()} ${i.unit}`;return` : ,  ${r.origin}  ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` :    "${r.prefix}"`;if("ends_with"===r.format)return` :    "${r.suffix}"`;if("includes"===r.format)return` :   "${r.includes}"`;if("regex"===r.format)return` :    ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` :    ${r.divisor}`;case"unrecognized_keys":return` ${r.keys.length>1?"":""}: ${lK(r.keys,", ")}`;case"invalid_key":return`   ${r.origin}`;case"invalid_union":return"  ";case"invalid_element":return`   ${r.origin}`;default:return`  `}})}},"ur",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:" ",email:"  ",url:"  ",emoji:"",uuid:"   ",uuidv4:"     4",uuidv6:"     6",nanoid:"  ",guid:"   ",cuid:"   ",cuid2:"    2",ulid:"   ",xid:"  ",ksuid:"    ",datetime:"    ",date:"   ",time:"   ",duration:"   ",ipv4:"   4 ",ipv6:"   6 ",cidrv4:"   4 ",cidrv6:"   6 ",base64:" 64   ",base64url:" 64      ",json_string:"    ",e164:" 164 ",jwt:"  ",template_literal:" "},r=>{switch(r.code){case"invalid_type":return`  : ${r.expected}   ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}  `;case"invalid_value":if(1===r.values.length)return`  : ${uu(r.values[0])}  `;return` : ${lK(r.values,"|")}     `;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` : ${r.origin??""}  ${t}${r.maximum.toString()} ${i.unit??""}   `;return` : ${r.origin??""}  ${t}${r.maximum.toString()}   `}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` : ${r.origin}  ${t}${r.minimum.toString()} ${i.unit}   `;return` : ${r.origin}  ${t}${r.minimum.toString()}   `}case"invalid_format":if("starts_with"===r.format)return` : "${r.prefix}"    `;if("ends_with"===r.format)return` : "${r.suffix}"    `;if("includes"===r.format)return` : "${r.includes}"   `;if("regex"===r.format)return` :  ${r.pattern}    `;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` : ${r.divisor}    `;case"unrecognized_keys":return`   ${r.keys.length>1?"":""}: ${lK(r.keys," ")}`;case"invalid_key":return`${r.origin}   `;case"invalid_union":return"  ";case"invalid_element":return`${r.origin}   `;default:return`  `}})}},"vi",0,function(){let e,t;return{localeError:(e={string:{unit:"k t",verb:"c"},file:{unit:"byte",verb:"c"},array:{unit:"phn t",verb:"c"},set:{unit:"phn t",verb:"c"}},t={regex:"u vo",email:"a ch email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ngy gi ISO",date:"ngy ISO",time:"gi ISO",duration:"khong thi gian ISO",ipv4:"a ch IPv4",ipv6:"a ch IPv6",cidrv4:"di IPv4",cidrv6:"di IPv6",base64:"chui m ha base64",base64url:"chui m ha base64url",json_string:"chui JSON",e164:"s E.164",jwt:"JWT",template_literal:"u vo"},r=>{switch(r.code){case"invalid_type":return`u v\xe0o kh\xf4ng hp l: mong i ${r.expected}, nhn c ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"s";case"object":if(Array.isArray(e))return"mng";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return`u v\xe0o kh\xf4ng hp l: mong i ${uu(r.values[0])}`;return`T\xf9y chn kh\xf4ng hp l: mong i mt trong c\xe1c gi\xe1 tr ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return`Qu\xe1 ln: mong i ${r.origin??"gi tr"} ${i.verb} ${t}${r.maximum.toString()} ${i.unit??"phn t"}`;return`Qu\xe1 ln: mong i ${r.origin??"gi tr"} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return`Qu\xe1 nh: mong i ${r.origin} ${i.verb} ${t}${r.minimum.toString()} ${i.unit}`;return`Qu\xe1 nh: mong i ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return`Chui kh\xf4ng hp l: phi bt u bng "${r.prefix}"`;if("ends_with"===r.format)return`Chui kh\xf4ng hp l: phi kt th\xfac bng "${r.suffix}"`;if("includes"===r.format)return`Chui kh\xf4ng hp l: phi bao gm "${r.includes}"`;if("regex"===r.format)return`Chui kh\xf4ng hp l: phi khp vi mu ${r.pattern}`;return`${t[r.format]??r.format} kh\xf4ng hp l`;case"not_multiple_of":return`S kh\xf4ng hp l: phi l\xe0 bi s ca ${r.divisor}`;case"unrecognized_keys":return`Kh\xf3a kh\xf4ng c nhn dng: ${lK(r.keys,", ")}`;case"invalid_key":return`Kh\xf3a kh\xf4ng hp l trong ${r.origin}`;case"invalid_union":return"u vo khng hp l";case"invalid_element":return`Gi\xe1 tr kh\xf4ng hp l trong ${r.origin}`;default:return`u v\xe0o kh\xf4ng hp l`}})}},"zhCN",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO",date:"ISO",time:"ISO",duration:"ISO",ipv4:"IPv4",ipv6:"IPv6",cidrv4:"IPv4",cidrv6:"IPv6",base64:"base64",base64url:"base64url",json_string:"JSON",e164:"E.164",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` ${r.expected} ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"(NaN)":"";case"object":if(Array.isArray(e))return"";if(null===e)return"(null)";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` ${uu(r.values[0])}`;return` ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` ${r.origin??""} ${t}${r.maximum.toString()} ${i.unit??""}`;return` ${r.origin??""} ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` ${r.origin} ${t}${r.minimum.toString()} ${i.unit}`;return` ${r.origin} ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` "${r.prefix}" `;if("ends_with"===r.format)return` "${r.suffix}" `;if("includes"===r.format)return` "${r.includes}"`;if("regex"===r.format)return` ${r.pattern}`;return`${t[r.format]??r.format}`;case"not_multiple_of":return` ${r.divisor} `;case"unrecognized_keys":return`(key): ${lK(r.keys,", ")}`;case"invalid_key":return`${r.origin} (key)`;case"invalid_union":return"";case"invalid_element":return`${r.origin} (value)`;default:return``}})}},"zhTW",0,function(){let e,t;return{localeError:(e={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},t={regex:"",email:"",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64 ",base64url:"base64url ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},r=>{switch(r.code){case"invalid_type":return` ${r.expected} ${(e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t})(r.input)}`;case"invalid_value":if(1===r.values.length)return` ${uu(r.values[0])}`;return` ${lK(r.values,"|")}`;case"too_big":{let t=r.inclusive?"<=":"<",i=e[r.origin]??null;if(i)return` ${r.origin??""}  ${t}${r.maximum.toString()} ${i.unit??""}`;return` ${r.origin??""}  ${t}${r.maximum.toString()}`}case"too_small":{let t=r.inclusive?">=":">",i=e[r.origin]??null;if(i)return` ${r.origin}  ${t}${r.minimum.toString()} ${i.unit}`;return` ${r.origin}  ${t}${r.minimum.toString()}`}case"invalid_format":if("starts_with"===r.format)return` "${r.prefix}" `;if("ends_with"===r.format)return` "${r.suffix}" `;if("includes"===r.format)return` "${r.includes}"`;if("regex"===r.format)return` ${r.pattern}`;return` ${t[r.format]??r.format}`;case"not_multiple_of":return` ${r.divisor} `;case"unrecognized_keys":return`${r.keys.length>1?"":""}${lK(r.keys,"")}`;case"invalid_key":return`${r.origin} `;case"invalid_union":return"";case"invalid_element":return`${r.origin} `;default:return``}})}}],60544);var vr=e.i(60544);e.i(52637),e.i(73911);class vi{constructor(e){this._def=e,this.def=e}implement(e){if("function"!=typeof e)throw Error("implement() must be called with a function");let t=(...r)=>{let i=this._def.input?u8(this._def.input,r,void 0,{callee:t}):r;if(!Array.isArray(i))throw Error("Invalid arguments schema: not an array or tuple schema.");let n=e(...i);return this._def.output?u8(this._def.output,n,void 0,{callee:t}):n};return t}implementAsync(e){if("function"!=typeof e)throw Error("implement() must be called with a function");let t=async(...r)=>{let i=this._def.input?await ce(this._def.input,r,void 0,{callee:t}):r;if(!Array.isArray(i))throw Error("Invalid arguments schema: not an array or tuple schema.");let n=await e(...i);return this._def.output?ce(this._def.output,n,void 0,{callee:t}):n};return t}input(...e){let t=this.constructor;return new t(Array.isArray(e[0])?{type:"function",input:new c9({type:"tuple",items:e[0],rest:e[1]}),output:this._def.output}:{type:"function",input:e[0],output:this._def.output})}output(e){return new this.constructor({type:"function",input:this._def.input,output:e})}}function vn(e){return new vi({type:"function",input:Array.isArray(e?.input)?pJ(c9,e?.input):e?.input??pF(cK,pl(cW)),output:e?.output??pl(cW)})}e.s(["$ZodFunction",()=>vi,"function",()=>vn],20321),e.i(20321),e.i(62061),e.i(7159),e.s([],33145);var va=e.i(33145);e.s(["$ZodAny",0,cq,"$ZodArray",0,cK,"$ZodAsyncError",()=>ln,"$ZodBase64",0,cT,"$ZodBase64URL",0,cN,"$ZodBigInt",0,cM,"$ZodBigIntFormat",0,cD,"$ZodBoolean",0,cz,"$ZodCIDRv4",0,cO,"$ZodCIDRv6",0,cS,"$ZodCUID",0,cf,"$ZodCUID2",0,cg,"$ZodCatch",0,df,"$ZodCheck",0,uE,"$ZodCheckBigIntFormat",0,uj,"$ZodCheckEndsWith",0,uG,"$ZodCheckGreaterThan",0,uN,"$ZodCheckIncludes",0,uW,"$ZodCheckLengthEquals",0,uD,"$ZodCheckLessThan",0,uA,"$ZodCheckLowerCase",0,uB,"$ZodCheckMaxLength",0,uz,"$ZodCheckMaxSize",0,uR,"$ZodCheckMimeType",0,uK,"$ZodCheckMinLength",0,uM,"$ZodCheckMinSize",0,uL,"$ZodCheckMultipleOf",0,uC,"$ZodCheckNumberFormat",0,uP,"$ZodCheckOverwrite",0,uX,"$ZodCheckProperty",0,uV,"$ZodCheckRegex",0,uF,"$ZodCheckSizeEquals",0,uU,"$ZodCheckStartsWith",0,uJ,"$ZodCheckStringFormat",0,uZ,"$ZodCheckUpperCase",0,uq,"$ZodCustom",0,dk,"$ZodCustomStringFormat",0,cR,"$ZodDate",0,cH,"$ZodDefault",0,du,"$ZodDiscriminatedUnion",0,c4,"$ZodE164",0,cC,"$ZodEmail",0,cd,"$ZodEmoji",0,ch,"$ZodEnum",0,dr,"$ZodError",0,u0,"$ZodFile",0,dn,"$ZodFunction",()=>vi,"$ZodGUID",0,cu,"$ZodIPv4",0,ck,"$ZodIPv6",0,cI,"$ZodISODate",0,cw,"$ZodISODateTime",0,cb,"$ZodISODuration",0,cx,"$ZodISOTime",0,c$,"$ZodIntersection",0,c2,"$ZodJWT",0,cj,"$ZodKSUID",0,cv,"$ZodLazy",0,dx,"$ZodLiteral",0,di,"$ZodMap",0,c8,"$ZodNaN",0,dg,"$ZodNanoID",0,cm,"$ZodNever",0,cJ,"$ZodNonOptional",0,dp,"$ZodNull",0,cB,"$ZodNullable",0,dl,"$ZodNumber",0,cL,"$ZodNumberFormat",0,cU,"$ZodObject",0,cQ,"$ZodOptional",0,ds,"$ZodPipe",0,dy,"$ZodPrefault",0,dd,"$ZodPromise",0,d$,"$ZodReadonly",0,dv,"$ZodRealError",0,u1,"$ZodRecord",0,c3,"$ZodRegistry",()=>hl,"$ZodSet",0,de,"$ZodString",0,co,"$ZodStringFormat",0,cl,"$ZodSuccess",0,dm,"$ZodSymbol",0,cZ,"$ZodTemplateLiteral",0,dw,"$ZodTransform",0,da,"$ZodTuple",0,c9,"$ZodType",0,cs,"$ZodULID",0,cy,"$ZodURL",0,cp,"$ZodUUID",0,cc,"$ZodUndefined",0,cF,"$ZodUnion",0,c1,"$ZodUnknown",0,cW,"$ZodVoid",0,cG,"$ZodXID",0,c_,"$brand",0,li,"$constructor",()=>lr,"$input",0,ho,"$output",0,hs,"Doc",()=>uY,"JSONSchema",0,va,"JSONSchemaGenerator",()=>gn,"NEVER",0,lt,"TimePrecision",0,dK,"_any",()=>po,"_array",()=>pF,"_base64",()=>dJ,"_base64url",()=>dG,"_bigint",()=>pe,"_boolean",()=>d8,"_catch",()=>p5,"_cidrv4",()=>dq,"_cidrv6",()=>dW,"_coercedBigint",()=>pt,"_coercedBoolean",()=>d7,"_coercedDate",()=>pp,"_coercedNumber",()=>d4,"_coercedString",()=>dS,"_cuid",()=>dU,"_cuid2",()=>dz,"_custom",()=>hr,"_date",()=>pd,"_default",()=>p2,"_discriminatedUnion",()=>pq,"_e164",()=>dH,"_email",()=>dE,"_emoji",()=>dR,"_endsWith",()=>pj,"_enum",()=>pK,"_file",()=>pQ,"_float32",()=>d6,"_float64",()=>d9,"_gt",()=>pg,"_gte",()=>py,"_guid",()=>dT,"_includes",()=>pC,"_int",()=>d2,"_int32",()=>d5,"_int64",()=>pr,"_intersection",()=>pW,"_ipv4",()=>dF,"_ipv6",()=>dB,"_isoDate",()=>dY,"_isoDateTime",()=>dX,"_isoDuration",()=>d0,"_isoTime",()=>dQ,"_jwt",()=>dV,"_ksuid",()=>dZ,"_lazy",()=>he,"_length",()=>pE,"_literal",()=>pY,"_lowercase",()=>pA,"_lt",()=>pm,"_lte",()=>pf,"_map",()=>pH,"_max",()=>pf,"_maxLength",()=>pO,"_maxSize",()=>px,"_mime",()=>pL,"_min",()=>py,"_minLength",()=>pS,"_minSize",()=>pk,"_multipleOf",()=>p$,"_nan",()=>ph,"_nanoid",()=>dL,"_nativeEnum",()=>pX,"_negative",()=>pv,"_never",()=>pu,"_nonnegative",()=>pw,"_nonoptional",()=>p6,"_nonpositive",()=>pb,"_normalize",()=>pz,"_null",()=>ps,"_nullable",()=>p4,"_number",()=>d1,"_optional",()=>p1,"_overwrite",()=>pU,"_parse",0,u3,"_parseAsync",0,u7,"_pipe",()=>p3,"_positive",()=>p_,"_promise",()=>ht,"_property",()=>pR,"_readonly",()=>p8,"_record",()=>pG,"_refine",()=>hi,"_regex",()=>pT,"_safeParse",0,ct,"_safeParseAsync",0,ci,"_set",()=>pV,"_size",()=>pI,"_startsWith",()=>pP,"_string",()=>dO,"_stringFormat",()=>ha,"_stringbool",()=>hn,"_success",()=>p9,"_symbol",()=>pn,"_templateLiteral",()=>p7,"_toLowerCase",()=>pD,"_toUpperCase",()=>pZ,"_transform",()=>p0,"_trim",()=>pM,"_tuple",()=>pJ,"_uint32",()=>d3,"_uint64",()=>pi,"_ulid",()=>dM,"_undefined",()=>pa,"_union",()=>pB,"_unknown",()=>pl,"_uppercase",()=>pN,"_url",()=>dj,"_uuid",()=>dA,"_uuidv4",()=>dN,"_uuidv6",()=>dC,"_uuidv7",()=>dP,"_void",()=>pc,"_xid",()=>dD,"clone",()=>us,"config",()=>ls,"flattenError",()=>u4,"formatError",()=>u2,"function",()=>vn,"globalConfig",0,la,"globalRegistry",0,hc,"isValidBase64",()=>cE,"isValidBase64URL",()=>cA,"isValidJWT",()=>cP,"locales",0,vr,"parse",0,u8,"parseAsync",0,ce,"prettifyError",()=>u5,"regexes",0,_7,"registry",()=>hu,"safeParse",0,cr,"safeParseAsync",0,cn,"toDotPath",()=>u9,"toJSONSchema",()=>ga,"treeifyError",()=>u6,"util",0,_8,"version",0,ca],13007);var vs=e.i(13007);e.s(["ZodAny",()=>bS,"ZodArray",()=>bU,"ZodBase64",()=>v5,"ZodBase64URL",()=>v8,"ZodBigInt",()=>bg,"ZodBigIntFormat",()=>b_,"ZodBoolean",()=>bm,"ZodCIDRv4",()=>v4,"ZodCIDRv6",()=>v6,"ZodCUID",()=>vF,"ZodCUID2",()=>vq,"ZodCatch",()=>wy,"ZodCustom",()=>wN,"ZodCustomStringFormat",()=>bn,"ZodDate",()=>bR,"ZodDefault",()=>wu,"ZodDiscriminatedUnion",()=>bJ,"ZodE164",()=>be,"ZodEmail",()=>vS,"ZodEmoji",()=>vz,"ZodEnum",()=>b9,"ZodFile",()=>we,"ZodGUID",()=>vT,"ZodIPv4",()=>vY,"ZodIPv6",()=>v0,"ZodIntersection",()=>bH,"ZodJWT",()=>br,"ZodKSUID",()=>vK,"ZodLazy",()=>wS,"ZodLiteral",()=>b8,"ZodMap",()=>b1,"ZodNaN",()=>wv,"ZodNanoID",()=>vD,"ZodNever",()=>bN,"ZodNonOptional",()=>wh,"ZodNull",()=>bI,"ZodNullable",()=>ws,"ZodNumber",()=>bs,"ZodNumberFormat",()=>bl,"ZodObject",()=>bD,"ZodOptional",()=>wn,"ZodPipe",()=>ww,"ZodPrefault",()=>wd,"ZodPromise",()=>wT,"ZodReadonly",()=>wx,"ZodRecord",()=>bY,"ZodSet",()=>b2,"ZodString",()=>vk,"ZodStringFormat",()=>vO,"ZodSuccess",()=>wf,"ZodSymbol",()=>bw,"ZodTemplateLiteral",()=>wI,"ZodTransform",()=>wr,"ZodTuple",()=>bK,"ZodType",()=>v$,"ZodULID",()=>vJ,"ZodURL",()=>vL,"ZodUUID",()=>vN,"ZodUndefined",()=>bx,"ZodUnion",()=>bq,"ZodUnknown",()=>bT,"ZodVoid",()=>bP,"ZodXID",()=>vH,"_ZodString",()=>vx,"_default",()=>wc,"any",()=>bE,"array",()=>bz,"base64",()=>v3,"base64url",()=>v7,"bigint",()=>by,"boolean",()=>bf,"catch",()=>w_,"check",()=>wC,"cidrv4",()=>v2,"cidrv6",()=>v9,"cuid",()=>vB,"cuid2",()=>vW,"custom",()=>wP,"date",()=>bL,"discriminatedUnion",()=>bG,"e164",()=>bt,"email",()=>vE,"emoji",()=>vM,"enum",()=>b5,"file",()=>wt,"float32",()=>bc,"float64",()=>bd,"guid",()=>vA,"instanceof",()=>wL,"int",()=>bu,"int32",()=>bp,"int64",()=>bv,"intersection",()=>bV,"ipv4",()=>vQ,"ipv6",()=>v1,"json",()=>wz,"jwt",()=>bi,"keyof",()=>bM,"ksuid",()=>vX,"lazy",()=>wE,"literal",()=>b7,"looseObject",()=>bB,"map",()=>b4,"nan",()=>wb,"nanoid",()=>vZ,"nativeEnum",()=>b3,"never",()=>bC,"nonoptional",()=>wm,"null",()=>bO,"nullable",()=>wo,"nullish",()=>wl,"number",()=>bo,"object",()=>bZ,"optional",()=>wa,"partialRecord",()=>b0,"pipe",()=>w$,"prefault",()=>wp,"preprocess",()=>wM,"promise",()=>wA,"readonly",()=>wk,"record",()=>bQ,"refine",()=>wj,"set",()=>b6,"strictObject",()=>bF,"string",()=>vI,"stringFormat",()=>ba,"stringbool",()=>wU,"success",()=>wg,"superRefine",()=>wR,"symbol",()=>b$,"templateLiteral",()=>wO,"transform",()=>wi,"tuple",()=>bX,"uint32",()=>bh,"uint64",()=>bb,"ulid",()=>vG,"undefined",()=>bk,"union",()=>bW,"unknown",()=>bA,"url",()=>vU,"uuid",()=>vC,"uuidv4",()=>vP,"uuidv6",()=>vj,"uuidv7",()=>vR,"void",()=>bj,"xid",()=>vV],7855);var hd=hd;e.s(["ZodISODate",()=>vu,"ZodISODateTime",()=>vo,"ZodISODuration",()=>vh,"ZodISOTime",()=>vd,"date",()=>vc,"datetime",()=>vl,"duration",()=>vm,"time",()=>vp],51047);let vo=lr("ZodISODateTime",(e,t)=>{cb.init(e,t),vO.init(e,t)});function vl(e){return dX(vo,e)}let vu=lr("ZodISODate",(e,t)=>{cw.init(e,t),vO.init(e,t)});function vc(e){return dY(vu,e)}let vd=lr("ZodISOTime",(e,t)=>{c$.init(e,t),vO.init(e,t)});function vp(e){return dQ(vd,e)}let vh=lr("ZodISODuration",(e,t)=>{cx.init(e,t),vO.init(e,t)});function vm(e){return d0(vh,e)}let vf=(e,t)=>{u0.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:t=>u2(e,t)},flatten:{value:t=>u4(e,t)},addIssue:{value:t=>e.issues.push(t)},addIssues:{value:t=>e.issues.push(...t)},isEmpty:{get:()=>0===e.issues.length}})},vg=lr("ZodError",vf),vy=lr("ZodError",vf,{Parent:Error});e.s(["ZodError",0,vg,"ZodRealError",0,vy],15874);let v_=u3(vy),vv=u7(vy),vb=ct(vy),vw=ci(vy);e.s(["parse",0,v_,"parseAsync",0,vv,"safeParse",0,vb,"safeParseAsync",0,vw],48804);let v$=lr("ZodType",(e,t)=>(cs.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone({...t,checks:[...t.checks??[],...r.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]}),e.clone=(t,r)=>us(e,t,r),e.brand=()=>e,e.register=(t,r)=>(t.add(e,r),e),e.parse=(t,r)=>v_(e,t,r,{callee:e.parse}),e.safeParse=(t,r)=>vb(e,t,r),e.parseAsync=async(t,r)=>vv(e,t,r,{callee:e.parseAsync}),e.safeParseAsync=async(t,r)=>vw(e,t,r),e.spa=e.safeParseAsync,e.refine=(t,r)=>e.check(wj(t,r)),e.superRefine=t=>e.check(wR(t)),e.overwrite=t=>e.check(pU(t)),e.optional=()=>wa(e),e.nullable=()=>wo(e),e.nullish=()=>wa(wo(e)),e.nonoptional=t=>wm(e,t),e.array=()=>bz(e),e.or=t=>bW([e,t]),e.and=t=>bV(e,t),e.transform=t=>w$(e,wi(t)),e.default=t=>wc(e,t),e.prefault=t=>wp(e,t),e.catch=t=>w_(e,t),e.pipe=t=>w$(e,t),e.readonly=()=>wk(e),e.describe=t=>{let r=e.clone();return hc.add(r,{description:t}),r},Object.defineProperty(e,"description",{get:()=>hc.get(e)?.description,configurable:!0}),e.meta=(...t)=>{if(0===t.length)return hc.get(e);let r=e.clone();return hc.add(r,t[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),vx=lr("_ZodString",(e,t)=>{co.init(e,t),v$.init(e,t);let r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...t)=>e.check(pT(...t)),e.includes=(...t)=>e.check(pC(...t)),e.startsWith=(...t)=>e.check(pP(...t)),e.endsWith=(...t)=>e.check(pj(...t)),e.min=(...t)=>e.check(pS(...t)),e.max=(...t)=>e.check(pO(...t)),e.length=(...t)=>e.check(pE(...t)),e.nonempty=(...t)=>e.check(pS(1,...t)),e.lowercase=t=>e.check(pA(t)),e.uppercase=t=>e.check(pN(t)),e.trim=()=>e.check(pM()),e.normalize=(...t)=>e.check(pz(...t)),e.toLowerCase=()=>e.check(pD()),e.toUpperCase=()=>e.check(pZ())}),vk=lr("ZodString",(e,t)=>{co.init(e,t),vx.init(e,t),e.email=t=>e.check(dE(vS,t)),e.url=t=>e.check(dj(vL,t)),e.jwt=t=>e.check(dV(br,t)),e.emoji=t=>e.check(dR(vz,t)),e.guid=t=>e.check(dT(vT,t)),e.uuid=t=>e.check(dA(vN,t)),e.uuidv4=t=>e.check(dN(vN,t)),e.uuidv6=t=>e.check(dC(vN,t)),e.uuidv7=t=>e.check(dP(vN,t)),e.nanoid=t=>e.check(dL(vD,t)),e.guid=t=>e.check(dT(vT,t)),e.cuid=t=>e.check(dU(vF,t)),e.cuid2=t=>e.check(dz(vq,t)),e.ulid=t=>e.check(dM(vJ,t)),e.base64=t=>e.check(dJ(v5,t)),e.base64url=t=>e.check(dG(v8,t)),e.xid=t=>e.check(dD(vH,t)),e.ksuid=t=>e.check(dZ(vK,t)),e.ipv4=t=>e.check(dF(vY,t)),e.ipv6=t=>e.check(dB(v0,t)),e.cidrv4=t=>e.check(dq(v4,t)),e.cidrv6=t=>e.check(dW(v6,t)),e.e164=t=>e.check(dH(be,t)),e.datetime=t=>e.check(vl(t)),e.date=t=>e.check(vc(t)),e.time=t=>e.check(vp(t)),e.duration=t=>e.check(vm(t))});function vI(e){return dO(vk,e)}let vO=lr("ZodStringFormat",(e,t)=>{cl.init(e,t),vx.init(e,t)}),vS=lr("ZodEmail",(e,t)=>{cd.init(e,t),vO.init(e,t)});function vE(e){return dE(vS,e)}let vT=lr("ZodGUID",(e,t)=>{cu.init(e,t),vO.init(e,t)});function vA(e){return dT(vT,e)}let vN=lr("ZodUUID",(e,t)=>{cc.init(e,t),vO.init(e,t)});function vC(e){return dA(vN,e)}function vP(e){return dN(vN,e)}function vj(e){return dC(vN,e)}function vR(e){return dP(vN,e)}let vL=lr("ZodURL",(e,t)=>{cp.init(e,t),vO.init(e,t)});function vU(e){return dj(vL,e)}let vz=lr("ZodEmoji",(e,t)=>{ch.init(e,t),vO.init(e,t)});function vM(e){return dR(vz,e)}let vD=lr("ZodNanoID",(e,t)=>{cm.init(e,t),vO.init(e,t)});function vZ(e){return dL(vD,e)}let vF=lr("ZodCUID",(e,t)=>{cf.init(e,t),vO.init(e,t)});function vB(e){return dU(vF,e)}let vq=lr("ZodCUID2",(e,t)=>{cg.init(e,t),vO.init(e,t)});function vW(e){return dz(vq,e)}let vJ=lr("ZodULID",(e,t)=>{cy.init(e,t),vO.init(e,t)});function vG(e){return dM(vJ,e)}let vH=lr("ZodXID",(e,t)=>{c_.init(e,t),vO.init(e,t)});function vV(e){return dD(vH,e)}let vK=lr("ZodKSUID",(e,t)=>{cv.init(e,t),vO.init(e,t)});function vX(e){return dZ(vK,e)}let vY=lr("ZodIPv4",(e,t)=>{ck.init(e,t),vO.init(e,t)});function vQ(e){return dF(vY,e)}let v0=lr("ZodIPv6",(e,t)=>{cI.init(e,t),vO.init(e,t)});function v1(e){return dB(v0,e)}let v4=lr("ZodCIDRv4",(e,t)=>{cO.init(e,t),vO.init(e,t)});function v2(e){return dq(v4,e)}let v6=lr("ZodCIDRv6",(e,t)=>{cS.init(e,t),vO.init(e,t)});function v9(e){return dW(v6,e)}let v5=lr("ZodBase64",(e,t)=>{cT.init(e,t),vO.init(e,t)});function v3(e){return dJ(v5,e)}let v8=lr("ZodBase64URL",(e,t)=>{cN.init(e,t),vO.init(e,t)});function v7(e){return dG(v8,e)}let be=lr("ZodE164",(e,t)=>{cC.init(e,t),vO.init(e,t)});function bt(e){return dH(be,e)}let br=lr("ZodJWT",(e,t)=>{cj.init(e,t),vO.init(e,t)});function bi(e){return dV(br,e)}let bn=lr("ZodCustomStringFormat",(e,t)=>{cR.init(e,t),vO.init(e,t)});function ba(e,t,r={}){return ha(bn,e,t,r)}let bs=lr("ZodNumber",(e,t)=>{cL.init(e,t),v$.init(e,t),e.gt=(t,r)=>e.check(pg(t,r)),e.gte=(t,r)=>e.check(py(t,r)),e.min=(t,r)=>e.check(py(t,r)),e.lt=(t,r)=>e.check(pm(t,r)),e.lte=(t,r)=>e.check(pf(t,r)),e.max=(t,r)=>e.check(pf(t,r)),e.int=t=>e.check(bu(t)),e.safe=t=>e.check(bu(t)),e.positive=t=>e.check(pg(0,t)),e.nonnegative=t=>e.check(py(0,t)),e.negative=t=>e.check(pm(0,t)),e.nonpositive=t=>e.check(pf(0,t)),e.multipleOf=(t,r)=>e.check(p$(t,r)),e.step=(t,r)=>e.check(p$(t,r)),e.finite=()=>e;let r=e._zod.bag;e.minValue=Math.max(r.minimum??-1/0,r.exclusiveMinimum??-1/0)??null,e.maxValue=Math.min(r.maximum??1/0,r.exclusiveMaximum??1/0)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function bo(e){return d1(bs,e)}let bl=lr("ZodNumberFormat",(e,t)=>{cU.init(e,t),bs.init(e,t)});function bu(e){return d2(bl,e)}function bc(e){return d6(bl,e)}function bd(e){return d9(bl,e)}function bp(e){return d5(bl,e)}function bh(e){return d3(bl,e)}let bm=lr("ZodBoolean",(e,t)=>{cz.init(e,t),v$.init(e,t)});function bf(e){return d8(bm,e)}let bg=lr("ZodBigInt",(e,t)=>{cM.init(e,t),v$.init(e,t),e.gte=(t,r)=>e.check(py(t,r)),e.min=(t,r)=>e.check(py(t,r)),e.gt=(t,r)=>e.check(pg(t,r)),e.gte=(t,r)=>e.check(py(t,r)),e.min=(t,r)=>e.check(py(t,r)),e.lt=(t,r)=>e.check(pm(t,r)),e.lte=(t,r)=>e.check(pf(t,r)),e.max=(t,r)=>e.check(pf(t,r)),e.positive=t=>e.check(pg(BigInt(0),t)),e.negative=t=>e.check(pm(BigInt(0),t)),e.nonpositive=t=>e.check(pf(BigInt(0),t)),e.nonnegative=t=>e.check(py(BigInt(0),t)),e.multipleOf=(t,r)=>e.check(p$(t,r));let r=e._zod.bag;e.minValue=r.minimum??null,e.maxValue=r.maximum??null,e.format=r.format??null});function by(e){return pe(bg,e)}let b_=lr("ZodBigIntFormat",(e,t)=>{cD.init(e,t),bg.init(e,t)});function bv(e){return pr(b_,e)}function bb(e){return pi(b_,e)}let bw=lr("ZodSymbol",(e,t)=>{cZ.init(e,t),v$.init(e,t)});function b$(e){return pn(bw,e)}let bx=lr("ZodUndefined",(e,t)=>{cF.init(e,t),v$.init(e,t)});function bk(e){return pa(bx,e)}let bI=lr("ZodNull",(e,t)=>{cB.init(e,t),v$.init(e,t)});function bO(e){return ps(bI,e)}let bS=lr("ZodAny",(e,t)=>{cq.init(e,t),v$.init(e,t)});function bE(){return po(bS)}let bT=lr("ZodUnknown",(e,t)=>{cW.init(e,t),v$.init(e,t)});function bA(){return pl(bT)}let bN=lr("ZodNever",(e,t)=>{cJ.init(e,t),v$.init(e,t)});function bC(e){return pu(bN,e)}let bP=lr("ZodVoid",(e,t)=>{cG.init(e,t),v$.init(e,t)});function bj(e){return pc(bP,e)}let bR=lr("ZodDate",(e,t)=>{cH.init(e,t),v$.init(e,t),e.min=(t,r)=>e.check(py(t,r)),e.max=(t,r)=>e.check(pf(t,r));let r=e._zod.bag;e.minDate=r.minimum?new Date(r.minimum):null,e.maxDate=r.maximum?new Date(r.maximum):null});function bL(e){return pd(bR,e)}let bU=lr("ZodArray",(e,t)=>{cK.init(e,t),v$.init(e,t),e.element=t.element,e.min=(t,r)=>e.check(pS(t,r)),e.nonempty=t=>e.check(pS(1,t)),e.max=(t,r)=>e.check(pO(t,r)),e.length=(t,r)=>e.check(pE(t,r)),e.unwrap=()=>e.element});function bz(e,t){return pF(bU,e,t)}function bM(e){return b7(Object.keys(e._zod.def.shape))}let bD=lr("ZodObject",(e,t)=>{cQ.init(e,t),v$.init(e,t),hd.defineLazy(e,"shape",()=>t.shape),e.keyof=()=>b5(Object.keys(e._zod.def.shape)),e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:bA()}),e.loose=()=>e.clone({...e._zod.def,catchall:bA()}),e.strict=()=>e.clone({...e._zod.def,catchall:bC()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>hd.extend(e,t),e.merge=t=>hd.merge(e,t),e.pick=t=>hd.pick(e,t),e.omit=t=>hd.omit(e,t),e.partial=(...t)=>hd.partial(wn,e,t[0]),e.required=(...t)=>hd.required(wh,e,t[0])});function bZ(e,t){return new bD({type:"object",get shape(){return hd.assignProp(this,"shape",{...e}),this.shape},...hd.normalizeParams(t)})}function bF(e,t){return new bD({type:"object",get shape(){return hd.assignProp(this,"shape",{...e}),this.shape},catchall:bC(),...hd.normalizeParams(t)})}function bB(e,t){return new bD({type:"object",get shape(){return hd.assignProp(this,"shape",{...e}),this.shape},catchall:bA(),...hd.normalizeParams(t)})}let bq=lr("ZodUnion",(e,t)=>{c1.init(e,t),v$.init(e,t),e.options=t.options});function bW(e,t){return new bq({type:"union",options:e,...hd.normalizeParams(t)})}let bJ=lr("ZodDiscriminatedUnion",(e,t)=>{bq.init(e,t),c4.init(e,t)});function bG(e,t,r){return new bJ({type:"union",options:t,discriminator:e,...hd.normalizeParams(r)})}let bH=lr("ZodIntersection",(e,t)=>{c2.init(e,t),v$.init(e,t)});function bV(e,t){return new bH({type:"intersection",left:e,right:t})}let bK=lr("ZodTuple",(e,t)=>{c9.init(e,t),v$.init(e,t),e.rest=t=>e.clone({...e._zod.def,rest:t})});function bX(e,t,r){let i=t instanceof cs,n=i?r:t;return new bK({type:"tuple",items:e,rest:i?t:null,...hd.normalizeParams(n)})}let bY=lr("ZodRecord",(e,t)=>{c3.init(e,t),v$.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function bQ(e,t,r){return new bY({type:"record",keyType:e,valueType:t,...hd.normalizeParams(r)})}function b0(e,t,r){return new bY({type:"record",keyType:bW([e,bC()]),valueType:t,...hd.normalizeParams(r)})}let b1=lr("ZodMap",(e,t)=>{c8.init(e,t),v$.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function b4(e,t,r){return new b1({type:"map",keyType:e,valueType:t,...hd.normalizeParams(r)})}let b2=lr("ZodSet",(e,t)=>{de.init(e,t),v$.init(e,t),e.min=(...t)=>e.check(pk(...t)),e.nonempty=t=>e.check(pk(1,t)),e.max=(...t)=>e.check(px(...t)),e.size=(...t)=>e.check(pI(...t))});function b6(e,t){return new b2({type:"set",valueType:e,...hd.normalizeParams(t)})}let b9=lr("ZodEnum",(e,t)=>{dr.init(e,t),v$.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);let r=new Set(Object.keys(t.entries));e.extract=(e,i)=>{let n={};for(let i of e)if(r.has(i))n[i]=t.entries[i];else throw Error(`Key ${i} not found in enum`);return new b9({...t,checks:[],...hd.normalizeParams(i),entries:n})},e.exclude=(e,i)=>{let n={...t.entries};for(let t of e)if(r.has(t))delete n[t];else throw Error(`Key ${t} not found in enum`);return new b9({...t,checks:[],...hd.normalizeParams(i),entries:n})}});function b5(e,t){return new b9({type:"enum",entries:Array.isArray(e)?Object.fromEntries(e.map(e=>[e,e])):e,...hd.normalizeParams(t)})}function b3(e,t){return new b9({type:"enum",entries:e,...hd.normalizeParams(t)})}let b8=lr("ZodLiteral",(e,t)=>{di.init(e,t),v$.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function b7(e,t){return new b8({type:"literal",values:Array.isArray(e)?e:[e],...hd.normalizeParams(t)})}let we=lr("ZodFile",(e,t)=>{dn.init(e,t),v$.init(e,t),e.min=(t,r)=>e.check(pk(t,r)),e.max=(t,r)=>e.check(px(t,r)),e.mime=(t,r)=>e.check(pL(Array.isArray(t)?t:[t],r))});function wt(e){return pQ(we,e)}let wr=lr("ZodTransform",(e,t)=>{da.init(e,t),v$.init(e,t),e._zod.parse=(r,i)=>{r.addIssue=i=>{"string"==typeof i?r.issues.push(hd.issue(i,r.value,t)):(i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=e),i.continue??(i.continue=!0),r.issues.push(hd.issue(i)))};let n=t.transform(r.value,r);return n instanceof Promise?n.then(e=>(r.value=e,r)):(r.value=n,r)}});function wi(e){return new wr({type:"transform",transform:e})}let wn=lr("ZodOptional",(e,t)=>{ds.init(e,t),v$.init(e,t),e.unwrap=()=>e._zod.def.innerType});function wa(e){return new wn({type:"optional",innerType:e})}let ws=lr("ZodNullable",(e,t)=>{dl.init(e,t),v$.init(e,t),e.unwrap=()=>e._zod.def.innerType});function wo(e){return new ws({type:"nullable",innerType:e})}function wl(e){return wa(wo(e))}let wu=lr("ZodDefault",(e,t)=>{du.init(e,t),v$.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function wc(e,t){return new wu({type:"default",innerType:e,get defaultValue(){return"function"==typeof t?t():t}})}let wd=lr("ZodPrefault",(e,t)=>{dd.init(e,t),v$.init(e,t),e.unwrap=()=>e._zod.def.innerType});function wp(e,t){return new wd({type:"prefault",innerType:e,get defaultValue(){return"function"==typeof t?t():t}})}let wh=lr("ZodNonOptional",(e,t)=>{dp.init(e,t),v$.init(e,t),e.unwrap=()=>e._zod.def.innerType});function wm(e,t){return new wh({type:"nonoptional",innerType:e,...hd.normalizeParams(t)})}let wf=lr("ZodSuccess",(e,t)=>{dm.init(e,t),v$.init(e,t),e.unwrap=()=>e._zod.def.innerType});function wg(e){return new wf({type:"success",innerType:e})}let wy=lr("ZodCatch",(e,t)=>{df.init(e,t),v$.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function w_(e,t){return new wy({type:"catch",innerType:e,catchValue:"function"==typeof t?t:()=>t})}let wv=lr("ZodNaN",(e,t)=>{dg.init(e,t),v$.init(e,t)});function wb(e){return ph(wv,e)}let ww=lr("ZodPipe",(e,t)=>{dy.init(e,t),v$.init(e,t),e.in=t.in,e.out=t.out});function w$(e,t){return new ww({type:"pipe",in:e,out:t})}let wx=lr("ZodReadonly",(e,t)=>{dv.init(e,t),v$.init(e,t)});function wk(e){return new wx({type:"readonly",innerType:e})}let wI=lr("ZodTemplateLiteral",(e,t)=>{dw.init(e,t),v$.init(e,t)});function wO(e,t){return new wI({type:"template_literal",parts:e,...hd.normalizeParams(t)})}let wS=lr("ZodLazy",(e,t)=>{dx.init(e,t),v$.init(e,t),e.unwrap=()=>e._zod.def.getter()});function wE(e){return new wS({type:"lazy",getter:e})}let wT=lr("ZodPromise",(e,t)=>{d$.init(e,t),v$.init(e,t),e.unwrap=()=>e._zod.def.innerType});function wA(e){return new wT({type:"promise",innerType:e})}let wN=lr("ZodCustom",(e,t)=>{dk.init(e,t),v$.init(e,t)});function wC(e){let t=new uE({check:"custom"});return t._zod.check=e,t}function wP(e,t){return hr(wN,e??(()=>!0),t)}function wj(e,t={}){return hi(wN,e,t)}function wR(e){let t=wC(r=>(r.addIssue=e=>{"string"==typeof e?r.issues.push(hd.issue(e,r.value,t._zod.def)):(e.fatal&&(e.continue=!1),e.code??(e.code="custom"),e.input??(e.input=r.value),e.inst??(e.inst=t),e.continue??(e.continue=!t._zod.def.abort),r.issues.push(hd.issue(e)))},e(r.value,r)));return t}function wL(e,t={error:`Input not instance of ${e.name}`}){let r=new wN({type:"custom",check:"custom",fn:t=>t instanceof e,abort:!0,...hd.normalizeParams(t)});return r._zod.bag.Class=e,r}let wU=(...e)=>hn({Pipe:ww,Boolean:bm,String:vk,Transform:wr},...e);function wz(e){let t=wE(()=>bW([vI(e),bo(),bf(),bO(),bz(t),bQ(vI(),t)]));return t}function wM(e,t){return w$(wi(e),t)}e.i(7855),e.s([],64328),e.i(64328),e.s(["endsWith",()=>pj,"gt",()=>pg,"gte",()=>py,"includes",()=>pC,"length",()=>pE,"lowercase",()=>pA,"lt",()=>pm,"lte",()=>pf,"maxLength",()=>pO,"maxSize",()=>px,"mime",()=>pL,"minLength",()=>pS,"minSize",()=>pk,"multipleOf",()=>p$,"negative",()=>pv,"nonnegative",()=>pw,"nonpositive",()=>pb,"normalize",()=>pz,"overwrite",()=>pU,"positive",()=>p_,"property",()=>pR,"regex",()=>pT,"size",()=>pI,"startsWith",()=>pP,"toLowerCase",()=>pD,"toUpperCase",()=>pZ,"trim",()=>pM,"uppercase",()=>pN],85648),e.i(85648),e.i(15874),e.i(48804);let wD={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"};function wZ(e){ls({customError:e})}function wF(){return ls().customError}e.s(["ZodIssueCode",0,wD,"getErrorMap",()=>wF,"setErrorMap",()=>wZ],33137),e.i(33137),e.s(["$brand",0,li,"ZodIssueCode",0,wD,"config",()=>ls,"getErrorMap",()=>wF,"setErrorMap",()=>wZ],63203),e.i(63203);var wB=e.i(51047);function wq(e){return dS(vk,e)}function wW(e){return d4(bs,e)}function wJ(e){return d7(bm,e)}function wG(e){return pt(bg,e)}function wH(e){return pp(bR,e)}e.s(["bigint",()=>wG,"boolean",()=>wJ,"date",()=>wH,"number",()=>wW,"string",()=>wq],34512);var wV=e.i(34512);e.s(["$brand",0,li,"$input",0,ho,"$output",0,hs,"NEVER",0,lt,"TimePrecision",0,dK,"ZodAny",0,bS,"ZodArray",0,bU,"ZodBase64",0,v5,"ZodBase64URL",0,v8,"ZodBigInt",0,bg,"ZodBigIntFormat",0,b_,"ZodBoolean",0,bm,"ZodCIDRv4",0,v4,"ZodCIDRv6",0,v6,"ZodCUID",0,vF,"ZodCUID2",0,vq,"ZodCatch",0,wy,"ZodCustom",0,wN,"ZodCustomStringFormat",0,bn,"ZodDate",0,bR,"ZodDefault",0,wu,"ZodDiscriminatedUnion",0,bJ,"ZodE164",0,be,"ZodEmail",0,vS,"ZodEmoji",0,vz,"ZodEnum",0,b9,"ZodError",0,vg,"ZodFile",0,we,"ZodGUID",0,vT,"ZodIPv4",0,vY,"ZodIPv6",0,v0,"ZodISODate",0,vu,"ZodISODateTime",0,vo,"ZodISODuration",0,vh,"ZodISOTime",0,vd,"ZodIntersection",0,bH,"ZodIssueCode",0,wD,"ZodJWT",0,br,"ZodKSUID",0,vK,"ZodLazy",0,wS,"ZodLiteral",0,b8,"ZodMap",0,b1,"ZodNaN",0,wv,"ZodNanoID",0,vD,"ZodNever",0,bN,"ZodNonOptional",0,wh,"ZodNull",0,bI,"ZodNullable",0,ws,"ZodNumber",0,bs,"ZodNumberFormat",0,bl,"ZodObject",0,bD,"ZodOptional",0,wn,"ZodPipe",0,ww,"ZodPrefault",0,wd,"ZodPromise",0,wT,"ZodReadonly",0,wx,"ZodRealError",0,vy,"ZodRecord",0,bY,"ZodSet",0,b2,"ZodString",0,vk,"ZodStringFormat",0,vO,"ZodSuccess",0,wf,"ZodSymbol",0,bw,"ZodTemplateLiteral",0,wI,"ZodTransform",0,wr,"ZodTuple",0,bK,"ZodType",0,v$,"ZodULID",0,vJ,"ZodURL",0,vL,"ZodUUID",0,vN,"ZodUndefined",0,bx,"ZodUnion",0,bq,"ZodUnknown",0,bT,"ZodVoid",0,bP,"ZodXID",0,vH,"_ZodString",0,vx,"_default",()=>wc,"any",()=>bE,"array",()=>bz,"base64",()=>v3,"base64url",()=>v7,"bigint",()=>by,"boolean",()=>bf,"catch",()=>w_,"check",()=>wC,"cidrv4",()=>v2,"cidrv6",()=>v9,"clone",()=>us,"coerce",0,wV,"config",()=>ls,"core",0,vs,"cuid",()=>vB,"cuid2",()=>vW,"custom",()=>wP,"date",()=>bL,"discriminatedUnion",()=>bG,"e164",()=>bt,"email",()=>vE,"emoji",()=>vM,"endsWith",()=>pj,"enum",()=>b5,"file",()=>wt,"flattenError",()=>u4,"float32",()=>bc,"float64",()=>bd,"formatError",()=>u2,"function",()=>vn,"getErrorMap",()=>wF,"globalRegistry",0,hc,"gt",()=>pg,"gte",()=>py,"guid",()=>vA,"includes",()=>pC,"instanceof",()=>wL,"int",()=>bu,"int32",()=>bp,"int64",()=>bv,"intersection",()=>bV,"ipv4",()=>vQ,"ipv6",()=>v1,"iso",0,wB,"json",()=>wz,"jwt",()=>bi,"keyof",()=>bM,"ksuid",()=>vX,"lazy",()=>wE,"length",()=>pE,"literal",()=>b7,"locales",0,vr,"looseObject",()=>bB,"lowercase",()=>pA,"lt",()=>pm,"lte",()=>pf,"map",()=>b4,"maxLength",()=>pO,"maxSize",()=>px,"mime",()=>pL,"minLength",()=>pS,"minSize",()=>pk,"multipleOf",()=>p$,"nan",()=>wb,"nanoid",()=>vZ,"nativeEnum",()=>b3,"negative",()=>pv,"never",()=>bC,"nonnegative",()=>pw,"nonoptional",()=>wm,"nonpositive",()=>pb,"normalize",()=>pz,"null",()=>bO,"nullable",()=>wo,"nullish",()=>wl,"number",()=>bo,"object",()=>bZ,"optional",()=>wa,"overwrite",()=>pU,"parse",0,v_,"parseAsync",0,vv,"partialRecord",()=>b0,"pipe",()=>w$,"positive",()=>p_,"prefault",()=>wp,"preprocess",()=>wM,"prettifyError",()=>u5,"promise",()=>wA,"property",()=>pR,"readonly",()=>wk,"record",()=>bQ,"refine",()=>wj,"regex",()=>pT,"regexes",()=>_7,"registry",()=>hu,"safeParse",0,vb,"safeParseAsync",0,vw,"set",()=>b6,"setErrorMap",()=>wZ,"size",()=>pI,"startsWith",()=>pP,"strictObject",()=>bF,"string",()=>vI,"stringFormat",()=>ba,"stringbool",0,wU,"success",()=>wg,"superRefine",()=>wR,"symbol",()=>b$,"templateLiteral",()=>wO,"toJSONSchema",()=>ga,"toLowerCase",()=>pD,"toUpperCase",()=>pZ,"transform",()=>wi,"treeifyError",()=>u6,"trim",()=>pM,"tuple",()=>bX,"uint32",()=>bh,"uint64",()=>bb,"ulid",()=>vG,"undefined",()=>bk,"union",()=>bW,"unknown",()=>bA,"uppercase",()=>pN,"url",()=>vU,"uuid",()=>vC,"uuidv4",()=>vP,"uuidv6",()=>vj,"uuidv7",()=>vR,"void",()=>bj,"xid",()=>vV],62810);var wK=e.i(62810),wK=wK;iP({},{BaseToolkit:()=>w1,DynamicStructuredTool:()=>w0,DynamicTool:()=>wQ,StructuredTool:()=>wX,Tool:()=>wY,ToolInputParsingException:()=>nZ,isLangChainTool:()=>yo,isRunnableToolLike:()=>ya,isStructuredTool:()=>yn,isStructuredToolParams:()=>ys,tool:()=>w4});var wX=class extends _u{extras;returnDirect=!1;verboseParsingErrors=!1;get lc_namespace(){return["langchain","tools"]}responseFormat="content";defaultConfig;constructor(e){super(e??{}),this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat,this.defaultConfig=e?.defaultConfig??this.defaultConfig,this.metadata=e?.metadata??this.metadata,this.extras=e?.extras??this.extras}async invoke(e,t){let r,i=of(oh(this.defaultConfig,t));return nD(e)?(r=e.args,i={...i,toolCall:e}):r=e,this.call(r,i)}async call(e,t,r){let i,n,a,s,o,l=nD(e)?e.args:e;if(hf(this.schema))try{i=await hb(this.schema,l)}catch(r){let t="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(t=`${t}
Details: ${r.message}`),hM(r)&&(t=`${t}

${wK.prettifyError(r)}`),new nZ(t,JSON.stringify(e))}else{let t=gk(l,this.schema);if(!t.valid){let r="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(r=`${r}
Details: ${t.errors.map(e=>`${e.keywordLocation}: ${e.error}`).join("\n")}`),new nZ(r,JSON.stringify(e))}i=l}let u=s7(t),c=os.configure(u.callbacks,this.callbacks,u.tags||r,this.tags,u.metadata,this.metadata,{verbose:this.verbose}),d=await c?.handleToolStart(this.toJSON(),"string"==typeof e?e:JSON.stringify(e),u.runId,void 0,void 0,void 0,u.runName);delete u.runId;try{n=await this._call(i,d,u)}catch(e){throw await d?.handleToolError(e),e}if("content_and_artifact"===this.responseFormat)if(Array.isArray(n)&&2===n.length)[a,s]=n;else throw Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(n)}`);else a=n;nD(e)&&(o=e.id),!o&&u&&"object"==typeof u&&"toolCall"in u&&null!=u.toolCall&&"object"==typeof u.toolCall&&"id"in u.toolCall&&"string"==typeof u.toolCall.id&&(o=u.toolCall.id);let p=function(e){let{content:t,artifact:r,toolCallId:i,metadata:n}=e;return!i||ng(t)?t:new ny("string"==typeof t||Array.isArray(t)&&t.every(e=>"object"==typeof e)?{status:"success",content:t,artifact:r,tool_call_id:i,name:e.name,metadata:n}:{status:"success",content:function(e){try{return JSON.stringify(e,null,2)??""}catch(t){return`${e}`}}(t),artifact:r,tool_call_id:i,name:e.name,metadata:n})}({content:a,artifact:s,toolCallId:o,name:this.name,metadata:this.metadata});return await d?.handleToolEnd(p),p}},wY=class extends wX{schema=gL.object({input:gL.string().optional()}).transform(e=>e.input);constructor(e){super(e)}call(e,t){return super.call("string"==typeof e||null==e?{input:e}:e,t)}},wQ=class extends wY{static lc_name(){return"DynamicTool"}name;description;func;constructor(e){super(e),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}async call(e,t){let r=s7(t);return void 0===r.runName&&(r.runName=this.name),super.call(e,r)}async _call(e,t,r){return this.func(e,t,r)}},w0=class extends wX{static lc_name(){return"DynamicStructuredTool"}name;description;func;schema;constructor(e){super(e),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}async call(e,t,r){let i=s7(t);return void 0===i.runName&&(i.runName=this.name),super.call(e,i,r)}_call(e,t,r){return this.func(e,t,r)}},w1=class{getTools(){return this.tools}};function w4(e,t){let r=hI(t.schema),i=gS(t.schema);if(!t.schema||r||i)return new wQ({...t,description:t.description??t.schema?.description??`${t.name} tool`,func:async(t,r,i)=>new Promise((n,a)=>{let s=og(i,{callbacks:r?.getChild()});od.runWithConfig(oy(s),async()=>{try{n(e(t,s))}catch(e){a(e)}})})});let n=t.schema,a=t.description??t.schema.description??`${t.name} tool`;return new w0({...t,description:a,schema:n,func:async(t,r,i)=>new Promise((n,a)=>{let s,o=()=>{i?.signal&&s&&i.signal.removeEventListener("abort",s)};i?.signal&&(s=()=>{o(),a(ov(i.signal))},i.signal.addEventListener("abort",s));let l=og(i,{callbacks:r?.getChild()});od.runWithConfig(oy(l),async()=>{try{let r=await e(t,l);if(i?.signal?.aborted)return void o();o(),n(r)}catch(e){o(),a(e)}})})})}e.s([],52914)},94681,e=>{"use strict";function t(e){if(!e)return"UNKNOWN";let t=String(e).toLowerCase().trim();return["count","low_count","high_count","number","quantity"].includes(t)?"VOLUME":["rate","percentage","ratio","percent","%"].includes(t)?"EFFICIENCY":["milestone","boolean","status","binary","yes/no","yes-no","achieved","completed"].includes(t)?"MILESTONE":["score","value","rating","index","satisfaction"].includes(t)?"PERFORMANCE":["text","narrative","description","qualitative"].includes(t)?"TEXT":"UNKNOWN"}function r(e){switch(e){case"VOLUME":return{category:"VOLUME",gapType:"Quantity Deficit",rootCauseFocus:["Insufficient pipeline or production capacity","Limited funding or resource allocation","Low frequency of activities/events","Reporting lag or data collection delays","Staff/resource availability constraints"],actionArchetype:"Scale Up",antiPattern:null};case"EFFICIENCY":return{category:"EFFICIENCY",gapType:"Quality/Conversion Deficit",rootCauseFocus:["Curriculum relevance and alignment with industry needs","Training quality and delivery effectiveness","Difficulty of standards or assessments","Retention policies and student support","Industry partnership and placement programs"],actionArchetype:"Optimize Quality",antiPattern:'Do NOT suggest "collecting more data" or "scaling data collection" - the data is likely correct, but performance is low'};case"MILESTONE":return{category:"MILESTONE",gapType:"Project Delay",rootCauseFocus:["Bureaucratic bottlenecks and approval delays","Resource or budget availability issues","Stakeholder coordination challenges","Dependency on external approvals","Change management resistance"],actionArchetype:"Intervention",antiPattern:"Do NOT suggest incremental improvements - focus on unblocking specific delays"};case"PERFORMANCE":return{category:"PERFORMANCE",gapType:"Satisfaction/Standard Deficit",rootCauseFocus:["User experience and service delivery quality","Facilities and infrastructure conditions","Process efficiency and responsiveness","Communication and feedback mechanisms","Staff competency and service attitude"],actionArchetype:"Root Cause Analysis",antiPattern:"Do NOT assume the issue without user feedback data - investigate surveys and feedback first"};case"TEXT":return{category:"TEXT",gapType:"Qualitative Context",rootCauseFocus:["Narrative completeness and clarity","Key themes and patterns","Sentiment and stakeholder perspectives"],actionArchetype:"Summarize",antiPattern:"Do NOT apply numeric gap analysis to text-based metrics"};default:return{category:"UNKNOWN",gapType:"Standard Variance",rootCauseFocus:["General performance review required"],actionArchetype:"Standard Analysis",antiPattern:null}}}function i(e){let i=t(e),n=r(i),a=n.rootCauseFocus.map((e,t)=>`   ${t+1}. ${e}`).join("\n"),s=n.antiPattern?`
 WARNING: ${n.antiPattern}`:"";switch(i){case"VOLUME":return`
[LOGIC RULE: VOLUME METRIC]
Since this KPI is a COUNT/VOLUME type:
1. Interpret any gap as a QUANTITY DEFICIT - not enough outputs are being produced.
2. Potential root causes to investigate:
${a}
3. Recommended action archetype: "${n.actionArchetype}"
   - Suggest increasing frequency of activities
   - Suggest allocating more resources/funding
   - Suggest batch-processing or fixing reporting backlogs
   - Suggest hiring/training more staff if capacity is limited
${s}
`;case"EFFICIENCY":return`
[LOGIC RULE: EFFICIENCY/QUALITY METRIC]
Since this KPI is a RATE/PERCENTAGE type:
1. Interpret any gap as a QUALITY/CONVERSION DEFICIT - outcomes are poor despite activity.
   Example: If employment rate is low, students ARE graduating but are NOT getting hired.
   Example: If passing rate is low, students ARE taking exams but are NOT passing.
2. Potential root causes to investigate:
${a}
3. Recommended action archetype: "${n.actionArchetype}"
   - Focus on curriculum review and industry alignment
   - Suggest skills training and competency enhancement
   - Recommend retention and support programs
   - Consider industry partnership improvements
${s}

CRITICAL: A low percentage does NOT mean "reporting problems" or "data collection issues."
The data is likely correct - the ACTUAL PERFORMANCE is the problem.
`;case"MILESTONE":return`
[LOGIC RULE: MILESTONE/STATUS METRIC]
Since this KPI is a MILESTONE/BOOLEAN type:
1. Interpret any gap as a PROJECT DELAY - something is blocked or incomplete.
2. Potential root causes to investigate:
${a}
3. Recommended action archetype: "${n.actionArchetype}"
   - Suggest fast-tracking approvals
   - Recommend task force assignment
   - Suggest budget/resource reallocation
   - Consider executive intervention for critical blockers
${s}
`;case"PERFORMANCE":return`
[LOGIC RULE: PERFORMANCE/SCORE METRIC]
Since this KPI is a SCORE/VALUE type:
1. Interpret any gap as a SATISFACTION/STANDARD DEFICIT - quality perception is low.
2. Potential root causes to investigate:
${a}
3. Recommended action archetype: "${n.actionArchetype}"
   - Conduct user surveys and feedback analysis
   - Review service delivery processes
   - Assess facilities and infrastructure
   - Implement improvement based on feedback data
${s}
`;case"TEXT":return`
[LOGIC RULE: TEXT/QUALITATIVE METRIC]
Since this KPI is a TEXT/NARRATIVE type:
1. This metric requires qualitative analysis, not numeric gap calculation.
2. Focus areas:
${a}
3. Recommended action archetype: "${n.actionArchetype}"
   - Extract key themes and patterns
   - Identify sentiment and stakeholder perspectives
   - Provide narrative summary
${s}
`;default:return`
[LOGIC RULE: STANDARD ANALYSIS]
KPI type not clearly defined. Apply standard variance analysis:
1. Compare actual vs target values
2. Identify the magnitude of the gap
3. Provide general improvement recommendations based on context
`}}function n(e,r){let i=t(r),n=[];if(e.toLowerCase(),"EFFICIENCY"===i){for(let t of[/reporting\s+(bottleneck|backlog|delay|lag)/i,/batch\s+(collection|processing|data)/i,/collect\s+more\s+(data|lists|reports)/i,/scale\s+up\s+(data|collection|reporting)/i,/data\s+collection\s+(delay|issue|problem)/i,/increase\s+(data|reporting)\s+frequency/i])if(t.test(e)){n.push("Anti-pattern detected: Suggesting data collection/reporting fixes for an EFFICIENCY metric. For rate/percentage KPIs, focus on quality improvement (curriculum, training, standards), not data volume.");break}}if("MILESTONE"===i){for(let t of[/gradual(ly)?\s+improve/i,/incremental\s+(improvement|progress|change)/i,/slow(ly)?\s+increase/i])if(t.test(e)){n.push("Anti-pattern detected: Suggesting incremental improvements for a MILESTONE metric. For milestone/status KPIs, focus on unblocking specific delays through intervention.");break}}return{isValid:0===n.length,warnings:n}}e.s(["generateTypeSpecificLogicInstruction",()=>i,"getGapInterpretation",()=>r,"getKpiTypeCategory",()=>t,"validatePrescriptiveAnalysis",()=>n])}];

//# sourceMappingURL=_01c58546._.js.map