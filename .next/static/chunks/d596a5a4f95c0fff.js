(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,8971,e=>{"use strict";var t=e.i(43476),r=e.i(71645),i=e.i(18566),a=e.i(91432),n=e.i(63780),s=e.i(67881),l=e.i(70065),o=e.i(31278),c=e.i(73375),d=e.i(30374),u=e.i(48425),p=e.i(96626),m=e.i(30030),h=e.i(20783),f=e.i(30207),g=e.i(86318),v=e.i(34620),x=e.i(70152),b=e.i(81140),y="ScrollArea",[w,j]=(0,m.createContextScope)(y),[N,S]=w(y),A=r.forwardRef((e,i)=>{let{__scopeScrollArea:a,type:n="hover",dir:s,scrollHideDelay:l=600,...o}=e,[c,d]=r.useState(null),[p,m]=r.useState(null),[f,v]=r.useState(null),[x,b]=r.useState(null),[y,w]=r.useState(null),[j,S]=r.useState(0),[A,R]=r.useState(0),[C,E]=r.useState(!1),[I,T]=r.useState(!1),P=(0,h.useComposedRefs)(i,e=>d(e)),k=(0,g.useDirection)(s);return(0,t.jsx)(N,{scope:a,type:n,dir:k,scrollHideDelay:l,scrollArea:c,viewport:p,onViewportChange:m,content:f,onContentChange:v,scrollbarX:x,onScrollbarXChange:b,scrollbarXEnabled:C,onScrollbarXEnabledChange:E,scrollbarY:y,onScrollbarYChange:w,scrollbarYEnabled:I,onScrollbarYEnabledChange:T,onCornerWidthChange:S,onCornerHeightChange:R,children:(0,t.jsx)(u.Primitive.div,{dir:k,...o,ref:P,style:{position:"relative","--radix-scroll-area-corner-width":j+"px","--radix-scroll-area-corner-height":A+"px",...e.style}})})});A.displayName=y;var R="ScrollAreaViewport",C=r.forwardRef((e,i)=>{let{__scopeScrollArea:a,children:n,nonce:s,...l}=e,o=S(R,a),c=r.useRef(null),d=(0,h.useComposedRefs)(i,c,o.onViewportChange);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),(0,t.jsx)(u.Primitive.div,{"data-radix-scroll-area-viewport":"",...l,ref:d,style:{overflowX:o.scrollbarXEnabled?"scroll":"hidden",overflowY:o.scrollbarYEnabled?"scroll":"hidden",...e.style},children:(0,t.jsx)("div",{ref:o.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});C.displayName=R;var E="ScrollAreaScrollbar",I=r.forwardRef((e,i)=>{let{forceMount:a,...n}=e,s=S(E,e.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:o}=s,c="horizontal"===e.orientation;return r.useEffect(()=>(c?l(!0):o(!0),()=>{c?l(!1):o(!1)}),[c,l,o]),"hover"===s.type?(0,t.jsx)(T,{...n,ref:i,forceMount:a}):"scroll"===s.type?(0,t.jsx)(P,{...n,ref:i,forceMount:a}):"auto"===s.type?(0,t.jsx)(k,{...n,ref:i,forceMount:a}):"always"===s.type?(0,t.jsx)(K,{...n,ref:i}):null});I.displayName=E;var T=r.forwardRef((e,i)=>{let{forceMount:a,...n}=e,s=S(E,e.__scopeScrollArea),[l,o]=r.useState(!1);return r.useEffect(()=>{let e=s.scrollArea,t=0;if(e){let r=()=>{window.clearTimeout(t),o(!0)},i=()=>{t=window.setTimeout(()=>o(!1),s.scrollHideDelay)};return e.addEventListener("pointerenter",r),e.addEventListener("pointerleave",i),()=>{window.clearTimeout(t),e.removeEventListener("pointerenter",r),e.removeEventListener("pointerleave",i)}}},[s.scrollArea,s.scrollHideDelay]),(0,t.jsx)(p.Presence,{present:a||l,children:(0,t.jsx)(k,{"data-state":l?"visible":"hidden",...n,ref:i})})}),P=r.forwardRef((e,i)=>{var a;let{forceMount:n,...s}=e,l=S(E,e.__scopeScrollArea),o="horizontal"===e.orientation,c=J(()=>u("SCROLL_END"),100),[d,u]=(a={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},r.useReducer((e,t)=>a[e][t]??e,"hidden"));return r.useEffect(()=>{if("idle"===d){let e=window.setTimeout(()=>u("HIDE"),l.scrollHideDelay);return()=>window.clearTimeout(e)}},[d,l.scrollHideDelay,u]),r.useEffect(()=>{let e=l.viewport,t=o?"scrollLeft":"scrollTop";if(e){let r=e[t],i=()=>{let i=e[t];r!==i&&(u("SCROLL"),c()),r=i};return e.addEventListener("scroll",i),()=>e.removeEventListener("scroll",i)}},[l.viewport,o,u,c]),(0,t.jsx)(p.Presence,{present:n||"hidden"!==d,children:(0,t.jsx)(K,{"data-state":"hidden"===d?"hidden":"visible",...s,ref:i,onPointerEnter:(0,b.composeEventHandlers)(e.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:(0,b.composeEventHandlers)(e.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),k=r.forwardRef((e,i)=>{let a=S(E,e.__scopeScrollArea),{forceMount:n,...s}=e,[l,o]=r.useState(!1),c="horizontal"===e.orientation,d=J(()=>{if(a.viewport){let e=a.viewport.offsetWidth<a.viewport.scrollWidth,t=a.viewport.offsetHeight<a.viewport.scrollHeight;o(c?e:t)}},10);return G(a.viewport,d),G(a.content,d),(0,t.jsx)(p.Presence,{present:n||l,children:(0,t.jsx)(K,{"data-state":l?"visible":"hidden",...s,ref:i})})}),K=r.forwardRef((e,i)=>{let{orientation:a="vertical",...n}=e,s=S(E,e.__scopeScrollArea),l=r.useRef(null),o=r.useRef(0),[c,d]=r.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=V(c.viewport,c.content),p={...n,sizes:c,onSizesChange:d,hasThumb:!!(u>0&&u<1),onThumbChange:e=>l.current=e,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:e=>o.current=e};function m(e,t){return function(e,t,r,i="ltr"){let a=q(r),n=t||a/2,s=r.scrollbar.paddingStart+n,l=r.scrollbar.size-r.scrollbar.paddingEnd-(a-n),o=r.content-r.viewport;return X([s,l],"ltr"===i?[0,o]:[-1*o,0])(e)}(e,o.current,c,t)}return"horizontal"===a?(0,t.jsx)(D,{...p,ref:i,onThumbPositionChange:()=>{if(s.viewport&&l.current){let e=Y(s.viewport.scrollLeft,c,s.dir);l.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{s.viewport&&(s.viewport.scrollLeft=e)},onDragScroll:e=>{s.viewport&&(s.viewport.scrollLeft=m(e,s.dir))}}):"vertical"===a?(0,t.jsx)(L,{...p,ref:i,onThumbPositionChange:()=>{if(s.viewport&&l.current){let e=Y(s.viewport.scrollTop,c);l.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{s.viewport&&(s.viewport.scrollTop=e)},onDragScroll:e=>{s.viewport&&(s.viewport.scrollTop=m(e))}}):null}),D=r.forwardRef((e,i)=>{let{sizes:a,onSizesChange:n,...s}=e,l=S(E,e.__scopeScrollArea),[o,c]=r.useState(),d=r.useRef(null),u=(0,h.useComposedRefs)(i,d,l.onScrollbarXChange);return r.useEffect(()=>{d.current&&c(getComputedStyle(d.current))},[d]),(0,t.jsx)(F,{"data-orientation":"horizontal",...s,ref:u,sizes:a,style:{bottom:0,left:"rtl"===l.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===l.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":q(a)+"px",...e.style},onThumbPointerDown:t=>e.onThumbPointerDown(t.x),onDragScroll:t=>e.onDragScroll(t.x),onWheelScroll:(t,r)=>{if(l.viewport){var i,a;let n=l.viewport.scrollLeft+t.deltaX;e.onWheelScroll(n),i=n,a=r,i>0&&i<a&&t.preventDefault()}},onResize:()=>{d.current&&l.viewport&&o&&n({content:l.viewport.scrollWidth,viewport:l.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:W(o.paddingLeft),paddingEnd:W(o.paddingRight)}})}})}),L=r.forwardRef((e,i)=>{let{sizes:a,onSizesChange:n,...s}=e,l=S(E,e.__scopeScrollArea),[o,c]=r.useState(),d=r.useRef(null),u=(0,h.useComposedRefs)(i,d,l.onScrollbarYChange);return r.useEffect(()=>{d.current&&c(getComputedStyle(d.current))},[d]),(0,t.jsx)(F,{"data-orientation":"vertical",...s,ref:u,sizes:a,style:{top:0,right:"ltr"===l.dir?0:void 0,left:"rtl"===l.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":q(a)+"px",...e.style},onThumbPointerDown:t=>e.onThumbPointerDown(t.y),onDragScroll:t=>e.onDragScroll(t.y),onWheelScroll:(t,r)=>{if(l.viewport){var i,a;let n=l.viewport.scrollTop+t.deltaY;e.onWheelScroll(n),i=n,a=r,i>0&&i<a&&t.preventDefault()}},onResize:()=>{d.current&&l.viewport&&o&&n({content:l.viewport.scrollHeight,viewport:l.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:W(o.paddingTop),paddingEnd:W(o.paddingBottom)}})}})}),[$,z]=w(E),F=r.forwardRef((e,i)=>{let{__scopeScrollArea:a,sizes:n,hasThumb:s,onThumbChange:l,onThumbPointerUp:o,onThumbPointerDown:c,onThumbPositionChange:d,onDragScroll:p,onWheelScroll:m,onResize:g,...v}=e,x=S(E,a),[y,w]=r.useState(null),j=(0,h.useComposedRefs)(i,e=>w(e)),N=r.useRef(null),A=r.useRef(""),R=x.viewport,C=n.content-n.viewport,I=(0,f.useCallbackRef)(m),T=(0,f.useCallbackRef)(d),P=J(g,10);function k(e){N.current&&p({x:e.clientX-N.current.left,y:e.clientY-N.current.top})}return r.useEffect(()=>{let e=e=>{let t=e.target;y?.contains(t)&&I(e,C)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})},[R,y,C,I]),r.useEffect(T,[n,T]),G(y,P),G(x.content,P),(0,t.jsx)($,{scope:a,scrollbar:y,hasThumb:s,onThumbChange:(0,f.useCallbackRef)(l),onThumbPointerUp:(0,f.useCallbackRef)(o),onThumbPositionChange:T,onThumbPointerDown:(0,f.useCallbackRef)(c),children:(0,t.jsx)(u.Primitive.div,{...v,ref:j,style:{position:"absolute",...v.style},onPointerDown:(0,b.composeEventHandlers)(e.onPointerDown,e=>{0===e.button&&(e.target.setPointerCapture(e.pointerId),N.current=y.getBoundingClientRect(),A.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",x.viewport&&(x.viewport.style.scrollBehavior="auto"),k(e))}),onPointerMove:(0,b.composeEventHandlers)(e.onPointerMove,k),onPointerUp:(0,b.composeEventHandlers)(e.onPointerUp,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=A.current,x.viewport&&(x.viewport.style.scrollBehavior=""),N.current=null})})})}),_="ScrollAreaThumb",O=r.forwardRef((e,r)=>{let{forceMount:i,...a}=e,n=z(_,e.__scopeScrollArea);return(0,t.jsx)(p.Presence,{present:i||n.hasThumb,children:(0,t.jsx)(M,{ref:r,...a})})}),M=r.forwardRef((e,i)=>{let{__scopeScrollArea:a,style:n,...s}=e,l=S(_,a),o=z(_,a),{onThumbPositionChange:c}=o,d=(0,h.useComposedRefs)(i,e=>o.onThumbChange(e)),p=r.useRef(void 0),m=J(()=>{p.current&&(p.current(),p.current=void 0)},100);return r.useEffect(()=>{let e=l.viewport;if(e){let t=()=>{m(),p.current||(p.current=Q(e,c),c())};return c(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}},[l.viewport,m,c]),(0,t.jsx)(u.Primitive.div,{"data-state":o.hasThumb?"visible":"hidden",...s,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:(0,b.composeEventHandlers)(e.onPointerDownCapture,e=>{let t=e.target.getBoundingClientRect(),r=e.clientX-t.left,i=e.clientY-t.top;o.onThumbPointerDown({x:r,y:i})}),onPointerUp:(0,b.composeEventHandlers)(e.onPointerUp,o.onThumbPointerUp)})});O.displayName=_;var H="ScrollAreaCorner",B=r.forwardRef((e,r)=>{let i=S(H,e.__scopeScrollArea),a=!!(i.scrollbarX&&i.scrollbarY);return"scroll"!==i.type&&a?(0,t.jsx)(U,{...e,ref:r}):null});B.displayName=H;var U=r.forwardRef((e,i)=>{let{__scopeScrollArea:a,...n}=e,s=S(H,a),[l,o]=r.useState(0),[c,d]=r.useState(0),p=!!(l&&c);return G(s.scrollbarX,()=>{let e=s.scrollbarX?.offsetHeight||0;s.onCornerHeightChange(e),d(e)}),G(s.scrollbarY,()=>{let e=s.scrollbarY?.offsetWidth||0;s.onCornerWidthChange(e),o(e)}),p?(0,t.jsx)(u.Primitive.div,{...n,ref:i,style:{width:l,height:c,position:"absolute",right:"ltr"===s.dir?0:void 0,left:"rtl"===s.dir?0:void 0,bottom:0,...e.style}}):null});function W(e){return e?parseInt(e,10):0}function V(e,t){let r=e/t;return isNaN(r)?0:r}function q(e){let t=V(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd;return Math.max((e.scrollbar.size-r)*t,18)}function Y(e,t,r="ltr"){let i=q(t),a=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,n=t.scrollbar.size-a,s=t.content-t.viewport,l=(0,x.clamp)(e,"ltr"===r?[0,s]:[-1*s,0]);return X([0,s],[0,n-i])(l)}function X(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];let i=(t[1]-t[0])/(e[1]-e[0]);return t[0]+i*(r-e[0])}}var Q=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},i=0;return!function a(){let n={left:e.scrollLeft,top:e.scrollTop},s=r.left!==n.left,l=r.top!==n.top;(s||l)&&t(),r=n,i=window.requestAnimationFrame(a)}(),()=>window.cancelAnimationFrame(i)};function J(e,t){let i=(0,f.useCallbackRef)(e),a=r.useRef(0);return r.useEffect(()=>()=>window.clearTimeout(a.current),[]),r.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(i,t)},[i,t])}function G(e,t){let r=(0,f.useCallbackRef)(t);(0,v.useLayoutEffect)(()=>{let t=0;if(e){let i=new ResizeObserver(()=>{cancelAnimationFrame(t),t=window.requestAnimationFrame(r)});return i.observe(e),()=>{window.cancelAnimationFrame(t),i.unobserve(e)}}},[e,r])}var Z=e.i(47163);function ee({className:e,children:r,...i}){return(0,t.jsxs)(A,{"data-slot":"scroll-area",className:(0,Z.cn)("relative",e),...i,children:[(0,t.jsx)(C,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:r}),(0,t.jsx)(et,{}),(0,t.jsx)(B,{})]})}function et({className:e,orientation:r="vertical",...i}){return(0,t.jsx)(I,{"data-slot":"scroll-area-scrollbar",orientation:r,className:(0,Z.cn)("flex touch-none p-px transition-colors select-none","vertical"===r&&"h-full w-2.5 border-l border-l-transparent","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent",e),...i,children:(0,t.jsx)(O,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}var er=e.i(20682),ei=e.i(69638),ea=e.i(73884);let en=(0,e.i(75254).default)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var es=e.i(20278),el=e.i(41240),eo=e.i(60865),ec=e.i(23257),ed=e.i(10708),eu=e.i(62870),ep=e.i(27612),em=e.i(78583);function eh({activity:e,editedKRA:r,editedKPI:i,onKRAChange:a,onKPIChange:n,onDelete:s,kraChanged:l,availableKRAs:o=[],availableKPIs:c=[],mismatches:d,kraValidationError:u,kpiValidationError:p}){return(0,t.jsxs)("div",{className:"w-full bg-white rounded-2xl border border-gray-200 p-6 mb-4 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-5",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:e.name})}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("button",{onClick:s,className:"text-gray-300 hover:text-red-500 transition-colors p-1",title:"Delete",children:(0,t.jsx)(ep.Trash2,{className:"w-5 h-5"})})})]}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(ed.Label,{className:"text-xs font-bold text-gray-600 uppercase tracking-wide",children:"KRA Assignment *"}),(0,t.jsxs)(eu.Select,{value:r||e.kraId,onValueChange:a,children:[(0,t.jsx)(eu.SelectTrigger,{className:(0,Z.cn)("w-full mt-1 bg-white border rounded-lg",u?"border-red-500":"border-gray-300"),children:(0,t.jsx)(eu.SelectValue,{placeholder:"Select KRA"})}),(0,t.jsx)(eu.SelectContent,{children:o.map(e=>(0,t.jsxs)(eu.SelectItem,{value:e.id,children:[e.id,": ",e.title]},e.id))})]}),u&&(0,t.jsx)("p",{className:"text-xs text-red-500 mt-1",children:u}),d&&(0,t.jsx)("p",{className:"text-xs text-yellow-600 mt-1",children:"⚠️ Potential KRA mismatch detected"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(ed.Label,{className:"text-xs font-bold text-gray-600 uppercase tracking-wide",children:"KPI Selection"}),(0,t.jsxs)("div",{className:(0,Z.cn)("mt-1 bg-gray-50 rounded-lg border p-3",p?"border-red-500":"border-gray-200"),children:[(0,t.jsxs)(eu.Select,{value:i||e.initiativeId,onValueChange:n,children:[(0,t.jsx)(eu.SelectTrigger,{className:"w-full bg-white border border-gray-300 rounded-md h-auto min-h-[40px] py-2",children:(0,t.jsx)(eu.SelectValue,{placeholder:"Select KPI",children:(i||e.initiativeId)&&(0,t.jsx)("span",{className:"text-left",children:i||e.initiativeId})})}),(0,t.jsx)(eu.SelectContent,{className:"max-h-[300px] overflow-y-auto",children:c.map(e=>(0,t.jsx)(eu.SelectItem,{value:e.id,className:"cursor-pointer",children:(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:e.id}),e.title&&(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-0.5 whitespace-normal max-w-[350px]",children:e.title}),void 0!==e.target&&(0,t.jsxs)("div",{className:"text-xs text-blue-600 font-medium mt-0.5",children:["Target: ",e.target,"percentage"===e.targetType?"%":""]})]})},e.id))})]}),p&&(0,t.jsx)("p",{className:"text-xs text-red-500 mt-1",children:p}),(i||e.initiativeId)&&(0,t.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200 space-y-1",children:[(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,t.jsx)("span",{className:"font-medium text-gray-700",children:"Output:"})," ",c.find(t=>t.id===(i||e.initiativeId))?.title||"N/A"]}),(0,t.jsx)("p",{className:"text-xs",children:(0,t.jsxs)("span",{className:"bg-blue-100 text-blue-700 px-2 py-0.5 rounded font-medium",children:["Target: ",e.target]})})]})]}),l&&(0,t.jsx)("span",{className:"inline-block mt-1 text-xs bg-yellow-100 text-yellow-700 rounded px-2 py-1 font-semibold",children:"Possible Mismatch"})]}),e.evidenceSnippet&&!e.evidenceSnippet.startsWith("Target:")&&e.evidenceSnippet.length>10&&(0,t.jsxs)("div",{children:[(0,t.jsx)(ed.Label,{className:"text-xs font-bold text-gray-600 uppercase tracking-wide",children:"Evidence"}),(0,t.jsxs)("div",{className:"mt-1 flex items-start gap-2 text-xs text-gray-600 bg-gray-50 p-3 rounded border border-dashed border-gray-300",children:[(0,t.jsx)(em.FileText,{className:"w-4 h-4 mt-0.5 shrink-0"}),(0,t.jsxs)("span",{className:"italic",children:['"',e.evidenceSnippet,'"']})]})]})]})})]})}var ef=e.i(82395);function eg(e){if(!e)return"";if("string"!=typeof e){if(Array.isArray(e))return e.map(e=>eg(e)).join("\n");if("object"==typeof e){if(e.action)return`${e.action}${e.timeline?` (${e.timeline})`:""}`;if(e.recommendation)return e.recommendation;try{return JSON.stringify(e)}catch{}}return String(e)}let t=e;try{let e=JSON.parse(t);if(Array.isArray(e))return e.map(e=>"string"==typeof e?e:e?.action?e.action:e?.recommendation?e.recommendation:String(e)).join("\n• ");if("object"==typeof e&&null!==e){if(e.action)return e.action;if(e.recommendation)return e.recommendation}}catch{}return(t=(t=(t=(t=(t=t.replace(/^#{1,3}\s+/gm,"")).replace(/\*\*([^*]+)\*\*/g,"$1")).replace(/\*([^*]+)\*/g,"$1")).replace(/^\["|"\]$/g,"")).replace(/","/g,", ")).trim()}function ev(e){if(!e)return null;let r=e.split("\n").filter(e=>e.trim()),i=[],a=[],n=null,s=()=>{a.length>0&&("numbered"===n?i.push((0,t.jsx)("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:a.map((e,r)=>(0,t.jsx)("li",{children:eg(e)},r))},`ol-${i.length}`)):i.push((0,t.jsx)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:a.map((e,r)=>(0,t.jsx)("li",{children:eg(e)},r))},`ul-${i.length}`)),a=[],n=null)};return r.forEach((e,r)=>{let l=e.trim();if(l.startsWith("###")||l.startsWith("##")||l.startsWith("#")){s();let e=l.replace(/^#{1,3}\s+/,"");i.push((0,t.jsx)("p",{className:"font-semibold mt-3 first:mt-0",children:eg(e)},`h-${r}`));return}let o=l.match(/^\d+\.\s+(.+)/);if(o){"numbered"!==n&&(s(),n="numbered"),a.push(o[1]);return}let c=l.match(/^[-*]\s+(.+)/);if(c){"bullet"!==n&&(s(),n="bullet"),a.push(c[1]);return}s(),l&&i.push((0,t.jsx)("p",{className:"mb-2 last:mb-0",children:eg(l)},`p-${r}`))}),s(),(0,t.jsx)("div",{className:"space-y-2",children:i})}let ex={"KRA 1":["curriculum","curricula","course","program design"],"KRA 2":["market","industry","demand"],"KRA 3":["instruction","teaching","learning","quality","student","employment","graduate"],"KRA 4":["international","mou","moa","global","linkage"],"KRA 5":["research","publication","innovation"],"KRA 6":["research linkage","collaboration","partnership"],"KRA 7":["research resources","funding","laboratory"],"KRA 8":["community","outreach","service"],"KRA 11":["human resources","faculty","staff"],"KRA 12":["international","global","stakeholder"],"KRA 13":["competitive","human resources"],"KRA 14":["satisfaction","satisfaction rating"],"KRA 18":["risk","compliance"],"KRA 19":["revenue","operational","efficiency"],"KRA 22":["financial","resources","budget"]},eb=[{id:"KRA 1",title:"Development of New Curricula Incorporating Emerging Technologies"},{id:"KRA 2",title:"Market-Driven Program Design and Implementation"},{id:"KRA 3",title:"Quality and Relevance of Instruction"},{id:"KRA 4",title:"College and Office International Activities and Projects"},{id:"KRA 5",title:"Research, Extension, and Innovation Productivity"},{id:"KRA 6",title:"Research, Extension, and Innovation Linkages"},{id:"KRA 7",title:"Research, Extension, and Innovation Resources"},{id:"KRA 8",title:"Service to the Community"},{id:"KRA 9",title:"Implementation of Sustainable Governance"},{id:"KRA 10",title:"Transforming into Green University"},{id:"KRA 11",title:"Judicious Management of Human Resources"},{id:"KRA 12",title:"Internationalized/Global University Stakeholders"},{id:"KRA 13",title:"Competitive Human Resources"},{id:"KRA 14",title:"Improved Satisfaction Rating of the Students, Faculty, and Personnel of the University"},{id:"KRA 15",title:"Certification and Compliance to Regulatory Requirements"},{id:"KRA 16",title:"Updating of Learning Materials and Facilities"},{id:"KRA 17",title:"Digital Transformation and Smart Campus Enablement"},{id:"KRA 18",title:"Risk Management and Compliance"},{id:"KRA 19",title:"Revenue Growth and Operational Efficiency"},{id:"KRA 20",title:"Related IGP Industry Engagement"},{id:"KRA 21",title:"Responsive Management of Resources"},{id:"KRA 22",title:"Management of Financial Resources"}];function ey({isOpen:e,onClose:i,analysisId:a,onApprove:n,onReject:l,forceFullPage:c=!1}){let{toast:u}=(0,er.useToast)(),[p,m]=(0,r.useState)(!1),[h,f]=(0,r.useState)(null),[g,v]=(0,r.useState)(null),[x,b]=(0,r.useState)([]),[y,w]=(0,r.useState)(!1),[j,N]=(0,r.useState)(!1),[S,A]=(0,r.useState)(!1),[R,C]=(0,r.useState)(!1),[E,I]=(0,r.useState)(new Set),[T,P]=(0,r.useState)({}),[k,K]=(0,r.useState)({}),[D,L]=(0,r.useState)({}),[$,z]=(0,r.useState)(new Map),[F,_]=(0,r.useState)(!1);(0,r.useEffect)(()=>{a&&(e||c)&&(async()=>{try{let e=await eo.default.getAccessToken(),t=await fetch(`/api/qpro/analyses/${a}`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)return;let r=await t.json(),i=r.activities||[],n=Array.from(new Set(i.map(e=>e.kraId).filter(Boolean))),s=new Map;for(let t of n){let i=r.year||new Date().getFullYear(),a=await fetch(`/api/kpi-progress?kraId=${encodeURIComponent(t)}&year=${i}`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){let e=(await a.json()).data;if(e?.initiatives)for(let t of e.initiatives){let e=t.progress?.filter(e=>e.year===i).reduce((e,t)=>{let r="number"==typeof t.currentValue?t.currentValue:parseFloat(String(t.currentValue))||0;return e+r},0)||0,r=t.progress?.find(e=>e.year===i),a=r?.targetValue||0;s.set(t.id,{current:e,target:"number"==typeof a?a:parseFloat(String(a))||0})}}}z(s)}catch(e){console.error("Error fetching current progress:",e)}})()},[a,e,c]),(0,r.useEffect)(()=>{a&&(e||c)&&M()},[a,e,c]);let O=e=>{if(e.activities&&Array.isArray(e.activities)&&e.activities.length>0)return e.activities.map(e=>({name:e.name||e.title||"Unnamed Activity",kraId:e.kraId||e.kra_id||"",initiativeId:e.initiativeId||e.initiative_id||"",reported:Number(e.reported)||0,target:Number(e.target)||0,achievement:Number(e.achievement)||0,status:"MET"===e.status?"MET":"MISSED",authorizedStrategy:e.authorizedStrategy||"",evidenceSnippet:e.evidenceSnippet||"",confidence:Number(e.confidence)||.75,confidenceScore:Number(e.confidenceScore)||Number(e.confidence)||.75,prescriptiveNote:e.prescriptiveNote||"",prescriptiveAnalysis:e.prescriptiveAnalysis||"",rootCause:e.rootCause||"",aiInsight:e.aiInsight||""}));if(e.organizedActivities&&Array.isArray(e.organizedActivities)){let t=[];return e.organizedActivities.forEach(e=>{let r=e.kraId||"",i=e.kpiId||"";e.activities&&Array.isArray(e.activities)&&e.activities.forEach(e=>{t.push({name:e.title||e.name||"Unnamed Activity",kraId:r,initiativeId:e.initiativeId||i||"",reported:Number(e.reported)||0,target:Number(e.target)||0,achievement:Number(e.achievement)||0,status:"MET"===e.status||Number(e.achievement)>=100?"MET":"MISSED",authorizedStrategy:e.authorizedStrategy||"",evidenceSnippet:e.evidenceSnippet||e.description||"",confidence:Number(e.confidence)||.75,confidenceScore:Number(e.confidenceScore)||Number(e.confidence)||.75,prescriptiveNote:e.prescriptiveNote||"",prescriptiveAnalysis:e.prescriptiveAnalysis||"",rootCause:e.rootCause||"",aiInsight:e.aiInsight||""})})}),t}return[]},M=async()=>{try{m(!0);let e=await eo.default.getAccessToken(),t=await fetch(`/api/qpro/analyses/${a}`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw Error("Failed to fetch analysis");let r=await t.json();v(r),"APPROVED"===r.status&&_(!0);let i=O(r);b(i)}catch(e){f(e instanceof Error?e.message:"An error occurred")}finally{m(!1)}},H=e=>{let t=ec.default.kras.find(t=>t.kra_id===e);if(!t?.initiatives)return[];let r=Number(g?.year)||new Date().getFullYear();return t.initiatives.map(e=>{let t=e.targets?.timeline_data,i=t?.find(e=>e.year===r),a=i?parseFloat(i.target_value):void 0;return{...e,title:e.key_performance_indicator?.outputs||e.key_performance_indicator?.outcomes||e.description||e.id,target:a,targetType:e.targets?.type||"count"}})},B=(e,t,r)=>{let i=[...x];if(i[e]={...i[e],[t]:r},"reported"===t||"target"===t){let a="reported"===t?r:i[e].reported,n="target"===t?r:i[e].target;n>0?(i[e].achievement=a/n*100,i[e].status=i[e].achievement>=100?"MET":"MISSED"):i[e].achievement=0}b(i)},U=()=>{let e={};return x.forEach((t,r)=>{E.has(r)&&!t.initiativeId&&(e[r]="KPI is required for changed KRA")}),L(e),0===Object.keys(e).length},W=e=>{if(!e)return null;if("string"==typeof e)return e;if(Array.isArray(e))return e.map((e,t)=>{if("string"==typeof e)return`${t+1}. ${e}`;if("object"==typeof e){let t=e.title||e.issue||e.name||"",r=e.action||e.nextStep||e.recommendation||"";return t&&r?`**${t}**: ${r}`:t?`- ${t}`:r?`- ${r}`:Object.keys(e).filter(t=>"string"==typeof e[t]).map(t=>`- **${t}**: ${e[t]}`).join("\n")}return String(e)}).join("\n\n");if("object"==typeof e){let t=[];if(e.documentInsight&&t.push(W(e.documentInsight)||""),e.prescriptiveAnalysis&&t.push(W(e.prescriptiveAnalysis)||""),e.summary&&t.push(W(e.summary)||""),e.recommendations&&t.push(W(e.recommendations)||""),e.prescriptiveItems&&t.push(W(e.prescriptiveItems)||""),t.length>0)return t.filter(Boolean).join("\n\n");let r=Object.entries(e).filter(([,e])=>e&&"string"==typeof e);if(r.length>0)return r.map(([e,t])=>`**${e}**: ${t}`).join("\n\n")}return null},V=async()=>{if(0===E.size)return void f("No KRA changes to regenerate");if(!U())return void f("Please select the correct KPI for each changed activity before regenerating.");try{C(!0),f(null),u({title:"Regenerating Insights",description:"Analyzing KPI types and generating fresh recommendations...",duration:3e3});let e=await eo.default.getAccessToken();if(!e)throw Error("Authentication required");let t=x.map((e,t)=>({...e,index:t,userSelectedKPI:!0})).filter(e=>E.has(e.index)),r=await fetch("/api/qpro/regenerate-insights",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({analysisId:a,activities:t})});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to regenerate insights")}let i=await r.json();console.log("[ReviewQProModal] Regeneration successful, refetching fresh analysis data..."),v(e=>({...e||{},...i,_regeneratedAt:new Date().toISOString()})),b(e=>{let r=[...e];return i.activities.forEach(e=>{let i=t.find(t=>t.name===e.name)?.index;void 0!==i&&(r[i]={...r[i],...e})}),r});try{let t=await fetch(`/api/qpro/analyses/${a}`,{headers:{Authorization:`Bearer ${e}`},cache:"no-store"});if(t.ok){let e=await t.json();console.log("[ReviewQProModal] Fresh analysis data retrieved after regeneration"),v(t=>({...t||{},...e,prescriptiveAnalysis:e.prescriptiveAnalysis||i.prescriptiveAnalysis||t?.prescriptiveAnalysis}));let r=O(e);r.length>0&&b(r)}}catch(e){console.warn("[ReviewQProModal] Could not refetch fresh data after regeneration:",e)}I(new Set),f(null),u({title:"✓ Success - Insights Regenerated",description:`${t.length} ${1===t.length?"activity":"activities"} updated with fresh AI analysis and corrected KPI classifications.`,duration:5e3,className:"bg-green-50 border-green-200"})}catch(e){f(e instanceof Error?e.message:"Failed to regenerate insights")}finally{C(!1)}},q=async()=>{try{let e;if(N(!0),f(null),e={},x.forEach((t,r)=>{t.kraId||(e[r]="KRA is required")}),K(e),0!==Object.keys(e).length){f("Please assign a KRA to all activities before approval"),N(!1);return}if(!U()){f("Please select the correct KPI under the corrected KRA before approval"),N(!1);return}let t=await eo.default.getAccessToken();if(!t)throw Error("Authentication required");console.log("[ReviewModal] Saving activity edits before approval...");let r=await fetch(`/api/qpro/analyses/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({activities:x})});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||"Failed to save activity edits. Please try again.")}console.log("[ReviewModal] Activity edits saved successfully, proceeding with approval...");let i=await fetch(`/api/qpro/approve/${a}`,{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(!i.ok){let e=await i.json();throw Error(e.error||"Failed to approve analysis")}console.log("[ReviewModal] Analysis approved successfully"),console.log("[ReviewModal] Calling onApprove callback to trigger page reload..."),n?.()}catch(e){f(e instanceof Error?e.message:"Failed to approve")}finally{N(!1)}},Y=async()=>{try{A(!0),f(null);let e=await eo.default.getAccessToken();if(!e)throw Error("Authentication required");if(!(await fetch(`/api/qpro/approve/${a}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({reason:"Rejected after review"})})).ok)throw Error("Failed to reject analysis");l?.(),i()}catch(e){f(e instanceof Error?e.message:"Failed to reject")}finally{A(!1)}},X=(()=>{let e=x.filter(e=>e.target>0),t=new Map;for(let r of e){let e=String(r.kraId||"").trim(),i=String(r.initiativeId||"").trim();if(!e||!i)continue;let a=`${e}::${i}`;t.has(a)||t.set(a,{kraId:e,initiativeId:i,activities:[]}),t.get(a).activities.push(r)}let r=ec.default.kras||[],i=g?.year||2025,a=[];for(let e of t.values()){let t=(0,ef.getInitiativeTargetMeta)({kras:r},e.kraId,e.initiativeId,i),n="number"==typeof e.activities?.[0]?.target?e.activities[0].target:Number(e.activities?.[0]?.target||0),s=t.targetValue??(Number.isFinite(n)&&n>0?n:0),l=(0,ef.computeAggregatedAchievement)({targetType:t.targetType||e.activities?.[0]?.targetType,targetValue:s,targetScope:t.targetScope,activities:e.activities.map(e=>({reported:e.reported,target:e.target}))}),o=l.achievementPercent;if(e.initiativeId&&$.has(e.initiativeId)){let t=$.get(e.initiativeId),r=t.target||s||1,i=t.current+l.totalReported,a=r>0?i/r*100:0;o=Math.min(a,100),console.log(`[Review] KPI ${e.initiativeId}:`),console.log(`  Current progress: ${t.current}, This document adds: ${l.totalReported}`),console.log(`  New total: ${i}, Target: ${r}, Raw Achievement: ${a.toFixed(1)}%, Displayed: ${o.toFixed(1)}%`)}o>=0&&a.push(o)}let n=a.length>0?a.reduce((e,t)=>e+t,0)/a.length:0,s=e.filter(e=>e.achievement>=100).length,l=e.filter(e=>e.achievement<100).length;return{totalActivities:x.length,metCount:s,missedCount:l,avgAchievement:n}})(),Q=()=>{let e,r,i,a,n,s,l,c;return(0,t.jsx)(t.Fragment,{children:p?(0,t.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,t.jsx)(o.Loader2,{className:"w-6 h-6 animate-spin text-blue-600"}),(0,t.jsx)("span",{className:"ml-2 text-slate-600",children:"Loading analysis..."})]}):h?(0,t.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-red-700",children:h})}):(0,t.jsxs)(t.Fragment,{children:[F&&(0,t.jsx)("div",{className:"p-4 mb-4 bg-amber-50 border border-amber-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-amber-800 font-medium",children:"Only DRAFT analyses can be edited. This analysis is already APPROVED"})}),(0,t.jsxs)("div",{className:"flex justify-center gap-3 mb-4 flex-wrap",children:[(0,t.jsxs)("div",{className:"p-3 bg-blue-50 rounded-lg text-center min-w-[100px]",children:[(0,t.jsxs)("p",{className:"text-2xl font-bold text-blue-700",children:[X.avgAchievement.toFixed(1),"%"]}),(0,t.jsx)("p",{className:"text-xs text-blue-600",children:"Overall Achievement"})]}),(0,t.jsxs)("div",{className:"p-3 bg-slate-50 rounded-lg text-center min-w-[100px]",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:X.totalActivities}),(0,t.jsx)("p",{className:"text-xs text-slate-600",children:"Total Activities"})]})]}),(e=g?W(g.aiInsight||g.documentInsight):null,r=g?W(g.prescriptiveAnalysis):null,a=(i=(()=>{if(!g?.prescriptiveAnalysis||"object"!=typeof g.prescriptiveAnalysis)return[];let e=g.prescriptiveAnalysis.prescriptiveItems;return Array.isArray(e)?e.filter(e=>e&&"object"==typeof e).slice(0,5).map(e=>({title:String(e.title||"").trim(),issue:String(e.issue||"").trim(),action:String(e.action||"").trim(),nextStep:e.nextStep?String(e.nextStep).trim():void 0})).filter(e=>e.title&&e.issue&&e.action):[]})()).length>0?i:r?(function(e){if("string"!=typeof e)return[];let t=e.replace(/\r\n/g,"\n").trim();if(!t)return[];let r=t.split("\n"),i=[],a=null,n=()=>{if(!a)return;let e=String(a.title||"").trim(),t=String(a.issue||"").trim(),r=String(a.action||"").trim(),n=a.nextStep?String(a.nextStep).trim():void 0;e&&t&&r&&i.push({title:e,issue:t,action:r,nextStep:n}),a=null};for(let e of r){let t=e.trim();if(!t)continue;let r=t.match(/^\d+\.\s+(.*)$/);if(r){n(),a={title:r[1].trim()};continue}let i=t.match(/^(?:-\s*)?(Issue|Action|Next\s*Step)\s*:\s*(.*)$/i);if(i&&a){let e=i[1].toLowerCase().replace(/\s+/g,""),t=i[2].trim();"issue"===e&&(a.issue=t),"action"===e&&(a.action=t),"nextstep"===e&&(a.nextStep=t);continue}}return n(),i})(r).slice(0,5):[],s="string"==typeof(n=g?.prescriptiveAnalysis&&"object"==typeof g.prescriptiveAnalysis?g.prescriptiveAnalysis.documentInsight:null)&&n.trim()?n.trim():e||"",c="string"==typeof(l=g?.prescriptiveAnalysis&&"object"==typeof g.prescriptiveAnalysis?g.prescriptiveAnalysis.prescriptiveAnalysis:null)&&l.trim()?l.trim():r||"",s||c||a.length>0?(0,t.jsxs)("div",{className:"space-y-4 mb-4",children:[s&&(0,t.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,t.jsxs)("h4",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2 text-sm",children:[(0,t.jsx)(es.Target,{className:"w-4 h-4"}),"Document Insight"]}),(0,t.jsx)("div",{className:"text-sm text-blue-800 prose prose-sm prose-blue max-w-none",children:ev(s)})]}),(a.length>0||c)&&(0,t.jsxs)("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[(0,t.jsxs)("h4",{className:"font-semibold text-purple-900 mb-2 flex items-center gap-2 text-sm",children:[(0,t.jsx)(el.Lightbulb,{className:"w-4 h-4"}),"Prescriptive Analysis"]}),(0,t.jsx)("div",{className:"text-sm text-purple-800 prose prose-sm prose-purple max-w-none",children:a.length>0?(0,t.jsx)("ol",{className:"list-decimal list-inside space-y-3",children:a.map((e,r)=>(0,t.jsxs)("li",{className:"",children:[(0,t.jsx)("span",{className:"font-semibold text-purple-900",children:e.title}),(0,t.jsxs)("ul",{className:"list-disc ml-6 mt-1 space-y-1",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Issue:"})," ",e.issue]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Action:"})," ",e.action]}),e.nextStep?(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Next Step:"})," ",e.nextStep]}):null]})]},r))}):ev(c)})]})]}):null),(0,t.jsx)(ee,{className:"flex-1",children:(0,t.jsx)("div",{className:"space-y-3 pr-4",children:x.map((e,r)=>(0,t.jsx)(eh,{activity:e,mismatches:T[r],kraValidationError:k[r],kpiValidationError:D[r],availableKRAs:eb,availableKPIs:H(e.kraId),onKRAChange:e=>{let t,i,a,n,s;return(t=[...x])[r]={...t[r],kraId:e,initiativeId:void 0},b(t),(i=new Set(E)).add(r),I(i),a=ex[e]||[],n=t[r].name.toLowerCase(),s=!a.some(e=>n.includes(e)),void P(e=>({...e,[r]:s}))},onKPIChange:e=>{var t;let i,a,n,s;return(i=[...x])[r]={...i[r],initiativeId:e},a=Number(g?.year)||new Date().getFullYear(),t=i[r].kraId,n=e?H(t).find(t=>t.id===e):null,void(null!==(s=((e,t)=>{if(!e)return null;let r=e.find(e=>e.year===t);return r?parseFloat(r.target_value):null})(n?.targets?.timeline_data,a))&&(i[r].target=s,s>0&&(i[r].achievement=i[r].reported/s*100,i[r].status=i[r].achievement>=100?"MET":"MISSED")),b(i))},onReportedChange:e=>B(r,"reported",e),onTargetChange:e=>B(r,"target",e),onDelete:()=>{b(x.filter((e,t)=>t!==r))},kraChanged:E.has(r)},e.name+r))})})]})})},J=()=>(0,t.jsxs)("div",{className:c?"mt-6 gap-2 flex flex-col sm:flex-row":"gap-2 flex flex-col sm:flex-row",children:[E.size>0&&!F&&(0,t.jsx)("div",{className:"sm:col-span-2 md:col-span-3 p-3 bg-blue-50 border border-blue-200 rounded-lg mb-2",children:(0,t.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,t.jsxs)("strong",{children:[E.size," activity update(s) pending."]}),' Click "Regenerate Insights" to update targets and document-level AI analysis based on corrected KRA/KPI selections.']})}),(0,t.jsx)(s.Button,{variant:"outline",onClick:i,disabled:j||S||R,children:"Cancel"}),E.size>0&&!F&&(0,t.jsxs)(s.Button,{onClick:V,disabled:R||y,className:"bg-indigo-600 hover:bg-indigo-700",children:[R?(0,t.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin mr-2"}):(0,t.jsx)(en,{className:"w-4 h-4 mr-2"}),R?"Regenerating...":"Regenerate Insights"]}),(0,t.jsx)(s.Button,{variant:"destructive",onClick:Y,disabled:p||j||S||R||F,children:S?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin mr-2"}),"Rejecting..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ea.XCircle,{className:"w-4 h-4 mr-2"}),"Reject"]})}),(0,t.jsx)(s.Button,{onClick:q,disabled:p||j||S||R||F,className:"bg-green-600 hover:bg-green-700",children:j?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin mr-2"}),"Approving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ei.CheckCircle,{className:"w-4 h-4 mr-2"}),"Approve & Commit"]})})]});return c?(0,t.jsxs)("div",{className:"space-y-6 relative",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(en,{className:"w-5 h-5"}),(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Review QPro Analysis"})]}),R&&(0,t.jsx)("div",{className:"fixed inset-0 bg-white/80 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl border-2 border-indigo-200 p-8 flex flex-col items-center gap-4 max-w-md mx-4",children:[(0,t.jsx)(o.Loader2,{className:"w-12 h-12 animate-spin text-indigo-600"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-xl font-semibold text-slate-900",children:"Regenerating Insights"}),(0,t.jsx)("p",{className:"text-sm text-slate-600 mt-2",children:"Analyzing KPI types and generating fresh recommendations..."}),(0,t.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:"This may take a few moments."})]})]})}),(0,t.jsx)(Q,{}),(0,t.jsx)(J,{})]}):(0,t.jsx)(d.Dialog,{open:!!e,onOpenChange:e=>{e||i()},children:(0,t.jsxs)(d.DialogContent,{className:"w-[95vw] h-[95vh] max-w-[1400px] flex flex-col",children:[(0,t.jsx)(d.DialogHeader,{children:(0,t.jsxs)(d.DialogTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(en,{className:"w-5 h-5"}),"Review QPro Analysis"]})}),R&&(0,t.jsx)("div",{className:"absolute inset-0 bg-white/80 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl border-2 border-indigo-200 p-8 flex flex-col items-center gap-4 max-w-md",children:[(0,t.jsx)(o.Loader2,{className:"w-12 h-12 animate-spin text-indigo-600"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-xl font-semibold text-slate-900",children:"Regenerating Insights"}),(0,t.jsx)("p",{className:"text-sm text-slate-600 mt-2",children:"Analyzing KPI types and generating fresh recommendations..."}),(0,t.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:"This may take a few moments."})]})]})}),(0,t.jsx)(Q,{}),(0,t.jsx)(d.DialogFooter,{className:"mt-4 gap-2 flex flex-col sm:flex-row",children:(0,t.jsx)(J,{})})]})})}function ew(){let e=(0,i.useParams)(),d=(0,i.useRouter)(),{isAuthenticated:u,isLoading:p}=(0,a.useAuth)(),m=e.id;(0,r.useEffect)(()=>{p||u||d.push("/")},[p,u,d]);let h=()=>{d.back()};return p?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)(o.Loader2,{className:"w-8 h-8 animate-spin text-primary"})}):u?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Navbar,{}),(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("div",{className:"border-b bg-card",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Review QPRO Analysis"})})})}),(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(s.Button,{variant:"ghost",onClick:h,className:"gap-2",children:[(0,t.jsx)(c.ChevronLeft,{className:"w-4 h-4"}),"Back"]}),m?(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(ey,{isOpen:!0,onClose:h,analysisId:m,onApprove:()=>{console.log("[Review Page] handleApproveSuccess called - redirecting to QPRO page..."),d.push("/qpro")},forceFullPage:!0})}):(0,t.jsx)(l.Card,{children:(0,t.jsxs)("div",{className:"flex items-start gap-3 p-6",children:[(0,t.jsx)("p",{className:"font-medium text-red-900",children:"Invalid Analysis ID"}),(0,t.jsx)("p",{className:"text-sm text-red-700 mt-1",children:"No analysis ID was provided"})]})})]})})]})]}):null}e.s(["default",()=>ew],8971)}]);